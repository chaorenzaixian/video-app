# è½¬ç æœåŠ¡å™¨è‡ªåŠ¨ä¸Šä¼ é…ç½®æŒ‡å—

## ğŸ“‹ é…ç½®æ¦‚è§ˆ

å·²åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼Œéœ€è¦éƒ¨ç½²åˆ°è½¬ç æœåŠ¡å™¨ï¼š

### æœ¬åœ°æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰
- âœ… `scripts/upload_to_main.ps1` - ä¸Šä¼ è„šæœ¬
- âœ… `scripts/watcher_with_upload.ps1` - å¸¦ä¸Šä¼ åŠŸèƒ½çš„ç›‘æ§è„šæœ¬
- âœ… `scripts/SETUP_INSTRUCTIONS.txt` - é…ç½®è¯´æ˜
- âœ… `scripts/manual_setup_guide.md` - è¯¦ç»†æ‰‹å†Œ

### éœ€è¦åœ¨è½¬ç æœåŠ¡å™¨ä¸Šåˆ›å»º
- â­ï¸ `C:\server_key` - SSH å¯†é’¥æ–‡ä»¶
- â­ï¸ `D:\VideoTranscode\scripts\upload_to_main.ps1` - ä¸Šä¼ è„šæœ¬
- â­ï¸ `D:\VideoTranscode\scripts\watcher.ps1` - ç›‘æ§è„šæœ¬ï¼ˆæ›¿æ¢ç°æœ‰çš„ï¼‰

## ğŸš€ å¿«é€Ÿé…ç½®æ­¥éª¤

### æ–¹æ³•1ï¼šè¿œç¨‹æ¡Œé¢é…ç½®ï¼ˆæ¨èï¼‰

#### 1. è¿æ¥åˆ°è½¬ç æœåŠ¡å™¨
```
IP: 198.176.60.121
ç”¨æˆ·: Administrator
å¯†ç : jCkMIjNlnSd7f6GM
```

#### 2. åœ¨è½¬ç æœåŠ¡å™¨ä¸Šæ‰“å¼€ PowerShellï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤

```powershell
# åˆ›å»º SSH å¯†é’¥æ–‡ä»¶
$keyContent = @"
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACBE9vQLi1nGfWBVacAymJd/B6TeSVq6KeYxZBCd57L9gAAAAJDvzGZC78xm
QgAAAAtzc2gtZWQyNTUxOQAAACBE9vQLi1nGfWBVacAymJd/B6TeSVq6KeYxZBCd57L9gA
AAAECtAxcJq0SjnZjz4DYebdKR/2BX09k3EOCZniP9JI0SwkT29AuLWcZ9YFVpwDKYl38H
pN5JWrop5jFkEJ3nsv2AAAAADXJvb3RASEIxMzExMDM=
-----END OPENSSH PRIVATE KEY-----
"@

$keyContent | Out-File -FilePath C:\server_key -Encoding ASCII -NoNewline

Write-Host "SSH key created successfully!" -ForegroundColor Green
Get-Item C:\server_key
```

#### 3. å¤åˆ¶è„šæœ¬æ–‡ä»¶

é€šè¿‡è¿œç¨‹æ¡Œé¢ï¼Œå°†ä»¥ä¸‹æ–‡ä»¶ä»æœ¬åœ°å¤åˆ¶åˆ°è½¬ç æœåŠ¡å™¨ï¼š

**æ–‡ä»¶1ï¼šupload_to_main.ps1**
- æœ¬åœ°è·¯å¾„ï¼š`scripts\upload_to_main.ps1`
- ç›®æ ‡è·¯å¾„ï¼š`D:\VideoTranscode\scripts\upload_to_main.ps1`

**æ–‡ä»¶2ï¼šwatcher.ps1**
- æœ¬åœ°è·¯å¾„ï¼š`scripts\watcher_with_upload.ps1`
- ç›®æ ‡è·¯å¾„ï¼š`D:\VideoTranscode\scripts\watcher.ps1`ï¼ˆè¦†ç›–ç°æœ‰æ–‡ä»¶ï¼‰

#### 4. æµ‹è¯•ä¸Šä¼ åŠŸèƒ½

åœ¨è½¬ç æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```powershell
# æµ‹è¯•ä¸Šä¼ ï¼ˆä½¿ç”¨ä¹‹å‰è½¬ç çš„æµ‹è¯•è§†é¢‘ï¼‰
powershell -ExecutionPolicy Bypass -File D:\VideoTranscode\scripts\upload_to_main.ps1 -VideoFile D:\VideoTranscode\completed\test_out.mp4
```

é¢„æœŸè¾“å‡ºï¼š
```
==========================================
Starting upload: D:\VideoTranscode\completed\test_out.mp4
File: test_out.mp4
Size: X.XX MB
Uploading to main server...
Upload successful!
Duration: X.XX seconds
Speed: XX.XX MB/s
Remote path: 38.47.218.137:/www/wwwroot/video-app/backend/uploads/videos/test_out.mp4
==========================================
```

#### 5. éªŒè¯ä¸Šä¼ ç»“æœ

åœ¨æœ¬åœ°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ä¸»æœåŠ¡å™¨ï¼š

```powershell
ssh -i server_key_new root@38.47.218.137 "ls -lh /www/wwwroot/video-app/backend/uploads/videos/test_out.mp4"
```

#### 6. å¯åŠ¨è‡ªåŠ¨ç›‘æ§æœåŠ¡

åœ¨è½¬ç æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```powershell
powershell -ExecutionPolicy Bypass -NoExit -File D:\VideoTranscode\scripts\watcher.ps1
```

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
è½¬ç æœåŠ¡å™¨ (198.176.60.121)
â”œâ”€â”€ D:\VideoTranscode\downloads\     â† æ”¾å…¥å¾…è½¬ç è§†é¢‘
â”‚   â””â”€â”€ video.mp4
â”‚
â”œâ”€â”€ è‡ªåŠ¨è½¬ç  (28x å®æ—¶é€Ÿåº¦)
â”‚   â”œâ”€â”€ D:\VideoTranscode\processing\
â”‚   â””â”€â”€ D:\VideoTranscode\completed\
â”‚       â””â”€â”€ video_transcoded.mp4
â”‚
â””â”€â”€ è‡ªåŠ¨ä¸Šä¼  (50+ MB/s)
    â””â”€â”€ ä¸»æœåŠ¡å™¨ (38.47.218.137)
        â””â”€â”€ /www/wwwroot/video-app/backend/uploads/videos/
            â””â”€â”€ video_transcoded.mp4
```

## ğŸ¯ æ€§èƒ½æŒ‡æ ‡

### ä¸»æœåŠ¡å™¨ç£ç›˜ç©ºé—´
- **æ€»ç©ºé—´**: 450 GB
- **å·²ç”¨**: 15 GB
- **å¯ç”¨**: 412 GB âœ…
- **ä½¿ç”¨ç‡**: 4%

### å¤„ç†èƒ½åŠ›
| ä»»åŠ¡ | æ—¶é—´ | é€Ÿåº¦ |
|------|------|------|
| è½¬ç  1GB è§†é¢‘ | 4-5 åˆ†é’Ÿ | 28x å®æ—¶ |
| ä¸Šä¼ åˆ°ä¸»æœåŠ¡å™¨ | 10-20 ç§’ | 50+ MB/s |
| **æ€»è®¡** | **çº¦ 5-6 åˆ†é’Ÿ** | - |

### æ¯æ—¥å¤„ç†èƒ½åŠ›
- **å•çº¿ç¨‹**: 240-288 ä¸ªè§†é¢‘/å¤©
- **3ä¸ªå¹¶å‘**: 720-864 ä¸ªè§†é¢‘/å¤©
- **éœ€æ±‚**: 300 ä¸ªè§†é¢‘/å¤©
- **ç»“è®º**: âœ… å®Œå…¨æ»¡è¶³ï¼Œè¿˜æœ‰ä½™é‡

## ğŸ“ æ—¥å¿—æ–‡ä»¶

### ç›‘æ§æ—¥å¿—
```
D:\VideoTranscode\logs\watcher.log
```
è®°å½•ï¼š
- è§†é¢‘æ£€æµ‹
- è½¬ç è¿›åº¦
- ä¸Šä¼ çŠ¶æ€
- é”™è¯¯ä¿¡æ¯

### ä¸Šä¼ æ—¥å¿—
```
D:\VideoTranscode\logs\upload.log
```
è®°å½•ï¼š
- ä¸Šä¼ å¼€å§‹æ—¶é—´
- æ–‡ä»¶å¤§å°
- ä¸Šä¼ é€Ÿåº¦
- ä¸Šä¼ ç»“æœ

### æŸ¥çœ‹æ—¥å¿—
```powershell
# å®æ—¶æŸ¥çœ‹ç›‘æ§æ—¥å¿—
Get-Content D:\VideoTranscode\logs\watcher.log -Tail 50 -Wait

# æŸ¥çœ‹ä¸Šä¼ æ—¥å¿—
Get-Content D:\VideoTranscode\logs\upload.log -Tail 20
```

## âœ… éªŒè¯æ¸…å•

é…ç½®å®Œæˆåï¼Œè¯·ç¡®è®¤ï¼š

- [ ] SSH å¯†é’¥æ–‡ä»¶å·²åˆ›å»ºï¼š`C:\server_key`
- [ ] ä¸Šä¼ è„šæœ¬å·²éƒ¨ç½²ï¼š`D:\VideoTranscode\scripts\upload_to_main.ps1`
- [ ] ç›‘æ§è„šæœ¬å·²æ›´æ–°ï¼š`D:\VideoTranscode\scripts\watcher.ps1`
- [ ] æµ‹è¯•ä¸Šä¼ æˆåŠŸï¼ˆtest_out.mp4 å·²ä¸Šä¼ åˆ°ä¸»æœåŠ¡å™¨ï¼‰
- [ ] ç›‘æ§æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] æ—¥å¿—æ–‡ä»¶æ­£å¸¸è®°å½•

## ğŸ”§ å®Œæ•´å·¥ä½œæµç¨‹æµ‹è¯•

### 1. å‡†å¤‡æµ‹è¯•è§†é¢‘
```powershell
# åœ¨è½¬ç æœåŠ¡å™¨ä¸Šåˆ›å»ºæµ‹è¯•è§†é¢‘
ffmpeg -f lavfi -i testsrc=duration=10:size=1280x720:rate=30 -pix_fmt yuv420p D:\VideoTranscode\downloads\workflow_test.mp4
```

### 2. è§‚å¯Ÿè‡ªåŠ¨å¤„ç†
ç›‘æ§æœåŠ¡ä¼šè‡ªåŠ¨ï¼š
1. âœ… æ£€æµ‹åˆ°æ–°è§†é¢‘ï¼š`workflow_test.mp4`
2. âœ… ç§»åŠ¨åˆ°å¤„ç†ç›®å½•
3. âœ… å¼€å§‹è½¬ç 
4. âœ… è½¬ç å®Œæˆï¼š`workflow_test_transcoded.mp4`
5. âœ… è‡ªåŠ¨ä¸Šä¼ åˆ°ä¸»æœåŠ¡å™¨
6. âœ… åˆ é™¤åŸå§‹æ–‡ä»¶
7. âœ… è®°å½•æ—¥å¿—

### 3. éªŒè¯ç»“æœ
```powershell
# åœ¨æœ¬åœ°æ£€æŸ¥ä¸»æœåŠ¡å™¨
ssh -i server_key_new root@38.47.218.137 "ls -lh /www/wwwroot/video-app/backend/uploads/videos/workflow_test_transcoded.mp4"
```

## ğŸš¨ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šä¸Šä¼ å¤±è´¥ - SSH å¯†é’¥é”™è¯¯
**ç—‡çŠ¶**: `ERROR: SSH key not found` æˆ– `Permission denied`

**è§£å†³**:
```powershell
# æ£€æŸ¥å¯†é’¥æ–‡ä»¶
Get-Item C:\server_key

# é‡æ–°åˆ›å»ºå¯†é’¥æ–‡ä»¶ï¼ˆæ‰§è¡Œæ­¥éª¤2çš„å‘½ä»¤ï¼‰
```

### é—®é¢˜2ï¼šä¸Šä¼ å¤±è´¥ - ç½‘ç»œé—®é¢˜
**ç—‡çŠ¶**: `Connection timeout` æˆ– `Network unreachable`

**è§£å†³**:
```powershell
# æµ‹è¯•ç½‘ç»œè¿æ¥
ping 38.47.218.137

# æµ‹è¯• SSH è¿æ¥
ssh -i C:\server_key root@38.47.218.137 "echo Connection OK"
```

### é—®é¢˜3ï¼šç›‘æ§æœåŠ¡æ²¡æœ‰ååº”
**ç—‡çŠ¶**: è§†é¢‘æ”¾å…¥ downloads ç›®å½•åæ²¡æœ‰å¤„ç†

**è§£å†³**:
```powershell
# æ£€æŸ¥ç›‘æ§æœåŠ¡æ˜¯å¦è¿è¡Œ
Get-Process | Where-Object {$_.ProcessName -like "*powershell*"}

# é‡å¯ç›‘æ§æœåŠ¡
# æŒ‰ Ctrl+C åœæ­¢å½“å‰æœåŠ¡ï¼Œç„¶åé‡æ–°å¯åŠ¨
powershell -ExecutionPolicy Bypass -NoExit -File D:\VideoTranscode\scripts\watcher.ps1
```

### é—®é¢˜4ï¼šç£ç›˜ç©ºé—´ä¸è¶³
**ç—‡çŠ¶**: è½¬ç æˆ–ä¸Šä¼ å¤±è´¥

**è§£å†³**:
```powershell
# æ£€æŸ¥ç£ç›˜ç©ºé—´
Get-PSDrive D

# æ¸…ç†å·²ä¸Šä¼ çš„è§†é¢‘ï¼ˆå¦‚æœéœ€è¦ï¼‰
Remove-Item D:\VideoTranscode\completed\*.mp4 -Force
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
```powershell
# è½¬ç æœåŠ¡å™¨ç£ç›˜ç©ºé—´
Get-PSDrive D

# ä¸»æœåŠ¡å™¨ç£ç›˜ç©ºé—´
ssh -i server_key_new root@38.47.218.137 "df -h /"

# æœ€è¿‘çš„æ—¥å¿—
Get-Content D:\VideoTranscode\logs\watcher.log -Tail 20
Get-Content D:\VideoTranscode\logs\upload.log -Tail 10
```

### æ€§èƒ½ç›‘æ§
```powershell
# æŸ¥çœ‹ CPU å’Œå†…å­˜ä½¿ç”¨
Get-Process ffmpeg | Select-Object CPU, WorkingSet

# æŸ¥çœ‹ç½‘ç»œé€Ÿåº¦ï¼ˆä¸Šä¼ æ—¶ï¼‰
Get-NetAdapterStatistics
```

## ğŸ‰ é…ç½®å®Œæˆ

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œè½¬ç æœåŠ¡å™¨å°†ï¼š

1. âœ… è‡ªåŠ¨ç›‘æ§ `D:\VideoTranscode\downloads\` ç›®å½•
2. âœ… è‡ªåŠ¨è½¬ç æ–°è§†é¢‘ï¼ˆ28x å®æ—¶é€Ÿåº¦ï¼‰
3. âœ… è‡ªåŠ¨ä¸Šä¼ åˆ°ä¸»æœåŠ¡å™¨ï¼ˆ50+ MB/sï¼‰
4. âœ… è‡ªåŠ¨æ¸…ç†åŸå§‹æ–‡ä»¶
5. âœ… è®°å½•æ‰€æœ‰æ“ä½œæ—¥å¿—

**æ¯å¤©å¯å¤„ç† 300+ ä¸ªè§†é¢‘ï¼Œå®Œå…¨æ»¡è¶³éœ€æ±‚ï¼** ğŸš€

---

**é…ç½®æ—¶é—´**: 2026-01-16  
**ä¸»æœåŠ¡å™¨**: 38.47.218.137 (é¦™æ¸¯)  
**è½¬ç æœåŠ¡å™¨**: 198.176.60.121 (é¦™æ¸¯)  
**å¯ç”¨ç©ºé—´**: 412 GB  
**çŠ¶æ€**: â­ï¸ ç­‰å¾…æ‰‹åŠ¨éƒ¨ç½²
