/* empty css             *//* empty css                   *//* empty css                             *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                    *//* empty css                          *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                 *//* empty css                        *//* empty css                             *//* empty css                  *//* empty css               */import{_ as e,a}from"./index-C3P4JTuA.js";import{be as t,bk as l,E as r,bc as s,bd as d,bl as o,bm as i,bD as n,aM as u,bh as p,bi as c,bj as v,bn as g,bs as m,bt as _,aR as b,aS as y,bB as f,aU as h,aT as w,bG as j,bH as k}from"./element-plus-DlIn_qXi.js";import{r as V,l as z,j as C,y as x,O as I,F as U,z as R,C as S,G as T,L as D,M as $,aa as E,E as G,K as M,I as F}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const K={class:"report-manage"},L={class:"card-header"},O={class:"stat-item pending"},P={class:"stat-value"},q={class:"stat-item processed"},A={class:"stat-value"},B={class:"stat-item accepted"},H={class:"stat-value"},J={class:"stat-item rejected"},N={class:"stat-value"},X={class:"filter-bar"},Q={class:"target-info"},W={class:"target-title"},Y={key:1,class:"target-content"},Z={key:2},ee={class:"report-content"},ae=e({__name:"ReportManage",setup(e){const ae=V(!1),te=V([]),le=V([]),re=V({}),se=z({status:"",targetType:"",categoryId:"",dateRange:null}),de=z({page:1,pageSize:20,total:0}),oe=z({visible:!1,loading:!1,title:"",action:"",report:null}),ie=z({actions:[],note:""}),ne=z({visible:!1,data:null}),ue=async()=>{var e,t;ae.value=!0;try{const l={page:de.page,page_size:de.pageSize,status:se.status||void 0,target_type:se.targetType||void 0,category_id:se.categoryId||void 0};se.dateRange&&(l.start_date=se.dateRange[0],l.end_date=se.dateRange[1]);const r=await a.get("/reports/admin/list",{params:l});te.value=(null==(e=r.data)?void 0:e.items)||r.items||[],de.total=(null==(t=r.data)?void 0:t.total)||r.total||0}catch(l){r.error("获取举报列表失败")}finally{ae.value=!1}},pe=async()=>{try{const e=await a.get("/reports/admin/stats");re.value=e.data||e}catch(e){}},ce=()=>{se.status="",se.targetType="",se.categoryId="",se.dateRange=null,de.page=1,ue()},ve=(e,a)=>{oe.report=e,oe.action=a,oe.title="accepted"===a?"采纳举报":"驳回举报",ie.actions=[],ie.note="",oe.visible=!0},ge=async()=>{var e,t;oe.loading=!0;try{await a.post(`/reports/admin/${oe.report.id}/handle`,{status:oe.action,actions:ie.actions,handle_note:ie.note}),r.success("处理成功"),oe.visible=!1,ue(),pe()}catch(l){r.error("处理失败: "+((null==(t=null==(e=l.response)?void 0:e.data)?void 0:t.detail)||l.message))}finally{oe.loading=!1}},me=e=>e?new Date(e).toLocaleString("zh-CN"):"",_e=e=>({video:"primary",comment:"warning",user:"danger"}[e]||"info"),be=e=>({video:"视频",comment:"评论",user:"用户"}[e]||e),ye=e=>({pending:"warning",processed:"info",accepted:"success",rejected:"danger"}[e]||""),fe=e=>({pending:"待处理",processed:"已处理",accepted:"已采纳",rejected:"已驳回"}[e]||e);return C(()=>{ue(),pe(),(async()=>{try{const e=await a.get("/reports/categories");le.value=e.data||e||[]}catch(e){}})()}),(e,a)=>{const r=u,V=d,z=s,C=i,he=o,we=n,je=c,ke=v,Ve=g,ze=p,Ce=_,xe=t,Ie=y,Ue=h,Re=f,Se=w,Te=b,De=l,$e=k,Ee=j,Ge=m;return R(),x("div",K,[I(xe,null,{header:U(()=>[S("div",L,[a[12]||(a[12]=S("span",null,"举报审核管理",-1)),I(r,{type:"primary",onClick:pe},{default:U(()=>[...a[11]||(a[11]=[M("刷新统计",-1)])]),_:1})])]),default:U(()=>[I(z,{gutter:16,class:"stats-row"},{default:U(()=>[I(V,{span:6},{default:U(()=>[S("div",O,[S("div",P,D(re.value.pending||0),1),a[13]||(a[13]=S("div",{class:"stat-label"},"待处理",-1))])]),_:1}),I(V,{span:6},{default:U(()=>[S("div",q,[S("div",A,D(re.value.processed||0),1),a[14]||(a[14]=S("div",{class:"stat-label"},"已处理",-1))])]),_:1}),I(V,{span:6},{default:U(()=>[S("div",B,[S("div",H,D(re.value.accepted||0),1),a[15]||(a[15]=S("div",{class:"stat-label"},"已采纳",-1))])]),_:1}),I(V,{span:6},{default:U(()=>[S("div",J,[S("div",N,D(re.value.rejected||0),1),a[16]||(a[16]=S("div",{class:"stat-label"},"已驳回",-1))])]),_:1})]),_:1}),S("div",X,[I(he,{modelValue:se.status,"onUpdate:modelValue":a[0]||(a[0]=e=>se.status=e),placeholder:"处理状态",clearable:"",style:{width:"120px"}},{default:U(()=>[I(C,{label:"待处理",value:"pending"}),I(C,{label:"已处理",value:"processed"}),I(C,{label:"已采纳",value:"accepted"}),I(C,{label:"已驳回",value:"rejected"})]),_:1},8,["modelValue"]),I(he,{modelValue:se.targetType,"onUpdate:modelValue":a[1]||(a[1]=e=>se.targetType=e),placeholder:"举报类型",clearable:"",style:{width:"120px"}},{default:U(()=>[I(C,{label:"视频",value:"video"}),I(C,{label:"评论",value:"comment"}),I(C,{label:"用户",value:"user"})]),_:1},8,["modelValue"]),I(he,{modelValue:se.categoryId,"onUpdate:modelValue":a[2]||(a[2]=e=>se.categoryId=e),placeholder:"举报原因",clearable:"",style:{width:"140px"}},{default:U(()=>[(R(!0),x($,null,E(le.value,e=>(R(),G(C,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),I(we,{modelValue:se.dateRange,"onUpdate:modelValue":a[3]||(a[3]=e=>se.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"]),I(r,{type:"primary",onClick:ue},{default:U(()=>[...a[17]||(a[17]=[M("查询",-1)])]),_:1}),I(r,{onClick:ce},{default:U(()=>[...a[18]||(a[18]=[M("重置",-1)])]),_:1})]),T((R(),G(ze,{data:te.value,stripe:""},{default:U(()=>[I(je,{prop:"id",label:"ID",width:"80"}),I(je,{prop:"reporter_name",label:"举报人",width:"120"}),I(je,{prop:"target_type",label:"类型",width:"80"},{default:U(({row:e})=>[I(ke,{type:_e(e.target_type),size:"small"},{default:U(()=>[M(D(be(e.target_type)),1)]),_:2},1032,["type"])]),_:1}),I(je,{prop:"target_id",label:"目标ID",width:"100"}),I(je,{label:"目标信息","min-width":"200"},{default:U(({row:e})=>[S("div",Q,["video"===e.target_type?(R(),x($,{key:0},[e.target_cover?(R(),G(Ve,{key:0,src:e.target_cover,class:"target-cover",fit:"cover"},null,8,["src"])):F("",!0),S("span",W,D(e.target_title||`视频#${e.target_id}`),1)],64)):"comment"===e.target_type?(R(),x("span",Y,D(e.target_content||`评论#${e.target_id}`),1)):(R(),x("span",Z,D(e.target_name||`用户#${e.target_id}`),1))])]),_:1}),I(je,{prop:"category_name",label:"举报原因",width:"120"}),I(je,{prop:"reason",label:"详细说明","min-width":"150","show-overflow-tooltip":""}),I(je,{prop:"status",label:"状态",width:"100"},{default:U(({row:e})=>[I(ke,{type:ye(e.status)},{default:U(()=>[M(D(fe(e.status)),1)]),_:2},1032,["type"])]),_:1}),I(je,{prop:"created_at",label:"举报时间",width:"180"},{default:U(({row:e})=>[M(D(me(e.created_at)),1)]),_:1}),I(je,{label:"操作",width:"200",fixed:"right"},{default:U(({row:e})=>["pending"===e.status?(R(),x($,{key:0},[I(r,{size:"small",onClick:a=>(e=>{const a=e.target_type,t=e.target_id;"video"===a?window.open(`/user/video/${t}`,"_blank"):"user"===a&&window.open(`/users?id=${t}`,"_blank")})(e)},{default:U(()=>[...a[19]||(a[19]=[M("查看",-1)])]),_:1},8,["onClick"]),I(r,{size:"small",type:"success",onClick:a=>ve(e,"accepted")},{default:U(()=>[...a[20]||(a[20]=[M("采纳",-1)])]),_:1},8,["onClick"]),I(r,{size:"small",type:"danger",onClick:a=>ve(e,"rejected")},{default:U(()=>[...a[21]||(a[21]=[M("驳回",-1)])]),_:1},8,["onClick"])],64)):(R(),G(r,{key:1,size:"small",onClick:a=>(e=>{ne.data=e,ne.visible=!0})(e)},{default:U(()=>[...a[22]||(a[22]=[M("详情",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[Ge,ae.value]]),I(Ce,{class:"pagination","current-page":de.page,"onUpdate:currentPage":a[4]||(a[4]=e=>de.page=e),"page-size":de.pageSize,"onUpdate:pageSize":a[5]||(a[5]=e=>de.pageSize=e),total:de.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:ue,onCurrentChange:ue},null,8,["current-page","page-size","total"])]),_:1}),I(De,{modelValue:oe.visible,"onUpdate:modelValue":a[9]||(a[9]=e=>oe.visible=e),title:oe.title,width:"500px"},{footer:U(()=>[I(r,{onClick:a[8]||(a[8]=e=>oe.visible=!1)},{default:U(()=>[...a[29]||(a[29]=[M("取消",-1)])]),_:1}),I(r,{type:"primary",onClick:ge,loading:oe.loading},{default:U(()=>[...a[30]||(a[30]=[M("确认处理",-1)])]),_:1},8,["loading"])]),default:U(()=>[I(Te,{"label-width":"100px"},{default:U(()=>[I(Ie,{label:"举报内容"},{default:U(()=>{var e,t,l;return[S("div",ee,[S("p",null,[a[23]||(a[23]=S("strong",null,"类型：",-1)),M(D(be(null==(e=oe.report)?void 0:e.target_type)),1)]),S("p",null,[a[24]||(a[24]=S("strong",null,"原因：",-1)),M(D(null==(t=oe.report)?void 0:t.category_name),1)]),S("p",null,[a[25]||(a[25]=S("strong",null,"说明：",-1)),M(D((null==(l=oe.report)?void 0:l.reason)||"无"),1)])])]}),_:1}),"accepted"===oe.action?(R(),G(Ie,{key:0,label:"处理方式"},{default:U(()=>[I(Re,{modelValue:ie.actions,"onUpdate:modelValue":a[6]||(a[6]=e=>ie.actions=e)},{default:U(()=>[I(Ue,{label:"delete_target"},{default:U(()=>[...a[26]||(a[26]=[M("删除被举报内容",-1)])]),_:1}),I(Ue,{label:"warn_user"},{default:U(()=>[...a[27]||(a[27]=[M("警告被举报用户",-1)])]),_:1}),I(Ue,{label:"ban_user"},{default:U(()=>[...a[28]||(a[28]=[M("封禁被举报用户",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):F("",!0),I(Ie,{label:"处理说明"},{default:U(()=>[I(Se,{modelValue:ie.note,"onUpdate:modelValue":a[7]||(a[7]=e=>ie.note=e),type:"textarea",rows:"3",placeholder:"可选，输入处理说明"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"]),I(De,{modelValue:ne.visible,"onUpdate:modelValue":a[10]||(a[10]=e=>ne.visible=e),title:"举报详情",width:"600px"},{default:U(()=>[I(Ee,{column:1,border:""},{default:U(()=>[I($e,{label:"举报ID"},{default:U(()=>{var e;return[M(D(null==(e=ne.data)?void 0:e.id),1)]}),_:1}),I($e,{label:"举报人"},{default:U(()=>{var e;return[M(D(null==(e=ne.data)?void 0:e.reporter_name),1)]}),_:1}),I($e,{label:"举报类型"},{default:U(()=>{var e;return[I(ke,{type:_e(null==(e=ne.data)?void 0:e.target_type)},{default:U(()=>{var e;return[M(D(be(null==(e=ne.data)?void 0:e.target_type)),1)]}),_:1},8,["type"])]}),_:1}),I($e,{label:"目标ID"},{default:U(()=>{var e;return[M(D(null==(e=ne.data)?void 0:e.target_id),1)]}),_:1}),I($e,{label:"举报原因"},{default:U(()=>{var e;return[M(D(null==(e=ne.data)?void 0:e.category_name),1)]}),_:1}),I($e,{label:"详细说明"},{default:U(()=>{var e;return[M(D((null==(e=ne.data)?void 0:e.reason)||"无"),1)]}),_:1}),I($e,{label:"举报时间"},{default:U(()=>{var e;return[M(D(me(null==(e=ne.data)?void 0:e.created_at)),1)]}),_:1}),I($e,{label:"处理状态"},{default:U(()=>{var e;return[I(ke,{type:ye(null==(e=ne.data)?void 0:e.status)},{default:U(()=>{var e;return[M(D(fe(null==(e=ne.data)?void 0:e.status)),1)]}),_:1},8,["type"])]}),_:1}),I($e,{label:"处理人"},{default:U(()=>{var e;return[M(D((null==(e=ne.data)?void 0:e.handler_name)||"-"),1)]}),_:1}),I($e,{label:"处理时间"},{default:U(()=>{var e;return[M(D(me(null==(e=ne.data)?void 0:e.handled_at)||"-"),1)]}),_:1}),I($e,{label:"处理说明"},{default:U(()=>{var e;return[M(D((null==(e=ne.data)?void 0:e.handle_note)||"-"),1)]}),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5bdef33c"]]);export{ae as default};
