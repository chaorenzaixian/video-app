/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                 *//* empty css                       *//* empty css                    *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                             *//* empty css               *//* empty css                */import{bc as e,be as a,bk as l,E as t,bd as d,aQ as s,ap as r,aa as o,aq as n,aI as i,bz as u,bA as p,bl as c,bm as m,aT as g,bD as v,aM as b,bh as _,bi as h,bj as f,bs as y,bt as w,aR as V,aS as z,bf as I,by as S,bv as j,a as x}from"./element-plus-DlIn_qXi.js";import{_ as C,a as U}from"./index-C3P4JTuA.js";import{r as k,l as R,j as D,y as B,O as L,F as q,z as P,C as E,u as F,L as T,G as A,K as G,E as H,H as K,I as M}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const $={class:"finance-manage"},J={class:"stat-content"},N={class:"stat-icon recharge"},O={class:"stat-info"},Q={class:"stat-value"},W={class:"stat-content"},X={class:"stat-icon consume"},Y={class:"stat-info"},Z={class:"stat-value"},ee={class:"stat-content"},ae={class:"stat-icon orders"},le={class:"stat-info"},te={class:"stat-value"},de={class:"stat-content"},se={class:"stat-icon users"},re={class:"stat-info"},oe={class:"stat-value"},ne={class:"filter-bar"},ie={class:"filter-bar"},ue={class:"filter-bar"},pe={class:"coin-value"},ce={class:"filter-bar"},me=C({__name:"FinanceManage",setup(C){const me=k({}),ge=k("transactions"),ve=R({transactions:!1,orders:!1,balances:!1,purchases:!1}),be=k([]),_e=R({type:"",userId:"",dateRange:null}),he=R({page:1,pageSize:20,total:0}),fe=k([]),ye=R({status:"",orderId:"",userId:"",dateRange:null}),we=R({page:1,pageSize:20,total:0}),Ve=k([]),ze=R({userId:"",username:"",sortBy:"balance_desc"}),Ie=R({page:1,pageSize:20,total:0}),Se=k([]),je=R({userId:"",videoId:"",dateRange:null}),xe=R({page:1,pageSize:20,total:0}),Ce=R({visible:!1,loading:!1}),Ue=R({userId:"",username:"",currentBalance:void 0,type:"add",amount:0,reason:""}),ke=async()=>{var e,a;ve.transactions=!0;try{const l={page:he.page,page_size:he.pageSize,transaction_type:_e.type||void 0,user_id:_e.userId||void 0};_e.dateRange&&(l.start_date=_e.dateRange[0],l.end_date=_e.dateRange[1]);const t=await U.get("/admin/finance/coin-transactions",{params:l});be.value=(null==(e=t.data)?void 0:e.items)||t.items||[],he.total=(null==(a=t.data)?void 0:a.total)||t.total||0}catch(l){t.error("获取金币流水失败")}finally{ve.transactions=!1}},Re=async()=>{var e,a;ve.orders=!0;try{const l={page:we.page,page_size:we.pageSize,status:ye.status||void 0,order_id:ye.orderId||void 0,user_id:ye.userId||void 0};ye.dateRange&&(l.start_date=ye.dateRange[0],l.end_date=ye.dateRange[1]);const t=await U.get("/admin/finance/recharge-orders",{params:l});fe.value=(null==(e=t.data)?void 0:e.items)||t.items||[],we.total=(null==(a=t.data)?void 0:a.total)||t.total||0}catch(l){t.error("获取充值订单失败")}finally{ve.orders=!1}},De=async()=>{var e,a;ve.balances=!0;try{const l={page:Ie.page,page_size:Ie.pageSize,user_id:ze.userId||void 0,username:ze.username||void 0,sort_by:ze.sortBy},t=await U.get("/admin/finance/user-coins",{params:l});Ve.value=(null==(e=t.data)?void 0:e.items)||t.items||[],Ie.total=(null==(a=t.data)?void 0:a.total)||t.total||0}catch(l){t.error("获取用户余额失败")}finally{ve.balances=!1}},Be=async()=>{var e,a;ve.purchases=!0;try{const l={page:xe.page,page_size:xe.pageSize,user_id:je.userId||void 0,video_id:je.videoId||void 0};je.dateRange&&(l.start_date=je.dateRange[0],l.end_date=je.dateRange[1]);const t=await U.get("/admin/finance/video-purchases",{params:l});Se.value=(null==(e=t.data)?void 0:e.items)||t.items||[],xe.total=(null==(a=t.data)?void 0:a.total)||t.total||0}catch(l){t.error("获取视频购买记录失败")}finally{ve.purchases=!1}},Le=e=>{switch(e){case"transactions":be.value.length||ke();break;case"orders":fe.value.length||Re();break;case"balances":Ve.value.length||De();break;case"purchases":Se.value.length||Be()}},qe=()=>{t.info("导出功能开发中")},Pe=(e=null)=>{e?(Ue.userId=String(e.user_id),Ue.username=e.username,Ue.currentBalance=e.balance):(Ue.userId="",Ue.username="",Ue.currentBalance=void 0),Ue.type="add",Ue.amount=0,Ue.reason="",Ce.visible=!0},Ee=async()=>{var e,a;if(Ue.userId)if(Ue.amount||"set"===Ue.type)if(Ue.reason.trim()){await x.confirm(`确认${"add"===Ue.type?"增加":"deduct"===Ue.type?"扣除":"设置为"} ${Ue.amount} 金币？`,"确认操作"),Ce.loading=!0;try{await U.post("/admin/finance/adjust-coins",{user_id:parseInt(Ue.userId),adjust_type:Ue.type,amount:Ue.amount,reason:Ue.reason}),t.success("调整成功"),Ce.visible=!1,De(),ke()}catch(l){t.error("调整失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.detail)||l.message))}finally{Ce.loading=!1}}else t.warning("请输入调整原因");else t.warning("请输入金币数量");else t.warning("请输入用户ID")},Fe=e=>e?new Date(e).toLocaleString("zh-CN"):"-",Te=e=>({recharge:"充值",consume:"消费",refund:"退款",adjust:"调整",reward:"奖励"}[e]||e),Ae=e=>({pending:"待支付",completed:"已完成",cancelled:"已取消",expired:"已过期"}[e]||e);return D(()=>{(async()=>{try{const e=await U.get("/admin/finance/coin-transactions/stats");me.value=e.data||e}catch(e){}})(),ke()}),(t,x)=>{const C=s,U=a,k=d,R=e,D=m,Ge=c,He=g,Ke=v,Me=b,$e=h,Je=f,Ne=_,Oe=w,Qe=p,We=u,Xe=z,Ye=S,Ze=I,ea=j,aa=V,la=l,ta=y;return P(),B("div",$,[L(R,{gutter:20,class:"stats-row"},{default:q(()=>[L(k,{span:6},{default:q(()=>[L(U,{class:"stat-card"},{default:q(()=>{var e;return[E("div",J,[E("div",N,[L(C,null,{default:q(()=>[L(F(r))]),_:1})]),E("div",O,[E("div",Q,T((null==(e=me.value.totalRecharge)?void 0:e.toLocaleString())||0),1),x[29]||(x[29]=E("div",{class:"stat-label"},"总充值金币",-1))])])]}),_:1})]),_:1}),L(k,{span:6},{default:q(()=>[L(U,{class:"stat-card"},{default:q(()=>{var e;return[E("div",W,[E("div",X,[L(C,null,{default:q(()=>[L(F(o))]),_:1})]),E("div",Y,[E("div",Z,T((null==(e=me.value.totalConsume)?void 0:e.toLocaleString())||0),1),x[30]||(x[30]=E("div",{class:"stat-label"},"总消费金币",-1))])])]}),_:1})]),_:1}),L(k,{span:6},{default:q(()=>[L(U,{class:"stat-card"},{default:q(()=>{var e;return[E("div",ee,[E("div",ae,[L(C,null,{default:q(()=>[L(F(n))]),_:1})]),E("div",le,[E("div",te,T((null==(e=me.value.orderCount)?void 0:e.toLocaleString())||0),1),x[31]||(x[31]=E("div",{class:"stat-label"},"充值订单数",-1))])])]}),_:1})]),_:1}),L(k,{span:6},{default:q(()=>[L(U,{class:"stat-card"},{default:q(()=>{var e;return[E("div",de,[E("div",se,[L(C,null,{default:q(()=>[L(F(i))]),_:1})]),E("div",re,[E("div",oe,T((null==(e=me.value.userCount)?void 0:e.toLocaleString())||0),1),x[32]||(x[32]=E("div",{class:"stat-label"},"有余额用户",-1))])])]}),_:1})]),_:1})]),_:1}),L(U,{class:"main-card"},{default:q(()=>[L(We,{modelValue:ge.value,"onUpdate:modelValue":x[21]||(x[21]=e=>ge.value=e),onTabChange:Le},{default:q(()=>[L(Qe,{label:"金币流水",name:"transactions"},{default:q(()=>[E("div",ne,[L(Ge,{modelValue:_e.type,"onUpdate:modelValue":x[0]||(x[0]=e=>_e.type=e),placeholder:"交易类型",clearable:"",style:{width:"140px"}},{default:q(()=>[L(D,{label:"充值",value:"recharge"}),L(D,{label:"消费",value:"consume"}),L(D,{label:"退款",value:"refund"}),L(D,{label:"系统调整",value:"adjust"}),L(D,{label:"奖励",value:"reward"})]),_:1},8,["modelValue"]),L(He,{modelValue:_e.userId,"onUpdate:modelValue":x[1]||(x[1]=e=>_e.userId=e),placeholder:"用户ID",clearable:"",style:{width:"140px"}},null,8,["modelValue"]),L(Ke,{modelValue:_e.dateRange,"onUpdate:modelValue":x[2]||(x[2]=e=>_e.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"]),L(Me,{type:"primary",onClick:ke},{default:q(()=>[...x[33]||(x[33]=[G("查询",-1)])]),_:1}),L(Me,{onClick:qe},{default:q(()=>[...x[34]||(x[34]=[G("导出",-1)])]),_:1})]),A((P(),H(Ne,{data:be.value,stripe:""},{default:q(()=>[L($e,{prop:"id",label:"ID",width:"80"}),L($e,{prop:"user_id",label:"用户ID",width:"100"}),L($e,{prop:"username",label:"用户名",width:"120"}),L($e,{prop:"transaction_type",label:"类型",width:"100"},{default:q(({row:e})=>{return[L(Je,{type:(a=e.transaction_type,{recharge:"success",consume:"warning",refund:"info",adjust:"danger",reward:""}[a]||"")},{default:q(()=>[G(T(Te(e.transaction_type)),1)]),_:2},1032,["type"])];var a}),_:1}),L($e,{prop:"amount",label:"金额",width:"100"},{default:q(({row:e})=>[E("span",{class:K(e.amount>0?"text-success":"text-danger")},T(e.amount>0?"+":"")+T(e.amount),3)]),_:1}),L($e,{prop:"balance_after",label:"余额",width:"100"}),L($e,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),L($e,{prop:"created_at",label:"时间",width:"180"},{default:q(({row:e})=>[G(T(Fe(e.created_at)),1)]),_:1})]),_:1},8,["data"])),[[ta,ve.transactions]]),L(Oe,{class:"pagination","current-page":he.page,"onUpdate:currentPage":x[3]||(x[3]=e=>he.page=e),"page-size":he.pageSize,"onUpdate:pageSize":x[4]||(x[4]=e=>he.pageSize=e),total:he.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:ke,onCurrentChange:ke},null,8,["current-page","page-size","total"])]),_:1}),L(Qe,{label:"充值订单",name:"orders"},{default:q(()=>[E("div",ie,[L(Ge,{modelValue:ye.status,"onUpdate:modelValue":x[5]||(x[5]=e=>ye.status=e),placeholder:"订单状态",clearable:"",style:{width:"120px"}},{default:q(()=>[L(D,{label:"待支付",value:"pending"}),L(D,{label:"已完成",value:"completed"}),L(D,{label:"已取消",value:"cancelled"}),L(D,{label:"已过期",value:"expired"})]),_:1},8,["modelValue"]),L(He,{modelValue:ye.orderId,"onUpdate:modelValue":x[6]||(x[6]=e=>ye.orderId=e),placeholder:"订单号",clearable:"",style:{width:"180px"}},null,8,["modelValue"]),L(He,{modelValue:ye.userId,"onUpdate:modelValue":x[7]||(x[7]=e=>ye.userId=e),placeholder:"用户ID",clearable:"",style:{width:"120px"}},null,8,["modelValue"]),L(Ke,{modelValue:ye.dateRange,"onUpdate:modelValue":x[8]||(x[8]=e=>ye.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"]),L(Me,{type:"primary",onClick:Re},{default:q(()=>[...x[35]||(x[35]=[G("查询",-1)])]),_:1})]),A((P(),H(Ne,{data:fe.value,stripe:""},{default:q(()=>[L($e,{prop:"order_id",label:"订单号",width:"200"}),L($e,{prop:"user_id",label:"用户ID",width:"100"}),L($e,{prop:"package_name",label:"套餐名称",width:"120"}),L($e,{prop:"coins",label:"金币数",width:"100"}),L($e,{prop:"amount",label:"金额(元)",width:"100"},{default:q(({row:e})=>[G(" ¥"+T(e.amount),1)]),_:1}),L($e,{prop:"payment_method",label:"支付方式",width:"100"}),L($e,{prop:"status",label:"状态",width:"100"},{default:q(({row:e})=>{return[L(Je,{type:(a=e.status,{pending:"warning",completed:"success",cancelled:"info",expired:"danger"}[a]||"")},{default:q(()=>[G(T(Ae(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),L($e,{prop:"created_at",label:"创建时间",width:"180"},{default:q(({row:e})=>[G(T(Fe(e.created_at)),1)]),_:1}),L($e,{prop:"paid_at",label:"支付时间",width:"180"},{default:q(({row:e})=>[G(T(e.paid_at?Fe(e.paid_at):"-"),1)]),_:1})]),_:1},8,["data"])),[[ta,ve.orders]]),L(Oe,{class:"pagination","current-page":we.page,"onUpdate:currentPage":x[9]||(x[9]=e=>we.page=e),"page-size":we.pageSize,"onUpdate:pageSize":x[10]||(x[10]=e=>we.pageSize=e),total:we.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:Re,onCurrentChange:Re},null,8,["current-page","page-size","total"])]),_:1}),L(Qe,{label:"用户余额",name:"balances"},{default:q(()=>[E("div",ue,[L(He,{modelValue:ze.userId,"onUpdate:modelValue":x[11]||(x[11]=e=>ze.userId=e),placeholder:"用户ID",clearable:"",style:{width:"120px"}},null,8,["modelValue"]),L(He,{modelValue:ze.username,"onUpdate:modelValue":x[12]||(x[12]=e=>ze.username=e),placeholder:"用户名",clearable:"",style:{width:"140px"}},null,8,["modelValue"]),L(Ge,{modelValue:ze.sortBy,"onUpdate:modelValue":x[13]||(x[13]=e=>ze.sortBy=e),placeholder:"排序",style:{width:"120px"}},{default:q(()=>[L(D,{label:"余额降序",value:"balance_desc"}),L(D,{label:"余额升序",value:"balance_asc"}),L(D,{label:"总充值",value:"total_recharge"})]),_:1},8,["modelValue"]),L(Me,{type:"primary",onClick:De},{default:q(()=>[...x[36]||(x[36]=[G("查询",-1)])]),_:1}),L(Me,{type:"warning",onClick:Pe},{default:q(()=>[...x[37]||(x[37]=[G("调整余额",-1)])]),_:1})]),A((P(),H(Ne,{data:Ve.value,stripe:""},{default:q(()=>[L($e,{prop:"user_id",label:"用户ID",width:"100"}),L($e,{prop:"username",label:"用户名",width:"140"}),L($e,{prop:"balance",label:"当前余额",width:"120"},{default:q(({row:e})=>{var a;return[E("span",pe,T(null==(a=e.balance)?void 0:a.toLocaleString()),1)]}),_:1}),L($e,{prop:"total_recharge",label:"累计充值",width:"120"}),L($e,{prop:"total_consume",label:"累计消费",width:"120"}),L($e,{prop:"updated_at",label:"最后更新",width:"180"},{default:q(({row:e})=>[G(T(Fe(e.updated_at)),1)]),_:1}),L($e,{label:"操作",width:"150",fixed:"right"},{default:q(({row:e})=>[L(Me,{size:"small",onClick:a=>{return l=e.user_id,ge.value="transactions",_e.userId=String(l),void ke();var l}},{default:q(()=>[...x[38]||(x[38]=[G(" 查看流水 ",-1)])]),_:1},8,["onClick"]),L(Me,{size:"small",type:"warning",onClick:a=>Pe(e)},{default:q(()=>[...x[39]||(x[39]=[G(" 调整 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ta,ve.balances]]),L(Oe,{class:"pagination","current-page":Ie.page,"onUpdate:currentPage":x[14]||(x[14]=e=>Ie.page=e),"page-size":Ie.pageSize,"onUpdate:pageSize":x[15]||(x[15]=e=>Ie.pageSize=e),total:Ie.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:De,onCurrentChange:De},null,8,["current-page","page-size","total"])]),_:1}),L(Qe,{label:"视频购买",name:"purchases"},{default:q(()=>[E("div",ce,[L(He,{modelValue:je.userId,"onUpdate:modelValue":x[16]||(x[16]=e=>je.userId=e),placeholder:"用户ID",clearable:"",style:{width:"120px"}},null,8,["modelValue"]),L(He,{modelValue:je.videoId,"onUpdate:modelValue":x[17]||(x[17]=e=>je.videoId=e),placeholder:"视频ID",clearable:"",style:{width:"120px"}},null,8,["modelValue"]),L(Ke,{modelValue:je.dateRange,"onUpdate:modelValue":x[18]||(x[18]=e=>je.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"]),L(Me,{type:"primary",onClick:Be},{default:q(()=>[...x[40]||(x[40]=[G("查询",-1)])]),_:1})]),A((P(),H(Ne,{data:Se.value,stripe:""},{default:q(()=>[L($e,{prop:"id",label:"ID",width:"80"}),L($e,{prop:"user_id",label:"用户ID",width:"100"}),L($e,{prop:"video_id",label:"视频ID",width:"100"}),L($e,{prop:"video_title",label:"视频标题","min-width":"200","show-overflow-tooltip":""}),L($e,{prop:"coins_paid",label:"支付金币",width:"100"}),L($e,{prop:"created_at",label:"购买时间",width:"180"},{default:q(({row:e})=>[G(T(Fe(e.created_at)),1)]),_:1})]),_:1},8,["data"])),[[ta,ve.purchases]]),L(Oe,{class:"pagination","current-page":xe.page,"onUpdate:currentPage":x[19]||(x[19]=e=>xe.page=e),"page-size":xe.pageSize,"onUpdate:pageSize":x[20]||(x[20]=e=>xe.pageSize=e),total:xe.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:Be,onCurrentChange:Be},null,8,["current-page","page-size","total"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),L(la,{modelValue:Ce.visible,"onUpdate:modelValue":x[28]||(x[28]=e=>Ce.visible=e),title:"调整用户余额",width:"500px"},{footer:q(()=>[L(Me,{onClick:x[27]||(x[27]=e=>Ce.visible=!1)},{default:q(()=>[...x[44]||(x[44]=[G("取消",-1)])]),_:1}),L(Me,{type:"primary",onClick:Ee,loading:Ce.loading},{default:q(()=>[...x[45]||(x[45]=[G("确认调整",-1)])]),_:1},8,["loading"])]),default:q(()=>[L(aa,{model:Ue,"label-width":"100px"},{default:q(()=>[L(Xe,{label:"用户ID",required:""},{default:q(()=>[L(He,{modelValue:Ue.userId,"onUpdate:modelValue":x[22]||(x[22]=e=>Ue.userId=e),disabled:!!Ue.username},null,8,["modelValue","disabled"])]),_:1}),Ue.username?(P(),H(Xe,{key:0,label:"用户名"},{default:q(()=>[L(He,{modelValue:Ue.username,"onUpdate:modelValue":x[23]||(x[23]=e=>Ue.username=e),disabled:""},null,8,["modelValue"])]),_:1})):M("",!0),void 0!==Ue.currentBalance?(P(),H(Xe,{key:1,label:"当前余额"},{default:q(()=>[L(He,{value:Ue.currentBalance,disabled:""},null,8,["value"])]),_:1})):M("",!0),L(Xe,{label:"调整类型",required:""},{default:q(()=>[L(Ze,{modelValue:Ue.type,"onUpdate:modelValue":x[24]||(x[24]=e=>Ue.type=e)},{default:q(()=>[L(Ye,{value:"add"},{default:q(()=>[...x[41]||(x[41]=[G("增加",-1)])]),_:1}),L(Ye,{value:"deduct"},{default:q(()=>[...x[42]||(x[42]=[G("扣除",-1)])]),_:1}),L(Ye,{value:"set"},{default:q(()=>[...x[43]||(x[43]=[G("设置为",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),L(Xe,{label:"金币数量",required:""},{default:q(()=>[L(ea,{modelValue:Ue.amount,"onUpdate:modelValue":x[25]||(x[25]=e=>Ue.amount=e),min:0,max:9999999},null,8,["modelValue"])]),_:1}),L(Xe,{label:"调整原因",required:""},{default:q(()=>[L(He,{modelValue:Ue.reason,"onUpdate:modelValue":x[26]||(x[26]=e=>Ue.reason=e),type:"textarea",rows:"3",placeholder:"请输入调整原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-0272e736"]]);export{me as default};
