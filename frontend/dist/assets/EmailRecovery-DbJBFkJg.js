import{r as a,c as e,y as l,C as s,I as t,G as u,af as c,H as o,L as i,aC as n,z as v}from"./vue-vendor-Ba_vealp.js";import{_ as d}from"./ic_back-BPdSG6fy.js";import{_ as r,u as p}from"./index-C3P4JTuA.js";import{a as m}from"./utils-DflAyOWx.js";import{E as f}from"./element-plus-DlIn_qXi.js";const b={class:"email-recovery-page"},g={class:"page-header"},h={class:"form-section"},y={class:"form-item"},k={class:"form-item"},_={key:0,class:"debug-tip"},w={class:"debug-text"},j={class:"debug-code"},x=["disabled"],C=r({__name:"EmailRecovery",setup(r){const C=n(),I=p(),$=a(""),U=a(""),E=a(""),V=a(0),z=a(!1),G=a(!1);let H=null;const L=e(()=>/^[\w.-]+@[\w.-]+\.\w+$/.test($.value)),R=e(()=>L.value&&U.value.length>=4),S=async()=>{var a,e,l,s;if(!(V.value>0||!L.value||z.value)){z.value=!0,E.value="";try{const l=await m.post("/api/v1/auth/email/send-code",null,{params:{email:$.value,code_type:"login"}});(null==(a=l.data)?void 0:a.code)?(E.value=l.data.code,U.value=l.data.code,f({message:`è°ƒè¯•æ¨¡å¼ï¼šéªŒè¯ç  ${l.data.code} å·²è‡ªåŠ¨å¡«å…¥`,type:"success",duration:5e3})):f.success((null==(e=l.data)?void 0:e.message)||"éªŒè¯ç å·²å‘é€"),V.value=60,H=setInterval(()=>{V.value--,V.value<=0&&clearInterval(H)},1e3)}catch(t){f.error((null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.detail)||"å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{z.value=!1}}},q=async()=>{var a,e;if(R.value&&!G.value){G.value=!0;try{const a=await m.post("/api/v1/auth/recovery/login",null,{params:{email:$.value,code:U.value}});a.data.access_token&&(localStorage.setItem("token",a.data.access_token),await I.fetchUser(),f.success("ç™»å½•æˆåŠŸï¼"),C.push("/user/profile"))}catch(l){f.error((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.detail)||"éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥éªŒè¯ç ")}finally{G.value=!1}}};return(a,e)=>(v(),l("div",b,[s("header",g,[s("div",{class:"back-btn",onClick:e[0]||(e[0]=e=>a.$router.back())},[...e[3]||(e[3]=[s("img",{src:d,alt:"è¿”å›",class:"back-icon"},null,-1)])]),e[4]||(e[4]=s("h1",{class:"page-title"},"é‚®ç®±æ‰¾å›",-1)),e[5]||(e[5]=s("div",{class:"header-right"},null,-1))]),e[11]||(e[11]=s("div",{class:"info-section"},[s("div",{class:"info-icon"},"ğŸ“§"),s("h2",null,"é€šè¿‡é‚®ç®±éªŒè¯ç ç™»å½•"),s("p",null,"è¾“å…¥æ‚¨ç»‘å®šçš„é‚®ç®±ï¼ŒéªŒè¯åç›´æ¥ç™»å½•è´¦å·")],-1)),s("div",h,[s("div",y,[e[6]||(e[6]=s("span",{class:"form-label"},"é‚®ç®±",-1)),u(s("input",{type:"email","onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),placeholder:"è¯·è¾“å…¥æ‚¨ç»‘å®šçš„é‚®ç®±"},null,512),[[c,$.value]])]),s("div",k,[e[7]||(e[7]=s("span",{class:"form-label"},"éªŒè¯ç ",-1)),u(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>U.value=a),placeholder:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç ",maxlength:"6"},null,512),[[c,U.value]]),s("div",{class:o(["code-btn",{disabled:V.value>0||!L.value||z.value}]),onClick:S},i(z.value?"å‘é€ä¸­...":V.value>0?`${V.value}s`:"è·å–éªŒè¯ç "),3)]),E.value?(v(),l("div",_,[e[9]||(e[9]=s("div",{class:"debug-icon"},"ğŸ”§",-1)),s("div",w,[e[8]||(e[8]=s("span",null,"è°ƒè¯•æ¨¡å¼ - éªŒè¯ç å·²è‡ªåŠ¨å¡«å…¥",-1)),s("span",j,i(E.value),1)])])):t("",!0),s("button",{class:"submit-btn",onClick:q,disabled:!R.value||G.value},i(G.value?"ç™»å½•ä¸­...":"éªŒè¯å¹¶ç™»å½•"),9,x),e[10]||(e[10]=s("div",{class:"tips"},[s("p",null,"ğŸ’¡ éªŒè¯ç å°†å‘é€åˆ°æ‚¨è¾“å…¥çš„é‚®ç®±"),s("p",null,"â° éªŒè¯ç æœ‰æ•ˆæœŸ10åˆ†é’Ÿ")],-1))])]))}},[["__scopeId","data-v-2963ff31"]]);export{C as default};
