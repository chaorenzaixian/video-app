/* empty css             *//* empty css                   *//* empty css                 *//* empty css                       *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                  */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                              *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                *//* empty css                        *//* empty css                    */import{_ as e,a as l}from"./index-C3P4JTuA.js";import{be as a,bk as t,bh as o,bi as i,bj as d,aM as s,bs as n,b6 as u,bt as r,bl as p,bm as c,aR as _,bC as m,aS as v,aT as f,bE as y,bF as b,bo as V,bv as w,bf as g,by as h,aL as x,E as k}from"./element-plus-DlIn_qXi.js";import{r as j,l as U,j as z,y as C,O as F,F as I,z as P,G as S,E as D,C as L,V as H,K as M,L as Y,I as E,H as G,M as K,aa as R}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const $={class:"vip-levels-page"},q=["src"],A={key:1},B={class:"benefits-tags"},J={class:"card-header"},N={class:"header-actions"},O={class:"user-cell"},T={class:"user-info"},W={class:"nickname"},Q={class:"username"},X={class:"level-cell"},Z=["src"],ee={class:"pagination"},le={class:"discount-hint"},ae=e({__name:"VipLevels",setup(e){const ae=j(!1),te=j(!1),oe=j(!1),ie=j([]),de=j([]),se=U({vip_level:null,is_active:null}),ne=U({page:1,pageSize:20,total:0}),ue=j(!1),re=U({level:0,name:"",icon:"",color:"#FFD700",discount:1,description:"",can_download:!1,daily_downloads:0,ad_free:!1,priority_support:!1,exclusive_content:!1}),pe=j(!1),ce=U({user_id:0,username:"",nickname:"",vip_level:0,expire_type:"keep",expire_days:30,is_active:!0}),_e=async()=>{ae.value=!0;try{const e=await l.get("/admin/vip-levels");ie.value=e.data||e||[]}catch(e){}finally{ae.value=!1}},me=async()=>{te.value=!0;try{const e={page:ne.page,page_size:ne.pageSize};null!==se.vip_level&&(e.vip_level=se.vip_level),null!==se.is_active&&(e.is_active=se.is_active);const a=await l.get("/admin/vip-users",{params:e});de.value=a.data||a||[],ne.total=de.value.length}catch(e){}finally{te.value=!1}},ve=e=>{const l=ie.value.find(l=>l.level===e);return(null==l?void 0:l.icon)||""},fe=async()=>{var e,a;oe.value=!0;try{await l.put(`/admin/vip-levels/${re.level}`,{name:re.name,icon:re.icon,color:re.color,discount:re.discount,description:re.description,can_download:re.can_download,daily_downloads:re.daily_downloads,ad_free:re.ad_free,priority_support:re.priority_support,exclusive_content:re.exclusive_content}),k.success("保存成功"),ue.value=!1,_e()}catch(t){k.error("保存失败: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.detail)||t.message))}finally{oe.value=!1}},ye=async()=>{var e,a;oe.value=!0;try{const e={vip_level:ce.vip_level,is_active:ce.is_active};"days"===ce.expire_type?e.expire_days=ce.expire_days:"forever"===ce.expire_type&&(e.expire_days=0),await l.put(`/admin/users/${ce.user_id}/vip`,e),k.success("保存成功"),pe.value=!1,me()}catch(t){k.error("保存失败: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.detail)||t.message))}finally{oe.value=!1}};return z(()=>{_e(),me()}),(e,l)=>{const k=i,j=d,U=s,z=o,_e=a,be=c,Ve=p,we=u,ge=r,he=m,xe=f,ke=v,je=y,Ue=b,ze=V,Ce=w,Fe=_,Ie=t,Pe=h,Se=g,De=n;return P(),C("div",$,[F(_e,{class:"level-card"},{header:I(()=>[...l[22]||(l[22]=[L("div",{class:"card-header"},[L("span",null,"VIP等级配置")],-1)])]),default:I(()=>[S((P(),D(z,{data:ie.value,stripe:""},{default:I(()=>[F(k,{prop:"level",label:"等级",width:"60"}),F(k,{label:"图标",width:"70"},{default:I(({row:e})=>[e.icon?(P(),C("img",{key:0,src:e.icon,class:"level-icon"},null,8,q)):(P(),C("span",A,"-"))]),_:1}),F(k,{prop:"name",label:"名称",width:"120"}),F(k,{label:"颜色",width:"70"},{default:I(({row:e})=>[L("div",{class:"color-preview",style:H({backgroundColor:e.color||"#FFD700"})},null,4)]),_:1}),F(k,{label:"折扣率",width:"80"},{default:I(({row:e})=>[M(Y(0===e.discount?"免费":(100*e.discount).toFixed(0)+"%"),1)]),_:1}),F(k,{label:"权益",width:"180"},{default:I(({row:e})=>[L("div",B,[e.ad_free?(P(),D(j,{key:0,size:"small",type:"success"},{default:I(()=>[...l[23]||(l[23]=[M("免广告",-1)])]),_:1})):E("",!0),e.can_download?(P(),D(j,{key:1,size:"small",type:"primary"},{default:I(()=>[...l[24]||(l[24]=[M("可下载",-1)])]),_:1})):E("",!0),e.priority_support?(P(),D(j,{key:2,size:"small",type:"warning"},{default:I(()=>[...l[25]||(l[25]=[M("优先客服",-1)])]),_:1})):E("",!0),e.exclusive_content?(P(),D(j,{key:3,size:"small",type:"danger"},{default:I(()=>[...l[26]||(l[26]=[M("专属内容",-1)])]),_:1})):E("",!0)])]),_:1}),F(k,{prop:"description",label:"描述","min-width":"120"}),F(k,{label:"操作",width:"80"},{default:I(({row:e})=>[F(U,{link:"",type:"primary",onClick:l=>(e=>{re.level=e.level,re.name=e.name,re.icon=e.icon,re.color=e.color||"#FFD700",re.discount=e.discount??1,re.description=e.description,re.can_download=e.can_download??!1,re.daily_downloads=e.daily_downloads??0,re.ad_free=e.ad_free??!1,re.priority_support=e.priority_support??!1,re.exclusive_content=e.exclusive_content??!1,ue.value=!0})(e)},{default:I(()=>[...l[27]||(l[27]=[M("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[De,ae.value]])]),_:1}),F(_e,{class:"users-card"},{header:I(()=>[L("div",J,[l[28]||(l[28]=L("span",null,"VIP用户管理",-1)),L("div",N,[F(Ve,{modelValue:se.vip_level,"onUpdate:modelValue":l[0]||(l[0]=e=>se.vip_level=e),placeholder:"筛选等级",clearable:"",style:{width:"120px"},onChange:me},{default:I(()=>[(P(!0),C(K,null,R(ie.value,e=>(P(),D(be,{key:e.level,label:e.name,value:e.level},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),F(Ve,{modelValue:se.is_active,"onUpdate:modelValue":l[1]||(l[1]=e=>se.is_active=e),placeholder:"状态",clearable:"",style:{width:"100px"},onChange:me},{default:I(()=>[F(be,{label:"激活",value:!0}),F(be,{label:"过期",value:!1})]),_:1},8,["modelValue"])])])]),default:I(()=>[S((P(),D(z,{data:de.value,stripe:""},{default:I(()=>[F(k,{prop:"id",label:"ID",width:"80"}),F(k,{label:"用户",width:"200"},{default:I(({row:e})=>[L("div",O,[F(we,{src:e.avatar||"/images/avatars/icon_avatar_1.webp",size:32},null,8,["src"]),L("div",T,[L("span",W,Y(e.nickname||e.username),1),L("span",Q,"@"+Y(e.username),1)])])]),_:1}),F(k,{label:"VIP等级",width:"150"},{default:I(({row:e})=>[L("div",X,[ve(e.vip_level)?(P(),C("img",{key:0,src:ve(e.vip_level),class:"level-icon-sm"},null,8,Z)):E("",!0),L("span",null,Y(e.vip_level_name),1)])]),_:1}),F(k,{label:"状态",width:"100"},{default:I(({row:e})=>[F(j,{type:e.is_active?"success":"danger",size:"small"},{default:I(()=>[M(Y(e.is_active?"激活":"过期"),1)]),_:2},1032,["type"])]),_:1}),F(k,{label:"到期时间",width:"160"},{default:I(({row:e})=>{return[L("span",{class:G({expired:!e.is_active})},Y((l=e.expire_date,l?x(l).format("YYYY-MM-DD HH:mm"):"-")),3)];var l}),_:1}),F(k,{prop:"total_days",label:"累计天数",width:"100"}),F(k,{label:"操作",width:"100"},{default:I(({row:e})=>[F(U,{link:"",type:"primary",onClick:l=>(e=>{ce.user_id=e.id,ce.username=e.username,ce.nickname=e.nickname,ce.vip_level=e.vip_level,ce.expire_type="keep",ce.expire_days=30,ce.is_active=e.is_active,pe.value=!0})(e)},{default:I(()=>[...l[29]||(l[29]=[M("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[De,te.value]]),L("div",ee,[F(ge,{"current-page":ne.page,"onUpdate:currentPage":l[2]||(l[2]=e=>ne.page=e),"page-size":ne.pageSize,"onUpdate:pageSize":l[3]||(l[3]=e=>ne.pageSize=e),total:ne.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:me,onCurrentChange:me},null,8,["current-page","page-size","total"])])]),_:1}),F(Ie,{modelValue:ue.value,"onUpdate:modelValue":l[15]||(l[15]=e=>ue.value=e),title:"编辑VIP等级",width:"550px"},{footer:I(()=>[F(U,{onClick:l[14]||(l[14]=e=>ue.value=!1)},{default:I(()=>[...l[32]||(l[32]=[M("取消",-1)])]),_:1}),F(U,{type:"primary",onClick:fe,loading:oe.value},{default:I(()=>[...l[33]||(l[33]=[M("保存",-1)])]),_:1},8,["loading"])]),default:I(()=>[F(Fe,{model:re,"label-width":"100px"},{default:I(()=>[F(he,{"content-position":"left"},{default:I(()=>[...l[30]||(l[30]=[M("基础信息",-1)])]),_:1}),F(ke,{label:"等级"},{default:I(()=>[F(xe,{value:"Level "+re.level,disabled:""},null,8,["value"])]),_:1}),F(ke,{label:"名称"},{default:I(()=>[F(xe,{modelValue:re.name,"onUpdate:modelValue":l[4]||(l[4]=e=>re.name=e)},null,8,["modelValue"])]),_:1}),F(ke,{label:"图标URL"},{default:I(()=>[F(xe,{modelValue:re.icon,"onUpdate:modelValue":l[5]||(l[5]=e=>re.icon=e)},null,8,["modelValue"])]),_:1}),F(ke,{label:"等级颜色"},{default:I(()=>[F(je,{modelValue:re.color,"onUpdate:modelValue":l[6]||(l[6]=e=>re.color=e)},null,8,["modelValue"])]),_:1}),F(ke,{label:"折扣率"},{default:I(()=>[F(Ue,{modelValue:re.discount,"onUpdate:modelValue":l[7]||(l[7]=e=>re.discount=e),min:0,max:1,step:.05,"format-tooltip":e=>0===e?"免费":(100*e).toFixed(0)+"%"},null,8,["modelValue","format-tooltip"]),L("span",le,Y(0===re.discount?"免费":(100*re.discount).toFixed(0)+"%"),1)]),_:1}),F(ke,{label:"描述"},{default:I(()=>[F(xe,{modelValue:re.description,"onUpdate:modelValue":l[8]||(l[8]=e=>re.description=e),type:"textarea"},null,8,["modelValue"])]),_:1}),F(he,{"content-position":"left"},{default:I(()=>[...l[31]||(l[31]=[M("权益配置",-1)])]),_:1}),F(ke,{label:"免广告"},{default:I(()=>[F(ze,{modelValue:re.ad_free,"onUpdate:modelValue":l[9]||(l[9]=e=>re.ad_free=e)},null,8,["modelValue"])]),_:1}),F(ke,{label:"可下载"},{default:I(()=>[F(ze,{modelValue:re.can_download,"onUpdate:modelValue":l[10]||(l[10]=e=>re.can_download=e)},null,8,["modelValue"])]),_:1}),re.can_download?(P(),D(ke,{key:0,label:"每日下载次数"},{default:I(()=>[F(Ce,{modelValue:re.daily_downloads,"onUpdate:modelValue":l[11]||(l[11]=e=>re.daily_downloads=e),min:0,max:1e3},null,8,["modelValue"])]),_:1})):E("",!0),F(ke,{label:"优先客服"},{default:I(()=>[F(ze,{modelValue:re.priority_support,"onUpdate:modelValue":l[12]||(l[12]=e=>re.priority_support=e)},null,8,["modelValue"])]),_:1}),F(ke,{label:"专属内容"},{default:I(()=>[F(ze,{modelValue:re.exclusive_content,"onUpdate:modelValue":l[13]||(l[13]=e=>re.exclusive_content=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),F(Ie,{modelValue:pe.value,"onUpdate:modelValue":l[21]||(l[21]=e=>pe.value=e),title:"编辑用户VIP",width:"450px"},{footer:I(()=>[F(U,{onClick:l[20]||(l[20]=e=>pe.value=!1)},{default:I(()=>[...l[37]||(l[37]=[M("取消",-1)])]),_:1}),F(U,{type:"primary",onClick:ye,loading:oe.value},{default:I(()=>[...l[38]||(l[38]=[M("保存",-1)])]),_:1},8,["loading"])]),default:I(()=>[F(Fe,{model:ce,"label-width":"100px"},{default:I(()=>[F(ke,{label:"用户"},{default:I(()=>[L("span",null,Y(ce.nickname||ce.username)+" (@"+Y(ce.username)+")",1)]),_:1}),F(ke,{label:"VIP等级"},{default:I(()=>[F(Ve,{modelValue:ce.vip_level,"onUpdate:modelValue":l[16]||(l[16]=e=>ce.vip_level=e),style:{width:"100%"}},{default:I(()=>[(P(!0),C(K,null,R(ie.value,e=>(P(),D(be,{key:e.level,label:e.name,value:e.level},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),F(ke,{label:"有效期设置"},{default:I(()=>[F(Se,{modelValue:ce.expire_type,"onUpdate:modelValue":l[17]||(l[17]=e=>ce.expire_type=e)},{default:I(()=>[F(Pe,{label:"keep"},{default:I(()=>[...l[34]||(l[34]=[M("保持不变",-1)])]),_:1}),F(Pe,{label:"days"},{default:I(()=>[...l[35]||(l[35]=[M("指定天数",-1)])]),_:1}),F(Pe,{label:"forever"},{default:I(()=>[...l[36]||(l[36]=[M("永久",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"days"===ce.expire_type?(P(),D(ke,{key:0,label:"天数"},{default:I(()=>[F(Ce,{modelValue:ce.expire_days,"onUpdate:modelValue":l[18]||(l[18]=e=>ce.expire_days=e),min:1,max:3650},null,8,["modelValue"])]),_:1})):E("",!0),F(ke,{label:"激活状态"},{default:I(()=>[F(ze,{modelValue:ce.is_active,"onUpdate:modelValue":l[19]||(l[19]=e=>ce.is_active=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5bfbc7ed"]]);export{ae as default};
