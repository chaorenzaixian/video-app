/* empty css             *//* empty css                   *//* empty css                   *//* empty css                 *//* empty css                *//* empty css                    *//* empty css                    *//* empty css                          *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                   *//* empty css                  *//* empty css                 *//* empty css                        */import{r as e,l as a,c as l,j as t,y as r,O as s,F as i,z as o,C as d,G as u,K as n,u as p,E as c,L as m,I as f,M as v,aa as h,ae as g}from"./vue-vendor-Ba_vealp.js";import{be as _,bk as y,E as b,bz as w,bA as j,aM as x,aQ as k,a6 as z,bh as V,bi as C,bn as S,bj as U,br as M,bs as $,bt as I,bB as P,aU as Y,aT as F,aJ as K,aL as L}from"./element-plus-DlIn_qXi.js";import{_ as A,a as D}from"./index-C3P4JTuA.js";import"./utils-DflAyOWx.js";const E={class:"featured-page"},G={class:"tab-header"},H={key:1},J={class:"pagination-wrapper"},O={class:"category-featured"},B={class:"category-section"},Q={key:0,class:"featured-summary"},R={class:"search-bar"},T={key:1,class:"text-muted"},W=A({__name:"Featured",setup(A){const W=e("videos"),q=e([]),N=e(!1),X=a({page:1,pageSize:20,total:0}),Z=e(!1),ee=e(""),ae=e([]),le=e(!1),te=e([]),re=e([]),se=l(()=>te.value.filter(e=>!e.parent_id||1===e.level)),ie=l(()=>se.value.filter(e=>e.children&&e.children.length>0)),oe=l(()=>{const e=[],a=l=>{for(const t of l)re.value.includes(t.id)&&e.push(t.name),t.children&&a(t.children)};return a(te.value),e}),de=e=>e?e.startsWith("http")?e:`${e}`:"",ue=e=>{if(!e)return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},ne=async()=>{N.value=!0;try{const e=await D.get("/admin/videos",{params:{page:X.page,page_size:X.pageSize,is_featured:!0}});q.value=e.data.items||[],X.total=e.data.total||0}catch(e){b.error("获取推荐视频失败")}finally{N.value=!1}},pe=async()=>{le.value=!0;try{const e={page:1,page_size:20};ee.value.trim()&&(e.search=ee.value);const a=await D.get("/admin/videos",{params:e});ae.value=a.data.items||[]}catch(e){b.error("搜索视频失败")}finally{le.value=!1}},ce=e=>{for(const a of e)a.is_featured&&re.value.push(a.id),a.children&&ce(a.children)},me=async()=>{try{await D.post("/admin/categories/featured",{category_ids:re.value}),b.success("保存成功")}catch(e){b.error("保存失败")}};return t(()=>{ne(),(async()=>{try{const e=await D.get("/videos/categories");te.value=e.data||[],ce(te.value)}catch(e){}})()}),(e,a)=>{const l=k,t=x,A=S,te=C,ce=U,fe=M,ve=V,he=I,ge=j,_e=Y,ye=P,be=w,we=_,je=F,xe=y,ke=$;return o(),r("div",E,[s(we,null,{header:i(()=>[...a[9]||(a[9]=[d("div",{class:"card-header"},[d("span",null,"推荐管理")],-1)])]),default:i(()=>[s(be,{modelValue:W.value,"onUpdate:modelValue":a[5]||(a[5]=e=>W.value=e)},{default:i(()=>[s(ge,{label:"视频推荐",name:"videos"},{default:i(()=>[d("div",G,[s(t,{type:"primary",onClick:a[0]||(a[0]=e=>Z.value=!0)},{default:i(()=>[s(l,null,{default:i(()=>[s(p(z))]),_:1}),a[10]||(a[10]=n("添加推荐视频 ",-1))]),_:1})]),u((o(),c(ve,{data:q.value,stripe:""},{default:i(()=>[s(te,{label:"封面",width:"120"},{default:i(({row:e})=>[s(A,{src:de(e.cover_url),fit:"cover",style:{width:"100px",height:"56px","border-radius":"4px"}},{error:i(()=>[...a[11]||(a[11]=[d("div",{class:"image-error"},"加载失败",-1)])]),_:1},8,["src"])]),_:1}),s(te,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),s(te,{label:"分类",width:"100"},{default:i(({row:e})=>[n(m(e.category_name||"-"),1)]),_:1}),s(te,{label:"时长",width:"80"},{default:i(({row:e})=>[n(m(ue(e.duration)),1)]),_:1}),s(te,{prop:"view_count",label:"播放",width:"80"}),s(te,{label:"VIP",width:"60"},{default:i(({row:e})=>[e.is_vip_only?(o(),c(ce,{key:0,type:"warning",size:"small"},{default:i(()=>[...a[12]||(a[12]=[n("VIP",-1)])]),_:1})):(o(),r("span",H,"-"))]),_:1}),s(te,{label:"上传时间",width:"160"},{default:i(({row:e})=>{return[n(m((a=e.created_at,a?L(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),s(te,{label:"操作",width:"100",fixed:"right"},{default:i(({row:e})=>[s(fe,{title:"确定要取消推荐吗？",onConfirm:a=>(async e=>{try{await D.put(`/admin/videos/${e.id}`,{is_featured:!1}),b.success("取消推荐成功"),ne()}catch(a){b.error("取消推荐失败")}})(e)},{reference:i(()=>[s(t,{type:"danger",size:"small",link:""},{default:i(()=>[...a[13]||(a[13]=[n("取消推荐",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[ke,N.value]]),d("div",J,[s(he,{"current-page":X.page,"onUpdate:currentPage":a[1]||(a[1]=e=>X.page=e),"page-size":X.pageSize,"onUpdate:pageSize":a[2]||(a[2]=e=>X.pageSize=e),"page-sizes":[10,20,50,100],total:X.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ne,onCurrentChange:ne},null,8,["current-page","page-size","total"])])]),_:1}),s(ge,{label:"分类推荐",name:"categories"},{default:i(()=>[d("div",O,[a[16]||(a[16]=d("p",{class:"tip"},"选择要在首页显示的推荐分类（支持一级和二级分类）",-1)),d("div",B,[a[14]||(a[14]=d("h4",null,"一级分类",-1)),s(ye,{modelValue:re.value,"onUpdate:modelValue":a[3]||(a[3]=e=>re.value=e),onChange:me},{default:i(()=>[(o(!0),r(v,null,h(se.value,e=>(o(),c(_e,{key:e.id,label:e.id},{default:i(()=>[n(m(e.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),(o(!0),r(v,null,h(ie.value,e=>(o(),r("div",{class:"category-section",key:e.id},[d("h4",null,m(e.name)+" - 二级分类",1),s(ye,{modelValue:re.value,"onUpdate:modelValue":a[4]||(a[4]=e=>re.value=e),onChange:me},{default:i(()=>[(o(!0),r(v,null,h(e.children,e=>(o(),c(_e,{key:e.id,label:e.id},{default:i(()=>[n(m(e.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]))),128)),oe.value.length>0?(o(),r("div",Q,[a[15]||(a[15]=d("span",{class:"label"},"当前推荐分类：",-1)),(o(!0),r(v,null,h(oe.value,e=>(o(),c(ce,{key:e,type:"success",style:{"margin-right":"8px","margin-bottom":"8px"}},{default:i(()=>[n(m(e),1)]),_:2},1024))),128))])):f("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(xe,{modelValue:Z.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Z.value=e),title:"添加推荐视频",width:"800px"},{footer:i(()=>[s(t,{onClick:a[7]||(a[7]=e=>Z.value=!1)},{default:i(()=>[...a[22]||(a[22]=[n("关闭",-1)])]),_:1})]),default:i(()=>[d("div",R,[s(je,{modelValue:ee.value,"onUpdate:modelValue":a[6]||(a[6]=e=>ee.value=e),placeholder:"搜索视频标题...",clearable:"",style:{width:"300px"},onKeyup:g(pe,["enter"])},{prefix:i(()=>[s(l,null,{default:i(()=>[s(p(K))]),_:1})]),_:1},8,["modelValue"]),s(t,{type:"primary",onClick:pe},{default:i(()=>[...a[17]||(a[17]=[n("搜索",-1)])]),_:1})]),u((o(),c(ve,{data:ae.value,stripe:"",style:{"margin-top":"16px"},"max-height":"400px"},{default:i(()=>[s(te,{label:"封面",width:"100"},{default:i(({row:e})=>[s(A,{src:de(e.cover_url),fit:"cover",style:{width:"80px",height:"45px","border-radius":"4px"}},{error:i(()=>[...a[18]||(a[18]=[d("div",{class:"image-error"},"加载失败",-1)])]),_:1},8,["src"])]),_:1}),s(te,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),s(te,{label:"分类",width:"100"},{default:i(({row:e})=>[n(m(e.category_name||"-"),1)]),_:1}),s(te,{label:"状态",width:"100"},{default:i(({row:e})=>[e.is_featured?(o(),c(ce,{key:0,type:"success",size:"small"},{default:i(()=>[...a[19]||(a[19]=[n("已推荐",-1)])]),_:1})):(o(),c(ce,{key:1,type:"info",size:"small"},{default:i(()=>[...a[20]||(a[20]=[n("未推荐",-1)])]),_:1}))]),_:1}),s(te,{label:"操作",width:"100",fixed:"right"},{default:i(({row:e})=>[e.is_featured?(o(),r("span",T,"已推荐")):(o(),c(t,{key:0,type:"primary",size:"small",link:"",onClick:a=>(async e=>{try{await D.put(`/admin/videos/${e.id}`,{is_featured:!0}),b.success("添加推荐成功"),e.is_featured=!0,ne()}catch(a){b.error("添加推荐失败")}})(e)},{default:i(()=>[...a[21]||(a[21]=[n(" 添加推荐 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[ke,le.value]])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-f666f68c"]]);export{W as default};
