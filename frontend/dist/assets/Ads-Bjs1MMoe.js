/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                             *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                  *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                        *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                 *//* empty css                        */import{r as e,l as a,c as l,j as t,y as i,O as o,F as d,z as s,C as r,G as n,E as u,I as p,L as m,K as c,u as _,U as g,M as v,aa as y}from"./vue-vendor-Ba_vealp.js";import{_ as b,a as h}from"./index-C3P4JTuA.js";import{be as f,bk as E,bl as V,bm as w,bh as O,bi as x,bn as I,bj as D,bo as M,aM as j,bs as k,bt as P,aQ as S,a6 as R,aR as H,aS as U,aT as A,bf as C,bg as z,bw as T,aF as L,bv as B,bD as G,E as N,a as F}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const q={class:"ads-page"},$={class:"card-header"},K={class:"filter-bar"},Q={key:0,class:"preview-images"},J={key:0,class:"extra-count"},W={class:"pagination"},X={key:0,class:"media-preview"},Y=["src"],Z={key:1,class:"upload-placeholder"},ee={class:"extra-images-section"},ae={class:"extra-images-tip"},le={class:"extra-images-list"},te=["onClick"],ie={class:"add-image-btn"},oe=b({__name:"Ads",setup(b){const oe=e(!1),de=e(!1),se=e(!1),re=e(!1),ne=e([]),ue=a({position:"",ad_type:""}),pe=a({page:1,pageSize:20,total:0}),me=a({id:null,title:"",description:"",ad_type:"IMAGE",media_url:"",extra_images:[],html_content:"",target_url:"",position:"VIDEO_PRE",duration:5,priority:0,dateRange:null}),ce=l(()=>"/api/v1/ads/upload/image"),_e=l(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),ge={SPLASH:"开屏广告",HOME_BANNER:"首页横幅",HOME_POPUP:"首页弹窗",VIDEO_PRE:"视频前贴",VIDEO_MID:"视频中插",VIDEO_POST:"视频后贴",SIDEBAR:"侧边栏",FEED:"信息流"},ve={SPLASH:"danger",VIDEO_PRE:"danger",VIDEO_MID:"warning",VIDEO_POST:"info",HOME_BANNER:"success",HOME_POPUP:"primary",SIDEBAR:"",FEED:""},ye=e=>ge[e]||e,be=async()=>{var e,a;oe.value=!0;try{const l={page:pe.page,page_size:pe.pageSize};ue.position&&(l.position=ue.position),ue.ad_type&&(l.ad_type=ue.ad_type);const t=await h.get("/ads/admin",{params:l});ne.value=(null==(e=t.data)?void 0:e.items)||t.data||[],pe.total=(null==(a=t.data)?void 0:a.total)||ne.value.length}catch(l){}finally{oe.value=!1}},he=()=>{me.id=null,me.title="",me.description="",me.ad_type="IMAGE",me.media_url="",me.extra_images=[],me.html_content="",me.target_url="",me.position="VIDEO_PRE",me.duration=5,me.priority=0,me.dateRange=null,re.value=!1,se.value=!0},fe=e=>{me.media_url=e.url,N.success("上传成功")},Ee=e=>{me.extra_images.push(e.url),N.success("上传成功")},Ve=async()=>{var e,a,l,t,i,o;if(me.title&&me.position){de.value=!0;try{const i={title:me.title,description:me.description,ad_type:me.ad_type,media_url:me.media_url,extra_images:me.extra_images,html_content:me.html_content,target_url:me.target_url,position:me.position,duration:me.duration,priority:me.priority,start_date:(null==(a=null==(e=me.dateRange)?void 0:e[0])?void 0:a.toISOString())||null,end_date:(null==(t=null==(l=me.dateRange)?void 0:l[1])?void 0:t.toISOString())||null};re.value?(await h.put(`/ads/admin/${me.id}`,i),N.success("更新成功")):(await h.post("/ads/admin",i),N.success("创建成功")),se.value=!1,be()}catch(d){N.error((null==(o=null==(i=d.response)?void 0:i.data)?void 0:o.detail)||"保存失败")}finally{de.value=!1}}else N.warning("请填写广告标题和位置")};return t(()=>{be()}),(e,a)=>{const l=S,t=j,b=w,ge=V,we=x,Oe=I,xe=D,Ie=M,De=O,Me=P,je=f,ke=A,Pe=U,Se=z,Re=C,He=T,Ue=B,Ae=G,Ce=H,ze=E,Te=k;return s(),i("div",q,[o(je,null,{header:d(()=>[r("div",$,[a[17]||(a[17]=r("span",null,"广告管理",-1)),o(t,{type:"primary",onClick:he},{default:d(()=>[o(l,null,{default:d(()=>[o(_(R))]),_:1}),a[16]||(a[16]=c(" 新增广告 ",-1))]),_:1})])]),default:d(()=>[r("div",K,[o(ge,{modelValue:ue.position,"onUpdate:modelValue":a[0]||(a[0]=e=>ue.position=e),placeholder:"广告位置",clearable:"",style:{width:"150px"},onChange:be},{default:d(()=>[o(b,{label:"开屏广告",value:"SPLASH"}),o(b,{label:"首页横幅",value:"HOME_BANNER"}),o(b,{label:"首页弹窗",value:"HOME_POPUP"}),o(b,{label:"视频前贴",value:"VIDEO_PRE"}),o(b,{label:"视频中插",value:"VIDEO_MID"}),o(b,{label:"视频后贴",value:"VIDEO_POST"}),o(b,{label:"侧边栏",value:"SIDEBAR"}),o(b,{label:"信息流",value:"FEED"})]),_:1},8,["modelValue"]),o(ge,{modelValue:ue.ad_type,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.ad_type=e),placeholder:"广告类型",clearable:"",style:{width:"120px"},onChange:be},{default:d(()=>[o(b,{label:"图片",value:"IMAGE"}),o(b,{label:"视频",value:"VIDEO"}),o(b,{label:"HTML",value:"HTML"})]),_:1},8,["modelValue"])]),n((s(),u(De,{data:ne.value,stripe:""},{default:d(()=>[o(we,{prop:"id",label:"ID",width:"60"}),o(we,{label:"预览",width:"120"},{default:d(({row:e})=>{var l;return["image"===e.ad_type||"IMAGE"===e.ad_type?(s(),i("div",Q,[o(Oe,{src:e.media_url,style:{width:"80px",height:"45px","object-fit":"cover","border-radius":"4px"},fit:"cover"},null,8,["src"]),(null==(l=e.extra_images)?void 0:l.length)?(s(),i("span",J,"+"+m(e.extra_images.length),1)):p("",!0)])):"video"===e.ad_type||"VIDEO"===e.ad_type?(s(),u(xe,{key:1,type:"primary",size:"small"},{default:d(()=>[...a[18]||(a[18]=[c("视频广告",-1)])]),_:1})):(s(),u(xe,{key:2,type:"info",size:"small"},{default:d(()=>[...a[19]||(a[19]=[c("HTML",-1)])]),_:1}))]}),_:1}),o(we,{prop:"title",label:"标题","min-width":"150"}),o(we,{label:"位置",width:"100"},{default:d(({row:e})=>{return[o(xe,{type:(a=e.position,ve[a]||""),size:"small"},{default:d(()=>[c(m(ye(e.position)),1)]),_:2},1032,["type"])];var a}),_:1}),o(we,{prop:"duration",label:"时长(秒)",width:"80"}),o(we,{prop:"impression_count",label:"展示",width:"80"}),o(we,{prop:"click_count",label:"点击",width:"80"}),o(we,{label:"CTR",width:"80"},{default:d(({row:e})=>[c(m(e.impression_count>0?(e.click_count/e.impression_count*100).toFixed(2):0)+"% ",1)]),_:1}),o(we,{label:"状态",width:"80"},{default:d(({row:e})=>[o(Ie,{modelValue:e.is_active,"onUpdate:modelValue":a=>e.is_active=a,onChange:a=>(async e=>{try{await h.put(`/ads/admin/${e.id}`,{is_active:e.is_active}),N.success(e.is_active?"已启用":"已禁用")}catch(a){e.is_active=!e.is_active,N.error("操作失败")}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(we,{label:"操作",width:"150"},{default:d(({row:e})=>[o(t,{link:"",type:"primary",onClick:a=>(e=>{me.id=e.id,me.title=e.title,me.description=e.description||"",me.ad_type=e.ad_type,me.media_url=e.media_url||"",me.extra_images=e.extra_images||[],me.html_content=e.html_content||"",me.target_url=e.target_url||"",me.position=e.position,me.duration=e.duration||5,me.priority=e.priority||0,me.dateRange=e.start_date&&e.end_date?[new Date(e.start_date),new Date(e.end_date)]:null,re.value=!0,se.value=!0})(e)},{default:d(()=>[...a[20]||(a[20]=[c("编辑",-1)])]),_:1},8,["onClick"]),o(t,{link:"",type:"danger",onClick:a=>(async e=>{try{await F.confirm("确定删除此广告吗？","提示",{type:"warning"}),await h.delete(`/ads/admin/${e.id}`),N.success("删除成功"),be()}catch(a){"cancel"!==a&&N.error("删除失败")}})(e)},{default:d(()=>[...a[21]||(a[21]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Te,oe.value]]),r("div",W,[o(Me,{"current-page":pe.page,"onUpdate:currentPage":a[2]||(a[2]=e=>pe.page=e),"page-size":pe.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>pe.pageSize=e),total:pe.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:be,onCurrentChange:be},null,8,["current-page","page-size","total"])])]),_:1}),o(ze,{modelValue:se.value,"onUpdate:modelValue":a[15]||(a[15]=e=>se.value=e),title:re.value?"编辑广告":"新增广告",width:"650px","destroy-on-close":""},{footer:d(()=>[o(t,{onClick:a[14]||(a[14]=e=>se.value=!1)},{default:d(()=>[...a[29]||(a[29]=[c("取消",-1)])]),_:1}),o(t,{type:"primary",onClick:Ve,loading:de.value},{default:d(()=>[...a[30]||(a[30]=[c("保存",-1)])]),_:1},8,["loading"])]),default:d(()=>[o(Ce,{model:me,"label-width":"100px"},{default:d(()=>[o(Pe,{label:"广告标题",required:""},{default:d(()=>[o(ke,{modelValue:me.title,"onUpdate:modelValue":a[4]||(a[4]=e=>me.title=e),placeholder:"请输入广告标题"},null,8,["modelValue"])]),_:1}),o(Pe,{label:"广告描述"},{default:d(()=>[o(ke,{modelValue:me.description,"onUpdate:modelValue":a[5]||(a[5]=e=>me.description=e),type:"textarea",rows:"2",placeholder:"广告描述（可选）"},null,8,["modelValue"])]),_:1}),o(Pe,{label:"广告位置",required:""},{default:d(()=>[o(ge,{modelValue:me.position,"onUpdate:modelValue":a[6]||(a[6]=e=>me.position=e),style:{width:"100%"}},{default:d(()=>[o(b,{label:"开屏广告（启动时全屏显示）",value:"SPLASH"}),o(b,{label:"首页横幅",value:"HOME_BANNER"}),o(b,{label:"首页弹窗（支持多图）",value:"HOME_POPUP"}),o(b,{label:"视频前贴（5秒）",value:"VIDEO_PRE"}),o(b,{label:"视频中插",value:"VIDEO_MID"}),o(b,{label:"视频后贴",value:"VIDEO_POST"}),o(b,{label:"侧边栏",value:"SIDEBAR"}),o(b,{label:"信息流",value:"FEED"})]),_:1},8,["modelValue"])]),_:1}),o(Pe,{label:"广告类型",required:""},{default:d(()=>[o(Re,{modelValue:me.ad_type,"onUpdate:modelValue":a[7]||(a[7]=e=>me.ad_type=e)},{default:d(()=>[o(Se,{label:"IMAGE"},{default:d(()=>[...a[22]||(a[22]=[c("图片",-1)])]),_:1}),o(Se,{label:"VIDEO"},{default:d(()=>[...a[23]||(a[23]=[c("视频",-1)])]),_:1}),o(Se,{label:"HTML"},{default:d(()=>[...a[24]||(a[24]=[c("HTML",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"HTML"!==me.ad_type?(s(),u(Pe,{key:0,label:"主图"},{default:d(()=>[o(He,{class:"media-uploader",action:ce.value,headers:_e.value,"show-file-list":!1,"on-success":fe,accept:"VIDEO"===me.ad_type?"video/*":"image/*"},{default:d(()=>[me.media_url?(s(),i("div",X,["IMAGE"===me.ad_type?(s(),u(Oe,{key:0,src:me.media_url,fit:"cover"},null,8,["src"])):(s(),i("video",{key:1,src:me.media_url,style:{"max-width":"100%","max-height":"150px"}},null,8,Y)),r("div",{class:"remove-btn",onClick:a[8]||(a[8]=g(e=>me.media_url="",["stop"]))},"×")])):(s(),i("div",Z,[o(l,null,{default:d(()=>[o(_(L))]),_:1}),r("span",null,"点击上传"+m("VIDEO"===me.ad_type?"视频":"主图"),1)]))]),_:1},8,["action","headers","accept"])]),_:1})):p("",!0),"HOME_POPUP"===me.position&&"IMAGE"===me.ad_type?(s(),u(Pe,{key:1,label:"额外图片"},{default:d(()=>[r("div",ee,[r("div",ae,[o(xe,{type:"info",size:"small"},{default:d(()=>[...a[25]||(a[25]=[c("排版说明",-1)])]),_:1}),a[26]||(a[26]=r("span",null,"1张=单图 | 2张=上下排版 | 3张以上=宫格排版",-1))]),r("div",le,[(s(!0),i(v,null,y(me.extra_images,(e,a)=>(s(),i("div",{key:a,class:"extra-image-item"},[o(Oe,{src:e,fit:"cover"},null,8,["src"]),r("div",{class:"remove-btn",onClick:e=>(e=>{me.extra_images.splice(e,1)})(a)},"×",8,te)]))),128)),me.extra_images.length<8?(s(),u(He,{key:0,class:"extra-image-uploader",action:ce.value,headers:_e.value,"show-file-list":!1,"on-success":Ee,accept:"image/*"},{default:d(()=>[r("div",ie,[o(l,null,{default:d(()=>[o(_(R))]),_:1})])]),_:1},8,["action","headers"])):p("",!0)])])]),_:1})):p("",!0),"HTML"===me.ad_type?(s(),u(Pe,{key:2,label:"HTML内容"},{default:d(()=>[o(ke,{modelValue:me.html_content,"onUpdate:modelValue":a[9]||(a[9]=e=>me.html_content=e),type:"textarea",rows:"4",placeholder:"输入HTML代码"},null,8,["modelValue"])]),_:1})):p("",!0),o(Pe,{label:"跳转链接"},{default:d(()=>[o(ke,{modelValue:me.target_url,"onUpdate:modelValue":a[10]||(a[10]=e=>me.target_url=e),placeholder:"点击广告跳转的URL"},null,8,["modelValue"])]),_:1}),o(Pe,{label:"展示时长"},{default:d(()=>[o(Ue,{modelValue:me.duration,"onUpdate:modelValue":a[11]||(a[11]=e=>me.duration=e),min:1,max:60},null,8,["modelValue"]),a[27]||(a[27]=r("span",{style:{"margin-left":"8px",color:"#909399"}},"秒",-1))]),_:1}),o(Pe,{label:"有效期"},{default:d(()=>[o(Ae,{modelValue:me.dateRange,"onUpdate:modelValue":a[12]||(a[12]=e=>me.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(Pe,{label:"优先级"},{default:d(()=>[o(Ue,{modelValue:me.priority,"onUpdate:modelValue":a[13]||(a[13]=e=>me.priority=e),min:0,max:100},null,8,["modelValue"]),a[28]||(a[28]=r("span",{style:{"margin-left":"8px",color:"#909399"}},"数字越大优先级越高",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-224a27d0"]]);export{oe as default};
