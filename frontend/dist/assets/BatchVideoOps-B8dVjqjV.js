/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                 *//* empty css                        *//* empty css                  */import{r as e,l as a,j as l,y as t,C as i,G as o,O as s,F as d,ae as u,E as r,z as n,K as p,L as c,M as v,aa as g,u as m}from"./vue-vendor-Ba_vealp.js";import{E as y,aM as b,aT as _,bl as f,bs as h,bt as w,bk as V,bh as k,bm as j,bi as C,bn as x,aQ as z,ac as U,bj as $,aR as S,aS as P,a as I}from"./element-plus-DlIn_qXi.js";import{_ as K,a as O}from"./index-C3P4JTuA.js";import"./utils-DflAyOWx.js";const E={class:"batch-video-ops"},F={class:"page-header"},G={class:"header-actions"},L={class:"filter-bar"},M={class:"image-placeholder"},q={key:1,class:"text-muted"},B={class:"pagination"},D=K({__name:"BatchVideoOps",setup(K){const D=e(!1),J=e([]),N=e([]),Q=e([]),R=e(!1),T=e(!1),A=e(!1),H=e(""),W=e(null),X=a({keyword:"",category_id:null,status:"",is_vip:null}),Y=a({page:1,pageSize:20,total:0}),Z={active:"正常",pending:"待审核",disabled:"已禁用",processing:"处理中",failed:"处理失败"};l(()=>{ee(),ae()});const ee=async()=>{try{const e=await O.get("/videos/categories");N.value=e.data||e||[]}catch(e){}},ae=async()=>{D.value=!0,Q.value=[];try{const e={page:Y.page,page_size:Y.pageSize};X.keyword&&(e.keyword=X.keyword),X.category_id&&(e.category_id=X.category_id),X.status&&(e.status=X.status),null!==X.is_vip&&""!==X.is_vip&&(e.is_vip=X.is_vip);const a=await O.get("/admin/videos",{params:e}),l=a.data||a;J.value=l.items||l.videos||[],Y.total=l.total||0}catch(e){y.error("获取视频列表失败")}finally{D.value=!1}},le=()=>{X.keyword="",X.category_id=null,X.status="",X.is_vip=null,Y.page=1,ae()},te=e=>{Q.value=e},ie=()=>{H.value="",T.value=!0},oe=()=>{W.value=null,A.value=!0},se=async()=>{if(H.value){R.value=!0;try{let e=0,a=0;for(const l of Q.value)try{await O.put(`/admin/videos/${l.id}/status`,{status:H.value}),e++}catch{a++}T.value=!1,y.success(`批量修改完成: 成功 ${e} 个, 失败 ${a} 个`),ae()}catch(e){y.error("批量修改状态失败")}finally{R.value=!1}}else y.warning("请选择状态")},de=async()=>{if(W.value){R.value=!0;try{let e=0,a=0;for(const l of Q.value)try{await O.put(`/admin/videos/${l.id}`,{category_id:W.value}),e++}catch{a++}A.value=!1,y.success(`批量修改完成: 成功 ${e} 个, 失败 ${a} 个`),ae()}catch(e){y.error("批量修改分类失败")}finally{R.value=!1}}else y.warning("请选择分类")},ue=async()=>{try{await I.confirm(`确定要删除选中的 ${Q.value.length} 个视频吗? 此操作不可恢复!`,"警告",{type:"warning"}),R.value=!0;let e=0,a=0;for(const l of Q.value)try{await O.delete(`/admin/videos/${l.id}`),e++}catch{a++}y.success(`批量删除完成: 成功 ${e} 个, 失败 ${a} 个`),ae()}catch(e){"cancel"!==e&&y.error("批量删除失败")}finally{R.value=!1}};return(e,a)=>{const l=b,y=_,I=j,K=f,O=C,ee=z,re=x,ne=$,pe=k,ce=w,ve=P,ge=S,me=V,ye=h;return n(),t("div",E,[i("div",F,[a[12]||(a[12]=i("h1",null,"视频批量操作",-1)),i("div",G,[s(l,{type:"primary",disabled:!Q.value.length,onClick:ie},{default:d(()=>[p(" 批量修改状态 ("+c(Q.value.length)+") ",1)]),_:1},8,["disabled"]),s(l,{type:"warning",disabled:!Q.value.length,onClick:oe},{default:d(()=>[p(" 批量修改分类 ("+c(Q.value.length)+") ",1)]),_:1},8,["disabled"]),s(l,{type:"danger",disabled:!Q.value.length,onClick:ue},{default:d(()=>[p(" 批量删除 ("+c(Q.value.length)+") ",1)]),_:1},8,["disabled"])])]),i("div",L,[s(y,{modelValue:X.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>X.keyword=e),placeholder:"搜索视频标题",clearable:"",style:{width:"200px"},onKeyup:u(ae,["enter"])},null,8,["modelValue"]),s(K,{modelValue:X.category_id,"onUpdate:modelValue":a[1]||(a[1]=e=>X.category_id=e),placeholder:"分类",clearable:"",onChange:ae},{default:d(()=>[(n(!0),t(v,null,g(N.value,e=>(n(),r(I,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(K,{modelValue:X.status,"onUpdate:modelValue":a[2]||(a[2]=e=>X.status=e),placeholder:"状态",clearable:"",onChange:ae},{default:d(()=>[s(I,{label:"正常",value:"active"}),s(I,{label:"待审核",value:"pending"}),s(I,{label:"已禁用",value:"disabled"}),s(I,{label:"处理中",value:"processing"})]),_:1},8,["modelValue"]),s(K,{modelValue:X.is_vip,"onUpdate:modelValue":a[3]||(a[3]=e=>X.is_vip=e),placeholder:"VIP",clearable:"",onChange:ae},{default:d(()=>[s(I,{label:"VIP视频",value:!0}),s(I,{label:"免费视频",value:!1})]),_:1},8,["modelValue"]),s(l,{type:"primary",onClick:ae},{default:d(()=>[...a[13]||(a[13]=[p("搜索",-1)])]),_:1}),s(l,{onClick:le},{default:d(()=>[...a[14]||(a[14]=[p("重置",-1)])]),_:1})]),o((n(),r(pe,{data:J.value,border:"",stripe:"",onSelectionChange:te},{default:d(()=>[s(O,{type:"selection",width:"50"}),s(O,{label:"封面",width:"120"},{default:d(({row:e})=>[s(re,{src:e.thumbnail||e.cover_url,fit:"cover",style:{width:"100px",height:"60px","border-radius":"4px"}},{error:d(()=>[i("div",M,[s(ee,null,{default:d(()=>[s(m(U))]),_:1})])]),_:1},8,["src"])]),_:1}),s(O,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),s(O,{prop:"category_name",label:"分类",width:"100"}),s(O,{label:"状态",width:"100"},{default:d(({row:e})=>{return[s(ne,{type:(a=e.status,{active:"success",pending:"warning",disabled:"danger",processing:"info",failed:"danger"}[a]||"info")},{default:d(()=>[p(c(Z[e.status]||e.status),1)]),_:2},1032,["type"])];var a}),_:1}),s(O,{label:"VIP",width:"80"},{default:d(({row:e})=>[e.is_vip?(n(),r(ne,{key:0,type:"warning"},{default:d(()=>[...a[15]||(a[15]=[p("VIP",-1)])]),_:1})):(n(),t("span",q,"免费"))]),_:1}),s(O,{prop:"view_count",label:"播放量",width:"100"}),s(O,{prop:"like_count",label:"点赞",width:"80"}),s(O,{label:"创建时间",width:"170"},{default:d(({row:e})=>{return[p(c((a=e.created_at,a?new Date(a).toLocaleString("zh-CN"):"")),1)];var a}),_:1})]),_:1},8,["data"])),[[ye,D.value]]),i("div",B,[s(ce,{"current-page":Y.page,"onUpdate:currentPage":a[4]||(a[4]=e=>Y.page=e),"page-size":Y.pageSize,"onUpdate:pageSize":a[5]||(a[5]=e=>Y.pageSize=e),total:Y.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:ae,onCurrentChange:ae},null,8,["current-page","page-size","total"])]),s(me,{modelValue:T.value,"onUpdate:modelValue":a[8]||(a[8]=e=>T.value=e),title:"批量修改状态",width:"400px"},{footer:d(()=>[s(l,{onClick:a[7]||(a[7]=e=>T.value=!1)},{default:d(()=>[...a[16]||(a[16]=[p("取消",-1)])]),_:1}),s(l,{type:"primary",onClick:se,loading:R.value},{default:d(()=>[...a[17]||(a[17]=[p("确定",-1)])]),_:1},8,["loading"])]),default:d(()=>[s(ge,{"label-width":"80px"},{default:d(()=>[s(ve,{label:"新状态"},{default:d(()=>[s(K,{modelValue:H.value,"onUpdate:modelValue":a[6]||(a[6]=e=>H.value=e),placeholder:"请选择状态"},{default:d(()=>[s(I,{label:"正常",value:"active"}),s(I,{label:"待审核",value:"pending"}),s(I,{label:"已禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(me,{modelValue:A.value,"onUpdate:modelValue":a[11]||(a[11]=e=>A.value=e),title:"批量修改分类",width:"400px"},{footer:d(()=>[s(l,{onClick:a[10]||(a[10]=e=>A.value=!1)},{default:d(()=>[...a[18]||(a[18]=[p("取消",-1)])]),_:1}),s(l,{type:"primary",onClick:de,loading:R.value},{default:d(()=>[...a[19]||(a[19]=[p("确定",-1)])]),_:1},8,["loading"])]),default:d(()=>[s(ge,{"label-width":"80px"},{default:d(()=>[s(ve,{label:"新分类"},{default:d(()=>[s(K,{modelValue:W.value,"onUpdate:modelValue":a[9]||(a[9]=e=>W.value=e),placeholder:"请选择分类"},{default:d(()=>[(n(!0),t(v,null,g(N.value,e=>(n(),r(I,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-9d5ed2a0"]]);export{D as default};
