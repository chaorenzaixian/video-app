/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                             *//* empty css                     *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                   */import{r as e,l as a,j as l,y as t,O as i,F as s,ai as d,z as n,C as r,G as p,ae as u,K as o,E as v,I as c,L as _,H as m,M as g,aa as f}from"./vue-vendor-Ba_vealp.js";import{_ as y,a as b}from"./index-C3P4JTuA.js";import{be as w,bk as h,aT as x,aQ as V,bl as k,bm as I,aM as P,bh as S,bi as z,bj as j,br as D,bs as C,bt as M,bC as U,aR as $,aS as Y,bD as H,bv as A,E}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const N={class:"users-page"},R={class:"filter-bar"},F={class:"user-cell"},K={class:"username"},T={class:"nickname"},q={class:"status-cell"},G={key:1,class:"text-muted"},L={key:0,class:"ip-cell"},J={class:"ip"},O={class:"location"},Q={key:1,class:"text-muted"},B={key:0,class:"ip-cell"},W={class:"ip"},X={class:"location"},Z={key:1,class:"text-muted"},ee={class:"action-btns"},ae={class:"pagination"},le={key:0,class:"vip-dialog-content"},te={class:"user-info-row"},ie={class:"user-info-row"},se={key:0,class:"user-info-row"},de={key:1,class:"user-info-row"},ne={key:0},re={class:"quick-btns"},pe=y({__name:"Users",setup(y){const pe=e(!1),ue=e([]),oe=a({search:"",role:""}),ve=a({page:1,pageSize:20,total:0}),ce=e(!1),_e=e(!1),me=e(null),ge=a({vip_level:0,expire_date:null,add_days:0}),fe=e([]),ye=e=>{const a=fe.value.find(a=>a.level===e);return(null==a?void 0:a.name)||"未知"},be=e=>({0:"info",1:"warning",2:"warning",3:"warning",4:"warning",5:"success",6:"primary",7:"danger"}[e]||"info"),we=e=>{if(!e)return"-";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},he=e=>{if(!e)return"-";const a=new Date(e);return`${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},xe=async()=>{pe.value=!0;try{const e=await b.get("/admin/users",{params:{page:ve.page,page_size:ve.pageSize,search:oe.search||void 0,role:oe.role||void 0}});ue.value=e.data.items,ve.total=e.data.total}catch(e){}finally{pe.value=!1}},Ve=e=>({SUPER_ADMIN:"超管",super_admin:"超管",ADMIN:"管理员",admin:"管理员",VIP:"VIP",vip:"VIP",USER:"用户",user:"用户"}[e]||e),ke=e=>!!e&&new Date(e)<new Date,Ie=e=>{ge.add_days=e,ge.expire_date=null},Pe=async()=>{if(me.value){_e.value=!0;try{const e={};if(void 0!==ge.vip_level&&(e.vip_level=ge.vip_level),ge.expire_date&&(e.expire_date=ge.expire_date),ge.add_days>0&&(e.add_days=ge.add_days),void 0===e.vip_level&&!e.expire_date&&!e.add_days)return void E.warning("请设置VIP等级、到期时间或增加天数");const a=await b.put(`/admin/users/${me.value.id}/vip`,e);E.success("VIP设置成功"),me.value.vip_expire_date=a.data.expire_date,me.value.is_vip=a.data.is_active,me.value.vip_level=a.data.vip_level,me.value.vip_level_name=a.data.vip_level_name,ce.value=!1}catch(e){E.error("设置VIP失败")}finally{_e.value=!1}}};return l(()=>{xe(),(async()=>{try{const e=await b.get("/admin/vip-levels");fe.value=e.data||e||[]}catch(e){fe.value=[{level:0,name:"非VIP"},{level:1,name:"普通VIP"},{level:2,name:"VIP1"},{level:3,name:"VIP2"},{level:4,name:"VIP3"},{level:5,name:"黄金至尊"},{level:6,name:"紫色限定至尊"}]}})()}),(e,a)=>{const l=d("Search"),y=V,Se=x,ze=I,je=k,De=P,Ce=z,Me=j,Ue=D,$e=S,Ye=M,He=w,Ae=U,Ee=Y,Ne=H,Re=A,Fe=$,Ke=h,Te=C;return n(),t("div",N,[i(He,null,{header:s(()=>[...a[13]||(a[13]=[r("div",{class:"card-header"},[r("span",null,"用户管理")],-1)])]),default:s(()=>[r("div",R,[i(Se,{modelValue:oe.search,"onUpdate:modelValue":a[0]||(a[0]=e=>oe.search=e),placeholder:"搜索用户名/邮箱",clearable:"",style:{width:"250px"},onKeyup:u(xe,["enter"])},{prefix:s(()=>[i(y,null,{default:s(()=>[i(l)]),_:1})]),_:1},8,["modelValue"]),i(je,{modelValue:oe.role,"onUpdate:modelValue":a[1]||(a[1]=e=>oe.role=e),placeholder:"角色",clearable:"",style:{width:"120px"}},{default:s(()=>[i(ze,{label:"普通用户",value:"user"}),i(ze,{label:"VIP",value:"vip"}),i(ze,{label:"管理员",value:"admin"}),i(ze,{label:"游客",value:"guest"})]),_:1},8,["modelValue"]),i(De,{onClick:xe},{default:s(()=>[i(y,null,{default:s(()=>[i(l)]),_:1}),a[14]||(a[14]=o("搜索",-1))]),_:1})]),p((n(),v($e,{data:ue.value,stripe:"",style:{width:"100%"},size:"small",border:""},{default:s(()=>[i(Ce,{prop:"id",label:"ID",width:"60",align:"center"}),i(Ce,{label:"用户信息",width:"150"},{default:s(({row:e})=>[r("div",F,[r("div",K,[o(_(e.username)+" ",1),e.is_guest?(n(),v(Me,{key:0,type:"info",size:"small"},{default:s(()=>[...a[15]||(a[15]=[o("游客",-1)])]),_:1})):c("",!0)]),r("div",T,_(e.nickname||"-"),1)])]),_:1}),i(Ce,{label:"状态",width:"120",align:"center"},{default:s(({row:e})=>{return[r("div",q,[i(Me,{type:(l=e.role,{SUPER_ADMIN:"danger",super_admin:"danger",ADMIN:"warning",admin:"warning",VIP:"success",vip:"success",USER:"info",user:"info"}[l]||"info"),size:"small"},{default:s(()=>[o(_(Ve(e.role)),1)]),_:2},1032,["type"]),e.vip_level>0?(n(),v(Me,{key:0,type:be(e.vip_level),size:"small"},{default:s(()=>[o(_(e.vip_level_name||ye(e.vip_level)),1)]),_:2},1032,["type"])):e.is_vip?(n(),v(Me,{key:1,type:"warning",size:"small"},{default:s(()=>[...a[16]||(a[16]=[o("VIP",-1)])]),_:1})):c("",!0),i(Me,{type:e.is_active?"success":"danger",size:"small"},{default:s(()=>[o(_(e.is_active?"正常":"禁用"),1)]),_:2},1032,["type"])])];var l}),_:1}),i(Ce,{label:"VIP到期",width:"140",align:"center"},{default:s(({row:e})=>[e.vip_expire_date?(n(),t("span",{key:0,class:m({"text-danger":ke(e.vip_expire_date),"text-success":!ke(e.vip_expire_date)})},_(he(e.vip_expire_date)),3)):(n(),t("span",G,"-"))]),_:1}),i(Ce,{label:"注册IP / 归属地",width:"160"},{default:s(({row:e})=>[e.register_ip?(n(),t("div",L,[r("div",J,_(e.register_ip),1),r("div",O,_(e.register_ip_location||"-"),1)])):(n(),t("span",Q,"-"))]),_:1}),i(Ce,{label:"登录IP / 归属地",width:"160"},{default:s(({row:e})=>[e.last_login_ip?(n(),t("div",B,[r("div",W,_(e.last_login_ip),1),r("div",X,_(e.last_login_ip_location||"-"),1)])):(n(),t("span",Z,"-"))]),_:1}),i(Ce,{label:"注册时间",width:"140",align:"center"},{default:s(({row:e})=>[o(_(he(e.created_at)),1)]),_:1}),i(Ce,{label:"最近登录",width:"140",align:"center"},{default:s(({row:e})=>[o(_(he(e.last_login)),1)]),_:1}),i(Ce,{label:"操作",width:"160",fixed:"right",align:"center"},{default:s(({row:e})=>[r("div",ee,[i(De,{link:"",type:"warning",size:"small",onClick:a=>(e=>{me.value=e,ge.vip_level=e.vip_level||0,ge.expire_date=e.vip_expire_date||null,ge.add_days=0,ce.value=!0})(e)},{default:s(()=>[...a[17]||(a[17]=[o("VIP",-1)])]),_:1},8,["onClick"]),i(De,{link:"",type:e.is_active?"danger":"success",size:"small",onClick:a=>(async e=>{try{await b.put(`/admin/users/${e.id}/status`),e.is_active=!e.is_active,E.success("操作成功")}catch(a){}})(e)},{default:s(()=>[o(_(e.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),i(Ue,{title:"确定删除该用户吗？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:a=>(async e=>{try{await b.delete(`/admin/users/${e.id}`),E.success("删除成功"),xe()}catch(a){}})(e)},{reference:s(()=>[i(De,{link:"",type:"danger",size:"small",disabled:"SUPER_ADMIN"===e.role||"super_admin"===e.role||"ADMIN"===e.role||"admin"===e.role},{default:s(()=>[...a[18]||(a[18]=[o("删除",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"])])]),_:1})]),_:1},8,["data"])),[[Te,pe.value]]),r("div",ae,[i(Ye,{"current-page":ve.page,"onUpdate:currentPage":a[2]||(a[2]=e=>ve.page=e),"page-size":ve.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>ve.pageSize=e),total:ve.total,layout:"total, prev, pager, next",onCurrentChange:xe},null,8,["current-page","page-size","total"])])]),_:1}),i(Ke,{modelValue:ce.value,"onUpdate:modelValue":a[12]||(a[12]=e=>ce.value=e),title:"VIP管理",width:"500px"},{footer:s(()=>[i(De,{onClick:a[11]||(a[11]=e=>ce.value=!1)},{default:s(()=>[...a[27]||(a[27]=[o("取消",-1)])]),_:1}),i(De,{type:"primary",onClick:Pe,loading:_e.value},{default:s(()=>[...a[28]||(a[28]=[o("保存",-1)])]),_:1},8,["loading"])]),default:s(()=>[me.value?(n(),t("div",le,[r("div",te,[a[19]||(a[19]=r("span",{class:"label"},"用户：",-1)),r("span",null,_(me.value.username)+" ("+_(me.value.nickname||"无昵称")+")",1)]),r("div",ie,[a[20]||(a[20]=r("span",{class:"label"},"当前状态：",-1)),i(Me,{type:me.value.is_vip?"warning":"info",size:"small"},{default:s(()=>[o(_(me.value.is_vip?"VIP":"普通用户"),1)]),_:1},8,["type"])]),me.value.vip_level>0?(n(),t("div",se,[a[21]||(a[21]=r("span",{class:"label"},"VIP等级：",-1)),i(Me,{type:be(me.value.vip_level),size:"small"},{default:s(()=>[o(_(me.value.vip_level_name||ye(me.value.vip_level)),1)]),_:1},8,["type"])])):c("",!0),me.value.vip_expire_date?(n(),t("div",de,[a[22]||(a[22]=r("span",{class:"label"},"到期时间：",-1)),r("span",{class:m({"text-danger":ke(me.value.vip_expire_date)})},[o(_(we(me.value.vip_expire_date))+" ",1),ke(me.value.vip_expire_date)?(n(),t("span",ne,"(已过期)")):c("",!0)],2)])):c("",!0),i(Ae),i(Fe,{model:ge,"label-width":"100px"},{default:s(()=>[i(Ee,{label:"VIP等级"},{default:s(()=>[i(je,{modelValue:ge.vip_level,"onUpdate:modelValue":a[4]||(a[4]=e=>ge.vip_level=e),placeholder:"选择VIP等级",style:{width:"100%"}},{default:s(()=>[(n(!0),t(g,null,f(fe.value,e=>(n(),v(ze,{key:e.level,value:e.level,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(Ee,{label:"设置到期时间"},{default:s(()=>[i(Ne,{modelValue:ge.expire_date,"onUpdate:modelValue":a[5]||(a[5]=e=>ge.expire_date=e),type:"datetime",placeholder:"选择到期时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),i(Ee,{label:"或增加天数"},{default:s(()=>[i(Re,{modelValue:ge.add_days,"onUpdate:modelValue":a[6]||(a[6]=e=>ge.add_days=e),min:0,max:3650,placeholder:"增加VIP天数",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),i(Ee,{label:"快捷设置"},{default:s(()=>[r("div",re,[i(De,{size:"small",onClick:a[7]||(a[7]=e=>Ie(30))},{default:s(()=>[...a[23]||(a[23]=[o("+30天",-1)])]),_:1}),i(De,{size:"small",onClick:a[8]||(a[8]=e=>Ie(90))},{default:s(()=>[...a[24]||(a[24]=[o("+90天",-1)])]),_:1}),i(De,{size:"small",onClick:a[9]||(a[9]=e=>Ie(365))},{default:s(()=>[...a[25]||(a[25]=[o("+1年",-1)])]),_:1}),i(De,{size:"small",type:"warning",onClick:a[10]||(a[10]=e=>Ie(36500))},{default:s(()=>[...a[26]||(a[26]=[o("永久",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])])):c("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-847596fd"]]);export{pe as default};
