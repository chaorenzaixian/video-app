import{r as a,c as l,j as e,R as s,y as t,C as n,I as i,L as o,H as r,aD as u,M as v,aa as c,U as d,az as p,aC as y,z as k}from"./vue-vendor-Ba_vealp.js";import{_ as h}from"./ic_back-BPdSG6fy.js";import{_ as b,a as m}from"./index-C3P4JTuA.js";import{E as g}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const f={class:"audio-novel-player"},_={class:"top-header"},w={class:"title"},x={key:0,class:"loading-state"},C={key:1,class:"player-content"},M={class:"cover-section"},j={class:"cover-wrapper"},z=["src","alt"],I={class:"playing-info"},B={class:"progress-section"},V={class:"progress-bar-wrapper"},$=["value","max"],L={class:"time-display"},T={class:"current-time"},P={class:"total-time"},H={class:"controls-section"},S={class:"mode-text"},E=["disabled"],N={key:0,class:"play-icon",viewBox:"0 0 24 24",fill:"currentColor"},R={key:1,class:"play-icon",viewBox:"0 0 24 24",fill:"currentColor"},A=["disabled"],D={class:"recommend-section"},F={class:"recommend-grid"},O=["onClick"],U={class:"recommend-cover-wrap"},q=["src","alt"],G={class:"recommend-title"},J={class:"recommend-meta"},K={class:"playlist-panel"},Q={class:"playlist-header"},W={class:"playlist-title"},X={class:"sort-tabs"},Y={class:"playlist-content"},Z=["onClick"],aa={class:"chapter-title-text"},la={key:0,class:"lock-icon"},ea={key:0,class:"no-more-data"},sa=b({__name:"AudioNovelPlayer",setup(b){const sa=p(),ta=y(),na=a(!0),ia=a(null),oa=a([]),ra=a(0),ua=a(null),va=a([]),ca=a(!1),da=a("asc"),pa=a(null),ya=a(!1),ka=a(0),ha=a(0),ba=a("list");l(()=>{switch(ba.value){case"loop":return"ðŸ”";case"single":return"ðŸ”‚";default:return"ðŸ“‹"}});const ma=l(()=>{switch(ba.value){case"loop":return"åˆ—è¡¨å¾ªçŽ¯";case"single":return"å•é›†å¾ªçŽ¯";default:return"å¤šé›†å¾ªçŽ¯"}}),ga=l(()=>"desc"===da.value?[...oa.value].reverse():oa.value),fa=async()=>{try{const a=await m.get("/gallery-novel/novel/list",{params:{page_size:6,novel_type:"audio"}});va.value=(a.data||[]).filter(a=>{var l;return a.id!==(null==(l=ia.value)?void 0:l.id)}).slice(0,3)}catch(a){va.value=[]}},_a=async a=>{var l,e,s,t;if(a<0||a>=oa.value.length)return;const n=oa.value[a];if(!n.is_free&&!(null==(l=ia.value)?void 0:l.is_vip))return g.warning("æ­¤ç« èŠ‚éœ€è¦VIPæ‰èƒ½æ”¶å¬"),!1;try{const l=await m.get(`/gallery-novel/novel/${ia.value.id}/chapter/${n.id}`);return ua.value=l.data,ra.value=a,pa.value&&l.data.audio_url&&(pa.value.src=l.data.audio_url,pa.value.load(),(null==(e=ia.value.read_progress)?void 0:e.chapter_id)===n.id&&(null==(s=ia.value.read_progress)?void 0:s.audio_position)>0&&(pa.value.currentTime=ia.value.read_progress.audio_position)),!0}catch(i){return 403===(null==(t=i.response)?void 0:t.status)?g.warning("æ­¤ç« èŠ‚éœ€è¦VIPæ‰èƒ½æ”¶å¬"):g.error("åŠ è½½ç« èŠ‚å¤±è´¥"),!1}},wa=async a=>{const l=oa.value.findIndex(l=>l.id===a);l>=0&&await(async a=>{ca.value=!1,await _a(a)&&pa.value&&pa.value.play()})(l)},xa=()=>{pa.value&&(ya.value?pa.value.pause():pa.value.play())},Ca=async()=>{if(ra.value>0){await _a(ra.value-1)&&pa.value&&pa.value.play()}},Ma=async()=>{if(ra.value<oa.value.length-1){await _a(ra.value+1)&&pa.value&&pa.value.play()}},ja=a=>{if(!pa.value)return;const l=Math.max(0,Math.min(ha.value,ka.value+a));pa.value.currentTime=l},za=()=>{const a=["list","loop","single"],l=a.indexOf(ba.value);ba.value=a[(l+1)%a.length]},Ia=()=>{pa.value&&(ka.value=pa.value.currentTime)},Ba=()=>{pa.value&&(ha.value=pa.value.duration)},Va=async()=>{if(Ta(),"single"===ba.value)pa.value&&(pa.value.currentTime=0,pa.value.play());else if("loop"===ba.value||"list"===ba.value)if(ra.value<oa.value.length-1)await Ma();else if("loop"===ba.value){await _a(0)&&pa.value&&pa.value.play()}},$a=()=>{g.error("éŸ³é¢‘åŠ è½½å¤±è´¥")},La=a=>{if(!a||isNaN(a))return"00:00";const l=Math.floor(a/60),e=Math.floor(a%60);return`${l.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`},Ta=async()=>{if(ua.value&&ia.value)try{await m.post(`/gallery-novel/novel/${ia.value.id}/progress`,{chapter_id:ua.value.id,chapter_num:ua.value.chapter_num,audio_position:ka.value})}catch(a){}},Pa=async()=>{if(ia.value)try{const a=await m.post(`/gallery-novel/novel/${ia.value.id}/collect`);ia.value.is_collected=a.data.collected,g.success(a.data.collected?"æ”¶è—æˆåŠŸ":"å·²å–æ¶ˆæ”¶è—")}catch(a){g.error("æ“ä½œå¤±è´¥")}},Ha=()=>{Ta(),ta.push("/user/community?tab=novel&type=audio")};let Sa=null;return e(()=>{(async()=>{var a;na.value=!0;try{const l=sa.params.id,e=await m.get(`/gallery-novel/novel/${l}`);if(ia.value=e.data,oa.value=e.data.chapters||[],null==(a=e.data.read_progress)?void 0:a.chapter_id){const a=oa.value.findIndex(a=>a.id===e.data.read_progress.chapter_id);a>=0&&(ra.value=a)}oa.value.length>0&&await _a(ra.value),fa()}catch(l){g.error("èŽ·å–å°è¯´å¤±è´¥")}finally{na.value=!1}})(),Sa=setInterval(Ta,3e4)}),s(()=>{Sa&&clearInterval(Sa),pa.value&&pa.value.pause(),Ta()}),(a,l)=>{var e,s,p,y;return k(),t("div",f,[n("header",_,[n("button",{class:"back-btn",onClick:Ha},[...l[9]||(l[9]=[n("img",{src:h,alt:"è¿”å›ž",class:"back-icon"},null,-1)])]),n("h1",w,o((null==(e=ia.value)?void 0:e.title)||"æœ‰å£°å°è¯´"),1),n("button",{class:r(["collect-btn",{active:null==(s=ia.value)?void 0:s.is_collected}]),onClick:Pa},[n("span",null,o((null==(p=ia.value)?void 0:p.is_collected)?"å·²æ”¶è—":"+ æ”¶è—"),1)],2)]),na.value?(k(),t("div",x,[...l[10]||(l[10]=[n("div",{class:"loading-spinner"},null,-1)])])):ia.value?(k(),t("div",C,[n("div",M,[n("div",j,[n("img",{src:ia.value.cover,alt:ia.value.title,class:"cover-image"},null,8,z)])]),n("div",I,[n("span",null,"æ­£åœ¨æ’­æ”¾ï¼šç¬¬"+o(ra.value+1)+"é›†",1)]),n("div",B,[n("button",{class:"skip-btn",onClick:l[0]||(l[0]=a=>ja(-10))},[...l[11]||(l[11]=[n("svg",{class:"skip-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M1 4v6h6","stroke-linecap":"round","stroke-linejoin":"round"}),n("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10","stroke-linecap":"round","stroke-linejoin":"round"})],-1),n("span",{class:"skip-num"},"10",-1)])]),n("div",V,[n("input",{type:"range",class:"progress-slider",value:ka.value,max:ha.value||100,onInput:l[1]||(l[1]=a=>{return l=a.target.value,void(pa.value&&(pa.value.currentTime=parseFloat(l)));var l})},null,40,$)]),n("button",{class:"skip-btn",onClick:l[2]||(l[2]=a=>ja(10))},[...l[12]||(l[12]=[n("svg",{class:"skip-icon forward",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M23 4v6h-6","stroke-linecap":"round","stroke-linejoin":"round"}),n("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10","stroke-linecap":"round","stroke-linejoin":"round"})],-1),n("span",{class:"skip-num"},"10",-1)])])]),n("div",L,[n("span",T,o(La(ka.value)),1),n("span",P,o(La(ha.value)),1)]),n("div",H,[n("button",{class:"control-btn mode-btn",onClick:za},[l[13]||(l[13]=u('<svg class="mode-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-87b63b23><path d="M17 1l4 4-4 4" stroke-linecap="round" stroke-linejoin="round" data-v-87b63b23></path><path d="M3 11V9a4 4 0 0 1 4-4h14" stroke-linecap="round" stroke-linejoin="round" data-v-87b63b23></path><path d="M7 23l-4-4 4-4" stroke-linecap="round" stroke-linejoin="round" data-v-87b63b23></path><path d="M21 13v2a4 4 0 0 1-4 4H3" stroke-linecap="round" stroke-linejoin="round" data-v-87b63b23></path></svg>',1)),n("span",S,o(ma.value),1)]),n("button",{class:"control-btn nav-btn",onClick:Ca,disabled:ra.value<=0},[...l[14]||(l[14]=[n("svg",{class:"nav-icon",viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M6 6h2v12H6V6zm3.5 6l8.5 6V6l-8.5 6z"})],-1)])],8,E),n("button",{class:"control-btn play-btn",onClick:xa},[ya.value?(k(),t("svg",N,[...l[15]||(l[15]=[n("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"},null,-1)])])):(k(),t("svg",R,[...l[16]||(l[16]=[n("path",{d:"M8 5v14l11-7L8 5z"},null,-1)])]))]),n("button",{class:"control-btn nav-btn",onClick:Ma,disabled:ra.value>=oa.value.length-1},[...l[17]||(l[17]=[n("svg",{class:"nav-icon",viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M6 18l8.5-6L6 6v12zm10-12v12h2V6h-2z"})],-1)])],8,A),n("button",{class:"control-btn list-btn",onClick:l[3]||(l[3]=a=>ca.value=!0)},[...l[18]||(l[18]=[u('<svg class="list-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-87b63b23><line x1="8" y1="6" x2="21" y2="6" stroke-linecap="round" data-v-87b63b23></line><line x1="8" y1="12" x2="21" y2="12" stroke-linecap="round" data-v-87b63b23></line><line x1="8" y1="18" x2="21" y2="18" stroke-linecap="round" data-v-87b63b23></line><line x1="3" y1="6" x2="3.01" y2="6" stroke-linecap="round" data-v-87b63b23></line><line x1="3" y1="12" x2="3.01" y2="12" stroke-linecap="round" data-v-87b63b23></line><line x1="3" y1="18" x2="3.01" y2="18" stroke-linecap="round" data-v-87b63b23></line></svg><span class="list-text" data-v-87b63b23>æ’­æ”¾åˆ—è¡¨</span>',2)])])]),n("div",D,[l[20]||(l[20]=n("h3",{class:"section-title"},"ç›¸å…³æŽ¨è",-1)),n("div",F,[(k(!0),t(v,null,c(va.value,a=>(k(),t("div",{key:a.id,class:"recommend-item",onClick:l=>{return e=a.id,Ta(),void ta.push(`/user/audio-novel/${e}`);var e}},[n("div",U,[n("img",{src:a.cover,alt:a.title,class:"recommend-cover"},null,8,q),l[19]||(l[19]=n("span",{class:"audio-badge"},"ðŸŽ§",-1))]),n("p",G,o(a.title),1),n("p",J,"å…±"+o(a.chapter_count)+"è¯ Â· "+o("completed"===a.status?"å·²å®Œç»“":"è¿žè½½ä¸­"),1)],8,O))),128))])])])):i("",!0),ca.value?(k(),t("div",{key:2,class:"playlist-modal",onClick:l[6]||(l[6]=d(a=>ca.value=!1,["self"]))},[n("div",K,[l[22]||(l[22]=n("div",{class:"drag-handle"},null,-1)),n("div",Q,[n("span",W,o(null==(y=ia.value)?void 0:y.title),1),n("div",X,[n("span",{class:r(["sort-tab",{active:"asc"===da.value}]),onClick:l[4]||(l[4]=a=>da.value="asc")},"æ­£åº",2),l[21]||(l[21]=n("span",{class:"sort-divider"},"/",-1)),n("span",{class:r(["sort-tab",{active:"desc"===da.value}]),onClick:l[5]||(l[5]=a=>da.value="desc")},"å€’åº",2)])]),n("div",Y,[(k(!0),t(v,null,c(ga.value,(a,l)=>{var e,s,i,u;return k(),t("div",{key:a.id,class:r(["playlist-item",{active:a.id===(null==(e=oa.value[ra.value])?void 0:e.id),locked:!a.is_free&&!(null==(s=ia.value)?void 0:s.is_vip)}]),onClick:l=>wa(a.id)},[n("span",aa,"ç¬¬"+o(a.num||("asc"===da.value?l+1:oa.value.length-l))+"ç«  "+o(a.title),1),a.is_free||(null==(i=ia.value)?void 0:i.is_vip)?(k(),t("span",{key:1,class:r(["arrow-right",{active:a.id===(null==(u=oa.value[ra.value])?void 0:u.id)}])},null,2)):(k(),t("span",la,"ðŸ”’"))],10,Z)}),128)),oa.value.length>0?(k(),t("div",ea,"æ²¡æœ‰æ›´å¤šæ•°æ®äº†")):i("",!0)])])])):i("",!0),n("audio",{ref_key:"audioRef",ref:pa,onTimeupdate:Ia,onLoadedmetadata:Ba,onEnded:Va,onPlay:l[7]||(l[7]=a=>ya.value=!0),onPause:l[8]||(l[8]=a=>ya.value=!1),onError:$a},null,544)])}}},[["__scopeId","data-v-87b63b23"]]);export{sa as default};
