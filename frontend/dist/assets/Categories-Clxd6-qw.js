/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                 *//* empty css                       *//* empty css                *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                   *//* empty css                  */import{_ as e,a}from"./index-C3P4JTuA.js";import{be as l,bk as t,bh as o,bi as r,bj as s,aM as i,br as d,bs as u,aQ as n,aR as p,aS as m,aT as c,bf as v,by as _,bv as y,bl as f,bm as b,E as g}from"./element-plus-DlIn_qXi.js";import{r as h,l as w,c as j,j as k,y as V,O as C,F as x,ai as U,z,G as I,E as q,C as E,H as F,L as G,K as H,I as K,M as L,aa as M}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const R={class:"categories-page"},$={class:"card-header"},A={key:0,class:"parent-info"},B=e({__name:"Categories",setup(e){const B=h(!1),D=h(!1),O=h(!1),P=h(!1),Q=h(null),S=h(null),T=h([]),J=h(""),N=w({name:"",description:"",sort_order:0,parent_id:null,level:1,category_type:"video"}),W=e=>({video:"普通视频",short:"短视频",both:"两者通用"}[e]||"普通视频"),X={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},Y=j(()=>P.value?"编辑分类":1===N.level?"新增一级分类":"新增二级分类"),Z=j(()=>T.value.filter(e=>1===e.level)),ee=async()=>{B.value=!0;try{const e=await a.get("/videos/categories");T.value=e.data||[]}catch(e){}finally{B.value=!1}},ae=(e=null)=>{P.value=!1,Q.value=null,N.name="",N.description="",N.sort_order=0,N.parent_id=null,N.level=1,N.category_type="video",e?(N.parent_id=e.id,N.level=2,J.value=e.name):(N.level=1,J.value=""),O.value=!0},le=async()=>{S.value&&await S.value.validate(async e=>{var l,t;if(e){D.value=!0;try{const e={name:N.name,description:N.description,sort_order:N.sort_order,parent_id:N.parent_id,level:N.level,category_type:N.category_type};P.value&&Q.value?(await a.put(`/admin/categories/${Q.value}`,e),g.success("更新成功")):(await a.post("/admin/categories",e),g.success("创建成功")),O.value=!1,ee()}catch(o){const e=(null==(t=null==(l=o.response)?void 0:l.data)?void 0:t.detail)||"保存失败，请重试";g.error(e)}finally{D.value=!1}}})};return k(()=>{ee()}),(e,h)=>{const w=U("Plus"),j=n,k=i,te=r,oe=s,re=d,se=o,ie=l,de=m,ue=c,ne=_,pe=v,me=y,ce=b,ve=f,_e=p,ye=t,fe=u;return z(),V("div",R,[C(ie,null,{header:x(()=>[E("div",$,[h[9]||(h[9]=E("span",null,"分类管理",-1)),C(k,{type:"primary",onClick:h[0]||(h[0]=e=>ae())},{default:x(()=>[C(j,null,{default:x(()=>[C(w)]),_:1}),h[8]||(h[8]=H("新增一级分类 ",-1))]),_:1})])]),default:x(()=>[I((z(),q(se,{data:T.value,stripe:"","row-key":"id","tree-props":{children:"children"},"default-expand-all":""},{default:x(()=>[C(te,{prop:"id",label:"ID",width:"80"}),C(te,{prop:"name",label:"名称","min-width":"150"},{default:x(({row:e})=>[E("span",{class:F({"sub-category":2===e.level})},G(e.name),3)]),_:1}),C(te,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),C(te,{label:"级别",width:"100"},{default:x(({row:e})=>[C(oe,{type:1===e.level?"primary":"success",size:"small"},{default:x(()=>[H(G(1===e.level?"一级":"二级"),1)]),_:2},1032,["type"])]),_:1}),C(te,{label:"分类类型",width:"120"},{default:x(({row:e})=>{return[C(oe,{type:(a=e.category_type,{video:"primary",short:"success",both:"warning"}[a]||"info"),size:"small"},{default:x(()=>[H(G(W(e.category_type)),1)]),_:2},1032,["type"])];var a}),_:1}),C(te,{prop:"video_count",label:"视频数",width:"100"}),C(te,{prop:"sort_order",label:"排序",width:"80"}),C(te,{label:"操作",width:"200",fixed:"right"},{default:x(({row:e})=>[1===e.level?(z(),q(k,{key:0,link:"",type:"primary",onClick:a=>ae(e)},{default:x(()=>[...h[10]||(h[10]=[H(" 添加子分类 ",-1)])]),_:1},8,["onClick"])):K("",!0),C(k,{link:"",type:"primary",onClick:a=>(e=>{if(P.value=!0,Q.value=e.id,N.name=e.name,N.description=e.description||"",N.sort_order=e.sort_order||0,N.parent_id=e.parent_id,N.level=e.level||1,N.category_type=e.category_type||"video",e.parent_id){const a=T.value.find(a=>a.id===e.parent_id);J.value=a?a.name:""}O.value=!0})(e)},{default:x(()=>[...h[11]||(h[11]=[H("编辑",-1)])]),_:1},8,["onClick"]),C(re,{title:"确定删除这个分类吗？",onConfirm:l=>(async e=>{try{await a.delete(`/admin/categories/${e}`),g.success("删除成功"),ee()}catch(l){}})(e.id)},{reference:x(()=>[C(k,{link:"",type:"danger"},{default:x(()=>[...h[12]||(h[12]=[H("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[fe,B.value]])]),_:1}),C(ye,{modelValue:O.value,"onUpdate:modelValue":h[7]||(h[7]=e=>O.value=e),title:Y.value,width:"450px","destroy-on-close":""},{footer:x(()=>[C(k,{onClick:h[6]||(h[6]=e=>O.value=!1)},{default:x(()=>[...h[16]||(h[16]=[H("取消",-1)])]),_:1}),C(k,{type:"primary",onClick:le,loading:D.value},{default:x(()=>[...h[17]||(h[17]=[H("确定",-1)])]),_:1},8,["loading"])]),default:x(()=>[C(_e,{model:N,rules:X,ref_key:"formRef",ref:S,"label-width":"80px"},{default:x(()=>[P.value?K("",!0):(z(),q(de,{key:0,label:"级别"},{default:x(()=>[C(oe,{type:1===N.level?"primary":"success"},{default:x(()=>[H(G(1===N.level?"一级分类":"二级分类"),1)]),_:1},8,["type"]),N.parent_id?(z(),V("span",A," （父分类："+G(J.value)+"） ",1)):K("",!0)]),_:1})),C(de,{label:"名称",prop:"name"},{default:x(()=>[C(ue,{modelValue:N.name,"onUpdate:modelValue":h[1]||(h[1]=e=>N.name=e),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),C(de,{label:"描述"},{default:x(()=>[C(ue,{modelValue:N.description,"onUpdate:modelValue":h[2]||(h[2]=e=>N.description=e),type:"textarea",rows:3,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1}),C(de,{label:"分类类型",prop:"category_type"},{default:x(()=>[C(pe,{modelValue:N.category_type,"onUpdate:modelValue":h[3]||(h[3]=e=>N.category_type=e)},{default:x(()=>[C(ne,{value:"video"},{default:x(()=>[...h[13]||(h[13]=[H("普通视频",-1)])]),_:1}),C(ne,{value:"short"},{default:x(()=>[...h[14]||(h[14]=[H("短视频",-1)])]),_:1}),C(ne,{value:"both"},{default:x(()=>[...h[15]||(h[15]=[H("两者通用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),C(de,{label:"排序"},{default:x(()=>[C(me,{modelValue:N.sort_order,"onUpdate:modelValue":h[4]||(h[4]=e=>N.sort_order=e),min:0,max:999},null,8,["modelValue"])]),_:1}),P.value&&2===N.level?(z(),q(de,{key:1,label:"父分类"},{default:x(()=>[C(ve,{modelValue:N.parent_id,"onUpdate:modelValue":h[5]||(h[5]=e=>N.parent_id=e),placeholder:"选择父分类",style:{width:"100%"}},{default:x(()=>[(z(!0),V(L,null,M(Z.value,e=>(z(),q(ce,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):K("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-8471cfd9"]]);export{B as default};
