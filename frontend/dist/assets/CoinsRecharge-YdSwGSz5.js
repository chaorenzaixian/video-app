import{r as a,c as s,j as e,y as l,C as c,I as t,L as n,M as i,aa as o,K as r,U as u,H as d,aC as v,z as p}from"./vue-vendor-Ba_vealp.js";import{_ as g}from"./ic_back-BPdSG6fy.js";import{_ as m}from"./ic_coin-Bb_SXkyj.js";import{_ as b,a as k}from"./index-C3P4JTuA.js";import{E as h}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const y={class:"coins-recharge-page"},_={class:"nav-header"},f={class:"balance-section"},w={class:"balance-card"},C={class:"card-content"},j={class:"balance-info"},$={class:"balance-header"},M={class:"balance-amount"},x={class:"packages-section"},z={class:"packages-grid"},D=["onClick"],H={key:0,class:"bonus-tag"},I={class:"coins-amount"},R={class:"price"},S={class:"bottom-section"},B=["disabled"],E={key:0},K={key:1},L={key:2},U={class:"modal-content"},q={class:"modal-header"},A={class:"modal-tabs"},F={class:"modal-body"},G={class:"record-info"},J={class:"record-type"},N={class:"record-desc"},O={class:"record-time"},P={key:0,class:"empty-state"},Q=b({__name:"CoinsRecharge",setup(b){v();const Q=a({balance:0,total_recharged:0,total_spent:0,total_earned:0,frozen:0}),T=a([]),V=a(null),W=a(!1),X=a(!1),Y=a("all"),Z=a([]),aa=s(()=>"all"===Y.value?Z.value:"recharge"===Y.value?Z.value.filter(a=>a.amount>0):Z.value.filter(a=>a.amount<0)),sa=a=>{const s=new Date(a);return`${s.getMonth()+1}/${s.getDate()} ${s.getHours()}:${String(s.getMinutes()).padStart(2,"0")}`},ea=async()=>{try{const a=await k.get("/coins/balance");Q.value=a.data}catch(a){}},la=async()=>{try{const a=await k.get("/coins/transactions");Z.value=a.data}catch(a){}},ca=async()=>{var a,s;if(V.value){W.value=!0;try{const a=await k.post("/coins/recharge",{package_id:V.value.id,payment_method:"alipay"}),s=await k.post(`/coins/pay/${a.data.order_no}/simulate`);h.success(s.data.message||"充值成功"),await ea(),await la()}catch(e){h.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.detail)||"充值失败")}finally{W.value=!1}}else h.warning("请选择充值套餐")};return e(()=>{ea(),(async()=>{try{const a=await k.get("/coins/packages");T.value=a.data,T.value.length>=3?V.value=T.value[2]:T.value.length>0&&(V.value=T.value[0])}catch(a){}})(),la()}),(a,s)=>(p(),l("div",y,[c("div",_,[c("button",{class:"back-btn",onClick:s[0]||(s[0]=s=>a.$router.back())},[...s[8]||(s[8]=[c("img",{src:g,alt:"返回",class:"back-icon"},null,-1)])]),s[9]||(s[9]=c("h1",null,"金币充值",-1)),c("button",{class:"history-btn",onClick:s[1]||(s[1]=a=>X.value=!0)},"充值记录")]),c("div",f,[c("div",w,[s[12]||(s[12]=c("img",{src:"/images/backgrounds/rg_header_bg.webp",alt:"",class:"card-bg"},null,-1)),c("div",C,[c("div",j,[c("div",$,[s[10]||(s[10]=c("span",{class:"label"},"我的金币余额",-1)),c("button",{class:"detail-btn",onClick:s[2]||(s[2]=a=>X.value=!0)},"明细")]),c("div",M,n(Q.value.balance||0),1)]),s[11]||(s[11]=c("img",{src:m,alt:"金币",class:"coin-icon"},null,-1))])])]),c("div",x,[s[15]||(s[15]=c("div",{class:"section-header"},[c("span",{class:"title"},"余额充值"),c("span",{class:"subtitle"},"多充多送")],-1)),c("div",z,[(p(!0),l(i,null,o(T.value,a=>{var e;return p(),l("div",{key:a.id,class:d(["package-card",{selected:(null==(e=V.value)?void 0:e.id)===a.id}]),onClick:s=>V.value=a},[a.bonus_coins>0?(p(),l("div",H,[s[13]||(s[13]=c("img",{src:"/images/backgrounds/ic_gift.webp",alt:"",class:"gift-icon"},null,-1)),c("span",null,"赠送"+n(a.bonus_coins)+"金币",1)])):t("",!0),s[14]||(s[14]=c("div",{class:"coin-icon-wrapper"},[c("img",{src:m,alt:"",class:"pkg-coin-icon"})],-1)),c("div",I,n(a.coins)+"金币",1),c("div",R,n(a.price)+"RMB",1)],10,D)}),128))])]),c("div",S,[s[16]||(s[16]=c("p",{class:"tips"},[r(" *如提示【交易失败】【账户风险】等，可重新发起订单，或在15分钟后重试支付。如支付未到账，请 "),c("a",{href:"javascript:;",class:"link"},"反馈客服订单号")],-1)),c("button",{class:"pay-btn",disabled:!V.value||W.value,onClick:ca},[W.value?(p(),l("span",E,"处理中...")):V.value?(p(),l("span",K,"¥"+n(V.value.price)+"/立即支付",1)):(p(),l("span",L,"请选择充值套餐"))],8,B),s[17]||(s[17]=c("p",{class:"support-text"},[r(" 支付问题反馈，点击联系 "),c("a",{href:"javascript:;",class:"link"},"在线客服")],-1))]),X.value?(p(),l("div",{key:0,class:"history-modal",onClick:s[7]||(s[7]=u(a=>X.value=!1,["self"]))},[c("div",U,[c("div",q,[s[18]||(s[18]=c("span",null,"金币明细",-1)),c("button",{class:"close-btn",onClick:s[3]||(s[3]=a=>X.value=!1)},"×")]),c("div",A,[c("span",{class:d({active:"all"===Y.value}),onClick:s[4]||(s[4]=a=>Y.value="all")},"全部",2),c("span",{class:d({active:"recharge"===Y.value}),onClick:s[5]||(s[5]=a=>Y.value="recharge")},"充值",2),c("span",{class:d({active:"purchase"===Y.value}),onClick:s[6]||(s[6]=a=>Y.value="purchase")},"消费",2)]),c("div",F,[(p(!0),l(i,null,o(aa.value,a=>{return p(),l("div",{key:a.id,class:"record-item"},[c("div",G,[c("span",J,n((s=a.transaction_type,{recharge:"充值",purchase:"购买视频",tip:"打赏",earn:"收益",refund:"退款",withdraw:"提现",admin:"系统调整"}[s]||s)),1),c("span",N,n(a.description),1),c("span",O,n(sa(a.created_at)),1)]),c("span",{class:d(["record-amount",a.amount>0?"positive":"negative"])},n(a.amount>0?"+":"")+n(a.amount),3)]);var s}),128)),0===aa.value.length?(p(),l("div",P," 暂无记录 ")):t("",!0)])])])):t("",!0)]))}},[["__scopeId","data-v-96023567"]]);export{Q as default};
