/* empty css             *//* empty css                  */import{r as e,w as a,j as l,y as s,C as i,L as t,M as v,aa as n,I as o,H as u,O as d,F as r,az as c,aC as p,z as m,aD as g,K as k}from"./vue-vendor-Ba_vealp.js";import{a as y}from"./utils-DflAyOWx.js";import{_ as f}from"./index-C3P4JTuA.js";import{aM as h}from"./element-plus-DlIn_qXi.js";const _={class:"category-page"},w={class:"page-header"},b={class:"header-title"},C={class:"filter-bar"},M={class:"filter-tabs"},j=["onClick"],x={key:0,class:"toggle-icon"},I={key:1,class:"toggle-icon grid"},T={class:"video-list-wrapper"},$={key:1,class:"empty"},z=["onClick","onMouseenter","onMouseleave"],F={class:"video-cover"},L=["src","alt"],S=["src"],P={class:"cover-views"},W={class:"video-duration"},B={key:1,class:"vip-tag"},D={class:"video-info"},H={class:"video-title"},K={class:"video-meta"},O={key:0,class:"video-tag"},V={key:1,class:"video-tag"},q={key:2,class:"video-tag"},A={class:"video-comments"},E={key:3,class:"load-more"},G=f({__name:"Category",setup(f){const G=c(),J=p(),N=e({}),Q=[{label:"最新",key:"created_at"},{label:"最热",key:"hot"},{label:"最多播放",key:"view_count"}],R=e(0),U=e([]),X=e(!1),Y=e(!1),Z=e(2),ee=e(1),ae=e(!0),le=e({}),se=e(null),ie=e(!1),te=e=>se.value===e,ve=e=>{if(se.value&&se.value!==e.id){const e=le.value[se.value];e&&(e.pause(),e.currentTime=0)}se.value=e.id;const a=le.value[e.id];a&&(a.currentTime=0,a.play().catch(()=>{ne()}))},ne=()=>{if(se.value){const e=le.value[se.value];e&&(e.pause(),e.currentTime=0),se.value=null}},oe=()=>{ie.value=!0},ue=e=>e?e.startsWith("http")?e:`${e}`:"",de=e=>{if(!e)return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},re=()=>{J.push("/user")},ce=e=>{J.push(`/user/video/${e}`)},pe=async()=>{try{const e=await y.get("/api/v1/videos/categories"),a=parseInt(G.params.id),l=(e,a)=>{for(const s of e){if(s.id===a)return s;if(s.children){const e=l(s.children,a);if(e)return e}}return null},s=l(e.data,a);s&&(N.value=s)}catch(e){}},me=async(e=!0)=>{e?(X.value=!0,ee.value=1,U.value=[]):Y.value=!0;try{const a=parseInt(G.params.id),l=Q[R.value].key,s=await y.get("/api/v1/videos",{params:{category_id:a,sort_by:l,page:ee.value,page_size:20}}),i=s.data.items||s.data||[];e?U.value=i:U.value.push(...i),ae.value=i.length>=20}catch(a){}finally{X.value=!1,Y.value=!1}},ge=()=>{ee.value++,me(!1)};return a(()=>G.params.id,()=>{G.params.id&&(pe(),me())}),l(()=>{pe(),me()}),(e,a)=>{const l=h;return m(),s("div",_,[i("header",w,[i("div",{class:"header-left",onClick:re},[...a[1]||(a[1]=[i("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[i("path",{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),i("div",b,t(N.value.name||"分类"),1),a[2]||(a[2]=i("div",{class:"header-right"},null,-1))]),i("div",C,[i("div",M,[(m(),s(v,null,n(Q,(e,a)=>i("span",{key:e.key,class:u(["filter-item",{active:R.value===a}]),onClick:e=>(e=>{R.value=e,me()})(a)},t(e.label),11,j)),64))]),i("div",{class:"view-toggle",onClick:a[0]||(a[0]=e=>Z.value=1===Z.value?2:1)},[1===Z.value?(m(),s("span",x,[...a[3]||(a[3]=[i("i",null,null,-1),i("i",null,null,-1),i("i",null,null,-1)])])):(m(),s("span",I,[...a[4]||(a[4]=[i("i",null,null,-1),i("i",null,null,-1),i("i",null,null,-1),i("i",null,null,-1)])]))])]),i("div",T,[X.value&&0===U.value.length?(m(),s("div",{key:0,class:u(["video-list",1===Z.value?"single-column":"double-column"])},[(m(),s(v,null,n(6,e=>i("div",{key:"skeleton-"+e,class:"video-card skeleton"},[...a[5]||(a[5]=[g('<div class="video-cover skeleton-cover" data-v-5dc0fc74><div class="skeleton-shimmer" data-v-5dc0fc74></div></div><div class="video-info" data-v-5dc0fc74><div class="skeleton-title" data-v-5dc0fc74></div><div class="skeleton-meta" data-v-5dc0fc74></div></div>',2)])])),64))],2)):X.value||0!==U.value.length?(m(),s("div",{key:2,class:u(["video-list",1===Z.value?"single-column":"double-column"])},[(m(!0),s(v,null,n(U.value,e=>{return m(),s("div",{key:e.id,class:"video-card",onClick:a=>(e=>{ie.value&&e.preview_url?se.value===e.id?(ne(),ce(e.id)):ve(e):ce(e.id)})(e),onMouseenter:a=>(e=>{!ie.value&&e.preview_url&&ve(e)})(e),onMouseleave:a=>(e=>{if(!ie.value&&se.value===e.id){const a=le.value[e.id];a&&(a.pause(),a.currentTime=0),se.value=null}})(e),onTouchstartPassive:oe},[i("div",F,[i("img",{src:(v=e.cover_url,v?v.startsWith("http")?v:`${v}`:""),alt:e.title,class:u({hidden:te(e.id)})},null,10,L),e.preview_url?(m(),s("video",{key:0,ref_for:!0,ref:a=>((e,a)=>{a&&(le.value[e]=a)})(e.id,a),src:ue(e.preview_url),class:u(["preview-video",{visible:te(e.id)}]),muted:"",loop:"",playsinline:"",preload:"metadata"},null,10,S)):o("",!0),i("div",P,[a[7]||(a[7]=i("span",{class:"play-icon"},"▶",-1)),i("span",null,t((l=e.view_count,l?l>=1e4?(l/1e4).toFixed(1)+"w":l>=1e3?(l/1e3).toFixed(1)+"k":l.toString():"0")),1)]),i("div",W,t(de(e.duration)),1),e.is_vip_only?(m(),s("div",B,"VIP")):o("",!0)]),i("div",D,[i("p",H,t(e.title),1),i("div",K,[e.tags&&e.tags.length>0?(m(),s("span",O,t(e.tags[0]),1)):e.category_name?(m(),s("span",V,t(e.category_name),1)):(m(),s("span",q,"精选")),i("span",A,"评论 "+t(e.comment_count||0),1)])])],40,z);var l,v}),128))],2)):(m(),s("div",$,[...a[6]||(a[6]=[i("span",null,"暂无视频",-1)])])),ae.value&&!X.value&&U.value.length>0?(m(),s("div",E,[d(l,{onClick:ge,loading:Y.value},{default:r(()=>[...a[8]||(a[8]=[k("加载更多",-1)])]),_:1},8,["loading"])])):o("",!0)])])}}},[["__scopeId","data-v-5dc0fc74"]]);export{G as default};
