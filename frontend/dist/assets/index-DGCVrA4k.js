import{_ as e}from"./ic_back-BPdSG6fy.js";import{_ as a,a as s,u as i}from"./index-C3P4JTuA.js";import{u as l}from"./useAbortController-pf-gfr0d.js";import{a as t,V as r}from"./vip-C8N2TCfr.js";import{r as c,y as n,C as d,M as o,aa as p,H as v,z as u,I as m,L as g,E as y,O as _,F as b,K as f,U as k,T as h,a0 as I,c as C,j as P,u as w,k as S}from"./vue-vendor-Ba_vealp.js";import{E}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const V={class:"vip-cards-section"},$=["onClick"],x=["src"],M=a({__name:"VipCardSlider",props:{cards:{type:Array,default:()=>[]},selectedId:{type:[Number,String],default:null}},emits:["select"],setup(e,{expose:a}){const s=c(null);return a({cardsScrollRef:s}),(a,i)=>(u(),n("div",V,[d("div",{class:"cards-scroll",ref_key:"cardsScrollRef",ref:s},[(u(!0),n(o,null,p(e.cards,s=>(u(),n("div",{key:s.id,class:v(["vip-card",{selected:e.selectedId===s.id}]),onClick:e=>a.$emit("select",s)},[d("img",{src:s.background_image,class:"card-bg"},null,8,x)],10,$))),128))],512)]))}},[["__scopeId","data-v-f66b72b2"]]),T={class:"simple-cards-section"},A={class:"simple-cards-grid"},j=["onClick"],L={class:"simple-card-name"},R={class:"simple-card-price"},Y={class:"amount"},F={class:"simple-card-desc"},D={key:1,class:"simple-daily-cost"},B=a({__name:"SimpleCardGrid",props:{cards:{type:Array,default:()=>[]},selectedId:{type:[Number,String],default:null}},emits:["select"],setup(e){const a=e=>{const a=["badge-red","badge-orange","badge-purple","badge-blue","badge-green","badge-pink"];return a[e%a.length]};return(s,i)=>(u(),n("div",T,[d("div",A,[(u(!0),n(o,null,p(e.cards,(l,r)=>{return u(),n("div",{key:"simple-"+l.id,class:v(["simple-card",{selected:e.selectedId===l.id}]),onClick:e=>s.$emit("select",l)},[l.badge_text?(u(),n("div",{key:0,class:v(["simple-badge",a(r)])},g(l.badge_text),3)):m("",!0),d("div",L,g(l.name),1),d("div",R,[i[0]||(i[0]=d("span",{class:"currency"},"¥",-1)),d("span",Y,g(l.price),1)]),d("div",F,g(0===l.duration_days?"永久解锁":l.duration_days+"天")+g(l.description||(c=l.level,t[c]||"VIP特权")),1),l.duration_days>0?(u(),n("div",D,"每日仅需"+g((l.price/l.duration_days).toFixed(1))+"元",1)):m("",!0)],10,j);var c}),128))])]))}},[["__scopeId","data-v-4f64facf"]]),N={class:"privileges-section"},G={class:"privileges-list"},H={class:"privilege-icon"},O=["src"],U={class:"privilege-info"},J={class:"privilege-name"},q={class:"privilege-desc"},z=a({__name:"PrivilegeList",props:{privileges:{type:Array,default:()=>[]}},setup:e=>(a,s)=>(u(),n("div",N,[d("div",G,[(u(!0),n(o,null,p(e.privileges,e=>(u(),n("div",{key:e.id,class:"privilege-item"},[d("div",H,[d("img",{src:e.icon,alt:""},null,8,O)]),d("div",U,[d("div",J,g(e.name),1),d("div",q,g(e.description),1)])]))),128))])]))},[["__scopeId","data-v-3c6a5f73"]]),K={class:"payment-sheet"},Q={class:"payment-methods"},W=["onClick"],X=["src","alt"],Z={class:"method-name"},ee={key:0,class:"check-mark"},ae=["disabled"],se={key:0},ie={key:1},le=a({__name:"PaymentModal",props:{visible:{type:Boolean,default:!1},methods:{type:Array,default:()=>[]},selectedType:{type:String,default:"alipay"},price:{type:[Number,String],default:0},processing:{type:Boolean,default:!1}},emits:["close","confirm","update:selectedType"],setup:e=>(a,s)=>(u(),y(I,{to:"body"},[_(h,{name:"slide-up"},{default:b(()=>[e.visible?(u(),n("div",{key:0,class:"payment-sheet-overlay",onClick:s[1]||(s[1]=k(e=>a.$emit("close"),["self"]))},[d("div",K,[s[2]||(s[2]=d("div",{class:"sheet-handle"},null,-1)),s[3]||(s[3]=d("h3",{class:"sheet-title"},"选择支付方式",-1)),d("div",Q,[(u(!0),n(o,null,p(e.methods,s=>(u(),n("div",{key:s.type,class:"payment-method-item",onClick:e=>a.$emit("update:selectedType",s.type)},[d("img",{src:s.icon,alt:s.name,class:"method-icon"},null,8,X),d("span",Z,g(s.name),1),d("div",{class:v(["radio-circle",{checked:e.selectedType===s.type}])},[e.selectedType===s.type?(u(),n("span",ee,"✓")):m("",!0)],2)],8,W))),128))]),s[4]||(s[4]=d("div",{class:"tips-section"},[d("h4",{class:"tips-title"},"支付小贴士："),d("p",{class:"tips-item"},"1.因超时支付无法到账，请重新发起。"),d("p",{class:"tips-item"},"2.每天发起支付不能超过5次，连续发起且未支付，账号可能被加入黑名单。")],-1)),d("button",{class:"pay-btn",disabled:e.processing,onClick:s[0]||(s[0]=e=>a.$emit("confirm"))},[e.processing?(u(),n("span",se,"处理中...")):(u(),n("span",ie,"¥"+g(e.price)+"/立即支付",1))],8,ae),s[5]||(s[5]=d("p",{class:"support-text"},[f(" 支付中如有问题，请咨询 "),d("a",{href:"javascript:;",class:"link"},"在线客服")],-1))])])):m("",!0)]),_:1})]))},[["__scopeId","data-v-072eecec"]]),te={class:"modal-content"},re={class:"modal-header"},ce={class:"modal-body"},ne={class:"record-info"},de={class:"record-name"},oe={class:"record-time"},pe={class:"record-amount"},ve={key:0,class:"empty-state"},ue=a({__name:"RecordsModal",props:{visible:{type:Boolean,default:!1},records:{type:Array,default:()=>[]}},emits:["close"],setup(e){const a=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`};return(s,i)=>e.visible?(u(),n("div",{key:0,class:"records-modal",onClick:i[1]||(i[1]=k(e=>s.$emit("close"),["self"]))},[d("div",te,[d("div",re,[i[2]||(i[2]=d("span",null,"充值记录",-1)),d("button",{class:"close-btn",onClick:i[0]||(i[0]=e=>s.$emit("close"))},"×")]),d("div",ce,[(u(!0),n(o,null,p(e.records,e=>(u(),n("div",{key:e.id,class:"record-item"},[d("div",ne,[d("span",de,g(e.card_name),1),d("span",oe,g(a(e.created_at)),1)]),d("span",pe,"¥"+g(e.amount),1)]))),128)),0===e.records.length?(u(),n("div",ve,"暂无充值记录")):m("",!0)])])])):m("",!0)}},[["__scopeId","data-v-b3ccdbe6"]]);const me={class:"vip-page"},ge={class:"page-header"},ye={class:"user-info-section"},_e={class:"avatar-wrapper"},be=["src"],fe={class:"user-details"},ke={class:"nickname-row"},he={class:"username"},Ie=["src"],Ce={class:"vip-status"},Pe={key:0},we={key:1},Se={key:2,href:"javascript:;",class:"open-vip-link"},Ee={class:"pay-section"},Ve=["disabled"],$e={key:0},xe={key:1},Me={key:2},Te=a({__name:"index",setup(a){const o=i(),{signal:p}=l(),y=C(()=>o.user||{}),b=c(null),k=c(!1),h=C(()=>{if(y.value.avatar)return y.value.avatar;const e=(parseInt(y.value.id)||1)%52;return e<17?`/images/avatars/icon_avatar_${e+1}.webp`:e<32?`/images/avatars/DM_20251217202131_${String(e-17+1).padStart(3,"0")}.JPEG`:`/images/avatars/DM_20251217202341_${String(e-32+1).padStart(3,"0")}.JPEG`}),I=C(()=>r[y.value.vip_level]||""),{vipCards:V,selectedCard:$,paymentRecords:x,currentPrivileges:T,fetchVipCards:A,fetchPrivileges:j,fetchRecords:L,selectCard:R}=function(e){const a=c([]),i=c(null),l=c([]),n=c([]),d=c(!1),o=C(()=>{if(!i.value)return[];const e=i.value.privilege_ids;return e&&e.length>0?e.map(e=>l.value.find(a=>a.id===e)).filter(e=>null!=e):[]});return{vipCards:a,selectedCard:i,vipPrivileges:l,paymentRecords:n,isProcessing:d,currentPrivileges:o,getVipLevelIcon:e=>r[e]||"",getLevelBenefit:e=>t[e]||"VIP特权",getBadgeColorClass:e=>{const a=["badge-red","badge-orange","badge-purple","badge-blue","badge-green","badge-pink"];return a[e%a.length]},fetchVipCards:async()=>{try{const l=await s.get("/vip/cards",{signal:e});a.value=l.data||[],a.value.length>0&&!i.value&&(i.value=a.value[0])}catch(l){"CanceledError"!==l.name&&"AbortError"!==l.name&&(a.value=[{id:1,level:3,name:"尊享限定卡",background_image:"/images/vip/card_premium.webp",badge_text:"15项特权",price:200,original_price:500,duration_days:0},{id:2,level:2,name:"尊享永久卡",background_image:"/images/vip/card_forever.webp",badge_text:"13项特权",price:200,original_price:400,duration_days:0},{id:3,level:1,name:"至尊会员",background_image:"/images/vip/card_supreme.webp",badge_text:"",price:100,original_price:200,duration_days:30}],i.value=a.value[0])}},fetchPrivileges:async()=>{try{const a=await s.get("/vip/privileges",{signal:e});l.value=a.data||[]}catch(a){"CanceledError"!==a.name&&"AbortError"!==a.name&&(l.value=[{id:1,name:"至尊VIP标识",description:"专属VIP图标 至尊特权",icon:"/images/vip/ic_vip_badge.webp"},{id:2,name:"金币视频免费",description:"全网金币视频免费看",icon:"/images/vip/ic_coin_free.webp"},{id:3,name:"AI脱衣*15次",description:"AI科技 女神秒变母狗",icon:"/images/vip/ic_ai.webp"},{id:4,name:"每日下载50",description:"精彩视频 离线下载",icon:"/images/vip/ic_download.webp"},{id:5,name:"私信半价",description:"私信功能半价使用",icon:"/images/vip/ic_message.webp"},{id:6,name:"头像特权",description:"解锁修改头像",icon:"/images/vip/ic_avatar.webp"}])}},fetchRecords:async()=>{try{const a=await s.get("/vip/records",{signal:e});n.value=a.data||[]}catch(a){"CanceledError"!==a.name&&a.name}},selectCard:(e,s)=>{i.value=e;const l=a.value.findIndex(a=>a.id===e.id);if(-1!==l&&s){const e=168;s.scrollTo({left:l*e,behavior:"smooth"})}}}}(p),{showPaymentModal:Y,selectedPayType:F,isProcessing:D,paymentMethods:N,handlePay:G,confirmPay:H}=function(){const e=c(!1),a=c("alipay"),i=c(!1);return{showPaymentModal:e,selectedPayType:a,isProcessing:i,paymentMethods:[{type:"alipay",name:"支付宝",icon:"/images/icons/ic_alipay.png"},{type:"wxpay",name:"微信",icon:"/images/icons/ic_wechat.png"}],handlePay:a=>{a?e.value=!0:E.warning("请选择会员卡")},confirmPay:async l=>{var t,r,c,n;if(l){i.value=!0,e.value=!1;try{const e=await s.post("/payments/epay/create",{order_type:(d=l.level,{1:"VIP_MONTHLY",2:"VIP_QUARTERLY",3:"VIP_YEARLY",4:"VIP_YEARLY",5:"VIP_LIFETIME",6:"VIP_LIFETIME",7:"VIP_LIFETIME"}[d]||"VIP_MONTHLY")},{params:{pay_type:a.value}});(null==(t=e.data)?void 0:t.payment_url)?window.location.href=e.data.payment_url:(null==(r=e.data)?void 0:r.qr_code)?E.info("请使用手机扫码支付"):E.error("获取支付链接失败")}catch(o){E.error((null==(n=null==(c=o.response)?void 0:c.data)?void 0:n.detail)||"支付失败，请重试")}finally{i.value=!1}var d}}}}(),O=e=>{var a;R(e,null==(a=b.value)?void 0:a.cardsScrollRef)},U=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`};return P(()=>{A(),j(),L()}),(a,s)=>{var i,l,t;return u(),n("div",me,[d("header",ge,[d("button",{class:"back-btn",onClick:s[0]||(s[0]=e=>a.$router.back())},[...s[7]||(s[7]=[d("img",{src:e,alt:"返回",class:"back-icon"},null,-1)])]),s[8]||(s[8]=d("h1",null,"会员中心",-1)),d("button",{class:"record-btn",onClick:s[1]||(s[1]=e=>k.value=!0)},"充值记录")]),d("div",ye,[d("div",_e,[d("div",{class:v(["avatar-container",{"is-vip":y.value.is_vip}])},[d("img",{src:h.value,class:"user-avatar"},null,8,be)],2)]),d("div",fe,[d("div",ke,[d("span",he,g(y.value.nickname||y.value.username||"未登录"),1),y.value.vip_level>0?(u(),n("img",{key:0,src:I.value,class:"vip-level-badge"},null,8,Ie)):m("",!0)]),d("div",Ce,[y.value.is_vip?(u(),n("span",we,g(y.value.vip_level_name)+" · 到期："+g(U(y.value.vip_expire_date)),1)):(u(),n("span",Pe,"您还不是会员")),y.value.is_vip?m("",!0):(u(),n("a",Se,"开通会员")),s[9]||(s[9]=d("span",{class:"benefit-text"},"畅享特权",-1))])])]),_(M,{ref_key:"cardSlider",ref:b,cards:w(V),"selected-id":null==(i=w($))?void 0:i.id,onSelect:O},null,8,["cards","selected-id"]),_(B,{cards:w(V),"selected-id":null==(l=w($))?void 0:l.id,onSelect:O},null,8,["cards","selected-id"]),_(z,{privileges:w(T)},null,8,["privileges"]),s[11]||(s[11]=d("div",{class:"tips-section"},[d("p",{class:"tips"},[f("*如提示【交易失败】【账户风险】等，可重新发起订单，或在15分钟后重试支付。如支付未到账，请"),d("a",{href:"javascript:;",class:"link"},"反馈客服订单号")])],-1)),d("div",Ee,[d("button",{class:"pay-btn",disabled:!w($)||w(D),onClick:s[2]||(s[2]=e=>w(G)(w($)))},[w(D)?(u(),n("span",$e,"处理中...")):w($)?(u(),n("span",xe,"¥"+g(w($).price)+"/立即支付",1)):(u(),n("span",Me,"请选择会员卡"))],8,Ve),s[10]||(s[10]=d("p",{class:"support-text"},[f("支付问题反馈，点击联系 "),d("a",{href:"javascript:;",class:"link"},"在线客服")],-1))]),_(le,{visible:w(Y),methods:w(N),"selected-type":w(F),"onUpdate:selectedType":s[3]||(s[3]=e=>S(F)?F.value=e:null),price:null==(t=w($))?void 0:t.price,processing:w(D),onClose:s[4]||(s[4]=e=>Y.value=!1),onConfirm:s[5]||(s[5]=e=>w(H)(w($)))},null,8,["visible","methods","selected-type","price","processing"]),_(ue,{visible:k.value,records:w(x),onClose:s[6]||(s[6]=e=>k.value=!1)},null,8,["visible","records"])])}}},[["__scopeId","data-v-4c659499"]]);export{Te as default};
