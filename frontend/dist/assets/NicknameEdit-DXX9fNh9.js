import{r as a,c as e,j as s,n as l,y as i,C as t,E as n,H as u,L as c,G as v,I as r,af as o,U as d,a0 as p,aC as m,z as f}from"./vue-vendor-Ba_vealp.js";import{_ as k}from"./ic_back-BPdSG6fy.js";import{_ as b,u as h,a as y}from"./index-C3P4JTuA.js";import{E as _}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const g={class:"nickname-edit-page"},C={class:"page-header"},w={class:"input-section"},x={class:"input-wrapper"},j=b({__name:"NicknameEdit",setup(b){const j=m(),U=h(),z=a(""),E=a(!1),I=a(null),L=a(!1),V=e(()=>{var a,e;return!0===(null==(a=U.user)?void 0:a.is_vip)||(null==(e=U.user)?void 0:e.vip_level)>0}),B=()=>{L.value=!1,j.back()},G=()=>{L.value=!1,j.push("/user/vip")},H=async()=>{var a,e;if(z.value.trim()){if(z.value.trim().length<2)_.warning("昵称至少2个字符");else if(!E.value){E.value=!0;try{await y.put("/users/me",{nickname:z.value.trim()}),await U.fetchUser(),_.success("昵称已更新"),j.back()}catch(s){_.error((null==(e=null==(a=s.response)?void 0:a.data)?void 0:e.detail)||"更新失败，请重试")}finally{E.value=!1}}}else _.warning("请输入昵称")};return s(async()=>{var a,e;await U.fetchUser(),V.value?(z.value=(null==(a=U.user)?void 0:a.nickname)||"",await l(),null==(e=I.value)||e.focus()):L.value=!0}),(a,e)=>(f(),i("div",g,[t("header",C,[t("div",{class:"back-btn",onClick:e[0]||(e[0]=e=>a.$router.back())},[...e[3]||(e[3]=[t("img",{src:k,alt:"返回",class:"back-icon"},null,-1)])]),e[4]||(e[4]=t("h1",{class:"page-title"},"修改昵称",-1)),t("div",{class:u(["save-btn",{disabled:E.value||!z.value.trim()}]),onClick:H},c(E.value?"保存中...":"保存"),3)]),t("div",w,[t("div",x,[v(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>z.value=a),placeholder:"请输入昵称",maxlength:"20",ref_key:"inputRef",ref:I},null,512),[[o,z.value]]),z.value?(f(),i("div",{key:0,class:"clear-btn",onClick:e[2]||(e[2]=a=>z.value="")},[...e[5]||(e[5]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"})],-1)])])):r("",!0)]),e[6]||(e[6]=t("p",{class:"input-tip"},"注意*诱导性昵称会被投诉封号",-1))]),(f(),n(p,{to:"body"},[L.value?(f(),i("div",{key:0,class:"vip-modal-overlay",onClick:d(B,["self"])},[t("div",{class:"vip-modal-content"},[e[7]||(e[7]=t("h2",{class:"vip-modal-title"},"温馨提示",-1)),e[8]||(e[8]=t("p",{class:"vip-modal-text"},"您还不是VIP无法修改昵称!",-1)),e[9]||(e[9]=t("p",{class:"vip-modal-subtext"},"开通会员 即可解锁继续",-1)),t("button",{class:"vip-modal-btn",onClick:G},"立即开通")])])):r("",!0)]))]))}},[["__scopeId","data-v-d7aecf5d"]]);export{j as default};
