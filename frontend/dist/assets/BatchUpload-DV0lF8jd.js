/* empty css             *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                  *//* empty css                *//* empty css                     *//* empty css                  *//* empty css               *//* empty css                 *//* empty css                  */import{r as a,c as e,j as l,y as t,C as s,O as u,E as d,I as i,F as o,aC as r,z as p,M as n,aa as c,u as v,K as m,L as _}from"./vue-vendor-Ba_vealp.js";import{be as f,aR as g,bc as h,bd as y,aS as b,bl as j,bm as w,aT as V,bo as x,bw as k,aQ as M,aF as C,aM as U,bh as E,bi as F,bj as I,E as K}from"./element-plus-DlIn_qXi.js";import{_ as $,a as z}from"./index-C3P4JTuA.js";import"./utils-DflAyOWx.js";const A={class:"batch-upload-page"},B={class:"upload-header"},O={class:"progress-header"},P={class:"progress-stats"},Q=$({__name:"BatchUpload",setup($){const Q=r(),R=a({category_id:null,tags:[],title_prefix:"",is_vip_only:!1}),T=a([]),q=a([]),D=a(null),G=a([]),L=a([]),N=a(!1),S=a([]),W=e(()=>L.value.length>0&&!N.value),H=e(()=>S.value.filter(a=>"success"===a.status).length),J=e(()=>S.value.filter(a=>"error"===a.status).length),X=(a,e)=>{L.value=e.map(a=>a.raw||a),G.value=e},Y=(a,e)=>{L.value=e.map(a=>a.raw||a),G.value=e},Z=async()=>{var a,e;if(0!==L.value.length){N.value=!0,S.value=[];try{const a=new FormData;L.value.forEach(e=>{a.append("files",e)}),R.value.category_id&&a.append("category_id",R.value.category_id),a.append("is_vip_only",R.value.is_vip_only),R.value.tags.length>0&&a.append("tags",R.value.tags.join(",")),R.value.title_prefix&&a.append("title_prefix",R.value.title_prefix);const e=await z.post("/videos/batch-upload",a,{headers:{"Content-Type":"multipart/form-data"},timeout:0});S.value=e.data.results||[],e.data.success>0&&K.success(`æˆåŠŸä¸Šä¼  ${e.data.success} ä¸ªè§†é¢‘`),e.data.failed>0&&K.warning(`${e.data.failed} ä¸ªè§†é¢‘ä¸Šä¼ å¤±è´¥`),L.value=[],G.value=[],D.value&&D.value.clearFiles()}catch(l){K.error("æ‰¹é‡ä¸Šä¼ å¤±è´¥: "+((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.detail)||l.message))}finally{N.value=!1}}else K.warning("è¯·å…ˆé€‰æ‹©è§†é¢‘æ–‡ä»¶")};return l(()=>{(async()=>{try{const a=await z.get("/videos/categories");T.value=a.data||[]}catch(a){}})(),(async()=>{try{const a=await z.get("/admin/tags");q.value=a.data||[]}catch(a){}})()}),(a,e)=>{const l=w,r=j,K=b,$=y,z=V,aa=h,ea=x,la=g,ta=f,sa=M,ua=U,da=k,ia=I,oa=F,ra=E;return p(),t("div",A,[e[10]||(e[10]=s("div",{class:"page-header"},[s("h1",null,"æ‰¹é‡ä¸Šä¼ è§†é¢‘"),s("p",{class:"subtitle"},"æ”¯æŒåŒæ—¶ä¸Šä¼ å¤šä¸ªè§†é¢‘ï¼Œç»Ÿä¸€è®¾ç½®åˆ†ç±»å’Œæ ‡ç­¾")],-1)),u(ta,{class:"settings-card"},{header:o(()=>[...e[4]||(e[4]=[s("span",{class:"card-title"},"ðŸ“‹ æ‰¹é‡è®¾ç½®",-1)])]),default:o(()=>[u(la,{model:R.value,"label-width":"100px"},{default:o(()=>[u(aa,{gutter:20},{default:o(()=>[u($,{span:8},{default:o(()=>[u(K,{label:"è§†é¢‘åˆ†ç±»"},{default:o(()=>[u(r,{modelValue:R.value.category_id,"onUpdate:modelValue":e[0]||(e[0]=a=>R.value.category_id=a),placeholder:"é€‰æ‹©åˆ†ç±»",clearable:"",style:{width:"100%"}},{default:o(()=>[(p(!0),t(n,null,c(T.value,a=>(p(),d(l,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),u($,{span:8},{default:o(()=>[u(K,{label:"è§†é¢‘æ ‡ç­¾"},{default:o(()=>[u(r,{modelValue:R.value.tags,"onUpdate:modelValue":e[1]||(e[1]=a=>R.value.tags=a),multiple:"",filterable:"","allow-create":"",placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ ‡ç­¾",style:{width:"100%"}},{default:o(()=>[(p(!0),t(n,null,c(q.value,a=>(p(),d(l,{key:a.id,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),u($,{span:8},{default:o(()=>[u(K,{label:"æ ‡é¢˜å‰ç¼€"},{default:o(()=>[u(z,{modelValue:R.value.title_prefix,"onUpdate:modelValue":e[2]||(e[2]=a=>R.value.title_prefix=a),placeholder:"å¯é€‰ï¼Œå¦‚ï¼šã€æ–°å“ã€‘"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(aa,{gutter:20},{default:o(()=>[u($,{span:8},{default:o(()=>[u(K,{label:"VIPä¸“å±ž"},{default:o(()=>[u(ea,{modelValue:R.value.is_vip_only,"onUpdate:modelValue":e[3]||(e[3]=a=>R.value.is_vip_only=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),u(ta,{class:"upload-card"},{header:o(()=>[s("div",B,[e[5]||(e[5]=s("span",{class:"card-title"},"ðŸ“ é€‰æ‹©è§†é¢‘æ–‡ä»¶",-1)),u(ua,{type:"primary",disabled:!W.value,onClick:Z,loading:N.value},{default:o(()=>[u(sa,null,{default:o(()=>[u(v(C))]),_:1}),m(" å¼€å§‹ä¸Šä¼  ("+_(L.value.length)+" ä¸ªæ–‡ä»¶) ",1)]),_:1},8,["disabled","loading"])])]),default:o(()=>[u(da,{ref_key:"uploadRef",ref:D,class:"upload-area",drag:"",multiple:"","auto-upload":!1,"on-change":X,"on-remove":Y,accept:"video/*","file-list":G.value},{tip:o(()=>[...e[6]||(e[6]=[s("div",{class:"el-upload__tip"}," æ”¯æŒ MP4ã€WebMã€AVIã€MOVã€MKV æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§ 2GB ",-1)])]),default:o(()=>[u(sa,{class:"el-icon--upload"},{default:o(()=>[u(v(C))]),_:1}),e[7]||(e[7]=s("div",{class:"el-upload__text"},[m(" æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ– "),s("em",null,"ç‚¹å‡»é€‰æ‹©")],-1))]),_:1},8,["file-list"])]),_:1}),S.value.length>0?(p(),d(ta,{key:0,class:"progress-card"},{header:o(()=>[s("div",O,[e[8]||(e[8]=s("span",{class:"card-title"},"ðŸ“Š ä¸Šä¼ è¿›åº¦",-1)),s("div",P,[u(ia,{type:"success"},{default:o(()=>[m("æˆåŠŸ: "+_(H.value),1)]),_:1}),J.value>0?(p(),d(ia,{key:0,type:"danger"},{default:o(()=>[m("å¤±è´¥: "+_(J.value),1)]),_:1})):i("",!0),u(ia,{type:"info"},{default:o(()=>[m("æ€»è®¡: "+_(S.value.length),1)]),_:1})])])]),default:o(()=>[u(ra,{data:S.value,style:{width:"100%"}},{default:o(()=>[u(oa,{prop:"title",label:"æ–‡ä»¶å","min-width":"200"}),u(oa,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:o(({row:a})=>[u(ia,{type:"success"===a.status?"success":"error"===a.status?"danger":"warning"},{default:o(()=>[m(_("success"===a.status?"æˆåŠŸ":"error"===a.status?"å¤±è´¥":"å¤„ç†ä¸­"),1)]),_:2},1032,["type"])]),_:1}),u(oa,{prop:"message",label:"æ¶ˆæ¯","min-width":"200"}),u(oa,{label:"æ“ä½œ",width:"120"},{default:o(({row:a})=>[a.video_id?(p(),d(ua,{key:0,type:"primary",link:"",onClick:e=>{return l=a.video_id,void Q.push(`/videos/${l}`);var l}},{default:o(()=>[...e[9]||(e[9]=[m(" æŸ¥çœ‹è§†é¢‘ ",-1)])]),_:1},8,["onClick"])):i("",!0)]),_:1})]),_:1},8,["data"])]),_:1})):i("",!0)])}}},[["__scopeId","data-v-44c9bc2c"]]);export{Q as default};
