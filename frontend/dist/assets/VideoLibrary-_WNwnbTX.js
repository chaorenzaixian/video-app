import{r as e,w as a,j as l,y as s,C as i,I as t,O as v,M as o,aa as n,aC as c,z as u,H as r,L as d,aD as p}from"./vue-vendor-Ba_vealp.js";import{_ as y,a as k}from"./index-C3P4JTuA.js";import{S as g}from"./SearchHeader-hqKygmDY.js";import"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";import"./ic_back-BPdSG6fy.js";const m={class:"video-library-page"},h={class:"sticky-header"},f={class:"filter-section"},b={class:"filter-row"},w={class:"filter-options"},_=["onClick"],C={class:"filter-row"},S={class:"filter-options"},$=["onClick"],M={class:"filter-row"},j={class:"filter-options"},x=["onClick"],I={class:"filter-row"},T={class:"filter-options"},z=["onClick"],D={key:0,class:"video-section"},L={key:0,class:"video-list double-column"},P={key:1,class:"empty-videos"},V={key:2,class:"video-list double-column"},W=["onClick","onMouseenter","onMouseleave"],F={class:"video-cover"},H=["src","alt"],K=["src"],O={class:"cover-views"},q={class:"video-duration"},A={key:1,class:"vip-tag"},B={class:"video-info"},E={class:"video-title"},G={class:"video-meta"},J={key:0,class:"video-tag"},N={key:1,class:"video-tag"},Q={key:2,class:"video-tag"},R={class:"video-comments"},U={key:4,class:"loading-more"},X={key:1,class:"video-section"},Y={key:0,class:"loading-state"},Z={key:1,class:"empty-videos"},ee={key:2,class:"video-list double-column"},ae=["onClick"],le={class:"video-cover vertical"},se=["src","alt"],ie={class:"cover-views"},te={class:"video-info"},ve={class:"video-title"},oe={key:2,class:"gallery-section"},ne={key:0,class:"loading-state"},ce={key:1,class:"empty-videos"},ue={key:2,class:"gallery-grid"},re=["onClick"],de={class:"gallery-cover"},pe=["src","alt"],ye={class:"gallery-info"},ke={class:"views"},ge={class:"count"},me={class:"gallery-title"},he={key:3,class:"novel-section"},fe={key:0,class:"loading-state"},be={key:1,class:"empty-videos"},we={key:2,class:"novel-grid"},_e=["onClick"],Ce={class:"novel-cover-wrap"},Se=["src","alt"],$e={key:0,class:"audio-badge"},Me={class:"novel-info"},je={class:"novel-title"},xe={class:"novel-author"},Ie={class:"novel-chapters"},Te={key:4,class:"post-section"},ze={key:0,class:"loading-state"},De={key:1,class:"empty-videos"},Le={key:2,class:"post-list"},Pe=["onClick"],Ve={class:"post-header"},We=["src"],Fe={class:"post-user-info"},He={class:"post-username"},Ke={class:"post-time"},Oe={class:"post-content"},qe={key:0,class:"post-images"},Ae=["src"],Be={class:"post-stats"},Ee={key:0,class:"post-topic-tag"},Ge=20,Je=y({__name:"VideoLibrary",setup(y){const Je=c();e("library");const Ne=e([{key:"video",label:"å½±ç‰‡"},{key:"douyin",label:"æŠ–éŸ³"},{key:"gallery",label:"å›¾é›†"},{key:"novel",label:"å°è¯´"},{key:"post",label:"å¸–å­"}]),Qe=e([{key:"all",label:"å…¨éƒ¨ç±»åž‹"}]),Re=e([{key:"all",label:"å…¨éƒ¨"},{key:"vip",label:"VIP"}]),Ue=e([{key:"favorite",label:"æœ€å¤šæ”¶è—"},{key:"view",label:"æœ€å¤šè§‚çœ‹"},{key:"newest",label:"æœ€æ–°ä¸Šæž¶"}]),Xe=e("video"),Ye=e("all"),Ze=e("all"),ea=e("favorite"),aa=e([]),la=e(!1),sa=e(!1),ia=e(!0),ta=e(1),va=e([]),oa=e(!0),na=e(1),ca=e([]),ua=e(!0),ra=e(1),da=e([]),pa=e(!0),ya=e(1),ka=e([]),ga=e(!0),ma=e(1),ha=e({}),fa=e(null),ba=e(!1),wa=e=>fa.value===e,_a=e=>{if(fa.value&&fa.value!==e.id){const e=ha.value[fa.value];e&&(e.pause(),e.currentTime=0)}fa.value=e.id;const a=ha.value[e.id];a&&(a.currentTime=0,a.play().catch(()=>{Ca()}))},Ca=()=>{if(fa.value){const e=ha.value[fa.value];e&&(e.pause(),e.currentTime=0),fa.value=null}},Sa=()=>{ba.value=!0},$a=e=>e?(e.startsWith("http"),e):"",Ma=e=>e?e>=1e4?(e/1e4).toFixed(1)+"W":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString():"0",ja=e=>{if(!e)return"00:00";const a=Math.floor(e/3600),l=Math.floor(e%3600/60),s=Math.floor(e%60);return a>0?`${a}:${l.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${l.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},xa=e=>{if(!e)return"";const a=new Date(e),l=(new Date-a)/1e3;return l<60?"åˆšåˆš":l<3600?Math.floor(l/60)+"åˆ†é’Ÿå‰":l<86400?Math.floor(l/3600)+"å°æ—¶å‰":a.toLocaleDateString()},Ia=e=>Je.push(`/user/video/${e}`),Ta=async()=>{la.value=!0;try{switch(Xe.value){case"video":await za(!0);break;case"douyin":await Da(!0);break;case"gallery":await La(!0);break;case"novel":await Pa(!0);break;case"post":await Va(!0)}}finally{la.value=!1}},za=async(e=!0)=>{var a,l;e?(ta.value=1,aa.value=[]):sa.value=!0;try{const s={favorite:"hot",view:"view_count",newest:"created_at"},i={page:ta.value,limit:Ge,sort_by:s[ea.value]||"hot"};"vip"===Ze.value&&(i.is_vip_only=!0),"all"!==Ye.value&&(i.category_id=parseInt(Ye.value));const t=await k.get("/videos",{params:i}),v=((null==(a=t.data)?void 0:a.videos)||(null==(l=t.data)?void 0:l.items)||t.data||[]).map(e=>({...e,comment_count:e.comment_count||0}));aa.value=e?v:[...aa.value,...v],ia.value=v.length>=Ge}catch(s){}finally{sa.value=!1}},Da=async(e=!0)=>{var a;e&&(na.value=1,va.value=[]);try{const l=await k.get("/shorts",{params:{page:na.value,limit:Ge}}),s=(null==(a=l.data)?void 0:a.items)||l.data||[];va.value=e?s:[...va.value,...s],oa.value=s.length>=Ge}catch(l){}},La=async(e=!0)=>{e&&(ra.value=1,ca.value=[]);try{const a=(await k.get("/gallery-novel/gallery/list",{params:{page:ra.value,page_size:Ge}})).data||[];ca.value=e?a:[...ca.value,...a],ua.value=a.length>=Ge}catch(a){}},Pa=async(e=!0)=>{e&&(ya.value=1,da.value=[]);try{const a=((await k.get("/gallery-novel/novel/list",{params:{page:ya.value,page_size:Ge,novel_type:"all"}})).data||[]).filter(e=>e.title&&e.id);da.value=e?a:[...da.value,...a],pa.value=a.length>=Ge}catch(a){}},Va=async(e=!0)=>{e&&(ma.value=1,ka.value=[]);try{const a=(await k.get("/community/posts",{params:{page:ma.value,page_size:Ge}})).data||[];ka.value=e?a:[...ka.value,...a],ga.value=a.length>=Ge}catch(a){}},Wa=()=>{!sa.value&&ia.value&&(ta.value++,za(!1))},Fa=async()=>{na.value++,await Da(!1)},Ha=async()=>{ra.value++,await La(!1)},Ka=async()=>{ya.value++,await Pa(!1)},Oa=async()=>{ma.value++,await Va(!1)};return a(Xe,()=>{Ta()}),a([Ye,Ze,ea],()=>{"video"===Xe.value&&za(!0)}),l(()=>{(async()=>{try{const e=(await k.get("/videos/categories")).data||[];Qe.value=[{key:"all",label:"å…¨éƒ¨ç±»åž‹"},...e.map(e=>({key:String(e.id),label:e.name}))]}catch(e){}})(),Ta()}),(e,a)=>(u(),s("div",m,[i("div",h,[v(g,{"current-page":"library","show-search-box":!1})]),i("div",f,[i("div",b,[a[0]||(a[0]=i("span",{class:"filter-label"},"åˆ†ç±»",-1)),i("div",w,[(u(!0),s(o,null,n(Ne.value,e=>(u(),s("span",{key:e.key,class:r(["filter-option",{active:Xe.value===e.key}]),onClick:a=>Xe.value=e.key},d(e.label),11,_))),128))])]),i("div",C,[a[1]||(a[1]=i("span",{class:"filter-label"},"æ ‡ç­¾",-1)),i("div",S,[(u(!0),s(o,null,n(Qe.value,e=>(u(),s("span",{key:e.key,class:r(["filter-option",{active:Ye.value===e.key}]),onClick:a=>Ye.value=e.key},d(e.label),11,$))),128))])]),i("div",M,[a[2]||(a[2]=i("span",{class:"filter-label"},"ç±»åž‹",-1)),i("div",j,[(u(!0),s(o,null,n(Re.value,e=>(u(),s("span",{key:e.key,class:r(["filter-option",{active:Ze.value===e.key}]),onClick:a=>Ze.value=e.key},d(e.label),11,x))),128))])]),i("div",I,[a[3]||(a[3]=i("span",{class:"filter-label"},"æŽ’åº",-1)),i("div",T,[(u(!0),s(o,null,n(Ue.value,e=>(u(),s("span",{key:e.key,class:r(["filter-option",{active:ea.value===e.key}]),onClick:a=>ea.value=e.key},d(e.label),11,z))),128))])])]),"video"===Xe.value?(u(),s("div",D,[la.value&&0===aa.value.length?(u(),s("div",L,[(u(),s(o,null,n(6,e=>i("div",{key:"skeleton-"+e,class:"video-card skeleton"},[...a[4]||(a[4]=[p('<div class="video-cover skeleton-cover" data-v-34e6b1fc><div class="skeleton-shimmer" data-v-34e6b1fc></div></div><div class="video-info" data-v-34e6b1fc><div class="skeleton-title" data-v-34e6b1fc></div><div class="skeleton-meta" data-v-34e6b1fc></div></div>',2)])])),64))])):la.value||0!==aa.value.length?(u(),s("div",V,[(u(!0),s(o,null,n(aa.value,e=>{return u(),s("div",{key:e.id,class:"video-card",onClick:a=>(e=>{ba.value&&e.preview_url?fa.value===e.id?(Ca(),Ia(e.id)):_a(e):Ia(e.id)})(e),onMouseenter:a=>(e=>{!ba.value&&e.preview_url&&_a(e)})(e),onMouseleave:a=>(e=>{if(!ba.value&&fa.value===e.id){const a=ha.value[e.id];a&&(a.pause(),a.currentTime=0),fa.value=null}})(e),onTouchstartPassive:Sa},[i("div",F,[i("img",{src:$a(e.cover_url),alt:e.title,class:r({hidden:wa(e.id)})},null,10,H),e.preview_url?(u(),s("video",{key:0,ref_for:!0,ref:a=>((e,a)=>{a&&(ha.value[e]=a)})(e.id,a),src:(l=e.preview_url,l?(l.startsWith("http"),l):""),class:r(["preview-video",{visible:wa(e.id)}]),muted:"",loop:"",playsinline:"",preload:"metadata"},null,10,K)):t("",!0),i("div",O,[a[6]||(a[6]=i("span",{class:"play-icon"},"â–¶",-1)),i("span",null,d(Ma(e.view_count)),1)]),i("div",q,d(ja(e.duration)),1),e.is_vip_only?(u(),s("div",A,"VIP")):t("",!0)]),i("div",B,[i("p",E,d(e.title),1),i("div",G,[e.tags&&e.tags.length>0?(u(),s("span",J,d(e.tags[0]),1)):e.category_name?(u(),s("span",N,d(e.category_name),1)):(u(),s("span",Q,"ç²¾é€‰")),i("span",R,"è¯„è®º "+d(e.comment_count||0),1)])])],40,W);var l}),128))])):(u(),s("div",P,[...a[5]||(a[5]=[i("span",null,"æš‚æ— è§†é¢‘",-1)])])),ia.value&&!la.value&&aa.value.length>0?(u(),s("div",{key:3,class:"load-more",onClick:Wa},[...a[7]||(a[7]=[i("span",null,"åŠ è½½æ›´å¤š",-1)])])):t("",!0),sa.value?(u(),s("div",U,[...a[8]||(a[8]=[i("span",null,"åŠ è½½ä¸­...",-1)])])):t("",!0)])):t("",!0),"douyin"===Xe.value?(u(),s("div",X,[la.value&&0===va.value.length?(u(),s("div",Y,"åŠ è½½ä¸­...")):la.value||0!==va.value.length?(u(),s("div",ee,[(u(!0),s(o,null,n(va.value,e=>(u(),s("div",{key:e.id,class:"video-card",onClick:a=>{return l=e.id,Je.push(`/user/short-video/${l}`);var l}},[i("div",le,[i("img",{src:$a(e.cover_url),alt:e.title},null,8,se),i("div",ie,[a[10]||(a[10]=i("span",{class:"play-icon"},"â–¶",-1)),i("span",null,d(Ma(e.view_count)),1)])]),i("div",te,[i("p",ve,d(e.title),1)])],8,ae))),128))])):(u(),s("div",Z,[...a[9]||(a[9]=[i("span",null,"æš‚æ— çŸ­è§†é¢‘",-1)])])),oa.value&&va.value.length>0?(u(),s("div",{key:3,class:"load-more",onClick:Fa},[...a[11]||(a[11]=[i("span",null,"åŠ è½½æ›´å¤š",-1)])])):t("",!0)])):t("",!0),"gallery"===Xe.value?(u(),s("div",oe,[la.value&&0===ca.value.length?(u(),s("div",ne,"åŠ è½½ä¸­...")):la.value||0!==ca.value.length?(u(),s("div",ue,[(u(!0),s(o,null,n(ca.value,e=>(u(),s("div",{key:e.id,class:"gallery-item",onClick:a=>{return l=e.id,Je.push(`/user/gallery/${l}`);var l}},[i("div",de,[i("img",{src:e.cover,alt:e.title},null,8,pe),i("div",ye,[i("span",ke,"ðŸ‘ "+d(Ma(e.view_count)),1),i("span",ge,"ðŸ“· "+d(e.image_count),1)])]),i("p",me,d(e.title),1)],8,re))),128))])):(u(),s("div",ce,[...a[12]||(a[12]=[i("span",null,"æš‚æ— å›¾é›†",-1)])])),ua.value&&ca.value.length>0?(u(),s("div",{key:3,class:"load-more",onClick:Ha},[...a[13]||(a[13]=[i("span",null,"åŠ è½½æ›´å¤š",-1)])])):t("",!0)])):t("",!0),"novel"===Xe.value?(u(),s("div",he,[la.value&&0===da.value.length?(u(),s("div",fe,"åŠ è½½ä¸­...")):la.value||0!==da.value.length?(u(),s("div",we,[(u(!0),s(o,null,n(da.value,e=>(u(),s("div",{key:e.id,class:"novel-item",onClick:a=>(e=>{"audio"===e.novel_type?Je.push(`/user/audio-novel/${e.id}`):Je.push(`/user/novel/${e.id}`)})(e)},[i("div",Ce,[i("img",{src:e.cover||"/images/default-novel.webp",alt:e.title,class:"novel-cover"},null,8,Se),"audio"===e.novel_type?(u(),s("span",$e,"ðŸŽ§")):t("",!0)]),i("div",Me,[i("p",je,d(e.title),1),i("p",xe,d(e.author||"ä½šå"),1),i("p",Ie,"å…±"+d(e.chapter_count||0)+"ç« ",1)])],8,_e))),128))])):(u(),s("div",be,[...a[14]||(a[14]=[i("span",null,"æš‚æ— å°è¯´",-1)])])),pa.value&&da.value.length>0?(u(),s("div",{key:3,class:"load-more",onClick:Ka},[...a[15]||(a[15]=[i("span",null,"åŠ è½½æ›´å¤š",-1)])])):t("",!0)])):t("",!0),"post"===Xe.value?(u(),s("div",Te,[la.value&&0===ka.value.length?(u(),s("div",ze,"åŠ è½½ä¸­...")):la.value||0!==ka.value.length?(u(),s("div",Le,[(u(!0),s(o,null,n(ka.value,e=>{var a,l;return u(),s("div",{key:e.id,class:"post-card",onClick:a=>{return l=e.id,Je.push(`/user/community/post/${l}`);var l}},[i("div",Ve,[i("img",{src:(null==(a=e.user)?void 0:a.avatar)||"/images/avatars/icon_avatar_1.webp",class:"post-avatar"},null,8,We),i("div",Fe,[i("span",He,d((null==(l=e.user)?void 0:l.nickname)||"ç”¨æˆ·"),1),i("span",Ke,d(xa(e.created_at)),1)])]),i("p",Oe,d(e.content),1),e.images&&e.images.length?(u(),s("div",qe,[(u(!0),s(o,null,n(e.images.slice(0,3),(e,a)=>(u(),s("img",{key:a,src:e,class:"post-img"},null,8,Ae))),128))])):t("",!0),i("div",Be,[i("span",null,"ðŸ‘ "+d(Ma(e.view_count)),1),i("span",null,"ðŸ’¬ "+d(e.comment_count||0),1),i("span",null,"â¤ï¸ "+d(Ma(e.like_count)),1),e.topics&&e.topics.length?(u(),s("span",Ee,"#"+d(e.topics[0].name),1)):t("",!0)])],8,Pe)}),128))])):(u(),s("div",De,[...a[16]||(a[16]=[i("span",null,"æš‚æ— å¸–å­",-1)])])),ga.value&&ka.value.length>0?(u(),s("div",{key:3,class:"load-more",onClick:Oa},[...a[17]||(a[17]=[i("span",null,"åŠ è½½æ›´å¤š",-1)])])):t("",!0)])):t("",!0)]))}},[["__scopeId","data-v-34e6b1fc"]]);export{Je as default};
