/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import{_ as a,a as e}from"./index-C3P4JTuA.js";import{bl as t,aM as l,bs as s,bt as n,bk as o,E as r,bh as u,bm as i,bi as d,bj as c,aR as p,aS as m,aT as v,a as w,aL as _}from"./element-plus-DlIn_qXi.js";import{r as f,j as h,y as g,C as b,G as y,O as j,L as x,F as k,E as C,z as V,K as $,M as F}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const U={class:"withdrawals-page"},z={class:"page-header"},Y={class:"stats-cards"},L={class:"stat-card pending"},M={class:"stat-value"},O={class:"stat-card"},R={class:"stat-value"},D={class:"filter-bar"},E={class:"filter-actions"},S={class:"amount"},G={class:"actual-amount"},H={class:"account-number"},K={key:1,class:"processed-time"},q=a({__name:"Withdrawals",setup(a){const q=f(!1),B=f([]),I=f(1),J=f(20),P=f(0),T=f({status:""}),W=f({pending_withdrawals:0,total_withdrawn:0}),A=f([]),N=f(!1),Q=f(""),X=f(!1),Z=f(null),aa=f({reason:""}),ea=async()=>{try{const a=await e.get("/admin/promotion/stats"),t=a.data||a;W.value={pending_withdrawals:t.pending_withdrawals,total_withdrawn:t.total_withdrawn}}catch(a){}},ta=async()=>{q.value=!0;try{const a=await e.get("/admin/withdrawals",{params:{page:I.value,page_size:J.value,status:T.value.status||void 0}}),t=a.data||a;B.value=t.items,P.value=t.total}catch(a){r.error("获取提现列表失败")}finally{q.value=!1}},la=async()=>{var a,t;if(aa.value.reason)try{await e.post(`/admin/withdrawals/${Z.value.id}/process`,{action:"reject",reject_reason:aa.value.reason}),r.success("已拒绝"),X.value=!1,ta(),ea()}catch(l){r.error((null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.detail)||"操作失败")}else r.warning("请输入拒绝原因")},sa=a=>({alipay:"支付宝",wechat:"微信",bank:"银行卡"}[a]||a),na=a=>({pending:"待审核",processing:"处理中",success:"已完成",failed:"失败",rejected:"已拒绝"}[a]||a),oa=a=>_(a).format("YYYY-MM-DD HH:mm"),ra=a=>{A.value=a},ua=async()=>{const a=A.value.filter(a=>"pending"===a.status);if(0===a.length)return void r.warning("请选择待审核的提现");const t=a.reduce((a,e)=>a+e.amount,0);try{await w.confirm(`确定批量通过 ${a.length} 笔提现？\n总金额：¥${t.toFixed(2)}`,"确认批量通过",{type:"warning"});for(const t of a)await e.post(`/admin/withdrawals/${t.id}/process`,{action:"approve"});r.success(`成功通过 ${a.length} 笔提现`),ta(),ea()}catch(l){"cancel"!==l&&r.error("操作失败")}},ia=async()=>{const a=A.value.filter(a=>"pending"===a.status);if(Q.value)try{for(const t of a)await e.post(`/admin/withdrawals/${t.id}/process`,{action:"reject",reject_reason:Q.value});r.success(`成功拒绝 ${a.length} 笔提现`),N.value=!1,Q.value="",ta(),ea()}catch(t){r.error("操作失败")}else r.warning("请输入拒绝原因")},da=()=>{const a=B.value.map(a=>({"用户名":a.username,"提现金额":a.amount.toFixed(2),"手续费":a.fee.toFixed(2),"实际到账":a.actual_amount.toFixed(2),"提现方式":sa(a.withdraw_type),"账户名":a.account_name,"账号":a.account_number,"状态":na(a.status),"申请时间":oa(a.created_at),"处理时间":a.processed_at?oa(a.processed_at):""})),e=[Object.keys(a[0]||{}).join(","),...a.map(a=>Object.values(a).join(","))].join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=`提现记录_${_().format("YYYYMMDD")}.csv`,s.click(),URL.revokeObjectURL(l),r.success("导出成功")};return h(()=>{ea(),ta()}),(a,_)=>{const f=i,h=t,ca=l,pa=d,ma=c,va=u,wa=n,_a=v,fa=m,ha=p,ga=o,ba=s;return V(),g("div",U,[b("div",z,[_[12]||(_[12]=b("h2",null,"提现管理",-1)),b("div",Y,[b("div",L,[b("span",M,x(W.value.pending_withdrawals),1),_[10]||(_[10]=b("span",{class:"stat-label"},"待处理",-1))]),b("div",O,[b("span",R,"¥"+x(W.value.total_withdrawn.toFixed(2)),1),_[11]||(_[11]=b("span",{class:"stat-label"},"已提现",-1))])])]),b("div",D,[j(h,{modelValue:T.value.status,"onUpdate:modelValue":_[0]||(_[0]=a=>T.value.status=a),placeholder:"状态筛选",clearable:"",onChange:ta},{default:k(()=>[j(f,{label:"全部",value:""}),j(f,{label:"待审核",value:"pending"}),j(f,{label:"处理中",value:"processing"}),j(f,{label:"已完成",value:"success"}),j(f,{label:"已拒绝",value:"rejected"}),j(f,{label:"失败",value:"failed"})]),_:1},8,["modelValue"]),b("div",E,[j(ca,{type:"success",disabled:!A.value.length,onClick:ua},{default:k(()=>[$(" 批量通过 ("+x(A.value.length)+") ",1)]),_:1},8,["disabled"]),j(ca,{type:"danger",disabled:!A.value.length,onClick:_[1]||(_[1]=a=>N.value=!0)},{default:k(()=>[..._[13]||(_[13]=[$(" 批量拒绝 ",-1)])]),_:1},8,["disabled"]),j(ca,{onClick:da},{default:k(()=>[..._[14]||(_[14]=[$("导出数据",-1)])]),_:1})])]),y((V(),C(va,{data:B.value,stripe:"",onSelectionChange:ra},{default:k(()=>[j(pa,{type:"selection",width:"50"}),j(pa,{prop:"username",label:"用户名",width:"120"}),j(pa,{prop:"amount",label:"提现金额",width:"120"},{default:k(({row:a})=>[b("span",S,"¥"+x(a.amount.toFixed(2)),1)]),_:1}),j(pa,{prop:"fee",label:"手续费",width:"100"},{default:k(({row:a})=>[$(" ¥"+x(a.fee.toFixed(2)),1)]),_:1}),j(pa,{prop:"actual_amount",label:"实际到账",width:"120"},{default:k(({row:a})=>[b("span",G,"¥"+x(a.actual_amount.toFixed(2)),1)]),_:1}),j(pa,{prop:"withdraw_type",label:"提现方式",width:"100"},{default:k(({row:a})=>[$(x(sa(a.withdraw_type)),1)]),_:1}),j(pa,{prop:"account_name",label:"账户名",width:"120"}),j(pa,{prop:"account_number",label:"账号",width:"180"},{default:k(({row:a})=>{return[b("span",H,x((e=a.account_number,e?e.length<=8?e.replace(/.(?=.{4})/g,"*"):e.slice(0,4)+"****"+e.slice(-4):"")),1),j(ca,{type:"text",size:"small",onClick:e=>(a=>{w.alert(`账户名：${a.account_name}\n账号：${a.account_number}${a.bank_name?"\n银行："+a.bank_name:""}`,"账户信息")})(a)},{default:k(()=>[..._[15]||(_[15]=[$("查看",-1)])]),_:1},8,["onClick"])];var e}),_:1}),j(pa,{prop:"status",label:"状态",width:"100"},{default:k(({row:a})=>{return[j(ma,{type:(e=a.status,{pending:"warning",processing:"",success:"success",failed:"danger",rejected:"info"}[e]||"info")},{default:k(()=>[$(x(na(a.status)),1)]),_:2},1032,["type"])];var e}),_:1}),j(pa,{prop:"created_at",label:"申请时间",width:"160"},{default:k(({row:a})=>[$(x(oa(a.created_at)),1)]),_:1}),j(pa,{label:"操作",width:"150",fixed:"right"},{default:k(({row:a})=>["pending"===a.status?(V(),g(F,{key:0},[j(ca,{type:"success",size:"small",onClick:t=>(async a=>{var t,l;try{await w.confirm(`确定通过该提现申请？\n金额：¥${a.amount.toFixed(2)}\n实际到账：¥${a.actual_amount.toFixed(2)}`,"确认通过",{type:"warning"}),await e.post(`/admin/withdrawals/${a.id}/process`,{action:"approve"}),r.success("已通过"),ta(),ea()}catch(s){"cancel"!==s&&r.error((null==(l=null==(t=s.response)?void 0:t.data)?void 0:l.detail)||"操作失败")}})(a)},{default:k(()=>[..._[16]||(_[16]=[$("通过",-1)])]),_:1},8,["onClick"]),j(ca,{type:"danger",size:"small",onClick:e=>(a=>{Z.value=a,aa.value={reason:""},X.value=!0})(a)},{default:k(()=>[..._[17]||(_[17]=[$("拒绝",-1)])]),_:1},8,["onClick"])],64)):(V(),g("span",K,x(a.processed_at?oa(a.processed_at):""),1))]),_:1})]),_:1},8,["data"])),[[ba,q.value]]),j(wa,{"current-page":I.value,"onUpdate:currentPage":_[2]||(_[2]=a=>I.value=a),"page-size":J.value,"onUpdate:pageSize":_[3]||(_[3]=a=>J.value=a),total:P.value,layout:"total, prev, pager, next",onCurrentChange:ta},null,8,["current-page","page-size","total"]),j(ga,{modelValue:X.value,"onUpdate:modelValue":_[6]||(_[6]=a=>X.value=a),title:"拒绝提现",width:"400px"},{footer:k(()=>[j(ca,{onClick:_[5]||(_[5]=a=>X.value=!1)},{default:k(()=>[..._[18]||(_[18]=[$("取消",-1)])]),_:1}),j(ca,{type:"danger",onClick:la},{default:k(()=>[..._[19]||(_[19]=[$("确认拒绝",-1)])]),_:1})]),default:k(()=>[j(ha,{model:aa.value,"label-width":"80px"},{default:k(()=>[j(fa,{label:"拒绝原因"},{default:k(()=>[j(_a,{modelValue:aa.value.reason,"onUpdate:modelValue":_[4]||(_[4]=a=>aa.value.reason=a),type:"textarea",rows:3,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),j(ga,{modelValue:N.value,"onUpdate:modelValue":_[9]||(_[9]=a=>N.value=a),title:"批量拒绝提现",width:"400px"},{footer:k(()=>[j(ca,{onClick:_[8]||(_[8]=a=>N.value=!1)},{default:k(()=>[..._[20]||(_[20]=[$("取消",-1)])]),_:1}),j(ca,{type:"danger",onClick:ia},{default:k(()=>[..._[21]||(_[21]=[$("确认批量拒绝",-1)])]),_:1})]),default:k(()=>[b("p",null,"将拒绝 "+x(A.value.filter(a=>"pending"===a.status).length)+" 笔提现申请",1),j(ha,{"label-width":"80px"},{default:k(()=>[j(fa,{label:"拒绝原因"},{default:k(()=>[j(_a,{modelValue:Q.value,"onUpdate:modelValue":_[7]||(_[7]=a=>Q.value=a),type:"textarea",rows:3,placeholder:"请输入统一的拒绝原因"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-2091a8e8"]]);export{q as default};
