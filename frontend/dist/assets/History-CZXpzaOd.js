import{r as e,c as a,j as t,y as s,C as r,I as o,O as i,M as l,aa as c,aC as n,z as d,L as u,V as v,U as p}from"./vue-vendor-Ba_vealp.js";import{_ as m}from"./ic_back-BPdSG6fy.js";import{_ as h}from"./no_data-CMy5glMK.js";import{_,a as w}from"./index-C3P4JTuA.js";import{B as g}from"./BottomNav-CoGs_HZ2.js";import{a as y,E as b}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const f={class:"history-page"},D={class:"page-header"},k={class:"video-list double-column"},j=["onClick"],C={class:"video-cover"},$=["src","alt"],S={class:"cover-views"},x={class:"video-duration"},B={class:"progress-bar"},M={class:"video-info"},T={class:"video-title"},z={class:"video-meta"},E={class:"video-tag"},I=["onClick"],O={key:0,class:"empty-state"},W=_({__name:"History",setup(_){const W=n(),A=e([]);a(()=>{const e={};return A.value.forEach(a=>{const t=L(a.watched_at);e[t]||(e[t]={date:t,items:[]}),e[t].items.push(a)}),Object.values(e)});const F=async()=>{try{await y.confirm("确定清空所有观看记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.delete("/users/me/history"),A.value=[],b.success("已清空")}catch(e){"cancel"!==e&&b.error("清空失败")}},H=e=>{if(!e)return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},L=e=>{const a=new Date(e),t=new Date,s=new Date(t.getTime()-864e5);return a.toDateString()===t.toDateString()?"今天":a.toDateString()===s.toDateString()?"昨天":`${a.getMonth()+1}月${a.getDate()}日`};return t(()=>{(async()=>{var e;try{const a=await w.get("/users/me/history");A.value=(null==(e=a.data)?void 0:e.items)||a||[]}catch(a){A.value=[{id:1,video_id:1,title:"极品女神激情缠绵",cover_url:"/uploads/thumbnails/3.webp",duration:2032,view_count:131700,uploader_name:"创作者A",progress:75,watched_at:new Date},{id:2,video_id:2,title:"清纯学妹宿舍私拍",cover_url:"/uploads/thumbnails/3.webp",duration:1800,view_count:89e3,uploader_name:"创作者B",progress:30,watched_at:new Date(Date.now()-864e5)},{id:3,video_id:3,title:"人妻诱惑完整版",cover_url:"/uploads/thumbnails/3.webp",duration:2400,view_count:56e3,uploader_name:"创作者C",progress:100,watched_at:new Date(Date.now()-864e5)}]}})()}),(e,a)=>(d(),s("div",f,[r("header",D,[r("div",{class:"back-btn",onClick:a[0]||(a[0]=a=>e.$router.push("/user/profile"))},[...a[1]||(a[1]=[r("img",{src:m,alt:"返回",class:"back-icon"},null,-1)])]),a[2]||(a[2]=r("h1",null,"观看历史",-1)),r("div",{class:"clear-btn",onClick:F},"清空")]),r("div",k,[(d(!0),s(l,null,c(A.value,e=>{return d(),s("div",{key:e.id,class:"video-card",onClick:a=>{return t=e.video_id,void W.push(`/user/video/${t}`);var t}},[r("div",C,[r("img",{src:(i=e.cover_url,i?i.startsWith("/")?i:"/"+i:"/placeholder.webp"),alt:e.title,loading:"lazy"},null,8,$),r("div",S,[a[3]||(a[3]=r("span",{class:"play-icon"},"▶",-1)),r("span",null,u((o=e.view_count,o?o>=1e4?(o/1e4).toFixed(1)+"W":o.toString():"0")),1)]),r("div",x,u(H(e.duration)),1),r("div",B,[r("div",{class:"progress",style:v({width:(e.watch_progress||e.progress||0)+"%"})},null,4)])]),r("div",M,[r("p",T,u(e.title),1),r("div",z,[r("span",E,u((t=e.watch_progress||e.progress||0,t>=100?"已看完":`${t}%`)),1),r("span",{class:"delete-icon",onClick:p(a=>(async e=>{try{await w.delete(`/users/me/history/${e}`),A.value=A.value.filter(a=>a.id!==e),b.success("已删除")}catch(a){b.error("删除失败")}})(e.id),["stop"])},"✕",8,I)])])],8,j);var t,o,i}),128))]),A.value.length?o("",!0):(d(),s("div",O,[...a[4]||(a[4]=[r("img",{src:h,alt:"暂无内容",class:"empty-icon"},null,-1),r("p",{class:"empty-text"},"暂无观看记录",-1)])])),i(g)]))}},[["__scopeId","data-v-e09be545"]]);export{W as default};
