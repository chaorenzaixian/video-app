/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                    *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                    *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                 *//* empty css                  *//* empty css                 *//* empty css                       *//* empty css                        */import{r as e,c as l,l as a,j as t,y as s,C as o,O as i,E as d,I as r,F as n,ae as c,aD as u,G as m,M as p,aa as v,z as f,K as _,u as y,L as b,P as g}from"./vue-vendor-Ba_vealp.js";import{bf as k,aM as h,bs as w,bt as V,bk as C,bl as z,aT as j,bh as x,bg as U,bm as I,a9 as P,b7 as $,aQ as B,bj as S,bI as L,bi as M,aR as R,aS as T,bw as K,a6 as q,bv as D,aU as E,a as F,E as G}from"./element-plus-DlIn_qXi.js";import{_ as Q,a as A}from"./index-C3P4JTuA.js";import"./utils-DflAyOWx.js";const H={class:"admin-page"},J={class:"filter-bar"},O={key:0,class:"table-container"},W={class:"tree-content"},Y={class:"tree-item level-1"},N={class:"col-name"},X=["src"],Z={class:"topic-name"},ee={class:"col-stats"},le={class:"col-tags"},ae={class:"col-sort"},te={class:"col-actions"},se={class:"tree-children"},oe={class:"col-name"},ie=["src"],de={class:"topic-name"},re={class:"col-stats"},ne={class:"col-tags"},ce={class:"col-sort"},ue={class:"col-actions"},me={key:0,class:"empty-children"},pe={key:1,class:"table-container"},ve={class:"topic-cell"},fe=["src"],_e={class:"topic-info"},ye={class:"topic-name"},be={key:0,class:"topic-parent"},ge={class:"topic-desc"},ke={class:"upload-with-input"},he=["src"],we={class:"upload-with-input"},Ve=["src"],Ce=Q({__name:"CommunityTopics",setup(Q){const Ce=e(!1),ze=e("tree"),je=e([]),xe=e([]),Ue=e([]),Ie=l(()=>`${A.defaults.baseURL}/admin/gallery-novel/upload/image`),Pe=l(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),$e=e=>{const l=e.type.startsWith("image/"),a=e.size/1024/1024<5;return l?!!a||(G.error("图片大小不能超过 5MB"),!1):(G.error("只能上传图片文件"),!1)},Be=(e,l)=>{e.url?(Me.form[l]=e.url,G.success("上传成功")):G.error("上传失败")},Se=a({level:null,keyword:""}),Le=a({page:1,pageSize:50,total:0}),Me=a({visible:!1,title:"",isCreate:!0,editId:null,form:{name:"",parent_id:null,icon:"",cover:"",description:"",sort_order:0,is_hot:!1,is_recommended:!1}}),Re=a({visible:!1,topic:null,newParentId:null}),Te=async()=>{var e,l;if("tree"!==ze.value){Ce.value=!0;try{const a={page:Le.page,page_size:Le.pageSize};Se.level&&(a.level=Se.level),Se.keyword&&(a.keyword=Se.keyword);const t=await A.get("/admin/community/topics",{params:a});xe.value=(null==(e=t.data)?void 0:e.items)||[],Le.total=(null==(l=t.data)?void 0:l.total)||0}catch(a){xe.value=[]}finally{Ce.value=!1}}else await(async()=>{Ce.value=!0;try{const e=await A.get("/admin/community/topics/tree");je.value=(e.data||[]).map(e=>({...e,expanded:!0}))}catch(a){je.value=[]}finally{Ce.value=!1}})()},Ke=async()=>{try{const e=await A.get("/admin/community/topics/categories");Ue.value=e.data||[]}catch(e){Ue.value=[]}},qe=()=>{Te()},De=e=>{Me.isCreate=!0,Me.editId=null,Me.title=e?"添加子话题":"新建顶级分类",Me.form={name:"",parent_id:e||0,icon:"",cover:"",description:"",sort_order:0,is_hot:!1,is_recommended:!1},Me.visible=!0},Ee=e=>{Me.isCreate=!1,Me.editId=e.id,Me.title=1===e.level?"编辑顶级分类":"编辑话题",Me.form={name:e.name,parent_id:e.parent_id||0,icon:e.icon||"",cover:e.cover||"",description:e.description||"",sort_order:e.sort_order||0,is_hot:e.is_hot,is_recommended:e.is_recommended,level:e.level},Me.visible=!0},Fe=async()=>{var e,l;if(!Me.form.name.trim())return void G.warning("请输入名称");const a={...Me.form};0===a.parent_id&&(a.parent_id=null);try{Me.isCreate?(await A.post("/admin/community/topics",a),G.success("创建成功")):(await A.put(`/admin/community/topics/${Me.editId}`,a),G.success("更新成功")),Me.visible=!1,Te(),Ke()}catch(t){G.error((null==(l=null==(e=t.response)?void 0:e.data)?void 0:l.detail)||"操作失败")}},Ge=e=>{Re.topic=e,Re.newParentId=0,Re.visible=!0},Qe=async()=>{var e,l;try{const e=0===Re.newParentId?null:Re.newParentId;await A.put(`/admin/community/topics/${Re.topic.id}/move`,null,{params:{new_parent_id:e}}),G.success("移动成功"),Re.visible=!1,Te(),Ke()}catch(a){G.error((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.detail)||"移动失败")}},Ae=async e=>{var l,a;const t=1===e.level?`删除顶级分类「${e.name}」前请确保没有子话题，确定删除？`:`确定删除话题「${e.name}」？`;try{await F.confirm(t,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await A.delete(`/admin/community/topics/${e.id}`),G.success("删除成功"),Te(),Ke()}catch(s){"cancel"!==s&&G.error((null==(a=null==(l=s.response)?void 0:l.data)?void 0:a.detail)||"删除失败")}};return t(()=>{Te(),Ke()}),(e,l)=>{const a=U,t=k,F=I,G=z,Q=j,A=h,Ke=B,He=S,Je=L,Oe=M,We=x,Ye=V,Ne=T,Xe=K,Ze=D,el=E,ll=R,al=C,tl=w;return f(),s("div",H,[l[49]||(l[49]=o("div",{class:"page-header"},[o("h1",null,"话题管理"),o("p",{class:"page-desc"},"管理社区话题分类，支持两级分类结构")],-1)),o("div",J,[i(t,{modelValue:ze.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ze.value=e),onChange:qe},{default:n(()=>[i(a,{value:"tree"},{default:n(()=>[...l[18]||(l[18]=[_("树形视图",-1)])]),_:1}),i(a,{value:"list"},{default:n(()=>[...l[19]||(l[19]=[_("列表视图",-1)])]),_:1})]),_:1},8,["modelValue"]),"list"===ze.value?(f(),d(G,{key:0,modelValue:Se.level,"onUpdate:modelValue":l[1]||(l[1]=e=>Se.level=e),placeholder:"层级",clearable:"",style:{width:"120px"}},{default:n(()=>[i(F,{label:"顶级分类",value:1}),i(F,{label:"二级话题",value:2})]),_:1},8,["modelValue"])):r("",!0),"list"===ze.value?(f(),d(Q,{key:1,modelValue:Se.keyword,"onUpdate:modelValue":l[2]||(l[2]=e=>Se.keyword=e),placeholder:"搜索话题",clearable:"",style:{width:"200px"},onKeyup:c(Te,["enter"])},null,8,["modelValue"])):r("",!0),"list"===ze.value?(f(),d(A,{key:2,type:"primary",onClick:Te},{default:n(()=>[...l[20]||(l[20]=[_("查询",-1)])]),_:1})):r("",!0),l[22]||(l[22]=o("div",{style:{flex:"1"}},null,-1)),i(A,{type:"success",onClick:l[3]||(l[3]=e=>De(null))},{default:n(()=>[...l[21]||(l[21]=[_("新建顶级分类",-1)])]),_:1})]),"tree"===ze.value?(f(),s("div",O,[l[33]||(l[33]=u('<div class="tree-header" data-v-cbd59093><span class="col-name" data-v-cbd59093>名称</span><span class="col-stats" data-v-cbd59093>帖子/关注</span><span class="col-tags" data-v-cbd59093>标签</span><span class="col-sort" data-v-cbd59093>排序</span><span class="col-actions" data-v-cbd59093>操作</span></div>',1)),m((f(),s("div",W,[(f(!0),s(p,null,v(je.value,e=>{var a;return f(),s("div",{key:e.id,class:"tree-category"},[o("div",Y,[o("div",N,[i(Ke,{class:"expand-icon",onClick:l=>(e=>{e.expanded=!e.expanded})(e)},{default:n(()=>[e.expanded?(f(),d(y($),{key:1})):(f(),d(y(P),{key:0}))]),_:2},1032,["onClick"]),e.icon?(f(),s("img",{key:0,src:e.icon,class:"topic-icon"},null,8,X)):r("",!0),o("span",Z,b(e.name),1),i(He,{size:"small",type:"info"},{default:n(()=>{var l;return[_(b((null==(l=e.children)?void 0:l.length)||0)+"个子话题",1)]}),_:2},1024)]),o("div",ee,b(e.post_count)+" / "+b(e.follow_count),1),o("div",le,[e.is_hot?(f(),d(He,{key:0,type:"danger",size:"small"},{default:n(()=>[...l[23]||(l[23]=[_("热门",-1)])]),_:1})):r("",!0),e.is_recommended?(f(),d(He,{key:1,type:"success",size:"small"},{default:n(()=>[...l[24]||(l[24]=[_("推荐",-1)])]),_:1})):r("",!0)]),o("div",ae,b(e.sort_order),1),o("div",te,[i(A,{size:"small",type:"primary",onClick:l=>De(e.id)},{default:n(()=>[...l[25]||(l[25]=[_("添加子话题",-1)])]),_:1},8,["onClick"]),i(A,{size:"small",onClick:l=>Ee(e)},{default:n(()=>[...l[26]||(l[26]=[_("编辑",-1)])]),_:1},8,["onClick"]),i(A,{size:"small",type:"danger",onClick:l=>Ae(e)},{default:n(()=>[...l[27]||(l[27]=[_("删除",-1)])]),_:1},8,["onClick"])])]),m(o("div",se,[(f(!0),s(p,null,v(e.children,e=>(f(),s("div",{key:e.id,class:"tree-item level-2"},[o("div",oe,[e.cover?(f(),s("img",{key:0,src:e.cover,class:"topic-cover"},null,8,ie)):r("",!0),o("span",de,b(e.name),1)]),o("div",re,b(e.post_count)+" / "+b(e.follow_count),1),o("div",ne,[e.is_hot?(f(),d(He,{key:0,type:"danger",size:"small"},{default:n(()=>[...l[28]||(l[28]=[_("热门",-1)])]),_:1})):r("",!0),e.is_recommended?(f(),d(He,{key:1,type:"success",size:"small"},{default:n(()=>[...l[29]||(l[29]=[_("推荐",-1)])]),_:1})):r("",!0)]),o("div",ce,b(e.sort_order),1),o("div",ue,[i(A,{size:"small",onClick:l=>Ee(e)},{default:n(()=>[...l[30]||(l[30]=[_("编辑",-1)])]),_:1},8,["onClick"]),i(A,{size:"small",onClick:l=>Ge(e)},{default:n(()=>[...l[31]||(l[31]=[_("移动",-1)])]),_:1},8,["onClick"]),i(A,{size:"small",type:"danger",onClick:l=>Ae(e)},{default:n(()=>[...l[32]||(l[32]=[_("删除",-1)])]),_:1},8,["onClick"])])]))),128)),(null==(a=e.children)?void 0:a.length)?r("",!0):(f(),s("div",me,"暂无子话题"))],512),[[g,e.expanded]])])}),128)),je.value.length||Ce.value?r("",!0):(f(),d(Je,{key:0,description:"暂无分类"}))])),[[tl,Ce.value]])])):(f(),s("div",pe,[m((f(),d(We,{data:xe.value,stripe:"",border:""},{default:n(()=>[i(Oe,{label:"话题","min-width":"250"},{default:n(({row:e})=>[o("div",ve,[o("img",{src:e.icon||e.cover||"/images/default-topic.webp",class:"topic-cover"},null,8,fe),o("div",_e,[o("span",ye,b(e.name),1),e.parent_name?(f(),s("span",be,"所属："+b(e.parent_name),1)):r("",!0),o("span",ge,b(e.description||"暂无描述"),1)])])]),_:1}),i(Oe,{label:"层级",width:"100",align:"center"},{default:n(({row:e})=>[i(He,{type:1===e.level?"primary":"success",size:"small"},{default:n(()=>[_(b(1===e.level?"顶级分类":"二级话题"),1)]),_:2},1032,["type"])]),_:1}),i(Oe,{label:"帖子数",width:"100",align:"center",prop:"post_count"}),i(Oe,{label:"关注数",width:"100",align:"center",prop:"follow_count"}),i(Oe,{label:"排序",width:"80",align:"center",prop:"sort_order"}),i(Oe,{label:"标签",width:"150",align:"center"},{default:n(({row:e})=>[e.is_hot?(f(),d(He,{key:0,type:"danger",size:"small"},{default:n(()=>[...l[34]||(l[34]=[_("热门",-1)])]),_:1})):r("",!0),e.is_recommended?(f(),d(He,{key:1,type:"success",size:"small"},{default:n(()=>[...l[35]||(l[35]=[_("推荐",-1)])]),_:1})):r("",!0),e.is_active?r("",!0):(f(),d(He,{key:2,type:"info",size:"small"},{default:n(()=>[...l[36]||(l[36]=[_("已禁用",-1)])]),_:1}))]),_:1}),i(Oe,{label:"操作",width:"200",fixed:"right",align:"center"},{default:n(({row:e})=>[i(A,{size:"small",onClick:l=>Ee(e)},{default:n(()=>[...l[37]||(l[37]=[_("编辑",-1)])]),_:1},8,["onClick"]),2===e.level?(f(),d(A,{key:0,size:"small",onClick:l=>Ge(e)},{default:n(()=>[...l[38]||(l[38]=[_("移动",-1)])]),_:1},8,["onClick"])):r("",!0),i(A,{size:"small",type:"danger",onClick:l=>Ae(e)},{default:n(()=>[...l[39]||(l[39]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[tl,Ce.value]]),i(Ye,{"current-page":Le.page,"onUpdate:currentPage":l[4]||(l[4]=e=>Le.page=e),"page-size":Le.pageSize,total:Le.total,layout:"total, prev, pager, next",onCurrentChange:Te,class:"pagination"},null,8,["current-page","page-size","total"])])),i(al,{modelValue:Me.visible,"onUpdate:modelValue":l[14]||(l[14]=e=>Me.visible=e),title:Me.title,width:"500px"},{footer:n(()=>[i(A,{onClick:l[13]||(l[13]=e=>Me.visible=!1)},{default:n(()=>[...l[43]||(l[43]=[_("取消",-1)])]),_:1}),i(A,{type:"primary",onClick:Fe},{default:n(()=>[...l[44]||(l[44]=[_("确定",-1)])]),_:1})]),default:n(()=>[i(ll,{model:Me.form,"label-width":"80px"},{default:n(()=>[void 0!==Me.form.parent_id||Me.isCreate?(f(),d(Ne,{key:0,label:"所属分类"},{default:n(()=>[i(G,{modelValue:Me.form.parent_id,"onUpdate:modelValue":l[5]||(l[5]=e=>Me.form.parent_id=e),placeholder:"顶级分类",clearable:"",disabled:!Me.isCreate&&1===Me.form.level},{default:n(()=>[i(F,{label:"作为顶级分类",value:0}),(f(!0),s(p,null,v(Ue.value,e=>(f(),d(F,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):r("",!0),i(Ne,{label:"名称",required:""},{default:n(()=>[i(Q,{modelValue:Me.form.name,"onUpdate:modelValue":l[6]||(l[6]=e=>Me.form.name=e),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),Me.form.parent_id?r("",!0):(f(),d(Ne,{key:1,label:"图标"},{default:n(()=>[o("div",ke,[i(Xe,{class:"icon-uploader",action:Ie.value,headers:Pe.value,"show-file-list":!1,"on-success":e=>Be(e,"icon"),"before-upload":$e,accept:"image/*"},{default:n(()=>[Me.form.icon?(f(),s("img",{key:0,src:Me.form.icon,class:"upload-preview"},null,8,he)):(f(),d(Ke,{key:1,class:"upload-icon"},{default:n(()=>[i(y(q))]),_:1}))]),_:1},8,["action","headers","on-success"]),i(Q,{modelValue:Me.form.icon,"onUpdate:modelValue":l[7]||(l[7]=e=>Me.form.icon=e),placeholder:"或输入图标URL"},null,8,["modelValue"])])]),_:1})),i(Ne,{label:"封面图"},{default:n(()=>[o("div",we,[i(Xe,{class:"cover-uploader",action:Ie.value,headers:Pe.value,"show-file-list":!1,"on-success":e=>Be(e,"cover"),"before-upload":$e,accept:"image/*"},{default:n(()=>[Me.form.cover?(f(),s("img",{key:0,src:Me.form.cover,class:"upload-preview"},null,8,Ve)):(f(),d(Ke,{key:1,class:"upload-icon"},{default:n(()=>[i(y(q))]),_:1}))]),_:1},8,["action","headers","on-success"]),i(Q,{modelValue:Me.form.cover,"onUpdate:modelValue":l[8]||(l[8]=e=>Me.form.cover=e),placeholder:"或输入封面图URL"},null,8,["modelValue"])])]),_:1}),i(Ne,{label:"描述"},{default:n(()=>[i(Q,{modelValue:Me.form.description,"onUpdate:modelValue":l[9]||(l[9]=e=>Me.form.description=e),type:"textarea",rows:3,placeholder:"话题描述"},null,8,["modelValue"])]),_:1}),i(Ne,{label:"排序"},{default:n(()=>[i(Ze,{modelValue:Me.form.sort_order,"onUpdate:modelValue":l[10]||(l[10]=e=>Me.form.sort_order=e),min:0,max:9999},null,8,["modelValue"]),l[40]||(l[40]=o("span",{class:"form-tip"},"数值越大越靠前",-1))]),_:1}),i(Ne,{label:"设置"},{default:n(()=>[i(el,{modelValue:Me.form.is_hot,"onUpdate:modelValue":l[11]||(l[11]=e=>Me.form.is_hot=e)},{default:n(()=>[...l[41]||(l[41]=[_("热门",-1)])]),_:1},8,["modelValue"]),i(el,{modelValue:Me.form.is_recommended,"onUpdate:modelValue":l[12]||(l[12]=e=>Me.form.is_recommended=e)},{default:n(()=>[...l[42]||(l[42]=[_("推荐",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),i(al,{modelValue:Re.visible,"onUpdate:modelValue":l[17]||(l[17]=e=>Re.visible=e),title:"移动话题",width:"400px"},{footer:n(()=>[i(A,{onClick:l[16]||(l[16]=e=>Re.visible=!1)},{default:n(()=>[...l[47]||(l[47]=[_("取消",-1)])]),_:1}),i(A,{type:"primary",onClick:Qe},{default:n(()=>[...l[48]||(l[48]=[_("确定移动",-1)])]),_:1})]),default:n(()=>{var e;return[o("p",null,[l[45]||(l[45]=_("将 ",-1)),o("strong",null,b(null==(e=Re.topic)?void 0:e.name),1),l[46]||(l[46]=_(" 移动到：",-1))]),i(G,{modelValue:Re.newParentId,"onUpdate:modelValue":l[15]||(l[15]=e=>Re.newParentId=e),placeholder:"选择目标分类",style:{width:"100%"}},{default:n(()=>[i(F,{label:"设为顶级分类",value:0}),(f(!0),s(p,null,v(Ue.value.filter(e=>{var l;return e.id!==(null==(l=Re.topic)?void 0:l.parent_id)}),e=>(f(),d(F,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]}),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-cbd59093"]]);export{Ce as default};
