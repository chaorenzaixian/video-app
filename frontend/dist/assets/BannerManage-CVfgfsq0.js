/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                             *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                  *//* empty css                    *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                 *//* empty css                        */import{E as e,aM as a,bl as l,bs as t,bt as i,bk as o,bh as s,aQ as r,a6 as n,bm as u,bi as d,bn as p,bj as m,bo as c,aR as _,aS as v,aT as g,bw as b,bv as h,bD as f,a as y}from"./element-plus-DlIn_qXi.js";import{_ as k,u as V,a as w}from"./index-C3P4JTuA.js";import{r as j,l as z,c as C,j as x,y as U,C as R,G as S,O as D,F as I,E as M,z as P,K as q,u as O,L as Y,I as $}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const B={class:"banner-manage"},H={class:"page-header"},E={class:"filter-bar"},F={key:0,class:"time-range"},G={key:0},K={key:1},L={key:1,class:"text-muted"},N={class:"pagination"},Q={class:"upload-area"},T=["src"],A=k({__name:"BannerManage",setup(k){const A=V(),J=j(!1),W=j([]),X=j(!1),Z=j(!1),ee=j(!1),ae=j(null),le=z({position:"",is_active:null}),te=z({page:1,pageSize:20,total:0}),ie=z({title:"",image_url:"",position:"home",link_type:"none",link_value:"",sort_order:0,timeRange:null,is_active:!0}),oe={home:"首页",short:"短视频",chess:"棋牌",vip:"VIP"},se={none:"无链接",internal:"内部页面",external:"外部链接",video:"视频详情"},re=C(()=>"/api/v1/ads/upload/image"),ne=C(()=>({Authorization:`Bearer ${A.token}`}));x(()=>{ue()});const ue=async()=>{J.value=!0;try{const e={page:te.page,page_size:te.pageSize};le.position&&(e.position=le.position),null!==le.is_active&&""!==le.is_active&&(e.is_active=le.is_active);const a=await w.get("/admin/content/banners",{params:e}),l=a.data||a;W.value=l.items||[],te.total=l.total||0}catch(a){e.error("获取轮播图失败")}finally{J.value=!1}},de=()=>{Z.value=!1,ae.value=null,Object.assign(ie,{title:"",image_url:"",position:"home",link_type:"none",link_value:"",sort_order:0,timeRange:null,is_active:!0}),X.value=!0},pe=a=>{const l=a.type.startsWith("image/"),t=a.size/1024/1024<2;return l?!!t||(e.error("图片大小不能超过 2MB!"),!1):(e.error("只能上传图片文件!"),!1)},me=a=>{a.url?(ie.image_url=a.url,e.success("图片上传成功")):e.error("图片上传失败")},ce=async()=>{if(ie.title)if(ie.image_url){ee.value=!0;try{const a={title:ie.title,image_url:ie.image_url,position:ie.position,link_type:ie.link_type,link_value:ie.link_value,sort_order:ie.sort_order,is_active:ie.is_active,start_time:ie.timeRange?ie.timeRange[0]:null,end_time:ie.timeRange?ie.timeRange[1]:null};Z.value?(await w.put(`/admin/content/banners/${ae.value}`,a),e.success("更新成功")):(await w.post("/admin/content/banners",a),e.success("添加成功")),X.value=!1,ue()}catch(a){e.error("提交失败")}finally{ee.value=!1}}else e.error("请上传图片");else e.error("请输入标题")},_e=e=>e?new Date(e).toLocaleDateString("zh-CN"):"";return(k,V)=>{const j=r,z=a,C=u,x=l,A=p,ve=d,ge=m,be=c,he=s,fe=i,ye=g,ke=v,Ve=b,we=h,je=f,ze=_,Ce=o,xe=t;return P(),U("div",B,[R("div",H,[V[14]||(V[14]=R("h1",null,"轮播图管理",-1)),D(z,{type:"primary",onClick:de},{default:I(()=>[D(j,null,{default:I(()=>[D(O(n))]),_:1}),V[13]||(V[13]=q(" 添加轮播图 ",-1))]),_:1})]),R("div",E,[D(x,{modelValue:le.position,"onUpdate:modelValue":V[0]||(V[0]=e=>le.position=e),placeholder:"位置",clearable:"",onChange:ue},{default:I(()=>[D(C,{label:"首页",value:"home"}),D(C,{label:"短视频",value:"short"}),D(C,{label:"棋牌",value:"chess"}),D(C,{label:"VIP",value:"vip"})]),_:1},8,["modelValue"]),D(x,{modelValue:le.is_active,"onUpdate:modelValue":V[1]||(V[1]=e=>le.is_active=e),placeholder:"状态",clearable:"",onChange:ue},{default:I(()=>[D(C,{label:"启用",value:!0}),D(C,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),S((P(),M(he,{data:W.value,border:"",stripe:""},{default:I(()=>[D(ve,{label:"图片",width:"200"},{default:I(({row:e})=>[D(A,{src:e.image_url,"preview-src-list":[e.image_url],fit:"cover",style:{width:"160px",height:"80px","border-radius":"4px"}},null,8,["src","preview-src-list"])]),_:1}),D(ve,{prop:"title",label:"标题","min-width":"150"}),D(ve,{prop:"position",label:"位置",width:"100"},{default:I(({row:e})=>[D(ge,null,{default:I(()=>[q(Y(oe[e.position]||e.position),1)]),_:2},1024)]),_:1}),D(ve,{prop:"link_type",label:"链接类型",width:"100"},{default:I(({row:e})=>[q(Y(se[e.link_type]||e.link_type),1)]),_:1}),D(ve,{prop:"sort_order",label:"排序",width:"80"}),D(ve,{prop:"is_active",label:"状态",width:"80"},{default:I(({row:a})=>[D(be,{modelValue:a.is_active,"onUpdate:modelValue":e=>a.is_active=e,onChange:l=>(async a=>{try{await w.put(`/admin/content/banners/${a.id}`,{is_active:a.is_active}),e.success("状态更新成功")}catch(l){a.is_active=!a.is_active,e.error("状态更新失败")}})(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),D(ve,{label:"有效期",width:"180"},{default:I(({row:e})=>[e.start_time||e.end_time?(P(),U("div",F,[e.start_time?(P(),U("div",G,"开始: "+Y(_e(e.start_time)),1)):$("",!0),e.end_time?(P(),U("div",K,"结束: "+Y(_e(e.end_time)),1)):$("",!0)])):(P(),U("span",L,"永久有效"))]),_:1}),D(ve,{label:"操作",width:"150",fixed:"right"},{default:I(({row:a})=>[D(z,{size:"small",onClick:e=>(e=>{Z.value=!0,ae.value=e.id,Object.assign(ie,{title:e.title,image_url:e.image_url,position:e.position,link_type:e.link_type||"none",link_value:e.link_url||"",sort_order:e.sort_order,timeRange:e.start_time&&e.end_time?[e.start_time,e.end_time]:null,is_active:e.is_active}),X.value=!0})(a)},{default:I(()=>[...V[15]||(V[15]=[q("编辑",-1)])]),_:1},8,["onClick"]),D(z,{size:"small",type:"danger",onClick:l=>(async a=>{try{await y.confirm("确定要删除这个轮播图吗?","提示",{type:"warning"}),await w.delete(`/admin/content/banners/${a.id}`),e.success("删除成功"),ue()}catch(l){"cancel"!==l&&e.error("删除失败")}})(a)},{default:I(()=>[...V[16]||(V[16]=[q("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[xe,J.value]]),R("div",N,[D(fe,{"current-page":te.page,"onUpdate:currentPage":V[2]||(V[2]=e=>te.page=e),"page-size":te.pageSize,"onUpdate:pageSize":V[3]||(V[3]=e=>te.pageSize=e),total:te.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:ue,onCurrentChange:ue},null,8,["current-page","page-size","total"])]),D(Ce,{modelValue:X.value,"onUpdate:modelValue":V[12]||(V[12]=e=>X.value=e),title:Z.value?"编辑轮播图":"添加轮播图",width:"600px"},{footer:I(()=>[D(z,{onClick:V[11]||(V[11]=e=>X.value=!1)},{default:I(()=>[...V[18]||(V[18]=[q("取消",-1)])]),_:1}),D(z,{type:"primary",onClick:ce,loading:ee.value},{default:I(()=>[q(Y(Z.value?"保存":"添加"),1)]),_:1},8,["loading"])]),default:I(()=>[D(ze,{model:ie,"label-width":"100px"},{default:I(()=>[D(ke,{label:"标题",required:""},{default:I(()=>[D(ye,{modelValue:ie.title,"onUpdate:modelValue":V[4]||(V[4]=e=>ie.title=e),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),D(ke,{label:"图片",required:""},{default:I(()=>[R("div",Q,[D(Ve,{class:"banner-uploader",action:re.value,headers:ne.value,"show-file-list":!1,"on-success":me,"before-upload":pe,accept:"image/*"},{default:I(()=>[ie.image_url?(P(),U("img",{key:0,src:ie.image_url,class:"preview-image"},null,8,T)):(P(),M(j,{key:1,class:"upload-icon"},{default:I(()=>[D(O(n))]),_:1}))]),_:1},8,["action","headers"]),V[17]||(V[17]=R("div",{class:"upload-tip"},"建议尺寸: 750 x 320 像素",-1))])]),_:1}),D(ke,{label:"位置",required:""},{default:I(()=>[D(x,{modelValue:ie.position,"onUpdate:modelValue":V[5]||(V[5]=e=>ie.position=e),placeholder:"请选择位置"},{default:I(()=>[D(C,{label:"首页",value:"home"}),D(C,{label:"短视频",value:"short"}),D(C,{label:"棋牌",value:"chess"}),D(C,{label:"VIP",value:"vip"})]),_:1},8,["modelValue"])]),_:1}),D(ke,{label:"链接类型"},{default:I(()=>[D(x,{modelValue:ie.link_type,"onUpdate:modelValue":V[6]||(V[6]=e=>ie.link_type=e),placeholder:"请选择链接类型"},{default:I(()=>[D(C,{label:"无链接",value:"none"}),D(C,{label:"内部页面",value:"internal"}),D(C,{label:"外部链接",value:"external"}),D(C,{label:"视频详情",value:"video"})]),_:1},8,["modelValue"])]),_:1}),ie.link_type&&"none"!==ie.link_type?(P(),M(ke,{key:0,label:"链接地址"},{default:I(()=>[D(ye,{modelValue:ie.link_value,"onUpdate:modelValue":V[7]||(V[7]=e=>ie.link_value=e),placeholder:"请输入链接地址或视频ID"},null,8,["modelValue"])]),_:1})):$("",!0),D(ke,{label:"排序"},{default:I(()=>[D(we,{modelValue:ie.sort_order,"onUpdate:modelValue":V[8]||(V[8]=e=>ie.sort_order=e),min:0},null,8,["modelValue"])]),_:1}),D(ke,{label:"有效期"},{default:I(()=>[D(je,{modelValue:ie.timeRange,"onUpdate:modelValue":V[9]||(V[9]=e=>ie.timeRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),D(ke,{label:"状态"},{default:I(()=>[D(be,{modelValue:ie.is_active,"onUpdate:modelValue":V[10]||(V[10]=e=>ie.is_active=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-ff90c113"]]);export{A as default};
