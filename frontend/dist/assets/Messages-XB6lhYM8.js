import{_ as a}from"./ic_back-BPdSG6fy.js";import{r as e,j as s,y as t,C as i,H as l,K as n,I as r,L as c,M as v,aa as o,aC as u,z as m}from"./vue-vendor-Ba_vealp.js";import{_ as d,a as p}from"./index-C3P4JTuA.js";import"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const g={class:"messages-page"},_={class:"page-header"},k={class:"tabs-bar"},y={key:0,class:"tab-badge"},b={key:0,class:"tab-badge"},h={key:0,class:"tab-badge"},w={class:"message-list"},$=["onClick"],f={class:"avatar-wrapper"},C=["src"],S={key:0,class:"unread-dot"},D={class:"message-content"},P={class:"nickname-row"},j={class:"nickname"},I=["src"],M={class:"preview"},F={class:"time"},V={key:0,class:"empty-state"},Y=["onClick"],x={class:"avatar-wrapper"},z=["src"],E={class:"message-content"},G={class:"nickname-row"},J={class:"nickname"},L=["src"],W={class:"preview"},q={class:"time"},H={key:0,class:"empty-state"},K=["onClick"],N={class:"avatar-wrapper"},T=["src"],A={class:"message-content"},B={class:"nickname-row"},O={class:"nickname"},Q=["src"],R={class:"preview"},U={class:"time"},X={key:0,class:"empty-state"},Z=d({__name:"Messages",setup(d){const Z=u(),aa=e("private"),ea=e([]),sa=e([]),ta=e([]),ia=e(!1),la=e({private:0,comment:0,like:0}),na={1:"/images/backgrounds/vip_gold.webp",2:"/images/backgrounds/vip_1.webp",3:"/images/backgrounds/vip_2.webp",4:"/images/backgrounds/vip_3.webp",5:"/images/backgrounds/super_vip_red.webp",6:"/images/backgrounds/super_vip_blue.webp"},ra=a=>na[a]||na[1],ca=(a,e)=>{if(a)return a.startsWith("http")||a.startsWith("/")?a:`/${a}`;return(a=>{const e=a%52;if(e<17)return`/images/avatars/icon_avatar_${e+1}.webp`;if(e<32)return`/images/avatars/DM_20251217202131_${String(e-17+1).padStart(3,"0")}.JPEG`;return`/images/avatars/DM_20251217202341_${String(e-32+1).padStart(3,"0")}.JPEG`})(parseInt(e)||1)},va=a=>{if(!a)return"";const e=new Date(a),s=new Date,t=s-e;return t<864e5&&e.getDate()===s.getDate()?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):t<1728e5?"昨天":e.getFullYear()===s.getFullYear()?`${e.getMonth()+1}-${e.getDate()}`:`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},oa=async()=>{try{const a=await p.get("/social/messages/conversations");ea.value=(a.data||[]).map(a=>{var e,s,t,i,l,n;return{id:a.id,user_id:null==(e=a.other_user)?void 0:e.id,nickname:null==(s=a.other_user)?void 0:s.nickname,username:null==(t=a.other_user)?void 0:t.nickname,avatar:null==(i=a.other_user)?void 0:i.avatar,is_vip:(null==(l=a.other_user)?void 0:l.is_vip)||!1,vip_level:(null==(n=a.other_user)?void 0:n.vip_level)||0,last_message:a.last_message,last_time:a.last_message_at,unread_count:a.unread_count||0}}),la.value.private=ea.value.reduce((a,e)=>a+(e.unread_count||0),0)}catch(a){}},ua=async()=>{var a,e;try{const s=await p.get("/notifications/comments");sa.value=(null==(a=s.data)?void 0:a.items)||[],la.value.comment=(null==(e=s.data)?void 0:e.unread_count)||0}catch(s){sa.value=[]}},ma=async()=>{var a,e;try{const s=await p.get("/notifications/likes");ta.value=(null==(a=s.data)?void 0:a.items)||[],la.value.like=(null==(e=s.data)?void 0:e.unread_count)||0}catch(s){ta.value=[]}},da=a=>{const e={video:"视频",short:"短视频",post:"帖子",gallery:"图集",novel:"小说"}[a.target_type]||"内容";return"reply"===a.notification_type?"回复了你的评论":`评论了你的${e}`},pa=a=>`赞了你的${{video:"视频",short:"短视频",post:"帖子",gallery:"图集",novel:"小说",video_comment:"评论",post_comment:"评论",gallery_comment:"评论"}[a.target_type]||"内容"}`,ga=a=>{const e=a.target_type,s=a.target_id;if(s)switch(e){case"video":case"video_comment":Z.push(`/user/video/${s}`);break;case"short":Z.push(`/shorts?id=${s}`);break;case"post":case"post_comment":Z.push(`/user/community/${s}`);break;case"gallery":case"gallery_comment":Z.push(`/gallery/${s}`);break;case"novel":Z.push(`/novel/${s}`)}};return s(async()=>{var a,e,s;ia.value=!0;try{const t=await p.get("/notifications/unread-count");la.value={private:(null==(a=t.data)?void 0:a.private_messages)||0,comment:(null==(e=t.data)?void 0:e.comments)||0,like:(null==(s=t.data)?void 0:s.likes)||0}}catch(t){}await Promise.all([oa(),ua(),ma()]),ia.value=!1;try{await p.post("/notifications/mark-read?notification_type=all"),la.value={private:0,comment:0,like:0}}catch(t){}}),(e,s)=>(m(),t("div",g,[i("header",_,[i("div",{class:"back-btn",onClick:s[0]||(s[0]=a=>e.$router.back())},[...s[4]||(s[4]=[i("img",{src:a,alt:"返回",class:"back-icon"},null,-1)])]),s[5]||(s[5]=i("h1",{class:"page-title"},"我的消息",-1)),s[6]||(s[6]=i("div",{class:"header-right"},null,-1))]),i("div",k,[i("div",{class:l(["tab-item",{active:"private"===aa.value}]),onClick:s[1]||(s[1]=a=>aa.value="private")},[s[7]||(s[7]=n(" 私信 ",-1)),la.value.private>0?(m(),t("span",y,c(la.value.private),1)):r("",!0)],2),s[10]||(s[10]=i("div",{class:"tab-divider"},"|",-1)),i("div",{class:l(["tab-item",{active:"comment"===aa.value}]),onClick:s[2]||(s[2]=a=>aa.value="comment")},[s[8]||(s[8]=n(" 评论 ",-1)),la.value.comment>0?(m(),t("span",b,c(la.value.comment),1)):r("",!0)],2),s[11]||(s[11]=i("div",{class:"tab-divider"},"|",-1)),i("div",{class:l(["tab-item",{active:"like"===aa.value}]),onClick:s[3]||(s[3]=a=>aa.value="like")},[s[9]||(s[9]=n(" 点赞 ",-1)),la.value.like>0?(m(),t("span",h,c(la.value.like),1)):r("",!0)],2)]),i("div",w,["private"===aa.value?(m(),t(v,{key:0},[(m(!0),t(v,null,o(ea.value,a=>(m(),t("div",{key:a.id,class:"message-item",onClick:e=>(a=>{Z.push({name:"PrivateChat",params:{id:a.user_id},query:{nickname:a.nickname||a.username,avatar:a.avatar}})})(a)},[i("div",f,[i("img",{src:ca(a.avatar,a.user_id),class:"avatar"},null,8,C),a.unread_count>0?(m(),t("span",S)):r("",!0)]),i("div",D,[i("div",P,[i("span",j,c(a.nickname||a.username),1),a.vip_level>0?(m(),t("img",{key:0,src:ra(a.vip_level),class:"vip-badge",alt:"VIP"},null,8,I)):r("",!0)]),i("span",M,c(a.last_message||"暂无消息"),1)]),i("span",F,c(va(a.last_time)),1)],8,$))),128)),0===ea.value.length?(m(),t("div",V,[...s[12]||(s[12]=[i("span",null,"暂无私信消息",-1)])])):r("",!0)],64)):r("",!0),"comment"===aa.value?(m(),t(v,{key:1},[(m(!0),t(v,null,o(sa.value,a=>(m(),t("div",{key:a.id,class:"message-item",onClick:e=>ga(a)},[i("div",x,[i("img",{src:ca(a.avatar,a.user_id),class:"avatar"},null,8,z)]),i("div",E,[i("div",G,[i("span",J,c(a.nickname||a.username),1),a.vip_level>0?(m(),t("img",{key:0,src:ra(a.vip_level),class:"vip-badge",alt:"VIP"},null,8,L)):r("",!0)]),i("span",W,c(da(a))+"："+c(a.content),1)]),i("span",q,c(va(a.created_at)),1)],8,Y))),128)),0===sa.value.length?(m(),t("div",H,[...s[13]||(s[13]=[i("span",null,"暂无评论消息",-1)])])):r("",!0)],64)):r("",!0),"like"===aa.value?(m(),t(v,{key:2},[(m(!0),t(v,null,o(ta.value,a=>(m(),t("div",{key:a.id,class:"message-item",onClick:e=>ga(a)},[i("div",N,[i("img",{src:ca(a.avatar,a.user_id),class:"avatar"},null,8,T)]),i("div",A,[i("div",B,[i("span",O,c(a.nickname||a.username),1),a.vip_level>0?(m(),t("img",{key:0,src:ra(a.vip_level),class:"vip-badge",alt:"VIP"},null,8,Q)):r("",!0)]),i("span",R,[n(c(pa(a))+" ",1),a.content?(m(),t(v,{key:0},[n("："+c(a.content),1)],64)):r("",!0)])]),i("span",U,c(va(a.created_at)),1)],8,K))),128)),0===ta.value.length?(m(),t("div",X,[...s[14]||(s[14]=[i("span",null,"暂无点赞消息",-1)])])):r("",!0)],64)):r("",!0)]),s[15]||(s[15]=i("div",{class:"list-footer"},[i("span",null,"—— 没有更多数据了 ——")],-1))]))}},[["__scopeId","data-v-ba9b15e8"]]);export{Z as default};
