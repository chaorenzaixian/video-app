/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                  *//* empty css               *//* empty css                  */import{E as e,aM as a,bs as l,bk as t,bh as o,aQ as i,a6 as r,bi as s,bo as n,aR as d,aS as u,aT as c,bv as m,a as p}from"./element-plus-DlIn_qXi.js";import{_ as v,a as _}from"./index-C3P4JTuA.js";import{r as h,l as f,j as b,y,C as w,G as g,O as V,F as j,E as k,z as C,K as x,u as U,L as $}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const z={class:"short-category-manage"},F={class:"page-header"},L={key:0,class:"category-icon"},R=["src"],S={key:1},q={key:1,class:"text-muted"},D=v({__name:"ShortCategoryManage",setup(v){const D=h(!1),E=h([]),G=h(!1),I=h(!1),M=h(!1),N=h(null),W=h(null),H=f({name:"",icon:"",description:"",sort_order:0,is_active:!0}),K={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]};b(()=>{O()});const O=async()=>{D.value=!0;try{const e=await _.get("/admin/short-categories");E.value=e.data||e||[]}catch(a){e.error("获取分类失败")}finally{D.value=!1}},Q=()=>{I.value=!1,W.value=null,T(),G.value=!0},T=()=>{var e;H.name="",H.icon="",H.description="",H.sort_order=0,H.is_active=!0,null==(e=N.value)||e.resetFields()},A=async()=>{var a,l,t;if(await(null==(a=N.value)?void 0:a.validate().catch(()=>!1))){M.value=!0;try{I.value?(await _.put(`/admin/short-categories/${W.value}`,{name:H.name,icon:H.icon||null,description:H.description||null,sort_order:H.sort_order,is_active:H.is_active}),e.success("更新成功")):(await _.post("/admin/short-categories",{name:H.name,icon:H.icon||null,description:H.description||null,sort_order:H.sort_order,is_active:H.is_active}),e.success("添加成功")),G.value=!1,O()}catch(o){e.error((null==(t=null==(l=o.response)?void 0:l.data)?void 0:t.detail)||"保存失败")}finally{M.value=!1}}};return(v,h)=>{const f=i,b=a,B=s,J=n,P=o,X=c,Y=u,Z=m,ee=d,ae=t,le=l;return C(),y("div",z,[w("div",F,[h[8]||(h[8]=w("h1",null,"短视频分类管理",-1)),V(b,{type:"primary",onClick:Q},{default:j(()=>[V(f,null,{default:j(()=>[V(U(r))]),_:1}),h[7]||(h[7]=x(" 添加分类 ",-1))]),_:1})]),g((C(),k(P,{data:E.value,border:"",stripe:""},{default:j(()=>[V(B,{prop:"id",label:"ID",width:"80"}),V(B,{label:"图标",width:"80"},{default:j(({row:e})=>[e.icon?(C(),y("div",L,[e.icon.startsWith("http")||e.icon.startsWith("/")?(C(),y("img",{key:0,src:e.icon},null,8,R)):(C(),y("span",S,$(e.icon),1))])):(C(),y("span",q,"-"))]),_:1}),V(B,{prop:"name",label:"分类名称","min-width":"150"}),V(B,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),V(B,{prop:"sort_order",label:"排序",width:"80"}),V(B,{prop:"video_count",label:"视频数",width:"100"}),V(B,{label:"状态",width:"100"},{default:j(({row:a})=>[V(J,{modelValue:a.is_active,"onUpdate:modelValue":e=>a.is_active=e,onChange:l=>(async a=>{try{await _.put(`/admin/short-categories/${a.id}`,{is_active:a.is_active}),e.success(a.is_active?"已启用":"已禁用")}catch(l){a.is_active=!a.is_active,e.error("更新状态失败")}})(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),V(B,{label:"创建时间",width:"170"},{default:j(({row:e})=>{return[x($((a=e.created_at,a?new Date(a).toLocaleString("zh-CN"):"")),1)];var a}),_:1}),V(B,{label:"操作",width:"150",fixed:"right"},{default:j(({row:a})=>[V(b,{type:"primary",link:"",onClick:e=>(e=>{I.value=!0,W.value=e.id,H.name=e.name,H.icon=e.icon||"",H.description=e.description||"",H.sort_order=e.sort_order||0,H.is_active=e.is_active,G.value=!0})(a)},{default:j(()=>[...h[9]||(h[9]=[x("编辑",-1)])]),_:1},8,["onClick"]),V(b,{type:"danger",link:"",onClick:l=>(async a=>{var l,t;try{await p.confirm(`确定要删除分类"${a.name}"吗？${a.video_count>0?`该分类下还有 ${a.video_count} 个视频！`:""}`,"警告",{type:"warning"}),await _.delete(`/admin/short-categories/${a.id}`),e.success("删除成功"),O()}catch(o){"cancel"!==o&&e.error((null==(t=null==(l=o.response)?void 0:l.data)?void 0:t.detail)||"删除失败")}})(a)},{default:j(()=>[...h[10]||(h[10]=[x("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,D.value]]),V(ae,{modelValue:G.value,"onUpdate:modelValue":h[6]||(h[6]=e=>G.value=e),title:I.value?"编辑分类":"添加分类",width:"500px",onClose:T},{footer:j(()=>[V(b,{onClick:h[5]||(h[5]=e=>G.value=!1)},{default:j(()=>[...h[11]||(h[11]=[x("取消",-1)])]),_:1}),V(b,{type:"primary",onClick:A,loading:M.value},{default:j(()=>[...h[12]||(h[12]=[x("确定",-1)])]),_:1},8,["loading"])]),default:j(()=>[V(ee,{ref_key:"formRef",ref:N,model:H,rules:K,"label-width":"100px"},{default:j(()=>[V(Y,{label:"分类名称",prop:"name"},{default:j(()=>[V(X,{modelValue:H.name,"onUpdate:modelValue":h[0]||(h[0]=e=>H.name=e),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),V(Y,{label:"图标"},{default:j(()=>[V(X,{modelValue:H.icon,"onUpdate:modelValue":h[1]||(h[1]=e=>H.icon=e),placeholder:"图标URL或emoji"},null,8,["modelValue"])]),_:1}),V(Y,{label:"描述"},{default:j(()=>[V(X,{modelValue:H.description,"onUpdate:modelValue":h[2]||(h[2]=e=>H.description=e),type:"textarea",rows:3,placeholder:"分类描述（可选）"},null,8,["modelValue"])]),_:1}),V(Y,{label:"排序"},{default:j(()=>[V(Z,{modelValue:H.sort_order,"onUpdate:modelValue":h[3]||(h[3]=e=>H.sort_order=e),min:0,max:9999},null,8,["modelValue"])]),_:1}),V(Y,{label:"状态"},{default:j(()=>[V(J,{modelValue:H.is_active,"onUpdate:modelValue":h[4]||(h[4]=e=>H.is_active=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-0b43340d"]]);export{D as default};
