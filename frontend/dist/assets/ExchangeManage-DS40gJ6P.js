/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                    *//* empty css                *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  */import{aM as e,be as a,bk as l,E as t,aQ as i,a6 as s,bh as o,bi as r,bn as u,bj as d,bo as m,bs as n,aR as p,aS as c,bw as v,aT as _,bl as g,bm as f,bv as b,a as h}from"./element-plus-DlIn_qXi.js";import{_ as y,a as w}from"./index-C3P4JTuA.js";import{r as V,c as k,j,y as x,C,O as U,F as I,z,K as $,u as q,G as A,E as M,L as P}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const E={class:"exchange-manage"},W={class:"page-header"},B={key:1,class:"no-image"},F={class:"points-cost"},G={class:"image-upload-wrapper"},K={key:0,class:"uploaded-image"},O=["src"],Q={class:"image-actions"},R={key:1,class:"upload-placeholder"},S=y({__name:"ExchangeManage",setup(y){const S=V(!1),D=V(!1),H=V([]),L=V(!1),N=V(!1),T=V(null),J=k(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),X={item_name:"",item_desc:"",item_type:"vip_card",points_cost:100,item_value:1,stock:-1,is_active:!0,image_url:""},Y=V({...X}),Z=e=>{if(!e)return"";if(e.startsWith("http"))return e;if(e.startsWith("/images/"))return e;return`${e}`},ee=e=>{e.url?(Y.value.image_url=e.url,t.success("图片上传成功")):t.error("上传失败：无效的响应")},ae=e=>{t.error("图片上传失败，请重试")},le=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?!!l||(t.error("图片大小不能超过 2MB!"),!1):(t.error("只能上传图片文件!"),!1)},te={item_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],item_type:[{required:!0,message:"请选择商品类型",trigger:"change"}],points_cost:[{required:!0,message:"请输入所需积分",trigger:"blur"}]},ie={vip_card:{name:"VIP体验卡",color:"warning"},ai_ticket:{name:"AI科技券",color:"danger"},blind_box:{name:"情趣盲盒",color:"success"},coupon:{name:"优惠券",color:"success"},physical:{name:"实物商品",color:"primary"},virtual:{name:"虚拟商品",color:"info"}},se=e=>{var a;return(null==(a=ie[e])?void 0:a.name)||e},oe=async()=>{S.value=!0;try{const e=await w.get("/admin/exchange-items");H.value=e.data||[]}catch(e){t.error("获取商品列表失败")}finally{S.value=!1}},re=()=>{N.value=!1,Y.value={...X},L.value=!0},ue=async()=>{T.value&&await T.value.validate(async e=>{var a,l;if(e){D.value=!0;try{N.value?(await w.put(`/admin/exchange-items/${Y.value.id}`,Y.value),t.success("更新成功")):(await w.post("/admin/exchange-items",Y.value),t.success("创建成功")),L.value=!1,oe()}catch(i){t.error((null==(l=null==(a=i.response)?void 0:a.data)?void 0:l.detail)||"操作失败")}finally{D.value=!1}}})};return j(()=>{oe()}),(y,V)=>{const k=i,j=e,X=r,de=u,me=d,ne=m,pe=o,ce=a,ve=v,_e=c,ge=_,fe=f,be=g,he=b,ye=p,we=l,Ve=n;return z(),x("div",E,[C("div",W,[V[10]||(V[10]=C("h2",null,"积分兑换管理",-1)),U(j,{type:"primary",onClick:re},{default:I(()=>[U(k,null,{default:I(()=>[U(q(s))]),_:1}),V[9]||(V[9]=$(" 新增商品 ",-1))]),_:1})]),U(ce,null,{default:I(()=>[A((z(),M(pe,{data:H.value,stripe:""},{default:I(()=>[U(X,{prop:"id",label:"ID",width:"60"}),U(X,{label:"卡片图片",width:"120"},{default:I(({row:e})=>[e.image_url?(z(),M(de,{key:0,src:Z(e.image_url),fit:"cover",style:{width:"80px",height:"50px","border-radius":"6px"}},null,8,["src"])):(z(),x("span",B,"未上传"))]),_:1}),U(X,{prop:"item_name",label:"商品名称",width:"150"}),U(X,{prop:"item_desc",label:"商品描述","min-width":"200"}),U(X,{prop:"item_type",label:"商品类型",width:"120"},{default:I(({row:e})=>{return[U(me,{type:(a=e.item_type,(null==(l=ie[a])?void 0:l.color)||"info")},{default:I(()=>[$(P(se(e.item_type)),1)]),_:2},1032,["type"])];var a,l}),_:1}),U(X,{prop:"points_cost",label:"所需积分",width:"100"},{default:I(({row:e})=>[C("span",F,P(e.points_cost),1)]),_:1}),U(X,{prop:"item_value",label:"商品价值",width:"100"}),U(X,{prop:"stock",label:"库存",width:"100"},{default:I(({row:e})=>[U(me,{type:e.stock>10?"success":e.stock>0?"warning":"danger"},{default:I(()=>[$(P(-1===e.stock?"无限":e.stock),1)]),_:2},1032,["type"])]),_:1}),U(X,{prop:"is_active",label:"状态",width:"100"},{default:I(({row:e})=>[U(ne,{modelValue:e.is_active,"onUpdate:modelValue":a=>e.is_active=a,onChange:a=>(async e=>{try{await w.put(`/admin/exchange-items/${e.id}`,{is_active:e.is_active}),t.success(e.is_active?"已启用":"已禁用")}catch(a){e.is_active=!e.is_active,t.error("操作失败")}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),U(X,{label:"操作",width:"150",fixed:"right"},{default:I(({row:e})=>[U(j,{size:"small",onClick:a=>(e=>{N.value=!0,Y.value={...e},L.value=!0})(e)},{default:I(()=>[...V[11]||(V[11]=[$("编辑",-1)])]),_:1},8,["onClick"]),U(j,{size:"small",type:"danger",onClick:a=>(async e=>{try{await h.confirm("确定要删除该商品吗？","提示",{type:"warning"}),await w.delete(`/admin/exchange-items/${e.id}`),t.success("删除成功"),oe()}catch(a){"cancel"!==a&&t.error("删除失败")}})(e)},{default:I(()=>[...V[12]||(V[12]=[$("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ve,S.value]])]),_:1}),U(we,{modelValue:L.value,"onUpdate:modelValue":V[8]||(V[8]=e=>L.value=e),title:N.value?"编辑商品":"新增商品",width:"550px"},{footer:I(()=>[U(j,{onClick:V[7]||(V[7]=e=>L.value=!1)},{default:I(()=>[...V[18]||(V[18]=[$("取消",-1)])]),_:1}),U(j,{type:"primary",onClick:ue,loading:D.value},{default:I(()=>[...V[19]||(V[19]=[$("确定",-1)])]),_:1},8,["loading"])]),default:I(()=>[U(ye,{model:Y.value,rules:te,ref_key:"formRef",ref:T,"label-width":"100px"},{default:I(()=>[U(_e,{label:"卡片图片",prop:"image_url"},{default:I(()=>[C("div",G,[U(ve,{class:"card-image-uploader",action:"/api/v1/ads/upload/image",headers:J.value,"show-file-list":!1,"on-success":ee,"on-error":ae,"before-upload":le,accept:"image/*"},{default:I(()=>[Y.value.image_url?(z(),x("div",K,[C("img",{src:Z(Y.value.image_url)},null,8,O),C("div",Q,[U(k,null,{default:I(()=>[U(q(s))]),_:1}),V[13]||(V[13]=C("span",null,"更换",-1))])])):(z(),x("div",R,[U(k,null,{default:I(()=>[U(q(s))]),_:1}),V[14]||(V[14]=C("span",null,"上传卡片图片",-1))]))]),_:1},8,["headers"]),V[15]||(V[15]=C("span",{class:"form-tip"},"建议尺寸: 400x200，票券风格背景图",-1))])]),_:1}),U(_e,{label:"商品名称",prop:"item_name"},{default:I(()=>[U(ge,{modelValue:Y.value.item_name,"onUpdate:modelValue":V[0]||(V[0]=e=>Y.value.item_name=e),placeholder:"输入商品名称"},null,8,["modelValue"])]),_:1}),U(_e,{label:"商品描述",prop:"item_desc"},{default:I(()=>[U(ge,{modelValue:Y.value.item_desc,"onUpdate:modelValue":V[1]||(V[1]=e=>Y.value.item_desc=e),type:"textarea",rows:2,placeholder:"输入商品描述"},null,8,["modelValue"])]),_:1}),U(_e,{label:"商品类型",prop:"item_type"},{default:I(()=>[U(be,{modelValue:Y.value.item_type,"onUpdate:modelValue":V[2]||(V[2]=e=>Y.value.item_type=e),placeholder:"选择商品类型"},{default:I(()=>[U(fe,{label:"VIP体验卡",value:"vip_card"}),U(fe,{label:"AI科技券",value:"ai_ticket"}),U(fe,{label:"情趣盲盒",value:"blind_box"}),U(fe,{label:"优惠券",value:"coupon"}),U(fe,{label:"实物商品",value:"physical"}),U(fe,{label:"虚拟商品",value:"virtual"})]),_:1},8,["modelValue"])]),_:1}),U(_e,{label:"所需积分",prop:"points_cost"},{default:I(()=>[U(he,{modelValue:Y.value.points_cost,"onUpdate:modelValue":V[3]||(V[3]=e=>Y.value.points_cost=e),min:1,max:1e5},null,8,["modelValue"])]),_:1}),U(_e,{label:"商品价值",prop:"item_value"},{default:I(()=>[U(he,{modelValue:Y.value.item_value,"onUpdate:modelValue":V[4]||(V[4]=e=>Y.value.item_value=e),min:0},null,8,["modelValue"]),V[16]||(V[16]=C("span",{class:"form-tip"},"如VIP天数、优惠金额等",-1))]),_:1}),U(_e,{label:"库存数量",prop:"stock"},{default:I(()=>[U(he,{modelValue:Y.value.stock,"onUpdate:modelValue":V[5]||(V[5]=e=>Y.value.stock=e),min:-1},null,8,["modelValue"]),V[17]||(V[17]=C("span",{class:"form-tip"},"-1表示无限库存",-1))]),_:1}),U(_e,{label:"启用状态"},{default:I(()=>[U(ne,{modelValue:Y.value.is_active,"onUpdate:modelValue":V[6]||(V[6]=e=>Y.value.is_active=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-75718f43"]]);export{S as default};
