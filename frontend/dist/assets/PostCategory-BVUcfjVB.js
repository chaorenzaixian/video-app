import{r as a,w as s,j as e,az as l,y as t,C as i,L as c,M as n,aa as o,I as u,aC as r,z as v,H as m,U as p,u as d,K as g}from"./vue-vendor-Ba_vealp.js";import{_ as k}from"./ic_back-BPdSG6fy.js";import{_ as y,a as h}from"./index-C3P4JTuA.js";import{g as _}from"./avatar-DXHBWedi.js";import{d as f,f as b}from"./format-s96t4k9e.js";import{g as C}from"./vip-C8N2TCfr.js";import"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const j={class:"post-category-page"},w={class:"top-header"},$={class:"page-title"},I={class:"filter-tabs"},x=["onClick"],z=["onClick"],H={class:"post-header"},q=["src","onClick"],M={class:"user-info"},P={class:"user-name-row"},K=["onClick"],L=["src"],R={class:"time"},S={class:"post-text"},T={key:0,class:"post-images"},U=["src"],V={key:0,class:"more-count"},A={class:"post-stats"},B={class:"stat-item"},D={class:"stat-item"},E=["onClick"],F={class:"stat-icon"},G={key:0,class:"post-topic-tag"},J={key:0,class:"loading"},N={key:1,class:"no-more"},O={key:2,class:"empty"},Q=y({__name:"PostCategory",setup(y){const Q=r(),W=l(),X=a(null),Y=a(""),Z=a([]),aa=a(!1),sa=a(!0),ea=a(1),la=a("hot_comment"),ta=a(null),ia=[{label:"æœ€æ–°çƒ­è¯„",value:"hot_comment"},{label:"æœ€æ–°ä¸Šæ¶",value:"latest"},{label:"æœ€å¤šè§‚çœ‹",value:"hot"}],ca=async()=>{var a;try{const s=await h.get(`/community/topics/${X.value}`);Y.value=(null==(a=s.data)?void 0:a.name)||"è¯é¢˜"}catch(s){}},na=async(a=!1)=>{if(!aa.value&&(a&&(ea.value=1,sa.value=!0,Z.value=[]),sa.value)){aa.value=!0;try{const s={page:ea.value,page_size:20,topic_id:X.value,feed_type:"hot_comment"===la.value?"recommend":la.value},e=(await h.get("/community/posts",{params:s})).data||[];e.length<20&&(sa.value=!1),Z.value=a?e:[...Z.value,...e],ea.value++}catch(s){}finally{aa.value=!1}}},oa=a=>{const{scrollTop:s,scrollHeight:e,clientHeight:l}=a.target;e-s-l<100&&!aa.value&&sa.value&&na()},ua=a=>{a&&Q.push(`/user/member/${a}`)};return s(()=>W.params.id,a=>{a&&(X.value=parseInt(a),ca(),na(!0))},{immediate:!0}),e(()=>{X.value=parseInt(W.params.id),W.query.name&&(Y.value=W.query.name),ca(),na(!0)}),(a,s)=>(v(),t("div",j,[i("header",w,[i("div",{class:"back-btn",onClick:s[0]||(s[0]=s=>a.$router.back())},[...s[1]||(s[1]=[i("img",{src:k,alt:"è¿”å›",class:"back-icon"},null,-1)])]),i("h1",$,c(Y.value),1),s[2]||(s[2]=i("div",{class:"header-right"},null,-1))]),i("div",I,[(v(),t(n,null,o(ia,a=>i("span",{key:a.value,class:m(["filter-tab",{active:la.value===a.value}]),onClick:s=>(a=>{la.value=a,na(!0)})(a.value)},c(a.label),11,x)),64))]),i("div",{class:"posts-list",ref_key:"listRef",ref:ta,onScroll:oa},[(v(!0),t(n,null,o(Z.value,a=>{var e,l,r,k,y,j,w,$;return v(),t("div",{key:a.id,class:"post-card",onClick:s=>{return e=a.id,Q.push(`/user/community/post/${e}`);var e}},[i("div",H,[i("img",{src:d(_)(null==(e=a.user)?void 0:e.avatar,null==(l=a.user)?void 0:l.id),class:"avatar clickable",onClick:p(s=>{var e;return ua(null==(e=a.user)?void 0:e.id)},["stop"])},null,8,q),i("div",M,[i("div",P,[i("span",{class:"username clickable",onClick:p(s=>{var e;return ua(null==(e=a.user)?void 0:e.id)},["stop"])},c((null==(r=a.user)?void 0:r.nickname)||(null==(k=a.user)?void 0:k.username)||"åŒ¿åç”¨æˆ·"),9,K),(null==(y=a.user)?void 0:y.is_vip)?(v(),t("img",{key:0,src:($=null==(j=a.user)?void 0:j.vip_level,C($)),class:"vip-icon",alt:"VIP"},null,8,L)):u("",!0)]),i("span",R,c((w=a.created_at,f(w))),1)])]),i("p",S,c(a.content),1),a.images&&a.images.length?(v(),t("div",T,[i("div",{class:m(["images-grid",`grid-${Math.min(a.images.length,4)}`])},[(v(!0),t(n,null,o(a.images.slice(0,4),(s,e)=>(v(),t("div",{key:e,class:"img-item"},[i("img",{src:s},null,8,U),3===e&&a.images.length>4?(v(),t("span",V,"+"+c(a.images.length-4),1)):u("",!0)]))),128))],2)])):u("",!0),i("div",A,[i("span",B,[s[3]||(s[3]=i("span",{class:"stat-icon"},"ğŸ‘",-1)),g(" "+c(d(b)(a.view_count)),1)]),i("span",D,[s[4]||(s[4]=i("span",{class:"stat-icon"},"ğŸ’¬",-1)),g(" "+c(a.comment_count||0),1)]),i("span",{class:"stat-item",onClick:p(s=>(async a=>{try{const s=await h.post(`/community/posts/${a.id}/like`);a.is_liked=s.data.liked,a.like_count=s.data.like_count}catch(s){}})(a),["stop"])},[i("span",F,c(a.is_liked?"â¤ï¸":"ğŸ¤"),1),g(" "+c(d(b)(a.like_count)),1)],8,E),a.topics&&a.topics.length?(v(),t("span",G,"#"+c(a.topics[0].name),1)):u("",!0)])],8,z)}),128)),aa.value?(v(),t("div",J,"åŠ è½½ä¸­...")):u("",!0),aa.value||sa.value||!Z.value.length?u("",!0):(v(),t("div",N,"æ²¡æœ‰æ›´å¤šäº†")),aa.value||Z.value.length?u("",!0):(v(),t("div",O,"æš‚æ— å†…å®¹"))],544)]))}},[["__scopeId","data-v-c8203fb6"]]);export{Q as default};
