import{c as a,r as s,j as t,y as e,C as l,E as r,H as v,L as i,M as u,aa as c,I as n,U as o,a0 as p,aC as d,z as m}from"./vue-vendor-Ba_vealp.js";import{_ as h}from"./ic_back-BPdSG6fy.js";import{_,u as f,a as g}from"./index-C3P4JTuA.js";import{E as b}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const k={class:"avatar-select-page"},y={class:"page-header"},C={class:"current-avatar-section"},S={class:"current-avatar"},$=["src"],w={class:"avatar-grid"},j=["onClick"],E=["src","alt"],M={key:0,class:"selected-mark"},x=_({__name:"AvatarSelect",setup(_){const x=d(),P=f(),D=a(()=>P.user),G=s(!1),J=s(""),L=s(!1),I=a(()=>{var a,s;return!0===(null==(a=P.user)?void 0:a.is_vip)||(null==(s=P.user)?void 0:s.vip_level)>0}),U=()=>{L.value=!1,x.back()},z=()=>{L.value=!1,x.push("/user/vip")},W=s([]),A=a(()=>{var a,s;if(J.value)return J.value;const t=null==(a=D.value)?void 0:a.avatar;if(t)return t.startsWith("http")||t.startsWith("/")?t:`/${t}`;return(a=>{const s=a%52;if(s<17)return`/images/avatars/icon_avatar_${s+1}.webp`;if(s<32)return`/images/avatars/DM_20251217202131_${String(s-17+1).padStart(3,"0")}.JPEG`;return`/images/avatars/DM_20251217202341_${String(s-32+1).padStart(3,"0")}.JPEG`})((null==(s=D.value)?void 0:s.id)||1)}),B=async()=>{if(J.value){if(!G.value){G.value=!0;try{await g.put("/users/me",{avatar:J.value}),await P.fetchUser(),b.success("头像已更新"),x.back()}catch(a){b.error("更新失败，请重试")}finally{G.value=!1}}}else b.warning("请选择一个头像")};return t(async()=>{var a;await P.fetchUser(),I.value?((()=>{const a=[];for(let s=1;s<=17;s++){const t=`/images/avatars/icon_avatar_${s}.webp`;a.push({path:t,url:t})}for(let s=1;s<=15;s++){const t=`/images/avatars/DM_20251217202131_${String(s).padStart(3,"0")}.JPEG`;a.push({path:t,url:t})}for(let s=1;s<=20;s++){const t=`/images/avatars/DM_20251217202341_${String(s).padStart(3,"0")}.JPEG`;a.push({path:t,url:t})}W.value=a})(),(null==(a=D.value)?void 0:a.avatar)&&(J.value=D.value.avatar)):L.value=!0}),(a,s)=>(m(),e("div",k,[l("header",y,[l("div",{class:"back-btn",onClick:s[0]||(s[0]=s=>a.$router.back())},[...s[1]||(s[1]=[l("img",{src:h,alt:"返回",class:"back-icon"},null,-1)])]),s[2]||(s[2]=l("h1",{class:"page-title"},"选择头像",-1)),l("div",{class:v(["save-btn",{disabled:G.value}]),onClick:B},i(G.value?"保存中...":"保存"),3)]),l("div",C,[l("div",S,[l("img",{src:A.value,alt:"当前头像"},null,8,$)]),s[3]||(s[3]=l("span",{class:"current-label"},"当前头像",-1))]),l("div",w,[(m(!0),e(u,null,c(W.value,(a,t)=>(m(),e("div",{key:t,class:v(["avatar-item",{selected:J.value===a.path}]),onClick:s=>{return t=a.path,void(J.value=t);var t}},[l("img",{src:a.url,alt:"头像"+(t+1)},null,8,E),J.value===a.path?(m(),e("div",M,[...s[4]||(s[4]=[l("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})],-1)])])):n("",!0)],10,j))),128))]),(m(),r(p,{to:"body"},[L.value?(m(),e("div",{key:0,class:"vip-modal-overlay",onClick:o(U,["self"])},[l("div",{class:"vip-modal-content"},[s[5]||(s[5]=l("h2",{class:"vip-modal-title"},"温馨提示",-1)),s[6]||(s[6]=l("p",{class:"vip-modal-text"},"您还不是VIP无法修改头像!",-1)),s[7]||(s[7]=l("p",{class:"vip-modal-subtext"},"开通会员 即可解锁继续",-1)),l("button",{class:"vip-modal-btn",onClick:z},"立即开通")])])):n("",!0)]))]))}},[["__scopeId","data-v-3a010820"]]);export{x as default};
