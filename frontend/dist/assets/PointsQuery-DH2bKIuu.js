/* empty css             *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                 *//* empty css                       *//* empty css                   *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                *//* empty css                     *//* empty css                  */import{_ as e,a}from"./index-C3P4JTuA.js";import{be as l,bk as t,E as u,aR as o,aS as s,aT as r,aM as i,bh as n,bi as d,bs as p,bt as m,bj as v,bf as _,by as c,bv as g}from"./element-plus-DlIn_qXi.js";import{r as f,j as b,y as h,C as y,O as w,F as j,z as V,K as z,G as S,E as k,L as x,H as C}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const U={class:"points-query"},D={class:"points-total"},$={class:"points-available"},I={class:"points-frozen"},q={class:"points-available"},F=e({__name:"PointsQuery",setup(e){const F=f(!1),H=f(!1),M=f(!1),E=f([]),G=f([]),K=f(!1),P=f(!1),R=f(null),A=f({user_id:"",username:""}),B=f({page:1,pageSize:20,total:0}),J=f({user_id:null,username:"",current_points:0,type:"add",amount:0,reason:""}),L={amount:[{required:!0,message:"请输入调整数量",trigger:"blur"}],reason:[{required:!0,message:"请输入调整原因",trigger:"blur"}]},O={task:"任务奖励",exchange:"积分兑换",admin_add:"管理员增加",admin_reduce:"管理员减少",invite:"邀请奖励",register:"注册奖励"},Q=e=>{if(!e)return"-";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},T=async()=>{var e,l;F.value=!0;try{const t={page:B.value.page,page_size:B.value.pageSize,...A.value},u=await a.get("/admin/user-points",{params:t});E.value=(null==(e=u.data)?void 0:e.items)||u.data||[],B.value.total=(null==(l=u.data)?void 0:l.total)||E.value.length}catch(t){u.error("获取用户积分列表失败")}finally{F.value=!1}},Y=()=>{B.value.page=1,T()},N=()=>{A.value={user_id:"",username:""},B.value.page=1,T()},W=async()=>{R.value&&await R.value.validate(async e=>{var l,t;if(e){M.value=!0;try{await a.post(`/admin/user-points/${J.value.user_id}/adjust`,{type:J.value.type,amount:J.value.amount,reason:J.value.reason}),u.success("调整成功"),P.value=!1,T()}catch(o){u.error((null==(t=null==(l=o.response)?void 0:l.data)?void 0:t.detail)||"调整失败")}finally{M.value=!1}}})};return b(()=>{T()}),(e,f)=>{const b=r,X=s,Z=i,ee=o,ae=l,le=d,te=n,ue=m,oe=v,se=t,re=c,ie=_,ne=g,de=p;return V(),h("div",U,[f[18]||(f[18]=y("div",{class:"page-header"},[y("h2",null,"用户积分查询")],-1)),w(ae,{class:"search-card"},{default:j(()=>[w(ee,{inline:!0,model:A.value},{default:j(()=>[w(X,{label:"用户ID"},{default:j(()=>[w(b,{modelValue:A.value.user_id,"onUpdate:modelValue":f[0]||(f[0]=e=>A.value.user_id=e),placeholder:"输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),w(X,{label:"用户名"},{default:j(()=>[w(b,{modelValue:A.value.username,"onUpdate:modelValue":f[1]||(f[1]=e=>A.value.username=e),placeholder:"输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),w(X,null,{default:j(()=>[w(Z,{type:"primary",onClick:Y},{default:j(()=>[...f[10]||(f[10]=[z("查询",-1)])]),_:1}),w(Z,{onClick:N},{default:j(()=>[...f[11]||(f[11]=[z("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),w(ae,null,{default:j(()=>[S((V(),k(te,{data:E.value,stripe:""},{default:j(()=>[w(le,{prop:"user_id",label:"用户ID",width:"100"}),w(le,{prop:"username",label:"用户名",width:"150"}),w(le,{prop:"nickname",label:"昵称",width:"150"}),w(le,{prop:"total_points",label:"累计积分",width:"120"},{default:j(({row:e})=>[y("span",D,x(e.total_points||0),1)]),_:1}),w(le,{prop:"available_points",label:"可用积分",width:"120"},{default:j(({row:e})=>[y("span",$,x(e.available_points||0),1)]),_:1}),w(le,{prop:"frozen_points",label:"冻结积分",width:"120"},{default:j(({row:e})=>[y("span",I,x(e.frozen_points||0),1)]),_:1}),w(le,{label:"操作",width:"200",fixed:"right"},{default:j(({row:e})=>[w(Z,{size:"small",onClick:l=>(async e=>{K.value=!0,H.value=!0;try{const l=await a.get(`/admin/user-points/${e.user_id}/logs`);G.value=l.data||[]}catch(l){u.error("获取积分明细失败")}finally{H.value=!1}})(e)},{default:j(()=>[...f[12]||(f[12]=[z("积分明细",-1)])]),_:1},8,["onClick"]),w(Z,{size:"small",type:"primary",onClick:a=>(e=>{J.value={user_id:e.user_id,username:e.username,current_points:e.available_points||0,type:"add",amount:0,reason:""},P.value=!0})(e)},{default:j(()=>[...f[13]||(f[13]=[z("调整积分",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,F.value]]),w(ue,{"current-page":B.value.page,"onUpdate:currentPage":f[2]||(f[2]=e=>B.value.page=e),"page-size":B.value.pageSize,"onUpdate:pageSize":f[3]||(f[3]=e=>B.value.pageSize=e),total:B.value.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:T,onCurrentChange:T,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),w(se,{modelValue:K.value,"onUpdate:modelValue":f[4]||(f[4]=e=>K.value=e),title:"积分明细",width:"700px"},{default:j(()=>[S((V(),k(te,{data:G.value,"max-height":"400"},{default:j(()=>[w(le,{prop:"id",label:"ID",width:"60"}),w(le,{prop:"log_type",label:"类型",width:"100"},{default:j(({row:e})=>[w(oe,{type:e.points_change>0?"success":"danger"},{default:j(()=>{return[z(x((a=e.log_type,O[a]||a)),1)];var a}),_:2},1032,["type"])]),_:1}),w(le,{prop:"points_change",label:"积分变动",width:"100"},{default:j(({row:e})=>[y("span",{class:C(e.points_change>0?"points-plus":"points-minus")},x(e.points_change>0?"+":"")+x(e.points_change),3)]),_:1}),w(le,{prop:"description",label:"描述","min-width":"200"}),w(le,{prop:"created_at",label:"时间",width:"160"},{default:j(({row:e})=>[z(x(Q(e.created_at)),1)]),_:1})]),_:1},8,["data"])),[[de,H.value]])]),_:1},8,["modelValue"]),w(se,{modelValue:P.value,"onUpdate:modelValue":f[9]||(f[9]=e=>P.value=e),title:"调整积分",width:"400px"},{footer:j(()=>[w(Z,{onClick:f[8]||(f[8]=e=>P.value=!1)},{default:j(()=>[...f[16]||(f[16]=[z("取消",-1)])]),_:1}),w(Z,{type:"primary",onClick:W,loading:M.value},{default:j(()=>[...f[17]||(f[17]=[z("确定",-1)])]),_:1},8,["loading"])]),default:j(()=>[w(ee,{model:J.value,rules:L,ref_key:"adjustFormRef",ref:R,"label-width":"80px"},{default:j(()=>[w(X,{label:"用户"},{default:j(()=>[y("span",null,x(J.value.username)+" (ID: "+x(J.value.user_id)+")",1)]),_:1}),w(X,{label:"当前积分"},{default:j(()=>[y("span",q,x(J.value.current_points),1)]),_:1}),w(X,{label:"调整类型",prop:"type"},{default:j(()=>[w(ie,{modelValue:J.value.type,"onUpdate:modelValue":f[5]||(f[5]=e=>J.value.type=e)},{default:j(()=>[w(re,{label:"add"},{default:j(()=>[...f[14]||(f[14]=[z("增加",-1)])]),_:1}),w(re,{label:"reduce"},{default:j(()=>[...f[15]||(f[15]=[z("减少",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),w(X,{label:"调整数量",prop:"amount"},{default:j(()=>[w(ne,{modelValue:J.value.amount,"onUpdate:modelValue":f[6]||(f[6]=e=>J.value.amount=e),min:1,max:1e5},null,8,["modelValue"])]),_:1}),w(X,{label:"调整原因",prop:"reason"},{default:j(()=>[w(b,{modelValue:J.value.reason,"onUpdate:modelValue":f[7]||(f[7]=e=>J.value.reason=e),type:"textarea",rows:2,placeholder:"输入调整原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-d03a5dbb"]]);export{F as default};
