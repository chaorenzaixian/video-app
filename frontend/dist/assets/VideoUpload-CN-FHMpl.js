/* empty css             *//* empty css                *//* empty css                    *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                          *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                        *//* empty css                  *//* empty css                  */import{r as e,l as a,j as l,y as t,O as s,F as o,aC as i,z as d,I as r,E as u,C as n,u as p,K as c,L as v,U as m,M as f,aa as _,H as y}from"./vue-vendor-Ba_vealp.js";import{_ as g,a as h}from"./index-C3P4JTuA.js";import{be as b,aR as V,aS as w,bw as k,aQ as x,bx as j,aG as P,aM as I,a4 as U,bf as C,bg as z,Z as M,a1 as F,aw as $,a0 as B,a2 as G,aF as T,a3 as W,$ as q,aT as A,bu as D,bl as K,bm as R,bv as S,bo as E,bp as H,E as N}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const O={class:"video-upload-page"},Q={key:0,class:"upload-area"},J={key:1,class:"file-info"},L={class:"file-details"},Z={class:"file-name"},X={class:"file-size"},Y={class:"cover-section"},ee={class:"cover-mode-switch"},ae={key:0,class:"cover-candidates"},le={key:0,class:"cover-hint"},te={key:1,class:"cover-loading"},se={key:2,class:"cover-actions"},oe={key:3,class:"cover-grid"},ie=["onClick"],de=["src","alt"],re={class:"cover-info"},ue={class:"time"},ne={key:0,class:"score"},pe={key:0,class:"selected-badge"},ce={key:1,class:"best-badge"},ve={key:1,class:"cover-upload"},me={key:0,class:"cover-upload-area"},fe={key:1,class:"cover-preview"},_e=["src"],ye={class:"cover-overlay"},ge={key:2,class:"cover-auto-hint"},he={key:0,class:"upload-progress"},be={class:"progress-text"},Ve=g({__name:"VideoUpload",setup(g){const Ve=i(),we=e(null),ke=e(null),xe=e(null),je=e(!1),Pe=e(0),Ie=e(""),Ue=e("auto"),Ce=e([]),ze=e(""),Me=e(!1),Fe=a({file:null,title:"",description:"",category_id:null,tags:[],is_vip_only:!1,pay_type:"free",coin_price:10,vip_coin_price:0,vip_free_level:1,free_preview_seconds:15}),$e=e(null),Be=e([]),Ge={title:[{required:!0,message:"ËØ∑ËæìÂÖ•ËßÜÈ¢ëÊ†áÈ¢ò",trigger:"blur"},{min:2,max:100,message:"Ê†áÈ¢òÈïøÂ∫¶Â∫îÂú®2-100‰∏™Â≠óÁ¨¶‰πãÈó¥",trigger:"blur"}]},Te=e=>{Fe.category_id=e},We=e([]),qe=e([]),Ae=e=>{if(Fe.file=e.raw,!Fe.title){const a=e.name.replace(/\.[^/.]+$/,"");Fe.title=a}Ce.value=[],ze.value=""},De=()=>{N.warning("Âè™ËÉΩ‰∏ä‰º†‰∏Ä‰∏™ËßÜÈ¢ëÊñá‰ª∂")},Ke=e=>{const a=e.type.startsWith("video/"),l=e.size/1024/1024/1024<5;return a?!!l||(N.error("ËßÜÈ¢ëÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá5GB"),!1):(N.error("Âè™ËÉΩ‰∏ä‰º†ËßÜÈ¢ëÊñá‰ª∂"),!1)},Re=()=>{var e;Fe.file=null,null==(e=ke.value)||e.clearFiles(),Ce.value=[],ze.value=""},Se=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":e<1073741824?(e/1024/1024).toFixed(2)+" MB":(e/1024/1024/1024).toFixed(2)+" GB",Ee=e=>e?e.startsWith("http")?e:`${e}`:"",He=async()=>{var e,a,l;if(Fe.file){Me.value=!0;try{const a=new FormData;a.append("file",Fe.file),a.append("num_candidates",6);const l=await h.post("/videos/extract-covers",a,{headers:{"Content-Type":"multipart/form-data"},timeout:3e5,onUploadProgress:e=>{Math.round(100*e.loaded/e.total)}});Ce.value=(null==(e=l.data)?void 0:e.candidates)||l.candidates||[],Ce.value.length>0?(N.success(`ÊàêÂäüÊèêÂèñ ${Ce.value.length} ‰∏™ÂÄôÈÄâÂ∞ÅÈù¢`),ze.value=Ce.value[0].url):N.warning("Êú™ËÉΩÊèêÂèñÂà∞ÂÄôÈÄâÂ∞ÅÈù¢")}catch(t){N.error("ÊèêÂèñÂ∞ÅÈù¢Â§±Ë¥•: "+((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.detail)||t.message))}finally{Me.value=!1}}else N.warning("ËØ∑ÂÖàÈÄâÊã©ËßÜÈ¢ëÊñá‰ª∂")},Ne=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<10;return a?!!l||(N.error("ÂõæÁâáÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá10MB"),!1):(N.error("Âè™ËÉΩ‰∏ä‰º†ÂõæÁâáÊñá‰ª∂"),!1)},Oe=async({file:e})=>{var a;try{const l=new FormData;l.append("file",e);const t=await h.post("/videos/upload-custom-cover",l,{headers:{"Content-Type":"multipart/form-data"}});ze.value=(null==(a=t.data)?void 0:a.url)||t.url,N.success("Â∞ÅÈù¢‰∏ä‰º†ÊàêÂäü")}catch(l){N.error("‰∏ä‰º†Â∞ÅÈù¢Â§±Ë¥•")}},Qe=async()=>{var e;Fe.file?await(null==(e=we.value)?void 0:e.validate(async e=>{if(!e)return;je.value=!0,Pe.value=0,Ie.value="ÂáÜÂ§á‰∏ä‰º†...";const a=new FormData;a.append("file",Fe.file),a.append("title",Fe.title),a.append("description",Fe.description||""),Fe.category_id&&a.append("category_id",Fe.category_id),a.append("is_vip_only",Fe.is_vip_only),Fe.tags&&Fe.tags.length>0&&a.append("tags",Fe.tags.join(",")),a.append("pay_type",Fe.pay_type),"free"!==Fe.pay_type&&a.append("coin_price",Fe.coin_price),"auto"!==Ue.value&&ze.value&&a.append("custom_cover_url",ze.value);try{await h.post("/videos/upload",a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{e.lengthComputable&&(Pe.value=Math.round(e.loaded/e.total*100),Ie.value=`‰∏ä‰º†‰∏≠ ${Se(e.loaded)} / ${Se(e.total)}`)}});Ie.value="‰∏ä‰º†ÂÆåÊàêÔºåÊ≠£Âú®Â§ÑÁêÜËßÜÈ¢ë...",N.success("‰∏ä‰º†ÊàêÂäüÔºåËßÜÈ¢ëÊ≠£Âú®ÂêéÂè∞Â§ÑÁêÜ‰∏≠"),setTimeout(()=>{Ve.push("/videos")},1500)}catch(l){Ie.value="‰∏ä‰º†Â§±Ë¥•"}finally{je.value=!1}})):N.warning("ËØ∑ÂÖàÈÄâÊã©ËßÜÈ¢ëÊñá‰ª∂")};return l(()=>{(async()=>{try{const e=await h.get("/videos/categories"),a=e.data||e||[];We.value=a,Be.value=a}catch(e){const a=[{id:1,name:"ÊïôËÇ≤",children:[]},{id:2,name:"Â®±‰πê",children:[]},{id:3,name:"ÁßëÊäÄ",children:[]},{id:4,name:"ÁîüÊ¥ª",children:[]}];We.value=a,Be.value=a}})(),(async()=>{try{const e=await h.get("/admin/tags");qe.value=(e.data||[]).map(e=>e.name)}catch(e){qe.value=["ÊïôÁ®ã","ÂÖ•Èó®","È´òÁ∫ß","ÂÆûÊàò","ÊäÄÂ∑ß","ÂàÜ‰∫´","ÂéüÂàõ"]}})()}),(e,a)=>{const l=x,i=I,g=k,h=w,N=z,Ve=C,We=A,Je=D,Le=R,Ze=K,Xe=S,Ye=E,ea=V,aa=H,la=b;return d(),t("div",O,[s(la,null,{header:o(()=>[...a[12]||(a[12]=[n("span",null,"‰∏ä‰º†ËßÜÈ¢ë",-1)])]),default:o(()=>[s(ea,{ref_key:"formRef",ref:we,model:Fe,rules:Ge,"label-width":"100px",style:{"max-width":"800px"}},{default:o(()=>[s(h,{label:"ËßÜÈ¢ëÊñá‰ª∂",prop:"file",required:""},{default:o(()=>[s(g,{ref_key:"uploadRef",ref:ke,"auto-upload":!1,limit:1,"on-change":Ae,"on-exceed":De,"before-upload":Ke,accept:"video/*",drag:""},{default:o(()=>[Fe.file?(d(),t("div",J,[s(l,{size:"32",color:"#6366f1"},{default:o(()=>[s(p(P))]),_:1}),n("div",L,[n("div",Z,v(Fe.file.name),1),n("div",X,v(Se(Fe.file.size)),1)]),s(i,{text:"",type:"danger",onClick:m(Re,["stop"])},{default:o(()=>[s(l,null,{default:o(()=>[s(p(U))]),_:1})]),_:1})])):(d(),t("div",Q,[s(l,{class:"upload-icon"},{default:o(()=>[s(p(j))]),_:1}),a[13]||(a[13]=n("div",{class:"upload-text"},[c("ÊãñÊãΩËßÜÈ¢ëÂà∞Ê≠§Â§ÑÔºåÊàñ "),n("em",null,"ÁÇπÂáª‰∏ä‰º†")],-1)),a[14]||(a[14]=n("div",{class:"upload-tip"},"ÊîØÊåÅ MP4„ÄÅWebM„ÄÅAVI„ÄÅMOV„ÄÅMKV Ê†ºÂºèÔºåÊúÄÂ§ß 5GB",-1))]))]),_:1},512)]),_:1}),s(h,{label:"ËßÜÈ¢ëÂ∞ÅÈù¢"},{default:o(()=>[n("div",Y,[n("div",ee,[s(Ve,{modelValue:Ue.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Ue.value=e),size:"small"},{default:o(()=>[s(N,{label:"auto"},{default:o(()=>[...a[15]||(a[15]=[c("ü§ñ Á≥ªÁªüÊô∫ËÉΩÈÄâÊã©",-1)])]),_:1}),s(N,{label:"select"},{default:o(()=>[...a[16]||(a[16]=[c("üéØ ÊâãÂä®ÈÄâÊã©Â∞ÅÈù¢",-1)])]),_:1}),s(N,{label:"upload"},{default:o(()=>[...a[17]||(a[17]=[c("üì§ ‰∏ä‰º†Ëá™ÂÆö‰πâ",-1)])]),_:1})]),_:1},8,["modelValue"])]),"select"===Ue.value?(d(),t("div",ae,[Fe.file?Me.value?(d(),t("div",te,[s(l,{class:"is-loading"},{default:o(()=>[s(p(F))]),_:1}),a[19]||(a[19]=n("span",null,"Ê≠£Âú®ÊèêÂèñËßÜÈ¢ëÂ∏ß...",-1))])):0===Ce.value.length?(d(),t("div",se,[s(i,{type:"primary",onClick:He,loading:Me.value},{default:o(()=>[s(l,null,{default:o(()=>[s(p($))]),_:1}),a[20]||(a[20]=c(" ÊèêÂèñÂÄôÈÄâÂ∞ÅÈù¢ ",-1))]),_:1},8,["loading"]),a[21]||(a[21]=n("span",{class:"hint-text"},"‰ªéËßÜÈ¢ë‰∏≠Êà™Âèñ6‰∏™Êó∂Èó¥ÁÇπÁöÑÁîªÈù¢‰æõÊÇ®ÈÄâÊã©",-1))])):(d(),t("div",oe,[(d(!0),t(f,null,_(Ce.value,(e,i)=>{return d(),t("div",{key:i,class:y(["cover-item",{selected:ze.value===e.url}]),onClick:a=>{return l=e.url,void(ze.value=l);var l}},[n("img",{src:Ee(e.url),alt:`Â∞ÅÈù¢ÂÄôÈÄâ ${i+1}`},null,8,de),n("div",re,[n("span",ue,v((u=e.time_point,`${Math.floor(u/60)}:${Math.floor(u%60).toString().padStart(2,"0")}`)),1),e.score?(d(),t("span",ne,v(e.score.toFixed(0))+"ÂàÜ",1)):r("",!0)]),ze.value===e.url?(d(),t("div",pe,[s(l,null,{default:o(()=>[s(p(B))]),_:1})])):r("",!0),0===i?(d(),t("div",ce,[...a[22]||(a[22]=[n("span",null,"AIÊé®Ëçê",-1)])])):r("",!0)],10,ie);var u}),128)),n("div",{class:"cover-item add-more",onClick:He},[s(l,{size:"24"},{default:o(()=>[s(p(G))]),_:1}),a[23]||(a[23]=n("span",null,"ÈáçÊñ∞ÊèêÂèñ",-1))])])):(d(),t("div",le,[s(l,null,{default:o(()=>[s(p(M))]),_:1}),a[18]||(a[18]=c(" ËØ∑ÂÖàÈÄâÊã©ËßÜÈ¢ëÊñá‰ª∂ ",-1))]))])):r("",!0),"upload"===Ue.value?(d(),t("div",ve,[s(g,{ref_key:"coverUploadRef",ref:xe,"auto-upload":!0,"show-file-list":!1,"before-upload":Ne,"http-request":Oe,accept:"image/*"},{default:o(()=>[ze.value?(d(),t("div",fe,[n("img",{src:Ee(ze.value),alt:"Ëá™ÂÆö‰πâÂ∞ÅÈù¢"},null,8,_e),n("div",ye,[s(l,{size:"20"},{default:o(()=>[s(p(W))]),_:1}),a[26]||(a[26]=n("span",null,"Êõ¥Êç¢Â∞ÅÈù¢",-1))])])):(d(),t("div",me,[s(l,{size:"32"},{default:o(()=>[s(p(T))]),_:1}),a[24]||(a[24]=n("div",null,"ÁÇπÂáª‰∏ä‰º†Â∞ÅÈù¢ÂõæÁâá",-1)),a[25]||(a[25]=n("div",{class:"tip"},"ÊîØÊåÅ JPG„ÄÅPNG„ÄÅWebP Ê†ºÂºè",-1))]))]),_:1},512)])):r("",!0),"auto"===Ue.value?(d(),t("div",ge,[s(l,{size:"20",color:"#67c23a"},{default:o(()=>[s(p(q))]),_:1}),a[27]||(a[27]=n("span",null,"Á≥ªÁªüÂ∞Ü‰ΩøÁî® AI Êô∫ËÉΩÂàÜÊûêÔºåËá™Âä®ÈÄâÊã©ÊúÄ‰Ω≥Â∞ÅÈù¢Â∏ß",-1))])):r("",!0)])]),_:1}),s(h,{label:"ËßÜÈ¢ëÊ†áÈ¢ò",prop:"title"},{default:o(()=>[s(We,{modelValue:Fe.title,"onUpdate:modelValue":a[1]||(a[1]=e=>Fe.title=e),placeholder:"ËØ∑ËæìÂÖ•ËßÜÈ¢ëÊ†áÈ¢ò",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(h,{label:"ËßÜÈ¢ëÊèèËø∞",prop:"description"},{default:o(()=>[s(We,{modelValue:Fe.description,"onUpdate:modelValue":a[2]||(a[2]=e=>Fe.description=e),type:"textarea",placeholder:"ËØ∑ËæìÂÖ•ËßÜÈ¢ëÊèèËø∞",rows:4,maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(h,{label:"ËßÜÈ¢ëÂàÜÁ±ª",prop:"category_id"},{default:o(()=>[s(Je,{modelValue:$e.value,"onUpdate:modelValue":a[3]||(a[3]=e=>$e.value=e),options:Be.value,props:{value:"id",label:"name",children:"children",emitPath:!1,checkStrictly:!0},placeholder:"ËØ∑ÈÄâÊã©ÂàÜÁ±ª",style:{width:"100%"},clearable:"",onChange:Te},null,8,["modelValue","options"])]),_:1}),s(h,{label:"ËßÜÈ¢ëÊ†áÁ≠æ"},{default:o(()=>[s(Ze,{modelValue:Fe.tags,"onUpdate:modelValue":a[4]||(a[4]=e=>Fe.tags=e),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"ËæìÂÖ•ÊàñÈÄâÊã©Ê†áÁ≠æ",style:{width:"100%"}},{default:o(()=>[(d(!0),t(f,null,_(qe.value,e=>(d(),u(Le,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(h,{label:"‰ªòË¥πËÆæÁΩÆ"},{default:o(()=>[s(Ve,{modelValue:Fe.pay_type,"onUpdate:modelValue":a[5]||(a[5]=e=>Fe.pay_type=e)},{default:o(()=>[s(N,{label:"free"},{default:o(()=>[...a[28]||(a[28]=[c("ÂÖçË¥π",-1)])]),_:1}),s(N,{label:"coins"},{default:o(()=>[...a[29]||(a[29]=[c("ÈáëÂ∏Å‰ªòË¥π",-1)])]),_:1}),s(N,{label:"vip_free"},{default:o(()=>[...a[30]||(a[30]=[c("VIPÂÖçË¥π",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"free"!==Fe.pay_type?(d(),u(h,{key:0,label:"Èùû‰ºöÂëò‰ª∑Ê†º"},{default:o(()=>[s(Xe,{modelValue:Fe.coin_price,"onUpdate:modelValue":a[6]||(a[6]=e=>Fe.coin_price=e),min:1,max:99999,placeholder:"ÈáëÂ∏ÅÊï∞Èáè"},null,8,["modelValue"]),a[31]||(a[31]=n("span",{class:"input-tip"},"ÈùûVIPÁî®Êà∑ÈúÄÊîØ‰ªòÁöÑÈáëÂ∏ÅÊï∞",-1))]),_:1})):r("",!0),"coins"===Fe.pay_type?(d(),u(h,{key:1,label:"VIP‰ºöÂëò‰ª∑Ê†º"},{default:o(()=>[s(Xe,{modelValue:Fe.vip_coin_price,"onUpdate:modelValue":a[7]||(a[7]=e=>Fe.vip_coin_price=e),min:0,max:99999,placeholder:"VIP‰ºòÊÉ†‰ª∑Ê†º"},null,8,["modelValue"]),a[32]||(a[32]=n("span",{class:"input-tip"},"VIP‰ºöÂëò‰ºòÊÉ†‰ª∑Ê†ºÔºå0‰∏∫VIPÂÖçË¥π",-1))]),_:1})):r("",!0),"vip_free"===Fe.pay_type?(d(),u(h,{key:2,label:"VIPÁ≠âÁ∫ßË¶ÅÊ±Ç"},{default:o(()=>[s(Ze,{modelValue:Fe.vip_free_level,"onUpdate:modelValue":a[8]||(a[8]=e=>Fe.vip_free_level=e),style:{width:"200px"}},{default:o(()=>[s(Le,{value:1,label:"ÊôÆÈÄöVIP"}),s(Le,{value:2,label:"VIP1"}),s(Le,{value:3,label:"VIP2"}),s(Le,{value:4,label:"VIP3"}),s(Le,{value:5,label:"ÈªÑÈáëËá≥Â∞ä"})]),_:1},8,["modelValue"])]),_:1})):r("",!0),"free"!==Fe.pay_type?(d(),u(h,{key:3,label:"ËØïÁúãÊó∂Èïø"},{default:o(()=>[s(Xe,{modelValue:Fe.free_preview_seconds,"onUpdate:modelValue":a[9]||(a[9]=e=>Fe.free_preview_seconds=e),min:0,max:300,step:5},null,8,["modelValue"]),a[33]||(a[33]=n("span",{class:"input-tip"},"ÁßíÔºå0Ë°®Á§∫‰∏çÂÖÅËÆ∏ËØïÁúã",-1))]),_:1})):r("",!0),s(h,{label:"VIP‰∏ì‰∫´"},{default:o(()=>[s(Ye,{modelValue:Fe.is_vip_only,"onUpdate:modelValue":a[10]||(a[10]=e=>Fe.is_vip_only=e)},null,8,["modelValue"]),a[34]||(a[34]=n("span",{class:"switch-tip"},"ÂºÄÂêØÂêé‰ªÖVIPÁî®Êà∑ÂèØËßÇÁúãÔºà‰ºòÂÖà‰∫é‰ªòË¥πËÆæÁΩÆÔºâ",-1))]),_:1}),s(h,null,{default:o(()=>[s(i,{type:"primary",onClick:Qe,loading:je.value,size:"large"},{default:o(()=>[s(l,null,{default:o(()=>[s(p(T))]),_:1}),c(" "+v(je.value?"‰∏ä‰º†‰∏≠...":"ÂºÄÂßã‰∏ä‰º†"),1)]),_:1},8,["loading"]),s(i,{onClick:a[11]||(a[11]=a=>e.$router.back()),size:"large"},{default:o(()=>[...a[35]||(a[35]=[c("ÂèñÊ∂à",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),je.value?(d(),t("div",he,[s(aa,{percentage:Pe.value,"stroke-width":20,"text-inside":!0},null,8,["percentage"]),n("p",be,v(Ie.value),1)])):r("",!0)]),_:1})])}}},[["__scopeId","data-v-cf5949ae"]]);export{Ve as default};
