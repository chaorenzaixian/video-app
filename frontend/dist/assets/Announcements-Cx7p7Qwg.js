/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                             *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                   *//* empty css               */import{_ as e,a}from"./index-C3P4JTuA.js";import{be as t,bk as l,bh as o,bi as d,bj as s,aM as n,br as r,bs as i,bI as u,aQ as p,aR as c,aS as m,aT as _,bv as v,bo as f,bD as b,aL as w,E as y}from"./element-plus-DlIn_qXi.js";import{r as h,l as k,j,y as V,O as g,F as x,ai as C,z as U,G as D,E as I,I as S,L as Y,K as z,C as H}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const L={class:"announcements-page"},M={class:"card-header"},O={key:0},q={key:1,class:"text-muted"},A=e({__name:"Announcements",setup(e){const A=h(!1),E=h(!1),F=h([]),G=h(!1),R=h(!1),T=h(null),$=h(null),K=k({content:"",link:"",sort_order:0,is_active:!0,start_date:null,end_date:null}),N={content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]},P=async()=>{A.value=!0;try{const e=await a.get("/ads/announcements/admin");F.value=e.data}catch(e){}finally{A.value=!1}},Q=e=>e?w(e).format("YYYY-MM-DD HH:mm"):"-",B=()=>{R.value=!1,T.value=null,K.content="",K.link="",K.sort_order=0,K.is_active=!0,K.start_date=null,K.end_date=null,G.value=!0},J=async()=>{$.value&&await $.value.validate(async e=>{if(e){E.value=!0;try{const e={content:K.content,link:K.link||null,sort_order:K.sort_order,is_active:K.is_active,start_date:K.start_date?w(K.start_date).toISOString():null,end_date:K.end_date?w(K.end_date).toISOString():null};R.value&&T.value?(await a.put(`/ads/announcements/${T.value}`,e),y.success("更新成功")):(await a.post("/ads/announcements",e),y.success("添加成功")),G.value=!1,P()}catch(t){y.error("保存失败")}finally{E.value=!1}}})};return j(()=>{P()}),(e,w)=>{const h=C("Plus"),k=p,j=n,W=d,X=s,Z=r,ee=o,ae=u,te=t,le=_,oe=m,de=v,se=f,ne=b,re=c,ie=l,ue=i;return U(),V("div",L,[g(te,null,{header:x(()=>[H("div",M,[w[9]||(w[9]=H("span",null,"公告管理",-1)),g(j,{type:"primary",onClick:B},{default:x(()=>[g(k,null,{default:x(()=>[g(h)]),_:1}),w[8]||(w[8]=z("添加公告 ",-1))]),_:1})])]),default:x(()=>[D((U(),I(ee,{data:F.value,stripe:""},{default:x(()=>[g(W,{prop:"id",label:"ID",width:"80"}),g(W,{prop:"content",label:"公告内容","min-width":"300","show-overflow-tooltip":""}),g(W,{prop:"link",label:"跳转链接",width:"200","show-overflow-tooltip":""},{default:x(({row:e})=>[e.link?(U(),V("span",O,Y(e.link),1)):(U(),V("span",q,"-"))]),_:1}),g(W,{prop:"sort_order",label:"排序",width:"80"}),g(W,{label:"状态",width:"100"},{default:x(({row:e})=>[g(X,{type:e.is_active?"success":"info",size:"small"},{default:x(()=>[z(Y(e.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),g(W,{label:"开始时间",width:"160"},{default:x(({row:e})=>[z(Y(Q(e.start_date)),1)]),_:1}),g(W,{label:"结束时间",width:"160"},{default:x(({row:e})=>[z(Y(Q(e.end_date)),1)]),_:1}),g(W,{label:"创建时间",width:"160"},{default:x(({row:e})=>[z(Y(Q(e.created_at)),1)]),_:1}),g(W,{label:"操作",width:"150",fixed:"right"},{default:x(({row:e})=>[g(j,{link:"",type:"primary",onClick:a=>(e=>{R.value=!0,T.value=e.id,K.content=e.content,K.link=e.link||"",K.sort_order=e.sort_order,K.is_active=e.is_active,K.start_date=e.start_date?new Date(e.start_date):null,K.end_date=e.end_date?new Date(e.end_date):null,G.value=!0})(e)},{default:x(()=>[...w[10]||(w[10]=[z("编辑",-1)])]),_:1},8,["onClick"]),g(Z,{title:"确定删除这条公告吗？",onConfirm:t=>(async e=>{try{await a.delete(`/ads/announcements/${e}`),y.success("删除成功"),P()}catch(t){y.error("删除失败")}})(e.id)},{reference:x(()=>[g(j,{link:"",type:"danger"},{default:x(()=>[...w[11]||(w[11]=[z("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[ue,A.value]]),A.value||0!==F.value.length?S("",!0):(U(),I(ae,{key:0,description:"暂无公告"}))]),_:1}),g(ie,{modelValue:G.value,"onUpdate:modelValue":w[7]||(w[7]=e=>G.value=e),title:R.value?"编辑公告":"添加公告",width:"550px","destroy-on-close":""},{footer:x(()=>[g(j,{onClick:w[6]||(w[6]=e=>G.value=!1)},{default:x(()=>[...w[12]||(w[12]=[z("取消",-1)])]),_:1}),g(j,{type:"primary",onClick:J,loading:E.value},{default:x(()=>[...w[13]||(w[13]=[z("保存",-1)])]),_:1},8,["loading"])]),default:x(()=>[g(re,{model:K,"label-width":"100px",rules:N,ref_key:"formRef",ref:$},{default:x(()=>[g(oe,{label:"公告内容",prop:"content"},{default:x(()=>[g(le,{modelValue:K.content,"onUpdate:modelValue":w[0]||(w[0]=e=>K.content=e),type:"textarea",rows:4,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1}),g(oe,{label:"跳转链接"},{default:x(()=>[g(le,{modelValue:K.link,"onUpdate:modelValue":w[1]||(w[1]=e=>K.link=e),placeholder:"点击公告跳转的链接（可选）"},null,8,["modelValue"])]),_:1}),g(oe,{label:"排序"},{default:x(()=>[g(de,{modelValue:K.sort_order,"onUpdate:modelValue":w[2]||(w[2]=e=>K.sort_order=e),min:0,max:9999,placeholder:"数字越大越靠前"},null,8,["modelValue"])]),_:1}),g(oe,{label:"状态"},{default:x(()=>[g(se,{modelValue:K.is_active,"onUpdate:modelValue":w[3]||(w[3]=e=>K.is_active=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),g(oe,{label:"开始时间"},{default:x(()=>[g(ne,{modelValue:K.start_date,"onUpdate:modelValue":w[4]||(w[4]=e=>K.start_date=e),type:"datetime",placeholder:"选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),g(oe,{label:"结束时间"},{default:x(()=>[g(ne,{modelValue:K.end_date,"onUpdate:modelValue":w[5]||(w[5]=e=>K.end_date=e),type:"datetime",placeholder:"选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-f3887bf2"]]);export{A as default};
