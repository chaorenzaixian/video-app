import{r as a,c as l,j as e,y as s,C as t,I as c,E as n,L as i,M as o,aa as u,aC as r,u as v,H as m,U as d,V as p,G as g,af as k,K as b,a0 as y,az as h,z as _}from"./vue-vendor-Ba_vealp.js";import{_ as f}from"./ic_back-BPdSG6fy.js";import{_ as C}from"./super_vip_blue-CukdgMfT.js";import{_ as w}from"./ic_launcher-GoPvjxRC.js";import{_ as $,a as x}from"./index-C3P4JTuA.js";import{l as j,a as M,c as D,p as S,s as U,r as I}from"./comment-DVVGXtEs.js";import{c as z,a as L,s as P}from"./share_grey-BZsozF2Q.js";import{V as R}from"./vip-C8N2TCfr.js";import{E as q}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const E={class:"gallery-detail-page"},G={class:"top-header"},T={class:"page-title"},V={key:0,class:"loading-state"},F={key:1,class:"content-area"},H={class:"images-grid"},J=["onClick"],Y=["src","alt"],A={key:0,class:"unlock-section"},B={class:"unlock-text"},K={key:2,class:"error-state"},O={key:3,class:"action-bar"},W=["src"],N={class:"action-text"},Q=["src"],X={class:"action-text"},Z=["src"],aa={class:"action-text"},la=["src"],ea={key:4,class:"preview-modal"},sa={class:"preview-content"},ta=["src"],ca={class:"preview-index"},na={key:2,class:"zoom-hint"},ia={class:"comments-panel"},oa={class:"comments-header"},ua={class:"comment-count"},ra={class:"sort-tabs"},va={class:"comments-list"},ma={key:0,class:"comment-item official-announcement"},da=["src"],pa={class:"comment-body"},ga={class:"comment-user"},ka={class:"official-name"},ba={class:"comment-text official-text"},ya={class:"comment-footer"},ha={class:"comment-time"},_a={key:1,class:"no-comments"},fa=["src","onClick"],Ca={class:"comment-body"},wa={class:"comment-user"},$a=["onClick"],xa=["src"],ja={class:"comment-text"},Ma=["onClick"],Da=["src"],Sa={class:"comment-footer"},Ua={class:"comment-time"},Ia={class:"comment-actions"},za=["onClick"],La=["onClick"],Pa=["src"],Ra={key:2,class:"no-more"},qa={class:"comment-toolbar"},Ea={class:"toolbar-left"},Ga=["src"],Ta=["src"],Va={class:"input-panel"},Fa={class:"input-panel-header"},Ha=["disabled"],Ja={class:"input-panel-body"},Ya={class:"char-counter"},Aa={key:0,class:"image-preview"},Ba=["src"],Ka={class:"input-panel-footer"},Oa={class:"footer-left"},Wa=["src"],Na={key:0,class:"emoji-panel"},Qa=["onClick"],Xa={class:"comment-image-preview-content"},Za=["src"],al={class:"share-modal-content"},ll={class:"share-promo-image"},el=["src"],sl={class:"share-qr-section"},tl={class:"share-qrcode"},cl=["src"],nl={class:"share-invite-info"},il={class:"invite-code"},ol={class:"official-url"},ul=$({__name:"GalleryDetail",setup($){const ul=h(),rl=r(),vl=a(!0),ml=a(null),dl=a([]),pl=a(!1),gl=a(0),kl=a(1),bl=a(0),yl=a(0),hl=a(!1),_l=a([]),fl=a(""),Cl=a("hot"),wl=a(null),$l=a(!1),xl=a(!1),jl=a(null),Ml=a(""),Dl=a(null),Sl=a(null),Ul=["ğŸ˜€","ğŸ˜‚","ğŸ¤£","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜‹","ğŸ¤¤","ğŸ˜","ğŸ¤©","ğŸ˜","ğŸ˜’","ğŸ˜","ğŸ˜¢","ğŸ˜­","ğŸ˜¤","ğŸ˜¡","ğŸ¤¬","ğŸ˜±","ğŸ˜¨","ğŸ¥º","ğŸ˜‡","ğŸ¤—","ğŸ¤”","ğŸ¤«","ğŸ¤­","ğŸ™„","ğŸ˜´","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ‘","ğŸ‘","ğŸ‘","ğŸ™Œ","ğŸ’ª","ğŸ¤","â¤ï¸","ğŸ’”","ğŸ’¯","ğŸ”¥","â­","ğŸ‰","ğŸŠ","ğŸ’","ğŸŒ¹","ğŸ€"],Il=l(()=>{var a;return!0===(null==(a=ml.value)?void 0:a.is_vip)}),zl=l(()=>{const a=dl.value||[];return Il.value?a:a.slice(0,5)}),Ll=l(()=>{const a=dl.value||[];return Il.value?a:a.slice(0,5)}),Pl=l(()=>({transform:`translate(${bl.value}px, ${yl.value}px) scale(${kl.value})`,transition:1===kl.value?"transform 0.3s":"none"})),Rl=()=>{pl.value=!1,Gl()},ql=()=>{gl.value>0&&(gl.value--,Gl())},El=()=>{gl.value<Ll.value.length-1&&(gl.value++,Gl())},Gl=()=>{kl.value=1,bl.value=0,yl.value=0},Tl=()=>{kl.value>1?Gl():kl.value=2.5},Vl=a=>{const l=a.deltaY>0?-.3:.3;kl.value=Math.max(1,Math.min(5,kl.value+l)),1===kl.value&&Gl()},Fl=async()=>{try{const a=await x.post(`/gallery-novel/gallery/${ml.value.id}/like`);ml.value.is_liked=a.data.liked,ml.value.like_count=a.data.like_count}catch(a){q.error("æ“ä½œå¤±è´¥")}},Hl=async()=>{try{const a=await x.post(`/gallery-novel/gallery/${ml.value.id}/collect`);ml.value.is_collected=a.data.collected,a.data.collected?ml.value.collect_count=(ml.value.collect_count||0)+1:ml.value.collect_count=Math.max(0,(ml.value.collect_count||0)-1),q.success(a.data.collected?"æ”¶è—æˆåŠŸ":"å·²å–æ¶ˆæ”¶è—")}catch(a){q.error("æ“ä½œå¤±è´¥")}},Jl=async()=>{hl.value=!0,await Promise.all([Al(),Bl()])},Yl=()=>{hl.value=!1},Al=async()=>{try{const a=await x.get(`/gallery-novel/gallery/${ml.value.id}/comments`);_l.value=a.data||[]}catch(a){_l.value=[]}},Bl=async()=>{try{const a=await x.get("/settings/comment-announcement");wl.value=a.data||a}catch(a){}},Kl=async()=>{var a,l;if(fl.value.trim()||jl.value)try{let a;if(jl.value){const l=new FormData;l.append("content",fl.value||""),l.append("image",jl.value),a=await x.post(`/gallery-novel/gallery/${ml.value.id}/comment`,l,{headers:{"Content-Type":"multipart/form-data"}})}else a=await x.post(`/gallery-novel/gallery/${ml.value.id}/comment`,{content:fl.value});fl.value="",jl.value=null,Ml.value="",$l.value=!1,xl.value=!1,await Al(),ml.value.comment_count=(ml.value.comment_count||0)+1,q.success("è¯„è®ºæˆåŠŸ")}catch(e){q.error((null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.detail)||"è¯„è®ºå¤±è´¥")}},Ol=()=>{$l.value=!0,xl.value=!1,setTimeout(()=>{var a;return null==(a=Sl.value)?void 0:a.focus()},100)},Wl=()=>{$l.value=!1,xl.value=!1},Nl=()=>{$l.value?xl.value=!xl.value:($l.value=!0,setTimeout(()=>{xl.value=!0},100))},Ql=()=>{var a;null==(a=Dl.value)||a.click()},Xl=a=>{var l;const e=null==(l=a.target.files)?void 0:l[0];if(e){if(e.size>5242880)return void q.warning("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");jl.value=e,Ml.value=URL.createObjectURL(e),$l.value||Ol()}a.target.value=""},Zl=()=>{jl.value=null,Ml.value=""},ae=a(""),le=a(!1),ee=()=>{le.value=!1,ae.value=""},se=a=>{if(!a)return"";const l=new Date(a),e=(new Date-l)/1e3;return e<60?"åˆšåˆš":e<3600?Math.floor(e/60)+"åˆ†é’Ÿå‰":e<86400?Math.floor(e/3600)+"å°æ—¶å‰":l.toLocaleDateString()},te=a=>{if(!a)return"";const l=new Date(a);return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`},ce=()=>rl.push("/user/vip"),ne=()=>{rl.push("/user/community?tab=gallery")},ie=a(!1),oe=a("3AUUHR"),ue=l(()=>window.location.origin.replace(/^https?:\/\//,"")),re=l(()=>{var a;return`${window.location.origin}/user/gallery/${null==(a=ml.value)?void 0:a.id}?ref=${oe.value}`}),ve=l(()=>`https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(re.value)}`),me=()=>{ie.value=!0},de=()=>{navigator.clipboard.writeText(re.value).then(()=>{q.success("åˆ†äº«é“¾æ¥å·²å¤åˆ¶ï¼Œåˆ†äº«ç»™å¥½å‹æ³¨å†Œåå¯è·å¾—3æ—¥VIP")}).catch(()=>{q.info("è¯·å¤åˆ¶é“¾æ¥åˆ†äº«ï¼š"+re.value)})},pe=()=>{q.info("é•¿æŒ‰å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œ")},ge=(a,l)=>{if(a)return a;return(a=>{const l=a%52;if(l<17)return`/images/avatars/icon_avatar_${l+1}.webp`;if(l<32)return`/images/avatars/DM_20251217202131_${String(l-17+1).padStart(3,"0")}.JPEG`;return`/images/avatars/DM_20251217202341_${String(l-32+1).padStart(3,"0")}.JPEG`})(parseInt(l)||1)},ke=a(null),be=a=>{a&&rl.push(`/user/profile/${a}`)};return e(()=>(async()=>{vl.value=!0;try{const a=ul.params.id,l=await x.get(`/gallery-novel/gallery/${a}`),e=l.data||l;ml.value=e,dl.value=e.images||[]}catch(a){q.error("è·å–å›¾é›†è¯¦æƒ…å¤±è´¥")}finally{vl.value=!1}})()),(a,l)=>{var e,r,h,$;return _(),s("div",E,[t("header",G,[t("button",{class:"back-btn",onClick:ne},[...l[5]||(l[5]=[t("img",{src:f,alt:"è¿”å›",class:"back-icon"},null,-1)])]),t("h1",T,i(null==(e=ml.value)?void 0:e.title)+"("+i(null==(r=ml.value)?void 0:r.image_count)+"P)",1),l[6]||(l[6]=t("div",{class:"header-right"},null,-1))]),vl.value?(_(),s("div",V,[...l[7]||(l[7]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"åŠ è½½ä¸­...",-1)])])):ml.value?(_(),s("div",F,[t("div",H,[(_(!0),s(o,null,u(zl.value,(a,l)=>(_(),s("div",{key:l,class:"image-item",onClick:a=>(a=>{Il.value?(gl.value=a,pl.value=!0,Gl()):q.warning("è¯·å…ˆè§£é”å³å¯æŸ¥çœ‹å¤§å›¾")})(l)},[t("img",{src:a,alt:"å›¾ç‰‡"+(l+1)},null,8,Y)],8,J))),128))]),!Il.value&&ml.value.image_count>5?(_(),s("div",A,[t("p",B,"å…¨æœ¬å®Œæ•´ä½œå“å…±"+i(ml.value.image_count)+"å¼ ",1),t("a",{class:"unlock-link",onClick:ce},"å¼€é€šä¼šå‘˜è§£é”"),l[8]||(l[8]=t("div",{class:"unlock-tip"},"è¯·å…ˆè§£é”å³å¯æŸ¥çœ‹å¤§å›¾",-1))])):c("",!0)])):(_(),s("div",K,[l[9]||(l[9]=t("p",null,"å›¾é›†ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤",-1)),t("button",{class:"back-btn-large",onClick:ne},"è¿”å›")])),ml.value?(_(),s("div",O,[t("button",{class:m(["action-btn",{active:ml.value.is_liked}]),onClick:Fl},[t("img",{src:ml.value.is_liked?v(j):v(M),class:"action-icon"},null,8,W),t("span",N,i(ml.value.like_count||0),1)],2),t("button",{class:"action-btn",onClick:Jl},[t("img",{src:v(D),class:"action-icon"},null,8,Q),t("span",X,i(ml.value.comment_count||0),1)]),t("button",{class:m(["action-btn",{active:ml.value.is_collected}]),onClick:Hl},[t("img",{src:ml.value.is_collected?v(z):v(L),class:"action-icon"},null,8,Z),t("span",aa,i(ml.value.collect_count||0),1)],2),t("button",{class:"action-btn",onClick:me},[t("img",{src:v(P),class:"action-icon"},null,8,la),l[10]||(l[10]=t("span",{class:"action-text"},"åˆ†äº«",-1))])])):c("",!0),pl.value?(_(),s("div",ea,[t("div",sa,[t("div",{class:"image-container",onDblclick:Tl,onWheel:d(Vl,["prevent"])},[t("img",{src:Ll.value[gl.value],alt:"é¢„è§ˆ",style:p(Pl.value)},null,12,ta)],32),t("div",ca,i(gl.value+1)+" / "+i(Ll.value.length),1),t("button",{class:"close-btn",onClick:Rl},"Ã—"),gl.value>0?(_(),s("button",{key:0,class:"nav-btn prev",onClick:ql},[...l[11]||(l[11]=[t("img",{src:f,alt:"è¿”å›",class:"back-icon"},null,-1)])])):c("",!0),gl.value<Ll.value.length-1?(_(),s("button",{key:1,class:"nav-btn next",onClick:El},"â€º")):c("",!0),kl.value>1?(_(),s("div",na,i(Math.round(100*kl.value))+"%",1)):c("",!0)])])):c("",!0),hl.value?(_(),s("div",{key:5,class:"comments-modal",onClick:d(Yl,["self"])},[t("div",ia,[l[16]||(l[16]=t("div",{class:"drag-handle"},null,-1)),t("div",oa,[t("span",ua,i(_l.value.length)+"æ¡è¯„è®º",1),t("div",ra,[t("span",{class:m(["sort-tab",{active:"hot"===Cl.value}]),onClick:l[0]||(l[0]=a=>Cl.value="hot")},"æ¨è",2),l[12]||(l[12]=t("span",{class:"sort-divider"},"|",-1)),t("span",{class:m(["sort-tab",{active:"new"===Cl.value}]),onClick:l[1]||(l[1]=a=>Cl.value="new")},"æœ€æ–°",2)])]),t("div",va,[wl.value&&wl.value.enabled?(_(),s("div",ma,[t("img",{src:wl.value.avatar||"/images/avatars/icon_avatar_1.webp",class:"comment-avatar"},null,8,da),t("div",pa,[t("div",ga,[t("span",ka,i(wl.value.name),1),l[13]||(l[13]=t("img",{src:C,class:"supreme-vip-icon"},null,-1))]),t("div",ba,i(wl.value.content),1),t("div",ya,[t("span",ha,i(te(wl.value.updated_at)),1)])])])):c("",!0),0!==_l.value.length||wl.value&&wl.value.enabled?c("",!0):(_(),s("div",_a,"æš‚æ— è¯„è®º")),(_(!0),s(o,null,u(_l.value,a=>{return _(),s("div",{key:a.id,class:"comment-item"},[t("img",{src:ge(a.user_avatar,a.user_id),class:"comment-avatar clickable",onClick:l=>be(a.user_id)},null,8,fa),t("div",Ca,[t("div",wa,[t("span",{class:"username clickable",onClick:l=>be(a.user_id)},i(a.user_nickname||"ç”¨æˆ·"),9,$a),a.user_vip_level>0?(_(),s("img",{key:0,src:(l=a.user_vip_level,R[l]||""),class:"vip-badge-sm"},null,8,xa)):c("",!0)]),t("div",ja,i(a.content),1),a.image_url?(_(),s("div",{key:0,class:"comment-image",onClick:l=>{return e=a.image_url,ae.value=e,void(le.value=!0);var e}},[t("img",{src:a.image_url,alt:"è¯„è®ºå›¾ç‰‡"},null,8,Da)],8,Ma)):c("",!0),t("div",Sa,[t("span",Ua,i(se(a.created_at)),1),t("div",Ia,[t("span",{class:m(["comment-like",{liked:a.is_liked}]),onClick:l=>(async a=>{try{const l=await x.post(`/gallery-novel/comment/${a.id}/like`);a.is_liked=l.data.liked,a.like_count=l.data.like_count}catch(l){q.error("æ“ä½œå¤±è´¥")}})(a)},i(a.is_liked?"â¤ï¸":"ğŸ¤")+" "+i(a.like_count||0),11,za),t("span",{class:"comment-reply",onClick:l=>(a=>{ke.value=a,fl.value=`@${a.user_nickname||"ç”¨æˆ·"} `,Ol()})(a)},[t("img",{src:v(I),class:"reply-icon"},null,8,Pa)],8,La)])])])]);var l}),128)),_l.value.length>0?(_(),s("div",Ra,"æ²¡æœ‰æ›´å¤šæ•°æ®äº†")):c("",!0)]),t("div",{class:"comment-input-trigger",onClick:Ol},[...l[14]||(l[14]=[t("span",{class:"input-placeholder"},"åœ¨è¿™é‡Œå†™ä¸‹ä½ æƒ³è¯´çš„...",-1),t("span",{class:"char-count"},"0/500",-1)])]),t("div",qa,[t("div",Ea,[t("button",{class:"toolbar-btn",onClick:Ql},[t("img",{src:v(S),class:"toolbar-icon"},null,8,Ga)]),t("button",{class:"toolbar-btn",onClick:Nl},[...l[15]||(l[15]=[t("span",{class:"emoji-icon"},"ğŸ˜Š",-1)])])]),t("button",{class:"toolbar-send",onClick:Ol},[t("img",{src:v(U),class:"send-icon"},null,8,Ta)])])])])):c("",!0),$l.value?(_(),s("div",{key:6,class:"input-panel-modal",onClick:d(Wl,["self"])},[t("div",Va,[t("div",Fa,[t("button",{class:"cancel-btn",onClick:Wl},"å–æ¶ˆ"),l[17]||(l[17]=t("span",{class:"panel-title"},"å‘è¡¨è¯„è®º",-1)),t("button",{class:"submit-btn",disabled:!fl.value.trim()&&!jl.value,onClick:Kl},"å‘é€",8,Ha)]),t("div",Ja,[g(t("textarea",{"onUpdate:modelValue":l[2]||(l[2]=a=>fl.value=a),class:"full-input",placeholder:"åœ¨è¿™é‡Œå†™ä¸‹ä½ æƒ³è¯´çš„...",maxlength:"500",ref_key:"textareaRef",ref:Sl},null,512),[[k,fl.value]]),t("div",Ya,i(fl.value.length)+"/500",1),jl.value?(_(),s("div",Aa,[t("img",{src:Ml.value,alt:"é¢„è§ˆ"},null,8,Ba),t("button",{class:"remove-image",onClick:Zl},"Ã—")])):c("",!0)]),t("div",Ka,[t("div",Oa,[t("button",{class:"footer-btn",onClick:Ql},[t("img",{src:v(S),class:"footer-icon"},null,8,Wa)]),t("button",{class:"footer-btn",onClick:Nl},[...l[18]||(l[18]=[t("span",{class:"emoji-icon"},"ğŸ˜Š",-1)])])])]),xl.value?(_(),s("div",Na,[(_(),s(o,null,u(Ul,a=>t("span",{key:a,class:"emoji-item",onClick:l=>(a=>{fl.value+=a})(a)},i(a),9,Qa)),64))])):c("",!0)])])):c("",!0),le.value?(_(),s("div",{key:7,class:"comment-image-preview-modal",onClick:ee},[t("div",Xa,[t("img",{src:ae.value,alt:"è¯„è®ºå›¾ç‰‡"},null,8,Za),t("button",{class:"close-preview-btn",onClick:d(ee,["stop"])},"Ã—")])])):c("",!0),(_(),n(y,{to:"body"},[ie.value?(_(),s("div",{key:0,class:"share-modal-overlay",onClick:l[4]||(l[4]=d(a=>ie.value=!1,["self"]))},[t("div",al,[t("button",{class:"share-modal-close",onClick:l[3]||(l[3]=a=>ie.value=!1)},"Ã—"),l[20]||(l[20]=t("div",{class:"share-header"},[t("img",{src:w,alt:"Logo",class:"share-logo"}),t("div",{class:"share-title-info"},[t("h3",{class:"share-site-name"},"Soulæˆäººç‰ˆ"),t("p",{class:"share-site-desc"},"å…¨ç½‘æœ€å…¨æˆäººè§†é¢‘å¹³å°")])],-1)),t("div",ll,[t("img",{src:(null==($=null==(h=ml.value)?void 0:h.images)?void 0:$[0])||"/images/default-cover.webp",alt:"æ¨å¹¿å›¾"},null,8,el)]),t("div",sl,[t("div",tl,[t("img",{src:ve.value,alt:"äºŒç»´ç "},null,8,cl)]),t("div",nl,[t("div",il,[l[19]||(l[19]=b("é‚€è¯·ç  ",-1)),t("span",null,i(oe.value),1)]),t("div",ol,"å®˜æ–¹ç½‘å€:"+i(ue.value),1)])]),t("div",{class:"share-actions"},[t("button",{class:"copy-link-btn",onClick:de},"å¤åˆ¶é“¾æ¥"),t("button",{class:"save-image-btn",onClick:pe},"ä¿å­˜å›¾ç‰‡")])])])):c("",!0)])),t("input",{type:"file",ref_key:"imageInput",ref:Dl,accept:"image/*",style:{display:"none"},onChange:Xl},null,544)])}}},[["__scopeId","data-v-ea13df0a"]]);export{ul as default};
