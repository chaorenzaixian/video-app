/* empty css             *//* empty css                 *//* empty css                       *//* empty css                   *//* empty css                     *//* empty css                    *//* empty css                 *//* empty css                        *//* empty css                    *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                             *//* empty css                  *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";import{bz as e,bk as a,bA as l,aM as t,aQ as o,a6 as i,bh as s,bi as r,bj as d,aT as u,bl as n,bm as p,bD as c,bt as m,aR as _,aS as g,bv as b,aU as v,bf as f,by as h,a as w,E as y}from"./element-plus-DlIn_qXi.js";import{_ as V,a as k}from"./index-C3P4JTuA.js";import{r as x,l as z,j as C,y as U,C as j,O as S,F as $,z as D,K as E,u as I,L as R,E as M,I as H,H as P}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const F={class:"admin-page"},K={class:"tab-header"},T={class:"coins-text"},q={key:0,class:"bonus-text"},A={key:1,class:"text-gray"},B={class:"tab-header"},G={key:0,class:"bonus-text"},J={class:"price-text"},L={class:"tab-header"},O={class:"coins-text"},Q={class:"coins-text"},Y={class:"trans-header"},N={class:"coins-text"},W=V({__name:"CoinsManage",setup(V){const W=x("packages"),X=x([]),Z=z({visible:!1,isEdit:!1}),ee=x({name:"",coins:100,bonus_coins:0,price:10,original_price:null,tag:"",sort_order:0,is_hot:!1,is_first_charge:!1,is_active:!0}),ae=x([]),le=z({keyword:"",status:"",dateRange:null}),te=z({page:1,pageSize:20,total:0}),oe=x([]),ie=z({keyword:""}),se=z({page:1,pageSize:20,total:0}),re=z({visible:!1,user:null}),de=x({type:"add",amount:0,reason:""}),ue=z({visible:!1,user:null}),ne=x([]),pe=z({page:1,pageSize:10,total:0}),ce=e=>({pending:"待支付",paid:"已支付",failed:"已失败"}[e]||e),me=e=>{if(!e)return"-";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},_e=async()=>{try{const e=await k.get("/admin/recharge-packages");X.value=e.data||[]}catch(e){X.value=[{id:1,name:"体验包",coins:60,bonus_coins:0,price:6,tag:"体验",sort_order:1,is_active:!0},{id:2,name:"超值套餐",coins:300,bonus_coins:50,price:30,tag:"热门",is_hot:!0,sort_order:2,is_active:!0},{id:3,name:"首充礼包",coins:100,bonus_coins:100,price:6,original_price:10,tag:"首充2倍",is_first_charge:!0,sort_order:0,is_active:!0}]}},ge=async()=>{var e,a;try{const l=await k.get("/admin/recharge-orders",{params:{page:te.page}});ae.value=(null==(e=l.data)?void 0:e.items)||[],te.total=(null==(a=l.data)?void 0:a.total)||0}catch(l){ae.value=[]}},be=async()=>{var e,a;try{const l=await k.get("/admin/user-coins",{params:{search:ie.keyword,page:se.page}});oe.value=(null==(e=l.data)?void 0:e.items)||[],se.total=(null==(a=l.data)?void 0:a.total)||0}catch(l){oe.value=[]}},ve=(e=null)=>{Z.isEdit=!!e,ee.value=e?{...e}:{name:"",coins:100,bonus_coins:0,price:10,original_price:null,tag:"",sort_order:0,is_hot:!1,is_first_charge:!1,is_active:!0},Z.visible=!0},fe=async()=>{try{Z.isEdit?await k.put(`/admin/recharge-packages/${ee.value.id}`,ee.value):await k.post("/admin/recharge-packages",ee.value),y.success("保存成功"),Z.visible=!1,await _e()}catch(e){y.error("保存失败")}},he=async()=>{if(!de.value.amount||de.value.amount<=0)y.warning("请输入调整数量");else if(de.value.reason)try{await k.post(`/admin/user-coins/${re.user.user_id}/adjust`,de.value),y.success("调整成功"),re.visible=!1,await be()}catch(e){y.error("调整失败")}else y.warning("请输入调整原因")},we=()=>{y.info("导出功能开发中")},ye=async()=>{var e,a;if(ue.user)try{const l=await k.get("/admin/coin-transactions",{params:{user_id:ue.user.user_id,page:pe.page,page_size:pe.pageSize}});ne.value=(null==(e=l.data)?void 0:e.items)||[],pe.total=(null==(a=l.data)?void 0:a.total)||0}catch(l){ne.value=[]}},Ve=e=>({recharge:{text:"充值",type:"success"},purchase:{text:"购买",type:"danger"},admin:{text:"管理调整",type:"warning"},reward:{text:"奖励",type:"success"},refund:{text:"退款",type:"info"},share:{text:"分享奖励",type:"success"}}[e]||{text:e,type:"info"});return C(()=>{_e()}),(V,x)=>{const z=o,C=t,ke=r,xe=d,ze=s,Ce=l,Ue=u,je=p,Se=n,$e=c,De=m,Ee=e,Ie=g,Re=b,Me=v,He=_,Pe=a,Fe=h,Ke=f;return D(),U("div",F,[x[47]||(x[47]=j("div",{class:"page-header"},[j("h1",null,"金币管理"),j("p",{class:"page-desc"},"管理充值套餐、查看订单记录、调整用户金币")],-1)),S(Ee,{modelValue:W.value,"onUpdate:modelValue":x[7]||(x[7]=e=>W.value=e),class:"main-tabs"},{default:$(()=>[S(Ce,{label:"充值套餐",name:"packages"},{default:$(()=>[j("div",K,[S(C,{type:"primary",onClick:x[0]||(x[0]=e=>ve())},{default:$(()=>[S(z,null,{default:$(()=>[S(I(i))]),_:1}),x[27]||(x[27]=E(" 添加套餐 ",-1))]),_:1})]),S(ze,{data:X.value,stripe:"",border:""},{default:$(()=>[S(ke,{prop:"id",label:"ID",width:"60"}),S(ke,{prop:"name",label:"套餐名称",width:"150"}),S(ke,{prop:"coins",label:"金币数",width:"100"},{default:$(({row:e})=>[j("span",T,R(e.coins),1)]),_:1}),S(ke,{prop:"bonus_coins",label:"赠送",width:"80"},{default:$(({row:e})=>[e.bonus_coins?(D(),U("span",q,"+"+R(e.bonus_coins),1)):(D(),U("span",A,"-"))]),_:1}),S(ke,{prop:"price",label:"价格(元)",width:"100"},{default:$(({row:e})=>[E(" ¥"+R(e.price),1)]),_:1}),S(ke,{prop:"tag",label:"标签",width:"100"},{default:$(({row:e})=>{return[e.tag?(D(),M(xe,{key:0,size:"small",type:(a=e.tag,(null==a?void 0:a.includes("热"))?"danger":(null==a?void 0:a.includes("推荐"))?"warning":(null==a?void 0:a.includes("首充"))?"success":"info")},{default:$(()=>[E(R(e.tag),1)]),_:2},1032,["type"])):H("",!0)];var a}),_:1}),S(ke,{prop:"is_hot",label:"热门",width:"80"},{default:$(({row:e})=>[e.is_hot?(D(),M(xe,{key:0,type:"danger",size:"small"},{default:$(()=>[...x[28]||(x[28]=[E("热门",-1)])]),_:1})):H("",!0)]),_:1}),S(ke,{prop:"is_first_charge",label:"首充",width:"80"},{default:$(({row:e})=>[e.is_first_charge?(D(),M(xe,{key:0,type:"warning",size:"small"},{default:$(()=>[...x[29]||(x[29]=[E("首充",-1)])]),_:1})):H("",!0)]),_:1}),S(ke,{prop:"is_active",label:"状态",width:"80"},{default:$(({row:e})=>[S(xe,{type:e.is_active?"success":"info",size:"small"},{default:$(()=>[E(R(e.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),S(ke,{prop:"sort_order",label:"排序",width:"70"}),S(ke,{label:"操作",width:"150",fixed:"right"},{default:$(({row:e})=>[S(C,{size:"small",onClick:a=>ve(e)},{default:$(()=>[...x[30]||(x[30]=[E("编辑",-1)])]),_:1},8,["onClick"]),S(C,{size:"small",type:"danger",onClick:a=>(async e=>{try{await w.confirm("确定删除此套餐?","提示",{type:"warning"}),await k.delete(`/admin/recharge-packages/${e.id}`),y.success("删除成功"),await _e()}catch(a){}})(e)},{default:$(()=>[...x[31]||(x[31]=[E("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),S(Ce,{label:"充值订单",name:"orders"},{default:$(()=>[j("div",B,[S(Ue,{modelValue:le.keyword,"onUpdate:modelValue":x[1]||(x[1]=e=>le.keyword=e),placeholder:"订单号/用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"]),S(Se,{modelValue:le.status,"onUpdate:modelValue":x[2]||(x[2]=e=>le.status=e),placeholder:"订单状态",clearable:"",style:{width:"120px"}},{default:$(()=>[S(je,{label:"待支付",value:"pending"}),S(je,{label:"已支付",value:"paid"}),S(je,{label:"已失败",value:"failed"})]),_:1},8,["modelValue"]),S($e,{modelValue:le.dateRange,"onUpdate:modelValue":x[3]||(x[3]=e=>le.dateRange=e),type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"]),S(C,{type:"primary",onClick:ge},{default:$(()=>[...x[32]||(x[32]=[E("查询",-1)])]),_:1}),S(C,{onClick:we},{default:$(()=>[...x[33]||(x[33]=[E("导出",-1)])]),_:1})]),S(ze,{data:ae.value,stripe:"",border:""},{default:$(()=>[S(ke,{prop:"order_no",label:"订单号",width:"200"}),S(ke,{label:"用户",width:"150"},{default:$(({row:e})=>{var a,l;return[j("span",null,R((null==(a=e.user)?void 0:a.nickname)||(null==(l=e.user)?void 0:l.username)),1)]}),_:1}),S(ke,{prop:"coins",label:"金币",width:"100"},{default:$(({row:e})=>[E(R(e.coins),1),e.bonus_coins?(D(),U("span",G,"+"+R(e.bonus_coins),1)):H("",!0)]),_:1}),S(ke,{prop:"amount",label:"金额",width:"100"},{default:$(({row:e})=>[j("span",J,"¥"+R(e.amount),1)]),_:1}),S(ke,{prop:"payment_method",label:"支付方式",width:"100"},{default:$(({row:e})=>[E(R("alipay"===e.payment_method?"支付宝":"wechat"===e.payment_method?"微信":e.payment_method),1)]),_:1}),S(ke,{prop:"status",label:"状态",width:"100"},{default:$(({row:e})=>{return[S(xe,{type:(a=e.status,{pending:"warning",paid:"success",failed:"danger"}[a]||"info"),size:"small"},{default:$(()=>[E(R(ce(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),S(ke,{prop:"paid_at",label:"支付时间",width:"160"},{default:$(({row:e})=>[E(R(me(e.paid_at)),1)]),_:1}),S(ke,{prop:"created_at",label:"创建时间",width:"160"},{default:$(({row:e})=>[E(R(me(e.created_at)),1)]),_:1})]),_:1},8,["data"]),S(De,{"current-page":te.page,"onUpdate:currentPage":x[4]||(x[4]=e=>te.page=e),"page-size":te.pageSize,total:te.total,layout:"total, prev, pager, next",onCurrentChange:ge,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),S(Ce,{label:"用户金币",name:"users"},{default:$(()=>[j("div",L,[S(Ue,{modelValue:ie.keyword,"onUpdate:modelValue":x[5]||(x[5]=e=>ie.keyword=e),placeholder:"用户名/昵称",clearable:"",style:{width:"200px"}},null,8,["modelValue"]),S(C,{type:"primary",onClick:be},{default:$(()=>[...x[34]||(x[34]=[E("查询",-1)])]),_:1})]),S(ze,{data:oe.value,stripe:"",border:""},{default:$(()=>[S(ke,{prop:"user_id",label:"用户ID",width:"80"}),S(ke,{label:"用户",width:"150"},{default:$(({row:e})=>[E(R(e.nickname||e.username),1)]),_:1}),S(ke,{prop:"balance",label:"当前余额",width:"120"},{default:$(({row:e})=>[j("span",O,R(e.balance),1)]),_:1}),S(ke,{prop:"total_recharged",label:"累计充值",width:"120"}),S(ke,{prop:"total_spent",label:"累计消费",width:"120"}),S(ke,{prop:"total_earned",label:"累计赚取",width:"120"}),S(ke,{label:"操作",width:"180",fixed:"right"},{default:$(({row:e})=>[S(C,{size:"small",onClick:a=>(async e=>{ue.user=e,pe.page=1,ue.visible=!0,await ye()})(e)},{default:$(()=>[...x[35]||(x[35]=[E("明细",-1)])]),_:1},8,["onClick"]),S(C,{size:"small",type:"primary",onClick:a=>{return l=e,re.user=l,de.value={type:"add",amount:0,reason:""},void(re.visible=!0);var l}},{default:$(()=>[...x[36]||(x[36]=[E("调整",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),S(De,{"current-page":se.page,"onUpdate:currentPage":x[6]||(x[6]=e=>se.page=e),"page-size":se.pageSize,total:se.total,layout:"total, prev, pager, next",onCurrentChange:be,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1})]),_:1},8,["modelValue"]),S(Pe,{modelValue:Z.visible,"onUpdate:modelValue":x[19]||(x[19]=e=>Z.visible=e),title:Z.isEdit?"编辑套餐":"添加套餐",width:"500px"},{footer:$(()=>[S(C,{onClick:x[18]||(x[18]=e=>Z.visible=!1)},{default:$(()=>[...x[40]||(x[40]=[E("取消",-1)])]),_:1}),S(C,{type:"primary",onClick:fe},{default:$(()=>[...x[41]||(x[41]=[E("保存",-1)])]),_:1})]),default:$(()=>[S(He,{model:ee.value,"label-width":"100px"},{default:$(()=>[S(Ie,{label:"套餐名称"},{default:$(()=>[S(Ue,{modelValue:ee.value.name,"onUpdate:modelValue":x[8]||(x[8]=e=>ee.value.name=e),placeholder:"请输入套餐名称"},null,8,["modelValue"])]),_:1}),S(Ie,{label:"金币数量"},{default:$(()=>[S(Re,{modelValue:ee.value.coins,"onUpdate:modelValue":x[9]||(x[9]=e=>ee.value.coins=e),min:1},null,8,["modelValue"])]),_:1}),S(Ie,{label:"赠送金币"},{default:$(()=>[S(Re,{modelValue:ee.value.bonus_coins,"onUpdate:modelValue":x[10]||(x[10]=e=>ee.value.bonus_coins=e),min:0},null,8,["modelValue"])]),_:1}),S(Ie,{label:"价格(元)"},{default:$(()=>[S(Re,{modelValue:ee.value.price,"onUpdate:modelValue":x[11]||(x[11]=e=>ee.value.price=e),min:.01,precision:2},null,8,["modelValue"])]),_:1}),S(Ie,{label:"原价(元)"},{default:$(()=>[S(Re,{modelValue:ee.value.original_price,"onUpdate:modelValue":x[12]||(x[12]=e=>ee.value.original_price=e),min:0,precision:2},null,8,["modelValue"])]),_:1}),S(Ie,{label:"标签"},{default:$(()=>[S(Ue,{modelValue:ee.value.tag,"onUpdate:modelValue":x[13]||(x[13]=e=>ee.value.tag=e),placeholder:"如: 热门、推荐"},null,8,["modelValue"])]),_:1}),S(Ie,{label:"排序"},{default:$(()=>[S(Re,{modelValue:ee.value.sort_order,"onUpdate:modelValue":x[14]||(x[14]=e=>ee.value.sort_order=e),min:0},null,8,["modelValue"])]),_:1}),S(Ie,{label:"选项"},{default:$(()=>[S(Me,{modelValue:ee.value.is_hot,"onUpdate:modelValue":x[15]||(x[15]=e=>ee.value.is_hot=e)},{default:$(()=>[...x[37]||(x[37]=[E("热门推荐",-1)])]),_:1},8,["modelValue"]),S(Me,{modelValue:ee.value.is_first_charge,"onUpdate:modelValue":x[16]||(x[16]=e=>ee.value.is_first_charge=e)},{default:$(()=>[...x[38]||(x[38]=[E("首充专享",-1)])]),_:1},8,["modelValue"]),S(Me,{modelValue:ee.value.is_active,"onUpdate:modelValue":x[17]||(x[17]=e=>ee.value.is_active=e)},{default:$(()=>[...x[39]||(x[39]=[E("启用",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),S(Pe,{modelValue:re.visible,"onUpdate:modelValue":x[24]||(x[24]=e=>re.visible=e),title:"调整用户金币",width:"400px"},{footer:$(()=>[S(C,{onClick:x[23]||(x[23]=e=>re.visible=!1)},{default:$(()=>[...x[44]||(x[44]=[E("取消",-1)])]),_:1}),S(C,{type:"primary",onClick:he},{default:$(()=>[...x[45]||(x[45]=[E("确认调整",-1)])]),_:1})]),default:$(()=>[S(He,{model:de.value,"label-width":"80px"},{default:$(()=>[S(Ie,{label:"用户"},{default:$(()=>{var e,a;return[j("span",null,R((null==(e=re.user)?void 0:e.nickname)||(null==(a=re.user)?void 0:a.username)),1)]}),_:1}),S(Ie,{label:"当前余额"},{default:$(()=>{var e;return[j("span",Q,R(null==(e=re.user)?void 0:e.balance),1)]}),_:1}),S(Ie,{label:"调整类型"},{default:$(()=>[S(Ke,{modelValue:de.value.type,"onUpdate:modelValue":x[20]||(x[20]=e=>de.value.type=e)},{default:$(()=>[S(Fe,{label:"add"},{default:$(()=>[...x[42]||(x[42]=[E("增加",-1)])]),_:1}),S(Fe,{label:"reduce"},{default:$(()=>[...x[43]||(x[43]=[E("扣减",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(Ie,{label:"金币数量"},{default:$(()=>[S(Re,{modelValue:de.value.amount,"onUpdate:modelValue":x[21]||(x[21]=e=>de.value.amount=e),min:1},null,8,["modelValue"])]),_:1}),S(Ie,{label:"调整原因"},{default:$(()=>[S(Ue,{modelValue:de.value.reason,"onUpdate:modelValue":x[22]||(x[22]=e=>de.value.reason=e),type:"textarea",rows:"2",placeholder:"请输入调整原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),S(Pe,{modelValue:ue.visible,"onUpdate:modelValue":x[26]||(x[26]=e=>ue.visible=e),title:"金币交易明细",width:"700px"},{default:$(()=>{var e,a,l;return[j("div",Y,[j("span",null,"用户: "+R((null==(e=ue.user)?void 0:e.nickname)||(null==(a=ue.user)?void 0:a.username)),1),j("span",null,[x[46]||(x[46]=E("当前余额: ",-1)),j("b",N,R(null==(l=ue.user)?void 0:l.balance),1)])]),S(ze,{data:ne.value,stripe:"",border:"","max-height":"400"},{default:$(()=>[S(ke,{prop:"id",label:"ID",width:"60"}),S(ke,{prop:"transaction_type",label:"类型",width:"100"},{default:$(({row:e})=>[S(xe,{type:Ve(e.transaction_type).type,size:"small"},{default:$(()=>[E(R(Ve(e.transaction_type).text),1)]),_:2},1032,["type"])]),_:1}),S(ke,{prop:"amount",label:"金额",width:"100"},{default:$(({row:e})=>[j("span",{class:P(e.amount>0?"text-success":"text-danger")},R(e.amount>0?"+":"")+R(e.amount),3)]),_:1}),S(ke,{prop:"balance_after",label:"余额",width:"100"}),S(ke,{prop:"description",label:"说明","min-width":"150","show-overflow-tooltip":""}),S(ke,{prop:"created_at",label:"时间",width:"160"},{default:$(({row:e})=>[E(R(me(e.created_at)),1)]),_:1})]),_:1},8,["data"]),S(De,{"current-page":pe.page,"onUpdate:currentPage":x[25]||(x[25]=e=>pe.page=e),"page-size":pe.pageSize,total:pe.total,layout:"total, prev, pager, next",onCurrentChange:ye,class:"pagination",style:{"margin-top":"16px"}},null,8,["current-page","page-size","total"])]}),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-16aaebdb"]]);export{W as default};
