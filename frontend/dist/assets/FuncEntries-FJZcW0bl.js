/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                    *//* empty css                *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                   *//* empty css                  *//* empty css               */import{be as e,bk as a,bh as l,bi as t,b4 as s,bj as i,aM as u,br as r,bs as o,aQ as n,a6 as d,aR as c,aS as m,aT as p,bw as v,bv as f,bo as _,bx as g,E as b}from"./element-plus-DlIn_qXi.js";import{_ as y,a as h}from"./index-C3P4JTuA.js";import{r as k,c as w,j,y as V,O as x,F as C,z as U,G as z,E as G,C as B,L as E,K as F,u as I,I as L}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const M={class:"func-entries-page"},$={class:"card-header"},A={class:"icon-preview"},P=["src"],R={key:1,class:"placeholder"},q={class:"url-text"},N={key:1,class:"text-muted"},Q={class:"url-text"},S={key:1,class:"text-muted"},W={class:"upload-inline"},H={key:0,class:"image-preview"},J=["src"],K="/api/v1/ads/upload/image",O=y({__name:"FuncEntries",setup(y){const O=k(!1),T=k(!1),D=k([]),X=k(!1),Y=k(!1),Z=k(null),ee=k({name:"",image:"",link:"",sort_order:0,is_active:!0}),ae=w(()=>Z.value?"编辑功能入口":"添加功能入口"),le=w(()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}}),te=async()=>{O.value=!0;try{const e=await h.get("/ads/func-entries/admin");D.value=e.data||e||[]}catch(e){}finally{O.value=!1}},se=()=>{Z.value=null,ee.value={name:"",image:"",link:"",sort_order:D.value.length+1,is_active:!0},X.value=!0},ie=async()=>{if(ee.value.name){T.value=!0;try{Z.value?(await h.put(`/ads/func-entries/${Z.value.id}`,ee.value),b.success("更新成功")):(await h.post("/ads/func-entries",ee.value),b.success("添加成功")),X.value=!1,te()}catch(e){b.error("保存失败")}finally{T.value=!1}}else b.warning("请输入名称")},ue=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?!!l||(b.error("图片大小不能超过 2MB!"),!1):(b.error("只能上传图片文件!"),!1)},re=e=>{e.url&&(ee.value.image=e.url,b.success("图片上传成功"))},oe=async e=>{if(e.url)try{await h.put(`/ads/func-entries/${Z.value.id}`,{...Z.value,image:e.url}),b.success("图片上传成功"),Y.value=!1,te()}catch(a){b.error("更新失败")}},ne=()=>{b.error("上传失败，请检查网络或重试")};return j(()=>{te()}),(y,k)=>{const w=n,j=u,de=t,ce=s,me=i,pe=r,ve=l,fe=e,_e=p,ge=m,be=v,ye=f,he=_,ke=c,we=a,je=o;return U(),V("div",M,[x(fe,null,{header:C(()=>[B("div",$,[k[9]||(k[9]=B("span",null,"功能入口管理",-1)),x(j,{type:"primary",onClick:se},{default:C(()=>[x(w,null,{default:C(()=>[x(I(d))]),_:1}),k[8]||(k[8]=F(" 添加入口 ",-1))]),_:1})])]),default:C(()=>[z((U(),G(ve,{data:D.value,style:{width:"100%"},border:""},{default:C(()=>[x(de,{label:"排序",prop:"sort_order",width:"70",align:"center"}),x(de,{label:"图标",width:"80",align:"center"},{default:C(({row:e})=>{var a;return[B("div",A,[e.image?(U(),V("img",{key:0,src:e.image,alt:"icon"},null,8,P)):(U(),V("span",R,E((null==(a=e.name)?void 0:a.charAt(0))||"?"),1))])]}),_:1}),x(de,{label:"名称",prop:"name",width:"120"}),x(de,{label:"图片URL","min-width":"200"},{default:C(({row:e})=>[e.image?(U(),G(ce,{key:0,content:e.image,placement:"top"},{default:C(()=>[B("span",q,E(e.image),1)]),_:2},1032,["content"])):(U(),V("span",N,"未设置"))]),_:1}),x(de,{label:"跳转链接","min-width":"200"},{default:C(({row:e})=>[e.link?(U(),G(ce,{key:0,content:e.link,placement:"top"},{default:C(()=>[B("span",Q,E(e.link),1)]),_:2},1032,["content"])):(U(),V("span",S,"未设置"))]),_:1}),x(de,{label:"状态",width:"80",align:"center"},{default:C(({row:e})=>[x(me,{type:e.is_active?"success":"info",size:"small"},{default:C(()=>[F(E(e.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),x(de,{label:"操作",width:"180",align:"center",fixed:"right"},{default:C(({row:e})=>[x(j,{size:"small",type:"primary",link:"",onClick:a=>(e=>{Z.value=e,ee.value={...e},X.value=!0})(e)},{default:C(()=>[...k[10]||(k[10]=[F("编辑",-1)])]),_:1},8,["onClick"]),x(j,{size:"small",type:"success",link:"",onClick:a=>(e=>{Z.value=e,Y.value=!0})(e)},{default:C(()=>[...k[11]||(k[11]=[F("上传图片",-1)])]),_:1},8,["onClick"]),x(pe,{title:"确定删除吗？",onConfirm:a=>(async e=>{try{await h.delete(`/ads/func-entries/${e.id}`),b.success("删除成功"),te()}catch(a){b.error("删除失败")}})(e)},{reference:C(()=>[x(j,{size:"small",type:"danger",link:""},{default:C(()=>[...k[12]||(k[12]=[F("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[je,O.value]])]),_:1}),x(we,{modelValue:X.value,"onUpdate:modelValue":k[6]||(k[6]=e=>X.value=e),title:ae.value,width:"500px"},{footer:C(()=>[x(j,{onClick:k[5]||(k[5]=e=>X.value=!1)},{default:C(()=>[...k[14]||(k[14]=[F("取消",-1)])]),_:1}),x(j,{type:"primary",onClick:ie,loading:T.value},{default:C(()=>[...k[15]||(k[15]=[F("保存",-1)])]),_:1},8,["loading"])]),default:C(()=>[x(ke,{model:ee.value,"label-width":"100px"},{default:C(()=>[x(ge,{label:"名称",required:""},{default:C(()=>[x(_e,{modelValue:ee.value.name,"onUpdate:modelValue":k[0]||(k[0]=e=>ee.value.name=e),placeholder:"入口名称"},null,8,["modelValue"])]),_:1}),x(ge,{label:"图标图片"},{default:C(()=>[B("div",W,[x(_e,{modelValue:ee.value.image,"onUpdate:modelValue":k[1]||(k[1]=e=>ee.value.image=e),placeholder:"图片URL或上传图片",style:{flex:"1"}},null,8,["modelValue"]),x(be,{action:K,headers:le.value,"show-file-list":!1,"on-success":re,accept:"image/*"},{default:C(()=>[x(j,{type:"primary"},{default:C(()=>[...k[13]||(k[13]=[F("上传",-1)])]),_:1})]),_:1},8,["headers"])]),ee.value.image?(U(),V("div",H,[B("img",{src:ee.value.image,alt:"预览"},null,8,J)])):L("",!0)]),_:1}),x(ge,{label:"跳转链接"},{default:C(()=>[x(_e,{modelValue:ee.value.link,"onUpdate:modelValue":k[2]||(k[2]=e=>ee.value.link=e),placeholder:"点击跳转链接"},null,8,["modelValue"])]),_:1}),x(ge,{label:"排序"},{default:C(()=>[x(ye,{modelValue:ee.value.sort_order,"onUpdate:modelValue":k[3]||(k[3]=e=>ee.value.sort_order=e),min:0,max:100},null,8,["modelValue"])]),_:1}),x(ge,{label:"状态"},{default:C(()=>[x(he,{modelValue:ee.value.is_active,"onUpdate:modelValue":k[4]||(k[4]=e=>ee.value.is_active=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),x(we,{modelValue:Y.value,"onUpdate:modelValue":k[7]||(k[7]=e=>Y.value=e),title:"上传图标图片",width:"450px"},{default:C(()=>[x(be,{class:"upload-area",drag:"",action:K,headers:le.value,"on-success":oe,"on-error":ne,"before-upload":ue,accept:"image/*"},{tip:C(()=>[...k[16]||(k[16]=[B("div",{class:"el-upload__tip"}," 建议尺寸：100x100px，支持 PNG/JPG/GIF/WEBP，大小不超过2MB ",-1)])]),default:C(()=>[x(w,{class:"el-icon--upload"},{default:C(()=>[x(I(g))]),_:1}),k[17]||(k[17]=B("div",{class:"el-upload__text"},[F(" 拖拽图片到此处，或 "),B("em",null,"点击上传")],-1))]),_:1},8,["headers"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-e2b76bf4"]]);export{O as default};
