/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                   *//* empty css               *//* empty css                  *//* empty css                              *//* empty css                  *//* empty css                  *//* empty css                    *//* empty css                 *//* empty css                       *//* empty css                *//* empty css                        *//* empty css                    *//* empty css                  *//* empty css                 *//* empty css                        */import{be as e,bk as a,E as l,bh as t,bi as i,bj as o,bn as r,bo as s,aM as m,bs as d,aQ as u,a6 as n,aR as p,aS as _,aT as c,bf as f,by as g,bw as y,bv as b,bE as v,bl as w,bm as V,bC as x,bF as h,a as k}from"./element-plus-DlIn_qXi.js";import{_ as j,u as U,a as z}from"./index-C3P4JTuA.js";import{r as I,l as A,c as C,j as D,y as M,O as E,F,z as H,G as q,E as G,K as P,L as S,M as Y,I as $,V as B,C as N,u as O}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const K={class:"watermark-manage"},Q={class:"card-header"},R={key:2,class:"text-muted"},W=j({__name:"WatermarkManage",setup(j){const W=U(),L=I(!1),T=I([]),J=I(),X=A({visible:!1,isEdit:!1,loading:!1}),Z=A({id:null,name:"",watermark_type:"image",image_url:"",image_width:150,text_content:"",font_size:24,text_color:"rgba(255,255,255,0.7)",font_family:"Microsoft YaHei",user_id_format:"ID: {user_id}",position:"bottom_right",opacity:.7,margin_x:20,margin_y:20,apply_to:"all",priority:10,is_active:!0}),ee={name:[{required:!0,message:"请输入配置名称",trigger:"blur"}],watermark_type:[{required:!0,message:"请选择水印类型",trigger:"change"}],text_content:[{required:!0,message:"请输入水印文字",trigger:"blur"}]},ae=C(()=>"/api/v1/watermark/upload-image"),le=C(()=>({Authorization:`Bearer ${W.token}`})),te=async()=>{var e;L.value=!0;try{const a=await z.get("/watermark/configs");let l=[];Array.isArray(a.data)?l=a.data:(null==(e=a.data)?void 0:e.items)&&Array.isArray(a.data.items)?l=a.data.items:Array.isArray(a)?l=a:(null==a?void 0:a.items)&&Array.isArray(a.items)&&(l=a.items),T.value=l}catch(a){l.error("获取水印配置失败"),T.value=[]}finally{L.value=!1}},ie=()=>{X.isEdit=!1,oe(),X.visible=!0},oe=()=>{Z.id=null,Z.name="",Z.watermark_type="image",Z.image_url="",Z.image_width=150,Z.text_content="",Z.font_size=24,Z.text_color="rgba(255,255,255,0.7)",Z.font_family="Microsoft YaHei",Z.user_id_format="ID: {user_id}",Z.position="bottom_right",Z.opacity=.7,Z.margin_x=20,Z.margin_y=20,Z.apply_to="all",Z.priority=10,Z.is_active=!0},re=e=>{var a;Z.image_url=e.url||(null==(a=e.data)?void 0:a.url),l.success("上传成功")},se=e=>{const a="image/png"===e.type||"image/gif"===e.type,t=e.size/1024/1024<2;return a?!!t||(l.error("图片大小不能超过 2MB"),!1):(l.error("水印图片只能是 PNG 或 GIF 格式"),!1)},me=async()=>{var e,a;if("image"!==Z.watermark_type||Z.image_url)if("text"!==Z.watermark_type||Z.text_content){X.loading=!0;try{const e={...Z};X.isEdit?(await z.put(`/watermark/configs/${Z.id}`,e),l.success("更新成功")):(await z.post("/watermark/configs",e),l.success("添加成功")),X.visible=!1,te()}catch(t){l.error("操作失败: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.detail)||t.message))}finally{X.loading=!1}}else l.warning("请输入水印文字");else l.warning("请上传水印图片")},de=e=>({image:"图片水印",text:"文字水印",user_id:"用户ID"}[e]||e);return D(()=>{te()}),(j,U)=>{const I=u,A=m,C=i,D=o,W=r,oe=s,ue=t,ne=e,pe=c,_e=_,ce=g,fe=f,ge=y,ye=b,be=v,ve=V,we=w,Ve=x,xe=h,he=p,ke=a,je=d;return H(),M("div",K,[E(ne,null,{header:F(()=>[N("div",Q,[U[20]||(U[20]=N("span",null,"水印配置管理",-1)),E(A,{type:"primary",onClick:ie},{default:F(()=>[E(I,null,{default:F(()=>[E(O(n))]),_:1}),U[19]||(U[19]=P(" 添加水印配置 ",-1))]),_:1})])]),default:F(()=>[q((H(),G(ue,{data:T.value,stripe:""},{default:F(()=>[E(C,{prop:"id",label:"ID",width:"80"}),E(C,{prop:"name",label:"配置名称",width:"150"}),E(C,{prop:"watermark_type",label:"水印类型",width:"120"},{default:F(({row:e})=>{return[E(D,{type:(a=e.watermark_type,{image:"primary",text:"success",user_id:"warning"}[a]||"info")},{default:F(()=>[P(S(de(e.watermark_type)),1)]),_:2},1032,["type"])];var a}),_:1}),E(C,{label:"预览",width:"150"},{default:F(({row:e})=>["image"===e.watermark_type?(H(),M(Y,{key:0},[e.image_url?(H(),G(W,{key:0,src:e.image_url,"preview-src-list":[e.image_url],class:"watermark-preview",fit:"contain"},null,8,["src","preview-src-list"])):$("",!0)],64)):"text"===e.watermark_type?(H(),M("span",{key:1,class:"text-preview",style:B({color:e.text_color,fontSize:e.font_size+"px"})},S(e.text_content),5)):(H(),M("span",R,"动态用户ID"))]),_:1}),E(C,{prop:"position",label:"位置",width:"120"},{default:F(({row:e})=>{return[P(S((a=e.position,{top_left:"左上角",top_right:"右上角",bottom_left:"左下角",bottom_right:"右下角",center:"居中",random:"随机移动"}[a]||a)),1)];var a}),_:1}),E(C,{prop:"opacity",label:"透明度",width:"100"},{default:F(({row:e})=>[P(S((100*e.opacity).toFixed(0))+"% ",1)]),_:1}),E(C,{prop:"apply_to",label:"应用范围",width:"120"},{default:F(({row:e})=>{return[P(S((a=e.apply_to,{all:"所有视频",paid:"付费视频",free:"免费视频",vip:"VIP视频"}[a]||a)),1)];var a}),_:1}),E(C,{prop:"is_active",label:"状态",width:"100"},{default:F(({row:e})=>[E(oe,{modelValue:e.is_active,"onUpdate:modelValue":a=>e.is_active=a,onChange:a=>(async e=>{try{await z.patch(`/watermark/configs/${e.id}/toggle`),l.success(e.is_active?"已启用":"已禁用")}catch(a){e.is_active=!e.is_active,l.error("操作失败")}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),E(C,{prop:"priority",label:"优先级",width:"80"}),E(C,{label:"操作",width:"150",fixed:"right"},{default:F(({row:e})=>[E(A,{size:"small",onClick:a=>(e=>{X.isEdit=!0,Object.assign(Z,{id:e.id,name:e.name,watermark_type:e.watermark_type,image_url:e.image_url||"",image_width:e.image_width||150,text_content:e.text_content||"",font_size:e.font_size||24,text_color:e.text_color||"rgba(255,255,255,0.7)",font_family:e.font_family||"Microsoft YaHei",user_id_format:e.user_id_format||"ID: {user_id}",position:e.position,opacity:e.opacity,margin_x:e.margin_x||20,margin_y:e.margin_y||20,apply_to:e.apply_to||"all",priority:e.priority||10,is_active:e.is_active}),X.visible=!0})(e)},{default:F(()=>[...U[21]||(U[21]=[P("编辑",-1)])]),_:1},8,["onClick"]),E(A,{size:"small",type:"danger",onClick:a=>(async e=>{await k.confirm("确定删除该水印配置？","确认删除",{type:"warning"});try{await z.delete(`/watermark/configs/${e.id}`),l.success("删除成功"),te()}catch(a){l.error("删除失败")}})(e)},{default:F(()=>[...U[22]||(U[22]=[P("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[je,L.value]])]),_:1}),E(ke,{modelValue:X.visible,"onUpdate:modelValue":U[18]||(U[18]=e=>X.visible=e),title:X.isEdit?"编辑水印配置":"添加水印配置",width:"650px"},{footer:F(()=>[E(A,{onClick:U[17]||(U[17]=e=>X.visible=!1)},{default:F(()=>[...U[32]||(U[32]=[P("取消",-1)])]),_:1}),E(A,{type:"primary",onClick:me,loading:X.loading},{default:F(()=>[...U[33]||(U[33]=[P("确定",-1)])]),_:1},8,["loading"])]),default:F(()=>[E(he,{model:Z,"label-width":"100px",rules:ee,ref_key:"formRef",ref:J},{default:F(()=>[E(_e,{label:"配置名称",prop:"name"},{default:F(()=>[E(pe,{modelValue:Z.name,"onUpdate:modelValue":U[0]||(U[0]=e=>Z.name=e),placeholder:"如：主水印、用户ID水印"},null,8,["modelValue"])]),_:1}),E(_e,{label:"水印类型",prop:"watermark_type"},{default:F(()=>[E(fe,{modelValue:Z.watermark_type,"onUpdate:modelValue":U[1]||(U[1]=e=>Z.watermark_type=e)},{default:F(()=>[E(ce,{value:"image"},{default:F(()=>[...U[23]||(U[23]=[P("图片水印",-1)])]),_:1}),E(ce,{value:"text"},{default:F(()=>[...U[24]||(U[24]=[P("文字水印",-1)])]),_:1}),E(ce,{value:"user_id"},{default:F(()=>[...U[25]||(U[25]=[P("用户ID水印",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"image"===Z.watermark_type?(H(),M(Y,{key:0},[E(_e,{label:"水印图片",required:""},{default:F(()=>[E(ge,{class:"watermark-uploader",action:ae.value,headers:le.value,"show-file-list":!1,"on-success":re,"before-upload":se,accept:"image/png,image/gif"},{default:F(()=>[Z.image_url?(H(),G(W,{key:0,src:Z.image_url,class:"uploaded-image",fit:"contain"},null,8,["src"])):(H(),G(I,{key:1,class:"upload-icon"},{default:F(()=>[E(O(n))]),_:1}))]),_:1},8,["action","headers"]),U[26]||(U[26]=N("div",{class:"upload-tip"},"建议使用透明PNG图片，尺寸不超过 300x100px",-1))]),_:1}),E(_e,{label:"图片宽度"},{default:F(()=>[E(ye,{modelValue:Z.image_width,"onUpdate:modelValue":U[2]||(U[2]=e=>Z.image_width=e),min:50,max:500},null,8,["modelValue"]),U[27]||(U[27]=N("span",{class:"form-tip"},"像素，高度自动缩放",-1))]),_:1})],64)):$("",!0),"text"===Z.watermark_type?(H(),M(Y,{key:1},[E(_e,{label:"水印文字",prop:"text_content"},{default:F(()=>[E(pe,{modelValue:Z.text_content,"onUpdate:modelValue":U[3]||(U[3]=e=>Z.text_content=e),placeholder:"输入水印文字"},null,8,["modelValue"])]),_:1}),E(_e,{label:"字体大小"},{default:F(()=>[E(ye,{modelValue:Z.font_size,"onUpdate:modelValue":U[4]||(U[4]=e=>Z.font_size=e),min:12,max:72},null,8,["modelValue"])]),_:1}),E(_e,{label:"文字颜色"},{default:F(()=>[E(be,{modelValue:Z.text_color,"onUpdate:modelValue":U[5]||(U[5]=e=>Z.text_color=e),"show-alpha":""},null,8,["modelValue"])]),_:1}),E(_e,{label:"字体"},{default:F(()=>[E(we,{modelValue:Z.font_family,"onUpdate:modelValue":U[6]||(U[6]=e=>Z.font_family=e),style:{width:"200px"}},{default:F(()=>[E(ve,{label:"微软雅黑",value:"Microsoft YaHei"}),E(ve,{label:"宋体",value:"SimSun"}),E(ve,{label:"黑体",value:"SimHei"}),E(ve,{label:"Arial",value:"Arial"})]),_:1},8,["modelValue"])]),_:1})],64)):$("",!0),"user_id"===Z.watermark_type?(H(),M(Y,{key:2},[E(_e,{label:"显示格式"},{default:F(()=>[E(pe,{modelValue:Z.user_id_format,"onUpdate:modelValue":U[7]||(U[7]=e=>Z.user_id_format=e),placeholder:"ID: {user_id}"},null,8,["modelValue"]),U[28]||(U[28]=N("div",{class:"form-tip"},"使用 {user_id} 作为用户ID占位符",-1))]),_:1}),E(_e,{label:"字体大小"},{default:F(()=>[E(ye,{modelValue:Z.font_size,"onUpdate:modelValue":U[8]||(U[8]=e=>Z.font_size=e),min:12,max:48},null,8,["modelValue"])]),_:1}),E(_e,{label:"文字颜色"},{default:F(()=>[E(be,{modelValue:Z.text_color,"onUpdate:modelValue":U[9]||(U[9]=e=>Z.text_color=e),"show-alpha":""},null,8,["modelValue"])]),_:1})],64)):$("",!0),E(Ve),E(_e,{label:"显示位置"},{default:F(()=>[E(we,{modelValue:Z.position,"onUpdate:modelValue":U[10]||(U[10]=e=>Z.position=e),style:{width:"200px"}},{default:F(()=>[E(ve,{label:"左上角",value:"top_left"}),E(ve,{label:"右上角",value:"top_right"}),E(ve,{label:"左下角",value:"bottom_left"}),E(ve,{label:"右下角",value:"bottom_right"}),E(ve,{label:"居中",value:"center"}),E(ve,{label:"随机移动",value:"random"})]),_:1},8,["modelValue"])]),_:1}),E(_e,{label:"透明度"},{default:F(()=>[E(xe,{modelValue:Z.opacity,"onUpdate:modelValue":U[11]||(U[11]=e=>Z.opacity=e),min:.1,max:1,step:.1,"format-tooltip":e=>(100*e).toFixed(0)+"%"},null,8,["modelValue","format-tooltip"])]),_:1}),E(_e,{label:"边距"},{default:F(()=>[E(ye,{modelValue:Z.margin_x,"onUpdate:modelValue":U[12]||(U[12]=e=>Z.margin_x=e),min:0,max:100},null,8,["modelValue"]),U[29]||(U[29]=N("span",{class:"margin-label"},"水平",-1)),E(ye,{modelValue:Z.margin_y,"onUpdate:modelValue":U[13]||(U[13]=e=>Z.margin_y=e),min:0,max:100},null,8,["modelValue"]),U[30]||(U[30]=N("span",{class:"margin-label"},"垂直",-1))]),_:1}),E(_e,{label:"应用范围"},{default:F(()=>[E(we,{modelValue:Z.apply_to,"onUpdate:modelValue":U[14]||(U[14]=e=>Z.apply_to=e),style:{width:"200px"}},{default:F(()=>[E(ve,{label:"所有视频",value:"all"}),E(ve,{label:"仅付费视频",value:"paid"}),E(ve,{label:"仅免费视频",value:"free"}),E(ve,{label:"仅VIP视频",value:"vip"})]),_:1},8,["modelValue"])]),_:1}),E(_e,{label:"优先级"},{default:F(()=>[E(ye,{modelValue:Z.priority,"onUpdate:modelValue":U[15]||(U[15]=e=>Z.priority=e),min:0,max:100},null,8,["modelValue"]),U[31]||(U[31]=N("span",{class:"form-tip"},"数值越大优先级越高",-1))]),_:1}),E(_e,{label:"启用状态"},{default:F(()=>[E(oe,{modelValue:Z.is_active,"onUpdate:modelValue":U[16]||(U[16]=e=>Z.is_active=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-2b5603a6"]]);export{W as default};
