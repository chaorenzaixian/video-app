/* empty css             *//* empty css                   *//* empty css                   *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                             *//* empty css                  *//* empty css               */import{_ as a,a as e}from"./index-C3P4JTuA.js";import{be as l,bk as t,E as d,bc as s,bd as i,bl as r,bm as o,aT as n,bD as u,aM as p,bh as c,bi as v,bj as m,bs as _,bt as b,bG as g,bH as f}from"./element-plus-DlIn_qXi.js";import{r as h,l as w,j as y,y as j,O as I,F as z,z as V,C as x,G as k,L as C,M as S,aa as U,E as D,K as R,I as A}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const E={class:"admin-logs"},G={class:"card-header"},L={class:"stat-item"},P={class:"stat-value"},F={class:"stat-item"},J={class:"stat-value"},K={class:"stat-item"},M={class:"stat-value"},N={class:"stat-item"},O={class:"stat-value"},T={class:"filter-bar"},H={class:"extra-data"},X=a({__name:"AdminLogs",setup(a){const X=h(!1),q=h([]),B=h({}),Q=h([]),W=w({adminId:"",action:"",targetId:"",dateRange:null}),Y=w({page:1,pageSize:20,total:0}),Z=w({visible:!1,data:null}),$=async()=>{var a,l;X.value=!0;try{const t={page:Y.page,page_size:Y.pageSize,admin_id:W.adminId||void 0,action:W.action||void 0,target_id:W.targetId||void 0};W.dateRange&&(t.start_date=W.dateRange[0],t.end_date=W.dateRange[1]);const d=await e.get("/admin/logs",{params:t});q.value=(null==(a=d.data)?void 0:a.items)||d.items||[],Y.total=(null==(l=d.data)?void 0:l.total)||d.total||0}catch(t){d.error("获取日志失败")}finally{X.value=!1}},aa=async()=>{try{const a=await e.get("/admin/logs/stats");B.value=a.data||a}catch(a){}},ea=()=>{W.adminId="",W.action="",W.targetId="",W.dateRange=null,Y.page=1,$()},la=a=>a?new Date(a).toLocaleString("zh-CN"):"-",ta=a=>["ban_user","delete_video","delete_comment"].includes(a)?"danger":["adjust_coins","handle_withdrawal"].includes(a)?"warning":["unban_user","review_video"].includes(a)?"success":"info",da=a=>({ban_user:"封禁用户",unban_user:"解封用户",delete_video:"删除视频",review_video:"审核视频",delete_comment:"删除评论",handle_report:"处理举报",adjust_coins:"调整金币",update_config:"修改配置",create_admin:"创建管理员",handle_withdrawal:"处理提现",login:"管理员登录",logout:"管理员登出"}[a]||a),sa=a=>({user:"用户",video:"视频",comment:"评论",report:"举报",order:"订单",config:"配置",withdrawal:"提现"}[a]||a||"-");return y(()=>{$(),aa(),(async()=>{var a;try{const l=await e.get("/admin/users",{params:{role:"admin",page_size:100}});Q.value=(null==(a=l.data)?void 0:a.items)||l.items||[]}catch(l){}})()}),(a,e)=>{const d=p,h=i,w=s,y=o,ia=r,ra=n,oa=u,na=v,ua=m,pa=c,ca=b,va=l,ma=f,_a=g,ba=t,ga=_;return V(),j("div",E,[I(va,null,{header:z(()=>[x("div",G,[e[8]||(e[8]=x("span",null,"管理员操作日志",-1)),I(d,{type:"primary",onClick:aa},{default:z(()=>[...e[7]||(e[7]=[R("刷新统计",-1)])]),_:1})])]),default:z(()=>[I(w,{gutter:16,class:"stats-row"},{default:z(()=>[I(h,{span:6},{default:z(()=>[x("div",L,[x("div",P,C(B.value.today||0),1),e[9]||(e[9]=x("div",{class:"stat-label"},"今日操作",-1))])]),_:1}),I(h,{span:6},{default:z(()=>[x("div",F,[x("div",J,C(B.value.week||0),1),e[10]||(e[10]=x("div",{class:"stat-label"},"本周操作",-1))])]),_:1}),I(h,{span:6},{default:z(()=>[x("div",K,[x("div",M,C(B.value.month||0),1),e[11]||(e[11]=x("div",{class:"stat-label"},"本月操作",-1))])]),_:1}),I(h,{span:6},{default:z(()=>[x("div",N,[x("div",O,C(B.value.total||0),1),e[12]||(e[12]=x("div",{class:"stat-label"},"总操作数",-1))])]),_:1})]),_:1}),x("div",T,[I(ia,{modelValue:W.adminId,"onUpdate:modelValue":e[0]||(e[0]=a=>W.adminId=a),placeholder:"管理员",clearable:"",style:{width:"140px"}},{default:z(()=>[(V(!0),j(S,null,U(Q.value,a=>(V(),D(y,{key:a.id,label:a.username,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),I(ia,{modelValue:W.action,"onUpdate:modelValue":e[1]||(e[1]=a=>W.action=a),placeholder:"操作类型",clearable:"",style:{width:"140px"}},{default:z(()=>[I(y,{label:"用户封禁",value:"ban_user"}),I(y,{label:"用户解封",value:"unban_user"}),I(y,{label:"删除视频",value:"delete_video"}),I(y,{label:"审核视频",value:"review_video"}),I(y,{label:"删除评论",value:"delete_comment"}),I(y,{label:"处理举报",value:"handle_report"}),I(y,{label:"调整金币",value:"adjust_coins"}),I(y,{label:"修改配置",value:"update_config"}),I(y,{label:"创建管理员",value:"create_admin"}),I(y,{label:"处理提现",value:"handle_withdrawal"})]),_:1},8,["modelValue"]),I(ra,{modelValue:W.targetId,"onUpdate:modelValue":e[2]||(e[2]=a=>W.targetId=a),placeholder:"目标ID",clearable:"",style:{width:"120px"}},null,8,["modelValue"]),I(oa,{modelValue:W.dateRange,"onUpdate:modelValue":e[3]||(e[3]=a=>W.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"]),I(d,{type:"primary",onClick:$},{default:z(()=>[...e[13]||(e[13]=[R("查询",-1)])]),_:1}),I(d,{onClick:ea},{default:z(()=>[...e[14]||(e[14]=[R("重置",-1)])]),_:1})]),k((V(),D(pa,{data:q.value,stripe:""},{default:z(()=>[I(na,{prop:"id",label:"ID",width:"80"}),I(na,{prop:"admin_username",label:"管理员",width:"120"}),I(na,{prop:"action",label:"操作类型",width:"120"},{default:z(({row:a})=>[I(ua,{type:ta(a.action)},{default:z(()=>[R(C(da(a.action)),1)]),_:2},1032,["type"])]),_:1}),I(na,{prop:"target_type",label:"目标类型",width:"100"},{default:z(({row:a})=>[R(C(sa(a.target_type)),1)]),_:1}),I(na,{prop:"target_id",label:"目标ID",width:"100"}),I(na,{prop:"description",label:"操作描述","min-width":"250","show-overflow-tooltip":""}),I(na,{prop:"ip_address",label:"IP地址",width:"140"}),I(na,{prop:"created_at",label:"操作时间",width:"180"},{default:z(({row:a})=>[R(C(la(a.created_at)),1)]),_:1}),I(na,{label:"操作",width:"100",fixed:"right"},{default:z(({row:a})=>[I(d,{size:"small",onClick:e=>(a=>{Z.data=a,Z.visible=!0})(a)},{default:z(()=>[...e[15]||(e[15]=[R("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ga,X.value]]),I(ca,{class:"pagination","current-page":Y.page,"onUpdate:currentPage":e[4]||(e[4]=a=>Y.page=a),"page-size":Y.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>Y.pageSize=a),total:Y.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:$,onCurrentChange:$},null,8,["current-page","page-size","total"])]),_:1}),I(ba,{modelValue:Z.visible,"onUpdate:modelValue":e[6]||(e[6]=a=>Z.visible=a),title:"操作详情",width:"600px"},{default:z(()=>[I(_a,{column:1,border:""},{default:z(()=>{var a;return[I(ma,{label:"日志ID"},{default:z(()=>{var a;return[R(C(null==(a=Z.data)?void 0:a.id),1)]}),_:1}),I(ma,{label:"管理员"},{default:z(()=>{var a;return[R(C(null==(a=Z.data)?void 0:a.admin_username),1)]}),_:1}),I(ma,{label:"操作类型"},{default:z(()=>{var a;return[I(ua,{type:ta(null==(a=Z.data)?void 0:a.action)},{default:z(()=>{var a;return[R(C(da(null==(a=Z.data)?void 0:a.action)),1)]}),_:1},8,["type"])]}),_:1}),I(ma,{label:"目标类型"},{default:z(()=>{var a;return[R(C(sa(null==(a=Z.data)?void 0:a.target_type)),1)]}),_:1}),I(ma,{label:"目标ID"},{default:z(()=>{var a;return[R(C(null==(a=Z.data)?void 0:a.target_id),1)]}),_:1}),I(ma,{label:"操作描述"},{default:z(()=>{var a;return[R(C(null==(a=Z.data)?void 0:a.description),1)]}),_:1}),I(ma,{label:"IP地址"},{default:z(()=>{var a;return[R(C(null==(a=Z.data)?void 0:a.ip_address),1)]}),_:1}),I(ma,{label:"User-Agent"},{default:z(()=>{var a;return[R(C(null==(a=Z.data)?void 0:a.user_agent),1)]}),_:1}),I(ma,{label:"操作时间"},{default:z(()=>{var a;return[R(C(la(null==(a=Z.data)?void 0:a.created_at)),1)]}),_:1}),(null==(a=Z.data)?void 0:a.extra_data)?(V(),D(ma,{key:0,label:"额外数据"},{default:z(()=>[x("pre",H,C(JSON.stringify(Z.data.extra_data,null,2)),1)]),_:1})):A("",!0)]}),_:1})]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-ebd99c0d"]]);export{X as default};
