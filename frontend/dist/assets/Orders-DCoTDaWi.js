/* empty css             *//* empty css                   *//* empty css                   *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                             */import{_ as a,a as e}from"./index-C3P4JTuA.js";import{be as t,bk as l,aL as s,bh as o,bi as n,bj as r,aM as i,bs as d,bt as u,bl as m,bm as p,bD as c,bG as _,bH as v,E as y}from"./element-plus-DlIn_qXi.js";import{r as f,j as b,y as h,C as g,O as j,L as w,F as x,z as k,G as V,E as Y,K as D,I as F,M as z}from"./vue-vendor-Ba_vealp.js";import"./utils-DflAyOWx.js";const M={class:"orders-page"},R={class:"page-header"},O={class:"stats-cards"},U={class:"stat-card"},C={class:"stat-value"},I={class:"stat-card success"},L={class:"stat-value"},T={class:"stat-card warning"},P={class:"stat-value"},E={class:"stat-card commission"},G={class:"stat-value"},H={class:"card-header"},q={class:"filter-bar"},A={class:"amount"},B={key:0,class:"inviter"},K={key:1,class:"no-inviter"},J={key:0,class:"commission"},S={key:1},X={class:"inviter-detail"},$={key:1},N={class:"commission-detail"},Q={class:"commission-rate"},W=a({__name:"Orders",setup(a){const W=f(!1),Z=f([]),aa=f(1),ea=f(20),ta=f(0),la=f({status:"",dateRange:null}),sa=f({total_orders:0,total_amount:0,today_orders:0,total_commission:0}),oa=f(!1),na=f(null),ra=async()=>{W.value=!0;try{const a={page:aa.value,page_size:ea.value,status:la.value.status||void 0};la.value.dateRange&&(a.start_date=s(la.value.dateRange[0]).format("YYYY-MM-DD"),a.end_date=s(la.value.dateRange[1]).format("YYYY-MM-DD"));const t=await e.get("/admin/orders",{params:a}),l=t.data||t;Z.value=l.items||[],ta.value=l.total||0}catch(a){Z.value=[{id:1,order_no:"VOD202412050001",username:"user1",order_type:"vip_monthly",amount:29,status:"success",payment_method:"alipay",created_at:"2024-12-05T10:00:00",paid_at:"2024-12-05T10:01:00",inviter_name:"推广员A",inviter_level_name:"普通代理",commission_amount:4.35,commission_rate:.15},{id:2,order_no:"VOD202412050002",username:"user2",order_type:"vip_yearly",amount:199,status:"success",payment_method:"wechat",created_at:"2024-12-05T11:00:00",paid_at:"2024-12-05T11:02:00",inviter_name:null,commission_amount:0,commission_rate:0},{id:3,order_no:"VOD202412050003",username:"user3",order_type:"vip_quarterly",amount:68,status:"pending",payment_method:"alipay",created_at:"2024-12-05T14:00:00",paid_at:null,inviter_name:"超级代理B",inviter_level_name:"超级代理",commission_amount:0,commission_rate:.5}],ta.value=Z.value.length}finally{W.value=!1}},ia=()=>{const a=Z.value.map(a=>{var e,t;return{"订单号":a.order_no,"用户":a.username,"类型":da(a.order_type),"金额":null==(e=a.amount)?void 0:e.toFixed(2),"状态":ma(a.status),"支付方式":pa(a.payment_method),"邀请人":a.inviter_name||"","佣金":(null==(t=a.commission_amount)?void 0:t.toFixed(2))||"0","创建时间":ca(a.created_at),"支付时间":a.paid_at?ca(a.paid_at):""}}),e=[Object.keys(a[0]||{}).join(","),...a.map(a=>Object.values(a).join(","))].join("\n"),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8"}),l=URL.createObjectURL(t),o=document.createElement("a");o.href=l,o.download=`订单列表_${s().format("YYYYMMDD")}.csv`,o.click(),URL.revokeObjectURL(l),y.success("导出成功")},da=a=>({vip_monthly:"包月VIP",vip_quarterly:"包季VIP",vip_yearly:"包年VIP",vip_lifetime:"永久VIP"}[a]||a),ua=a=>({success:"success",pending:"warning",failed:"danger",cancelled:"info"}[a]||"info"),ma=a=>({success:"已支付",pending:"待支付",failed:"失败",cancelled:"已取消"}[a]||a),pa=a=>({alipay:"支付宝",wechat:"微信",card:"银行卡"}[a]||a||"-"),ca=a=>a?s(a).format("YYYY-MM-DD HH:mm"):"-";return b(()=>{ra(),(async()=>{try{const a=await e.get("/admin/orders/stats");sa.value=a.data||a}catch(a){sa.value={total_orders:156,total_amount:12580,today_orders:8,total_commission:1886.5}}})()}),(a,e)=>{const s=p,y=m,f=c,b=i,_a=n,va=r,ya=o,fa=u,ba=t,ha=v,ga=_,ja=l,wa=d;return k(),h("div",M,[g("div",R,[e[9]||(e[9]=g("h2",null,"订单管理",-1)),g("div",O,[g("div",U,[g("span",C,w(sa.value.total_orders),1),e[5]||(e[5]=g("span",{class:"stat-label"},"总订单",-1))]),g("div",I,[g("span",L,"¥"+w(sa.value.total_amount.toFixed(2)),1),e[6]||(e[6]=g("span",{class:"stat-label"},"总金额",-1))]),g("div",T,[g("span",P,w(sa.value.today_orders),1),e[7]||(e[7]=g("span",{class:"stat-label"},"今日订单",-1))]),g("div",E,[g("span",G,"¥"+w(sa.value.total_commission.toFixed(2)),1),e[8]||(e[8]=g("span",{class:"stat-label"},"产生佣金",-1))])])]),j(ba,null,{header:x(()=>[g("div",H,[e[11]||(e[11]=g("span",null,"订单列表",-1)),g("div",q,[j(y,{modelValue:la.value.status,"onUpdate:modelValue":e[0]||(e[0]=a=>la.value.status=a),placeholder:"状态",clearable:"",onChange:ra},{default:x(()=>[j(s,{label:"全部",value:""}),j(s,{label:"待支付",value:"pending"}),j(s,{label:"已支付",value:"success"}),j(s,{label:"已失败",value:"failed"})]),_:1},8,["modelValue"]),j(f,{modelValue:la.value.dateRange,"onUpdate:modelValue":e[1]||(e[1]=a=>la.value.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:ra},null,8,["modelValue"]),j(b,{onClick:ia},{default:x(()=>[...e[10]||(e[10]=[D("导出",-1)])]),_:1})])])]),default:x(()=>[V((k(),Y(ya,{data:Z.value,stripe:""},{default:x(()=>[j(_a,{prop:"order_no",label:"订单号",width:"180"}),j(_a,{prop:"username",label:"用户",width:"120"}),j(_a,{prop:"order_type",label:"类型",width:"100"},{default:x(({row:a})=>[j(va,{size:"small"},{default:x(()=>[D(w(da(a.order_type)),1)]),_:2},1024)]),_:1}),j(_a,{prop:"amount",label:"金额",width:"100"},{default:x(({row:a})=>[g("span",A,"¥"+w(a.amount.toFixed(2)),1)]),_:1}),j(_a,{label:"邀请人",width:"120"},{default:x(({row:a})=>[a.inviter_name?(k(),h("span",B,w(a.inviter_name),1)):(k(),h("span",K,"-"))]),_:1}),j(_a,{label:"产生佣金",width:"100"},{default:x(({row:a})=>[a.commission_amount?(k(),h("span",J," ¥"+w(a.commission_amount.toFixed(2)),1)):(k(),h("span",S,"-"))]),_:1}),j(_a,{prop:"status",label:"状态",width:"100"},{default:x(({row:a})=>[j(va,{type:ua(a.status),size:"small"},{default:x(()=>[D(w(ma(a.status)),1)]),_:2},1032,["type"])]),_:1}),j(_a,{prop:"payment_method",label:"支付方式",width:"100"},{default:x(({row:a})=>[D(w(pa(a.payment_method)),1)]),_:1}),j(_a,{prop:"created_at",label:"创建时间",width:"160"},{default:x(({row:a})=>[D(w(ca(a.created_at)),1)]),_:1}),j(_a,{prop:"paid_at",label:"支付时间",width:"160"},{default:x(({row:a})=>[D(w(a.paid_at?ca(a.paid_at):"-"),1)]),_:1}),j(_a,{label:"操作",width:"100",fixed:"right"},{default:x(({row:a})=>[j(b,{type:"text",size:"small",onClick:e=>{return t=a,na.value=t,void(oa.value=!0);var t}},{default:x(()=>[...e[12]||(e[12]=[D("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[wa,W.value]]),j(fa,{"current-page":aa.value,"onUpdate:currentPage":e[2]||(e[2]=a=>aa.value=a),"page-size":ea.value,"onUpdate:pageSize":e[3]||(e[3]=a=>ea.value=a),total:ta.value,layout:"total, prev, pager, next",onCurrentChange:ra,style:{"margin-top":"16px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),j(ja,{modelValue:oa.value,"onUpdate:modelValue":e[4]||(e[4]=a=>oa.value=a),title:"订单详情",width:"600px"},{default:x(()=>[na.value?(k(),Y(ga,{key:0,column:2,border:""},{default:x(()=>[j(ha,{label:"订单号"},{default:x(()=>[D(w(na.value.order_no),1)]),_:1}),j(ha,{label:"用户"},{default:x(()=>[D(w(na.value.username),1)]),_:1}),j(ha,{label:"订单类型"},{default:x(()=>[D(w(da(na.value.order_type)),1)]),_:1}),j(ha,{label:"金额"},{default:x(()=>{var a;return[D("¥"+w(null==(a=na.value.amount)?void 0:a.toFixed(2)),1)]}),_:1}),j(ha,{label:"状态"},{default:x(()=>[j(va,{type:ua(na.value.status)},{default:x(()=>[D(w(ma(na.value.status)),1)]),_:1},8,["type"])]),_:1}),j(ha,{label:"支付方式"},{default:x(()=>[D(w(pa(na.value.payment_method)),1)]),_:1}),j(ha,{label:"创建时间"},{default:x(()=>[D(w(ca(na.value.created_at)),1)]),_:1}),j(ha,{label:"支付时间"},{default:x(()=>[D(w(na.value.paid_at?ca(na.value.paid_at):"-"),1)]),_:1}),j(ha,{label:"邀请人",span:2},{default:x(()=>[na.value.inviter_name?(k(),h(z,{key:0},[g("span",X,w(na.value.inviter_name),1),j(va,{size:"small",style:{"margin-left":"8px"}},{default:x(()=>[D(w(na.value.inviter_level_name),1)]),_:1})],64)):(k(),h("span",$,"无"))]),_:1}),na.value.commission_amount?(k(),Y(ha,{key:0,label:"产生佣金",span:2},{default:x(()=>{var a;return[g("span",N,"¥"+w(null==(a=na.value.commission_amount)?void 0:a.toFixed(2)),1),g("span",Q,"(佣金比例: "+w((100*na.value.commission_rate).toFixed(0))+"%)",1)]}),_:1})):F("",!0)]),_:1})):F("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-58aa1dd0"]]);export{W as default};
