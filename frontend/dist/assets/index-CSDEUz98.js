import{_ as e}from"./ic_back-BPdSG6fy.js";import{_ as a}from"./no_data-CMy5glMK.js";import{y as l,z as i,C as s,I as t,U as o,H as n,L as r,u,r as c,c as v,O as d,M as p,V as m,K as h,aa as f,G as g,af as _,ae as k,n as y,E as w,a0 as b,j as C,az as $,aE as T,W as x,R as M,w as V,aC as S}from"./vue-vendor-Ba_vealp.js";import{_ as I,a as j,u as E}from"./index-C3P4JTuA.js";import{u as P}from"./useAbortController-pf-gfr0d.js";import{u as D,b as L}from"./useCleanup-GCaf3062.js";import{f as B,a as R}from"./format-s96t4k9e.js";import{_ as z}from"./super_vip_blue-CukdgMfT.js";import{V as O}from"./vip-C8N2TCfr.js";import{E as U}from"./element-plus-DlIn_qXi.js";import{_ as A}from"./ic_launcher-GoPvjxRC.js";import"./utils-DflAyOWx.js";const G={class:"action-bar"},F=["src"],H=["fill"],N={class:"count"},Y={class:"count"},q=["fill"],J={class:"count"},W={class:"count"},X={key:0,class:"vip-tag"},K=I({__name:"ActionBar",props:{video:{type:Object,required:!0},isVip:{type:[Boolean,Number],default:!1}},emits:["like","comment","favorite","share","download","follow","go-profile"],setup(e){const a=(e,a)=>{if(e)return e.startsWith("/")||e.startsWith("http")?e:"/"+e;const l=(parseInt(a)||1)%52;return l<17?`/images/avatars/icon_avatar_${l+1}.webp`:l<32?`/images/avatars/DM_20251217202131_${String(l-17+1).padStart(3,"0")}.JPEG`:`/images/avatars/DM_20251217202341_${String(l-32+1).padStart(3,"0")}.JPEG`};return(c,v)=>(i(),l("div",G,[s("div",{class:"author-avatar",onClick:v[1]||(v[1]=o(a=>c.$emit("go-profile",e.video.uploader_id),["stop"]))},[s("img",{src:a(e.video.uploader_avatar,e.video.uploader_id),alt:""},null,8,F),e.video.is_followed?t("",!0):(i(),l("span",{key:0,class:"follow-btn",onClick:v[0]||(v[0]=o(a=>c.$emit("follow",e.video),["stop"]))},"+"))]),s("div",{class:"action-item",onClick:v[2]||(v[2]=o(e=>c.$emit("like"),["stop"]))},[s("div",{class:n(["icon-wrapper",{liked:e.video.is_liked}])},[(i(),l("svg",{viewBox:"0 0 24 24",fill:e.video.is_liked?"#fe2c55":"white"},[...v[7]||(v[7]=[s("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"},null,-1)])],8,H))],2),s("span",N,r(u(B)(e.video.like_count)),1)]),s("div",{class:"action-item",onClick:v[3]||(v[3]=o(e=>c.$emit("comment"),["stop"]))},[v[8]||(v[8]=s("div",{class:"icon-wrapper"},[s("svg",{viewBox:"0 0 48 48",fill:"white"},[s("path",{d:"M24 4C12.95 4 4 11.95 4 22c0 5.3 2.55 10.05 6.6 13.35L8 44l10.4-5.2c1.8.5 3.65.8 5.6.8 11.05 0 20-7.95 20-18S35.05 4 24 4z"})])],-1)),s("span",Y,r(u(B)(e.video.comment_count)),1)]),s("div",{class:"action-item",onClick:v[4]||(v[4]=o(e=>c.$emit("favorite"),["stop"]))},[s("div",{class:n(["icon-wrapper",{favorited:e.video.is_favorited}])},[(i(),l("svg",{viewBox:"0 0 24 24",fill:e.video.is_favorited?"#ffc107":"white"},[...v[9]||(v[9]=[s("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"},null,-1)])],8,q))],2),s("span",J,r(u(B)(e.video.favorite_count||0)),1)]),s("div",{class:"action-item",onClick:v[5]||(v[5]=o(e=>c.$emit("share"),["stop"]))},[v[10]||(v[10]=s("div",{class:"icon-wrapper"},[s("svg",{viewBox:"0 0 24 24",fill:"white"},[s("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"})])],-1)),s("span",W,r(u(B)(e.video.share_count||0)),1)]),s("div",{class:"action-item",onClick:v[6]||(v[6]=o(e=>c.$emit("download"),["stop"]))},[s("div",{class:n(["icon-wrapper",{"vip-feature":!e.isVip}])},[v[11]||(v[11]=s("svg",{viewBox:"0 0 24 24",fill:"white"},[s("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})],-1)),e.isVip?t("",!0):(i(),l("span",X,"VIP"))],2),v[12]||(v[12]=s("span",{class:"count"},"ä¸‹è½½",-1))])]))}},[["__scopeId","data-v-6ade6d97"]]),Q={class:"video-slide"},Z=["src","poster"],ee={key:0,class:"persistent-pause"},ae={key:1,class:"like-animation"},le={class:"video-info"},ie={class:"author-name"},se={class:"video-title"},te={key:1,class:"video-desc"},oe={key:2,class:"progress-bar-container"},ne={class:"time-display"},re={key:3,class:"trial-countdown"},ue={class:"countdown-text"},ce={key:4,class:"trial-overlay"},ve={class:"trial-content"},de={class:"trial-top-btns"},pe=["disabled"],me=I({__name:"VideoSlide",props:{video:{type:Object,required:!0},isCurrent:{type:Boolean,default:!1},isPlaying:{type:Boolean,default:!1},isVip:{type:[Boolean,Number],default:!1},isTrialEnded:{type:Boolean,default:!1},trialRemaining:{type:Number,default:15},purchasing:{type:Boolean,default:!1},showLikeAnimation:{type:Boolean,default:!1}},emits:["like","comment","favorite","share","download","follow","go-profile","go-vip","purchase","tap","double-tap","time-update","progress-seek","loaded","canplay","play","pause"],setup(e,{expose:a,emit:n}){const f=e,g=n,_=c(null),k=c(0),y=c(0),w=c(!1),b=c(0),C=c(0),$=c(0),T=c(!1);let x=0;const M=v(()=>!!f.video&&(!f.video.is_purchased&&(f.video.trial_seconds&&f.video.trial_seconds>0))),V=()=>{f.isVip&&f.video.is_vip_only||g("go-vip")},S=e=>{if(w.value)return;const a=e.target;a.duration&&(k.value=a.currentTime/a.duration*100,y.value=a.currentTime,g("time-update",{currentTime:a.currentTime,duration:a.duration}))},I=e=>{var a;const l=e.currentTarget.getBoundingClientRect(),i=e.clientX||e.touches&&(null==(a=e.touches[0])?void 0:a.clientX)||0,s=Math.max(0,Math.min(1,(i-l.left)/l.width)),t=f.video.duration||0;if(M.value){const e=f.video.trial_seconds||15;return Math.min(s*t,e)}return s*t},j=e=>{const a=I(e);_.value&&(_.value.currentTime=a,y.value=a,k.value=a/(f.video.duration||1)*100),g("progress-seek",a)},E=()=>{w.value=!0},P=e=>{if(!w.value)return;const a=I(e);_.value&&(_.value.currentTime=a,y.value=a,k.value=a/(f.video.duration||1)*100)},D=()=>{w.value=!1},L=e=>{var a;(null==(a=e.touches)?void 0:a.length)>0&&(b.value=e.touches[0].clientX,C.value=e.touches[0].clientY,$.value=Date.now(),T.value=!1)},B=e=>{var a;if(T.value)return;if(!(null==(a=e.changedTouches)?void 0:a.length))return;const l=e.changedTouches[0];Math.abs(l.clientX-b.value)>15||Math.abs(l.clientY-C.value)>15||(T.value=!0,e.preventDefault(),O())},z=()=>{T.value?T.value=!1:O()},O=()=>{const e=Date.now();e-x<300&&e-x>0?(x=0,g("double-tap")):(x=e,g("tap"))};return a({play:()=>{var e;return null==(e=_.value)?void 0:e.play()},pause:()=>{var e;return null==(e=_.value)?void 0:e.pause()},seek:e=>{_.value&&(_.value.currentTime=e)},getVideoElement:()=>_.value,videoRef:_}),(a,n)=>(i(),l("div",Q,[s("video",{ref_key:"videoRef",ref:_,src:e.video.video_url||e.video.hls_url,poster:e.video.cover_url,class:"short-video",loop:"",playsinline:"","webkit-playsinline":"","x5-playsinline":"",preload:"auto",onTimeupdate:S,onLoadedmetadata:n[0]||(n[0]=e=>a.$emit("loaded")),onCanplay:n[1]||(n[1]=e=>a.$emit("canplay")),onPlay:n[2]||(n[2]=e=>a.$emit("play")),onPause:n[3]||(n[3]=e=>a.$emit("pause"))},null,40,Z),s("div",{class:"tap-area",onTouchstartPassive:L,onTouchend:B,onClick:z},null,32),e.isCurrent&&!e.isPlaying?(i(),l("div",ee,[...n[14]||(n[14]=[s("svg",{viewBox:"0 0 48 48",fill:"none"},[s("path",{d:"M16 10.5C16 9.5 16.8 8.5 18 9L38 22c1.5 1 1.5 3 0 4L18 39c-1.2 0.5-2-0.5-2-1.5V10.5z",fill:"white","fill-opacity":"0.85",stroke:"white","stroke-width":"1","stroke-linejoin":"round","stroke-linecap":"round"})],-1)])])):t("",!0),e.showLikeAnimation?(i(),l("div",ae,[...n[15]||(n[15]=[s("svg",{class:"heart",viewBox:"0 0 24 24",fill:"#fe2c55"},[s("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)])])):t("",!0),d(K,{video:e.video,"is-vip":e.isVip,onLike:n[4]||(n[4]=e=>a.$emit("like")),onComment:n[5]||(n[5]=e=>a.$emit("comment")),onFavorite:n[6]||(n[6]=e=>a.$emit("favorite")),onShare:n[7]||(n[7]=e=>a.$emit("share")),onDownload:n[8]||(n[8]=e=>a.$emit("download")),onFollow:n[9]||(n[9]=e=>a.$emit("follow")),onGoProfile:n[10]||(n[10]=e=>a.$emit("go-profile",e))},null,8,["video","is-vip"]),s("div",le,[e.video.is_vip_only||M.value?(i(),l("div",{key:0,class:"vip-tip-bar",onClick:o(V,["stop"])},[e.isVip&&e.video.is_vip_only?(i(),l(p,{key:0},[n[16]||(n[16]=s("span",{class:"vip-icon"},"ðŸ‘‘",-1)),n[17]||(n[17]=s("span",{class:"vip-text"},"å·²äº«VIPå…è´¹ç‰¹æƒ",-1))],64)):(i(),l(p,{key:1},[n[18]||(n[18]=s("span",{class:"vip-text"},"å¼€é€šä¼šå‘˜ ç•…äº«å®Œæ•´ç‰ˆ",-1)),n[19]||(n[19]=s("span",{class:"vip-arrow"},"â€º",-1))],64))])):t("",!0),s("div",ie,"@"+r(e.video.uploader_nickname||"ç”¨æˆ·"),1),s("div",se,r(e.video.title),1),e.video.description?(i(),l("div",te,r(e.video.description),1)):t("",!0)]),e.isCurrent?(i(),l("div",oe,[s("span",ne,r(u(R)(y.value))+" / "+r(u(R)(e.video.duration)),1),s("div",{class:"progress-bar",onClick:o(j,["stop"]),onTouchstart:o(E,["stop"]),onTouchmove:o(P,["stop"]),onTouchend:o(D,["stop"])},[s("div",{class:"progress",style:m({width:k.value+"%"})},null,4),s("div",{class:"progress-thumb",style:m({left:k.value+"%"})},null,4)],32)])):t("",!0),e.isCurrent&&M.value&&!e.isTrialEnded&&e.trialRemaining>0&&e.trialRemaining<=5?(i(),l("div",re,[s("span",ue,"è¯•çœ‹å‰©ä½™ "+r(e.trialRemaining)+"s",1)])):t("",!0),e.isCurrent&&e.isTrialEnded&&M.value?(i(),l("div",ce,[s("div",ve,[n[22]||(n[22]=s("h3",null,"è¯•çœ‹ç»“æŸ",-1)),n[23]||(n[23]=s("p",{class:"trial-subtitle"},"å¼€é€šVIP æ°¸ä¹…å…è´¹è§‚çœ‹",-1)),s("div",de,[s("button",{class:"share-btn",onClick:n[11]||(n[11]=o(e=>a.$emit("share"),["stop"]))},"åˆ†äº«å¾—3æ—¥VIP"),s("button",{class:"vip-btn",onClick:n[12]||(n[12]=o(e=>a.$emit("go-vip"),["stop"]))},"å¼€é€šVIPå…è´¹çœ‹")]),n[24]||(n[24]=s("div",{class:"trial-divider"},"æˆ–",-1)),s("button",{class:"coin-purchase-btn",onClick:n[13]||(n[13]=o(e=>a.$emit("purchase"),["stop"])),disabled:e.purchasing},[n[20]||(n[20]=s("span",{class:"coin-icon"},"ðŸª™",-1)),h(" "+r(e.video.coin_price||20)+" é‡‘å¸è´­ä¹°æœ¬ç‰‡ ",1),n[21]||(n[21]=s("span",{class:"arrow"},"â€º",-1))],8,pe)])])):t("",!0)]))}},[["__scopeId","data-v-9f7e200f"]]),he={class:"drawer-content"},fe={class:"drawer-header"},ge={class:"comment-count"},_e={class:"comments-list"},ke={key:0,class:"comment-item official-announcement"},ye=["src"],we={class:"comment-body"},be={class:"comment-user"},Ce={class:"username official-name"},$e={class:"comment-text official-text"},Te={class:"comment-meta"},xe={class:"time"},Me=["src","onClick"],Ve={class:"comment-body"},Se={class:"comment-user"},Ie=["onClick"],je=["src"],Ee={class:"comment-text"},Pe=["onClick"],De=["src"],Le={class:"comment-meta"},Be={class:"time"},Re=["onClick"],ze=["onClick"],Oe={key:1,class:"replies-section"},Ue=["onClick"],Ae={key:1,class:"replies-list"},Ge=["src","onClick"],Fe={class:"reply-body"},He={class:"reply-user"},Ne=["onClick"],Ye=["src"],qe={class:"reply-text"},Je=["onClick"],We=["src"],Xe={class:"reply-meta"},Ke={class:"time"},Qe=["onClick"],Ze=["onClick"],ea=["onClick"],aa={key:1,class:"empty-comments"},la={class:"comment-input-bar"},ia={key:1,class:"input-area"},sa={key:0,class:"reply-hint"},ta={key:1,class:"image-preview"},oa=["src"],na={class:"input-row"},ra=["placeholder"],ua={class:"input-actions"},ca={class:"image-btn"},va={key:2,class:"emoji-picker"},da={class:"emoji-grid"},pa=["onClick"],ma=I({__name:"CommentsDrawer",props:{visible:{type:Boolean,default:!1},video:{type:Object,default:null},isVip:{type:[Boolean,Number],default:!1}},emits:["close","go-profile","go-vip","comment-added"],setup(e,{expose:a,emit:u}){const v=e,d=u,m=c([]),w=c(null),b=c(""),C=c(null),$=c(""),T=c(!1),x=c(null),M=c(null),V=c(!1),S=c(null),I=["ðŸ˜€","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜œ","ðŸ¤ª","ðŸ˜Ž","ðŸ¥³","ðŸ˜‡","ðŸ¤©","ðŸ˜‹","ðŸ˜›","ðŸ¤¤","ðŸ˜","ðŸ˜’","ðŸ˜”","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜ ","ðŸ¤¬","ðŸ˜±","ðŸ˜°","ðŸ˜¥","ðŸ¤§","ðŸ˜·","ðŸ¤’","ðŸ‘","ðŸ‘Ž","ðŸ‘","ðŸ™","ðŸ’ª","â¤ï¸","ðŸ’”","ðŸ’¯","ðŸ”¥","âœ¨","ðŸŽ‰","ðŸŽŠ","ðŸ’Ž","ðŸ†","ðŸ¥‡","â­","ðŸŒŸ","ðŸ’«","ðŸŒˆ","â˜€ï¸"],E=async()=>{var e;if(v.video)try{const[a,l]=await Promise.all([j.get(`/comments/video/${v.video.id}`),j.get("/settings/comment-announcement").catch(()=>null)]);m.value=(null==(e=a.data)?void 0:e.items)||a.data||[],l&&(w.value=l.data||l)}catch(a){}},P=async()=>{var e,a,l;if((b.value.trim()||C.value)&&v.video&&!T.value)if(v.isVip){T.value=!0;try{let a=null;if(C.value){const l=new FormData;l.append("file",C.value);const i=await j.post("/comments/upload-image",l,{headers:{"Content-Type":"multipart/form-data"}});a=(null==(e=i.data)?void 0:e.url)||i.url}const l={content:b.value,video_id:v.video.id,image_url:a};M.value&&(l.parent_id=M.value),await j.post("/comments",l),U.success(M.value?"å›žå¤æˆåŠŸ":"è¯„è®ºæˆåŠŸ"),b.value="",C.value=null,$.value="",V.value=!1,B(),d("comment-added"),await E()}catch(i){U.error((null==(l=null==(a=i.response)?void 0:a.data)?void 0:l.detail)||"è¯„è®ºå¤±è´¥")}finally{T.value=!1}}else U.warning("è¯·å…ˆå¼€é€šVIPä¼šå‘˜æ‰èƒ½å‘è¡¨è¯„è®º")},D=async e=>{var a,l;try{const l=await j.post(`/comments/${e.id}/like`);e.is_liked=!e.is_liked,e.like_count=(null==(a=l.data)?void 0:a.like_count)||l.like_count}catch(i){401===(null==(l=i.response)?void 0:l.status)&&U.warning("è¯·å…ˆç™»å½•åŽå†ç‚¹èµž")}},L=(e,a=null)=>{x.value=a||e,M.value=e.id,y(()=>{var e;return null==(e=S.value)?void 0:e.focus()})},B=()=>{x.value=null,M.value=null},R=e=>window.open(e,"_blank"),A=e=>{const a=e.target.files[0];a&&(a.size>5242880?U.warning("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB"):a.type.startsWith("image/")?(C.value=a,$.value=URL.createObjectURL(a)):U.warning("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶"))},G=()=>{C.value=null,$.value=""},F=e=>O[e]||"",H=(e,a)=>{if(e)return e.startsWith("/")||e.startsWith("http")?e:"/"+e;const l=(parseInt(a)||1)%52;return l<17?`/images/avatars/icon_avatar_${l+1}.webp`:l<32?`/images/avatars/DM_20251217202131_${String(l-17+1).padStart(3,"0")}.JPEG`:`/images/avatars/DM_20251217202341_${String(l-32+1).padStart(3,"0")}.JPEG`},N=e=>{if(!e)return"";const a=new Date(e),l=(new Date).getTime()-a.getTime(),i=Math.floor(l/6e4),s=Math.floor(l/36e5),t=Math.floor(l/864e5);return i<1?"åˆšåˆš":i<60?`${i}åˆ†é’Ÿå‰`:s<24?`${s}å°æ—¶å‰`:t<7?`${t}å¤©å‰`:`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},Y=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`};return a({loadComments:E}),(a,u)=>{var c,v;return e.visible?(i(),l("div",{key:0,class:"comments-drawer",onClick:u[4]||(u[4]=o(e=>a.$emit("close"),["self"]))},[s("div",he,[s("div",fe,[s("span",ge,r((null==(c=e.video)?void 0:c.comment_count)||0)+" æ¡è¯„è®º",1),s("span",{class:"close-btn",onClick:u[0]||(u[0]=e=>a.$emit("close"))},"Ã—")]),s("div",_e,[(null==(v=w.value)?void 0:v.enabled)?(i(),l("div",ke,[s("img",{src:w.value.avatar||"/images/avatars/icon_avatar_1.webp",class:"comment-avatar"},null,8,ye),s("div",we,[s("div",be,[s("span",Ce,r(w.value.name),1),u[5]||(u[5]=s("img",{src:z,class:"supreme-vip-icon"},null,-1))]),s("div",$e,r(w.value.content),1),s("div",Te,[s("span",xe,r(Y(w.value.updated_at)),1)])])])):t("",!0),(i(!0),l(p,null,f(m.value,e=>(i(),l("div",{key:e.id,class:"comment-item"},[s("img",{src:H(e.user_avatar,e.user_id),class:"comment-avatar clickable",onClick:l=>a.$emit("go-profile",e.user_id)},null,8,Me),s("div",Ve,[s("div",Se,[s("span",{class:"username clickable",onClick:l=>a.$emit("go-profile",e.user_id)},r(e.user_nickname||e.user_name),9,Ie),e.user_vip_level>0?(i(),l("img",{key:0,src:F(e.user_vip_level),class:"vip-badge-sm"},null,8,je)):t("",!0)]),s("div",Ee,r(e.content),1),e.image_url?(i(),l("div",{key:0,class:"comment-image",onClick:a=>R(e.image_url)},[s("img",{src:e.image_url,alt:"comment image"},null,8,De)],8,Pe)):t("",!0),s("div",Le,[s("span",Be,r(N(e.created_at)),1),s("span",{class:"reply-btn",onClick:o(a=>L(e),["stop"])},"å›žå¤",8,Re),s("span",{class:n(["like-btn",{liked:e.is_liked}]),onClick:o(a=>D(e),["stop"])},r(e.is_liked?"â¤ï¸":"ðŸ¤")+" "+r(e.like_count||0),11,ze)]),e.reply_count>0?(i(),l("div",Oe,[e.showReplies?(i(),l("div",Ae,[(i(!0),l(p,null,f(e.replies,u=>(i(),l("div",{key:u.id,class:"reply-item"},[s("img",{src:H(u.user_avatar,u.user_id),class:"reply-avatar clickable",onClick:e=>a.$emit("go-profile",u.user_id)},null,8,Ge),s("div",Fe,[s("div",He,[s("span",{class:"username clickable",onClick:e=>a.$emit("go-profile",u.user_id)},r(u.user_nickname||u.user_name),9,Ne),u.user_vip_level>0?(i(),l("img",{key:0,src:F(u.user_vip_level),class:"vip-badge-xs"},null,8,Ye)):t("",!0)]),s("div",qe,r(u.content),1),u.image_url?(i(),l("div",{key:0,class:"reply-image",onClick:e=>R(u.image_url)},[s("img",{src:u.image_url,alt:"reply image"},null,8,We)],8,Je)):t("",!0),s("div",Xe,[s("span",Ke,r(N(u.created_at)),1),s("span",{class:"reply-btn",onClick:o(a=>L(e,u),["stop"])},"å›žå¤",8,Qe),s("span",{class:n(["like-btn",{liked:u.is_liked}]),onClick:o(e=>D(u),["stop"])},r(u.is_liked?"â¤ï¸":"ðŸ¤")+" "+r(u.like_count||0),11,Ze)])])]))),128)),s("div",{class:"hide-replies-btn",onClick:o(a=>e.showReplies=!1,["stop"])},"æ”¶èµ·å›žå¤ â–²",8,ea)])):(i(),l("div",{key:0,class:"view-replies-btn",onClick:o(a=>(async e=>{var a;try{const l=await j.get(`/comments/replies/${e.id}`);e.replies=(null==(a=l.data)?void 0:a.items)||l.data||[],e.showReplies=!0}catch(l){U.error("åŠ è½½å›žå¤å¤±è´¥")}})(e),["stop"])}," æŸ¥çœ‹ "+r(e.reply_count)+" æ¡å›žå¤ â–¼ ",9,Ue))])):t("",!0)])]))),128)),0===m.value.length?(i(),l("div",aa,"æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘~")):t("",!0)]),s("div",la,[e.isVip?(i(),l("div",ia,[x.value?(i(),l("div",sa,[s("span",null,"å›žå¤ @"+r(x.value.user_nickname||x.value.user_name),1),s("span",{class:"cancel-reply",onClick:B},"Ã—")])):t("",!0),C.value?(i(),l("div",ta,[s("img",{src:$.value,alt:"preview"},null,8,oa),s("span",{class:"remove-image",onClick:G},"Ã—")])):t("",!0),s("div",na,[g(s("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=e=>b.value=e),placeholder:x.value?`å›žå¤ @${x.value.user_nickname||x.value.user_name}`:"è¯´ç‚¹ä»€ä¹ˆå§...",onKeyup:k(P,["enter"]),ref_key:"inputRef",ref:S},null,40,ra),[[_,b.value]]),s("div",ua,[s("span",{class:"emoji-btn",onClick:u[3]||(u[3]=e=>V.value=!V.value)},"ðŸ˜Š"),s("label",ca,[s("input",{type:"file",accept:"image/*",onChange:A,hidden:""},null,32),u[7]||(u[7]=h("ðŸ–¼ï¸ ",-1))]),s("span",{class:n(["send-btn",{disabled:T.value}]),onClick:P},[...u[8]||(u[8]=[s("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[s("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])],2)])]),V.value?(i(),l("div",va,[s("div",da,[(i(),l(p,null,f(I,e=>s("span",{key:e,class:"emoji-item",onClick:a=>(e=>{var a;b.value+=e,V.value=!1,null==(a=S.value)||a.focus()})(e)},r(e),9,pa)),64))])])):t("",!0)])):(i(),l("div",{key:0,class:"vip-comment-tip",onClick:u[1]||(u[1]=e=>a.$emit("go-vip"))},[...u[6]||(u[6]=[s("span",{class:"tip-icon"},"ðŸ‘‘",-1),s("span",{class:"tip-text"},"å¼€é€šVIPå³å¯å‘è¡¨è¯„è®º",-1),s("span",{class:"tip-btn"},"ç«‹å³å¼€é€š â€º",-1)])]))])])])):t("",!0)}}},[["__scopeId","data-v-3f938bc8"]]),ha={class:"share-modal-content"},fa={class:"share-promo-image"},ga=["src"],_a={class:"share-qr-section"},ka={class:"share-qrcode"},ya=["src"],wa={class:"share-invite-info"},ba={class:"invite-code"},Ca={class:"official-url"},$a=I({__name:"ShareModal",props:{visible:{type:Boolean,default:!1},video:{type:Object,default:null},inviteCode:{type:String,default:"3AUUHR"}},emits:["close"],setup(e){const a=e,n=v(()=>window.location.origin.replace(/^https?:\/\//,"")),u=v(()=>a.video?`${window.location.origin}/shorts/${a.video.id}?ref=${a.inviteCode}`:""),c=v(()=>`https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(u.value)}`),d=()=>{navigator.clipboard.writeText(u.value).then(()=>{U.success("åˆ†äº«é“¾æŽ¥å·²å¤åˆ¶ï¼Œåˆ†äº«ç»™å¥½å‹æ³¨å†ŒåŽå¯èŽ·å¾—3æ—¥VIP")}).catch(()=>{U.info("è¯·å¤åˆ¶é“¾æŽ¥åˆ†äº«ï¼š"+u.value)})},p=()=>{U.info("é•¿æŒ‰å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œ")};return(a,u)=>{var v;return i(),w(b,{to:"body"},[e.visible?(i(),l("div",{key:0,class:"share-modal-overlay",onClick:u[1]||(u[1]=o(e=>a.$emit("close"),["self"]))},[s("div",ha,[s("button",{class:"share-modal-close",onClick:u[0]||(u[0]=e=>a.$emit("close"))},"Ã—"),u[3]||(u[3]=s("div",{class:"share-header"},[s("img",{src:A,alt:"Logo",class:"share-logo"}),s("div",{class:"share-title-info"},[s("h3",{class:"share-site-name"},"Soulæˆäººç‰ˆ"),s("p",{class:"share-site-desc"},"å…¨ç½‘æœ€å…¨æˆäººè§†é¢‘å¹³å°")])],-1)),s("div",fa,[s("img",{src:(null==(v=e.video)?void 0:v.cover_url)||"/images/default-cover.webp",alt:"æŽ¨å¹¿å›¾"},null,8,ga)]),s("div",_a,[s("div",ka,[s("img",{src:c.value,alt:"äºŒç»´ç "},null,8,ya)]),s("div",wa,[s("div",ba,[u[2]||(u[2]=h("é‚€è¯·ç  ",-1)),s("span",null,r(e.inviteCode),1)]),s("div",Ca,"å®˜æ–¹ç½‘å€:"+r(n.value),1)])]),s("div",{class:"share-actions"},[s("button",{class:"copy-link-btn",onClick:d},"å¤åˆ¶é“¾æŽ¥"),s("button",{class:"save-image-btn",onClick:p},"ä¿å­˜å›¾ç‰‡")])])])):t("",!0)])}}},[["__scopeId","data-v-f9bdc9e7"]]),Ta={class:"short-video-page"},xa={class:"short-header"},Ma={class:"header-tabs"},Va={key:0,class:"loading-indicator"},Sa={key:1,class:"empty-state"},Ia=I({__name:"index",setup(o){const r=$(),u=S(),h=E(),{signal:g}=P(),_=D(),k=L(),b=v(()=>{var e,a;return h.isVip||!0===(null==(e=h.user)?void 0:e.is_vip)||(null==(a=h.user)?void 0:a.vip_level)&&h.user.vip_level>0}),I=c([]),B=c(0),R=c(!1),z=c(1),O=c(!0),A=c("recommend"),G=c(!1),F=c(!1),H=c(!1),N=c(!1),Y=c(15),q=c({});let J=null,W=0;const X=c(null),K=c(0),Q=c(0),Z=c(!1),ee=c(!1),ae=c(0),le=c(!1),ie=c(-1),se=c(!1),te=c(null),oe=c(null),ne=c(!1),re=c(null),ue=c("3AUUHR"),ce=c(!1),ve=c(-1),de=c({}),pe=()=>{var e,a;return null==(a=null==(e=q.value[B.value])?void 0:e.getVideoElement)?void 0:a.call(e)},he=e=>!!e&&(!e.is_purchased&&(e.trial_seconds&&e.trial_seconds>0)),fe=e=>e&&he(e)?e.trial_seconds||15:0,ge=async(e=!1)=>{var a;if(!R.value&&(O.value||e)){R.value=!0;try{e&&(z.value=1,I.value=[],B.value=0,N.value=!1);const l=await j.get("/shorts",{params:{page:z.value,limit:10},signal:g}),i=l.data||l;(null==(a=i.items)?void 0:a.length)>0?(I.value=e?i.items:[...I.value,...i.items],O.value=i.has_more,z.value++,e&&i.items.length>0&&(Y.value=fe(i.items[0]),F.value=!1,H.value=!1,await y(),_e())):O.value=!1}catch(l){"CanceledError"!==l.name&&l.name}finally{R.value=!1}}},_e=()=>{J&&_.clearTimeout(J),J=_.setTimeout(()=>{J=null,F.value||ke()},200)},ke=()=>{var e;const a=Date.now()-W;if(W>0&&a<500)return;Object.entries(q.value).forEach(([e,a])=>{var l;parseInt(e)!==B.value&&(null==(l=null==a?void 0:a.pause)||l.call(a))});const l=q.value[B.value];if(l&&!F.value){const a=null==(e=l.getVideoElement)?void 0:e.call(l);a&&a.play().catch(e=>{"NotAllowedError"===e.name&&(a.muted=!0,a.play().catch(()=>{}))})}},ye=e=>{ee.value||(Q.value=e.touches[0].clientY,Z.value=!0)},we=e=>{if(!Z.value)return;const a=e.touches[0].clientY-Q.value,l=-B.value*ae.value+a,i=-(I.value.length-1)*ae.value;K.value=Math.max(i-100,Math.min(100,l))},be=e=>{if(!Z.value)return;Z.value=!1;const a=e.changedTouches[0].clientY-Q.value,l=.2*ae.value;Math.abs(a)>l?a<0&&B.value<I.value.length-1?Ce(B.value+1):a>0&&B.value>0?Ce(B.value-1):Ce(B.value):Ce(B.value),B.value>=I.value.length-3&&ge()},Ce=e=>{var a,l;const i=e!==B.value;if(ee.value=!0,K.value=-e*ae.value,i){Object.entries(q.value).forEach(([a,l])=>{var i;parseInt(a)!==e&&(null==(i=null==l?void 0:l.pause)||i.call(l))}),B.value=e,F.value=!1,H.value=!1,N.value=!1;const i=I.value[e];Y.value=fe(i),null==(l=null==(a=q.value[e])?void 0:a.seek)||l.call(a,0),J&&(_.clearTimeout(J),J=null),J=_.setTimeout(()=>{ee.value=!1,J=null,F.value||ke()},300)}else _.setTimeout(()=>{ee.value=!1},300)},$e=async e=>{const a=I.value[e];if(!a)return;const l=`like_${a.id}`;if(de.value[l])return;de.value[l]=!0;const i=a.is_liked,s=a.like_count||0;a.is_liked=!i,a.like_count=i?Math.max(0,s-1):s+1;try{const e=await j.post(`/shorts/${a.id}/like`),l=e.data||e;a.is_liked=l.liked,a.like_count=l.like_count}catch(t){a.is_liked=i,a.like_count=s,U.error("æ“ä½œå¤±è´¥")}finally{de.value[l]=!1}},Te=()=>u.back(),xe=e=>{e&&u.push(`/user/member/${e}`)},Me=()=>{J&&(_.clearTimeout(J),J=null),Object.values(q.value).forEach(e=>{var a;try{const l=null==(a=null==e?void 0:e.getVideoElement)?void 0:a.call(e);l&&(l.pause(),l.removeAttribute("src"),l.load())}catch(l){}}),q.value={}},Ve=()=>{ae.value=window.innerHeight,K.value=-B.value*ae.value};return C(async()=>{var e;h.token&&(await h.fetchUser(),(async()=>{var e;try{const a=await j.get("/coins/balance",{signal:g});ve.value=(null==(e=a.data)?void 0:e.balance)||a.balance||0}catch(a){"CanceledError"!==a.name&&"AbortError"!==a.name&&(ve.value=-1)}})()),ae.value=window.innerHeight;const a=r.query.id||r.params.id;if(a)try{const l=await j.get(`/shorts/${a}`,{signal:g}),i=l.data||l;if(null==i?void 0:i.id){I.value=[i],B.value=0,Y.value=fe(i),F.value=!1,H.value=!1,await y(),_e(),z.value=1;const l=await j.get("/shorts",{params:{page:1,limit:10},signal:g}),s=l.data||l;if((null==(e=s.items)?void 0:e.length)>0){const e=s.items.filter(e=>e.id!==parseInt(a));I.value=[i,...e],O.value=s.has_more,z.value=2}return R.value=!1,void k.addEventListener(window,"resize",Ve)}}catch(l){"CanceledError"!==l.name&&l.name}ge(!0),k.addEventListener(window,"resize",Ve)}),T((e,a,l)=>{Me(),l()}),x(()=>Me()),M(()=>Me()),V(A,()=>ge(!0)),V(()=>r.path,(e,a)=>{(null==a?void 0:a.includes("/short"))&&!(null==e?void 0:e.includes("/short"))&&Me()}),(o,r)=>(i(),l("div",Ta,[s("header",xa,[s("div",{class:"back-btn",onClick:Te},[...r[8]||(r[8]=[s("img",{src:e,alt:"è¿”å›ž",class:"back-icon"},null,-1)])]),s("div",Ma,[s("span",{class:n(["tab-item",{active:"recommend"===A.value}]),onClick:r[0]||(r[0]=e=>A.value="recommend")},"æŽ¨è",2),s("span",{class:n(["tab-item",{active:"follow"===A.value}]),onClick:r[1]||(r[1]=e=>A.value="follow")},"å…³æ³¨",2)]),s("div",{class:"search-btn",onClick:r[2]||(r[2]=e=>o.$router.push("/user/search"))},[...r[9]||(r[9]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"11",cy:"11",r:"8"}),s("path",{d:"m21 21-4.35-4.35"})],-1)])])]),s("div",{class:"video-swiper",ref_key:"swiperRef",ref:X,onTouchstart:ye,onTouchmove:we,onTouchend:be},[s("div",{class:"video-track",style:m({transform:`translateY(${K.value}px)`,transition:ee.value?"transform 0.3s ease":"none"})},[(i(!0),l(p,null,f(I.value,(e,a)=>(i(),w(me,{key:e.id,ref_for:!0,ref:e=>((e,a)=>{a&&(q.value[e]=a)})(a,e),video:e,"is-current":B.value===a,"is-playing":B.value===a&&G.value,"is-vip":b.value,"is-trial-ended":B.value===a&&N.value,"trial-remaining":Y.value,purchasing:ce.value,"show-like-animation":le.value&&ie.value===a,onLike:e=>$e(a),onComment:a=>(async e=>{var a;te.value=e,se.value=!0,await y(),null==(a=oe.value)||a.loadComments()})(e),onFavorite:e=>(async e=>{const a=I.value[e];if(!a)return;const l=`favorite_${a.id}`;if(de.value[l])return;de.value[l]=!0;const i=a.is_favorited,s=a.favorite_count||0;a.is_favorited=!i,a.favorite_count=i?Math.max(0,s-1):s+1;try{const e=await j.post(`/shorts/${a.id}/favorite`),l=e.data||e;a.is_favorited=l.favorited,a.favorite_count=l.favorite_count,U.success(l.favorited?"æ”¶è—æˆåŠŸ":"å·²å–æ¶ˆæ”¶è—")}catch(t){a.is_favorited=i,a.favorite_count=s,U.error("æ“ä½œå¤±è´¥")}finally{de.value[l]=!1}})(a),onShare:a=>(e=>{re.value=e,ne.value=!0})(e),onDownload:a=>(async e=>{var a,l,i,s,t;if(!b.value)return U.warning("ä¸‹è½½åŠŸèƒ½ä»…é™VIPä¼šå‘˜ä½¿ç”¨"),void u.push("/user/vip");try{const a=await j.get(`/shorts/${e.id}/download-info`,{signal:g}),l=a.data||a;if(!l.can_download)return void U.warning(l.message||"æ— æ³•ä¸‹è½½æ­¤è§†é¢‘");U.info(`æ­£åœ¨ä¸‹è½½: ${l.title} (${l.file_size_mb||0}MB)`);const i=localStorage.getItem("video_downloads"),s=i?JSON.parse(i):[],t={id:`short_${e.id}_${Date.now()}`,videoId:e.id,title:e.title,thumbnail:e.cover_url,duration:e.duration,type:"short",status:"completed",downloadTime:Date.now()},o=s.findIndex(e=>e.videoId===t.videoId&&e.type===t.type);o>-1?s[o]=t:s.unshift(t),s.length>100&&s.pop(),localStorage.setItem("video_downloads",JSON.stringify(s));const n=document.createElement("a");n.href=`/api/v1/shorts/${e.id}/download`,n.download=`${l.title}.mp4`,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),U.success("ä¸‹è½½å·²å¼€å§‹")}catch(o){403===(null==(a=o.response)?void 0:a.status)?(U.warning("ä¸‹è½½åŠŸèƒ½ä»…é™VIPä¼šå‘˜ä½¿ç”¨"),u.push("/user/vip")):404===(null==(l=o.response)?void 0:l.status)?U.error("è§†é¢‘æ–‡ä»¶ä¸å­˜åœ¨"):429===(null==(i=o.response)?void 0:i.status)?U.warning((null==(t=null==(s=o.response)?void 0:s.data)?void 0:t.detail)||"ä»Šæ—¥ä¸‹è½½æ¬¡æ•°å·²è¾¾ä¸Šé™"):U.error("ä¸‹è½½å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}})(e),onFollow:a=>(async e=>{var a,l,i,s;const t=e.uploader_id;if(!t)return;const o=`follow_${t}`;if(!de.value[o]){de.value[o]=!0;try{await j.post(`/users/${t}/follow`),e.is_followed=!0,U.success("å…³æ³¨æˆåŠŸ")}catch(n){401===(null==(a=n.response)?void 0:a.status)?U.warning("è¯·å…ˆç™»å½•"):400===(null==(l=n.response)?void 0:l.status)?e.is_followed=!0:U.error((null==(s=null==(i=n.response)?void 0:i.data)?void 0:s.detail)||"å…³æ³¨å¤±è´¥")}finally{_.setTimeout(()=>{de.value[o]=!1},500)}}})(e),onGoProfile:xe,onGoVip:r[3]||(r[3]=e=>o.$router.push("/user/vip")),onPurchase:a=>(async e=>{var a,l;if(ce.value)return;if(e.is_purchased)return N.value=!1,void ke();const i=e.coin_price||20;if(ve.value>=0&&ve.value<i)return U.warning("é‡‘å¸ä¸è¶³ï¼Œè¯·å…ˆå……å€¼"),void u.push("/user/coins");ce.value=!0;try{await j.post(`/coins/purchase/video/${e.id}`),U.success("è´­ä¹°æˆåŠŸï¼"),e.is_purchased=!0,N.value=!1,Y.value=fe(e),ve.value=Math.max(0,ve.value-i),ke()}catch(s){const i=null==(l=null==(a=s.response)?void 0:a.data)?void 0:l.detail;"æ‚¨å·²è´­ä¹°è¿‡æ­¤è§†é¢‘"===i?(e.is_purchased=!0,N.value=!1,ke(),U.success("è§†é¢‘å·²è§£é”")):"æ­¤è§†é¢‘æ— éœ€è´­ä¹°"===i?(N.value=!1,ke()):"é‡‘å¸ä½™é¢ä¸è¶³"===i?(ve.value=0,U.warning("é‡‘å¸ä¸è¶³ï¼Œè¯·å…ˆå……å€¼"),u.push("/user/coins")):U.error(i||"è´­ä¹°å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{ce.value=!1}})(e),onTap:e=>(e=>{if(e!==B.value)return;const a=I.value[e];if(N.value&&he(a))return;const l=pe();l&&(l.paused?(Object.entries(q.value).forEach(([a,l])=>{var i;parseInt(a)!==e&&(null==(i=null==l?void 0:l.pause)||i.call(l))}),H.value=!0,F.value=!1,W=0,l.play().catch(e=>{"NotAllowedError"===e.name&&(l.muted=!0,l.play().catch(()=>{}))})):(F.value=!0,W=Date.now(),J&&(_.clearTimeout(J),J=null),l.pause()))})(a),onDoubleTap:e=>(e=>{I.value[e].is_liked||$e(e),ie.value=e,le.value=!0,_.setTimeout(()=>{le.value=!1},1e3)})(a),onTimeUpdate:e=>((e,{currentTime:a})=>{var l;if(e!==B.value)return;const i=I.value[e];if(he(i)&&!N.value){const e=fe(i);Y.value=Math.max(0,Math.ceil(e-a)),a>=e&&(N.value=!0,null==(l=pe())||l.pause(),G.value=!1)}})(a,e)},null,8,["video","is-current","is-playing","is-vip","is-trial-ended","trial-remaining","purchasing","show-like-animation","onLike","onComment","onFavorite","onShare","onDownload","onFollow","onPurchase","onTap","onDoubleTap","onTimeUpdate"]))),128))],4)],544),R.value?(i(),l("div",Va,[...r[10]||(r[10]=[s("span",{class:"spinner"},null,-1)])])):t("",!0),R.value||0!==I.value.length?t("",!0):(i(),l("div",Sa,[...r[11]||(r[11]=[s("img",{src:a,alt:""},null,-1),s("p",null,"æš‚æ— çŸ­è§†é¢‘å†…å®¹",-1)])])),d(ma,{ref_key:"commentsDrawerRef",ref:oe,visible:se.value,video:te.value,"is-vip":b.value,onClose:r[4]||(r[4]=e=>se.value=!1),onGoProfile:xe,onGoVip:r[5]||(r[5]=e=>o.$router.push("/user/vip")),onCommentAdded:r[6]||(r[6]=e=>te.value&&te.value.comment_count++)},null,8,["visible","video","is-vip"]),d($a,{visible:ne.value,video:re.value,"invite-code":ue.value,onClose:r[7]||(r[7]=e=>ne.value=!1)},null,8,["visible","video","invite-code"])]))}},[["__scopeId","data-v-384919d8"]]);export{Ia as default};
