import{r as e,j as a,n as l,R as s,y as i,C as t,I as r,O as o,M as n,aa as c,K as u,V as v,H as d,aC as m,z as g,L as k}from"./vue-vendor-Ba_vealp.js";import{_ as p,a as h}from"./index-C3P4JTuA.js";import{S as y}from"./SearchHeader-hqKygmDY.js";import"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";import"./ic_back-BPdSG6fy.js";const _={class:"search-page"},w={key:0,class:"ad-section"},f={class:"ad-row"},b=["onClick"],C={class:"ad-img"},E=["src","onError"],S={class:"ad-name"},M={key:0,class:"ad-row-scroll"},T={class:"scroll-track"},j={class:"scroll-content"},I=["onClick"],x={class:"ad-img"},z=["src","onError"],$={class:"ad-name"},H=["onClick"],L={class:"ad-img"},O=["src","onError"],W={class:"ad-name"},J={key:1,class:"search-history-section"},N={class:"history-tags"},P=["onClick"],R={class:"hot-search-section"},V={class:"hot-list"},q=["onClick"],F={key:0,src:"/images/backgrounds/hot_1.webp",alt:"1",class:"rank-icon"},K={key:1,src:"/images/backgrounds/hot_2.webp",alt:"2",class:"rank-icon"},U={key:2,src:"/images/backgrounds/hot_3.webp",alt:"3",class:"rank-icon"},A={class:"keyword"},B={class:"filter-tabs"},D=["onClick"],G={key:0,class:"toggle-icon"},Q={key:1,class:"toggle-icon grid"},X={class:"video-section"},Y=["onClick","onMouseenter","onMouseleave"],Z={class:"video-cover"},ee=["src","alt"],ae=["src"],le={class:"cover-views"},se={class:"video-duration"},ie={key:1,class:"vip-tag"},te={class:"video-info"},re={class:"video-title"},oe={class:"video-meta"},ne={key:0,class:"video-tag"},ce={key:1,class:"video-tag"},ue={key:2,class:"video-tag"},ve={key:3,class:"video-tag"},de={class:"video-comments"},me="video_search_history",ge=p({__name:"Search",setup(p){const ge=e(null),ke=e(118),pe=m();e("search");const he=e(""),ye=e(0),_e=e(!0),we=e(2),fe=e({}),be=e(null);let Ce=null;const Ee=e(!1),Se=e=>be.value===e,Me=e=>{if(be.value&&be.value!==e.id){const e=fe.value[be.value];e&&(e.pause(),e.currentTime=0)}be.value=e.id;const a=fe.value[e.id];a&&(a.currentTime=0,a.play().catch(e=>{}))},Te=()=>{Ee.value=!0},je=e=>{Ee.value&&e.preview_url?be.value===e.id?((()=>{if(be.value){const e=fe.value[be.value];e&&(e.pause(),e.currentTime=0),be.value=null}})(),qe(e.id)):Me(e):qe(e.id)},Ie=e=>e?(e.startsWith("http"),e):"",xe=e([]),ze=()=>{xe.value=[];try{localStorage.removeItem(me)}catch(e){}},$e=e([]),He=e([]),Le=e=>{e.link&&"#"!==e.link&&window.open(e.link,"_blank")},Oe=e(["制服","学生","萝莉","少女","白虎","巨乳","乱伦","调教","口交","内射"]),We=e([{key:"week",label:"本周最热"},{key:"month",label:"本月最热"},{key:"lastMonth",label:"上月最热"}]),Je=e([]),Ne=e(!1),Pe=async()=>{var e;Ne.value=!0;try{const a=We.value[ye.value].key,l=await h.get("/videos",{params:{page:1,page_size:20,sort_by:"view_count",time_range:a}});Je.value=((null==(e=l.data)?void 0:e.items)||(null==l?void 0:l.items)||[]).map(e=>({...e,tag:e.category_name||"国产",comment_count:e.comment_count||Math.floor(10*Math.random()),is_hot:e.view_count>1e5}))}catch(a){}finally{Ne.value=!1}},Re=()=>{he.value.trim()&&((e=>{if(!e||!e.trim())return;const a=e.trim(),l=xe.value.filter(e=>e!==a);l.unshift(a),xe.value=l.slice(0,20);try{localStorage.setItem(me,JSON.stringify(xe.value))}catch(s){}})(he.value),pe.push({path:"/user/search-result",query:{keyword:he.value.trim()}}))},Ve=e=>{he.value=e,Re()},qe=e=>{pe.push(`/user/video/${e}`)},Fe=()=>{},Ke=e=>{if(!e)return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},Ue=()=>{ge.value&&(ke.value=ge.value.offsetHeight-2)};return a(()=>{(()=>{try{const e=localStorage.getItem(me);e&&(xe.value=JSON.parse(e))}catch(e){xe.value=[]}})(),(async()=>{try{const e=await h.get("/ads/icons");e.data&&e.data.length>0&&($e.value=e.data.slice(0,5),He.value=e.data.slice(5))}catch(e){}})(),Pe(),Oe.value.length>0&&(he.value=Oe.value[0]),l(()=>{Ue()}),window.addEventListener("resize",Ue)}),s(()=>{window.removeEventListener("resize",Ue)}),(e,a)=>(g(),i("div",_,[t("div",{class:"sticky-top-area",ref_key:"stickyTopRef",ref:ge},[o(y,{"current-page":"search","show-search-box":!0,keyword:he.value,"onUpdate:keyword":a[0]||(a[0]=e=>he.value=e),placeholder:Oe.value[0]||"搜索",onSearch:Re},null,8,["keyword","placeholder"])],512),$e.value.length>0&&$e.value.some(e=>!e._imgError)?(g(),i("div",w,[t("div",f,[(g(!0),i(n,null,c($e.value,e=>(g(),i("div",{class:d(["ad-item",{hidden:e._imgError}]),key:e.id,onClick:a=>Le(e)},[t("div",C,[t("img",{src:e.image,onError:a=>e._imgError=!0},null,40,E)]),t("span",S,k(e.name),1)],10,b))),128))]),He.value.length>0&&He.value.some(e=>!e._imgError)?(g(),i("div",M,[t("div",T,[t("div",j,[(g(!0),i(n,null,c(He.value,e=>(g(),i("div",{class:d(["ad-item",{hidden:e._imgError}]),key:"a-"+e.id,onClick:a=>Le(e)},[t("div",x,[t("img",{src:e.image,onError:a=>e._imgError=!0},null,40,z)]),t("span",$,k(e.name),1)],10,I))),128)),(g(!0),i(n,null,c(He.value,e=>(g(),i("div",{class:d(["ad-item",{hidden:e._imgError}]),key:"b-"+e.id,onClick:a=>Le(e)},[t("div",L,[t("img",{src:e.image,onError:a=>e._imgError=!0},null,40,O)]),t("span",W,k(e.name),1)],10,H))),128))])])])):r("",!0)])):r("",!0),xe.value.length>0?(g(),i("div",J,[t("div",{class:"section-header"},[a[3]||(a[3]=t("h3",{class:"section-title"},"搜索记录",-1)),t("div",{class:"clear-btn",onClick:ze},[...a[2]||(a[2]=[t("img",{src:"/images/backgrounds/ic_search_clear.webp",alt:"清除",class:"clear-icon"},null,-1)])])]),t("div",N,[(g(!0),i(n,null,c(xe.value,(e,a)=>(g(),i("span",{class:"history-tag",key:a,onClick:a=>Ve(e)},k(e),9,P))),128))])])):r("",!0),t("div",R,[a[4]||(a[4]=t("h3",{class:"section-title"},[t("span",{class:"title-bar"}),u(" 热门搜索 ")],-1)),t("div",V,[(g(!0),i(n,null,c(Oe.value,(e,a)=>(g(),i("div",{class:"hot-item",key:a,onClick:a=>Ve(e)},[t("span",{class:d(["rank",`rank-${a+1}`])},[0===a?(g(),i("img",F)):1===a?(g(),i("img",K)):2===a?(g(),i("img",U)):(g(),i(n,{key:3},[u(k(a+1),1)],64))],2),t("span",A,k(e),1)],8,q))),128))])]),Je.value.length>0?(g(),i(n,{key:2},[t("div",{class:"filter-bar",style:v({top:ke.value+"px"})},[t("div",B,[(g(!0),i(n,null,c(We.value,(e,a)=>(g(),i("span",{key:e.key,class:d(["filter-item",{active:ye.value===a}]),onClick:e=>(e=>{ye.value!==e&&(ye.value=e,Pe())})(a)},k(e.label),11,D))),128))]),t("div",{class:"view-toggle",onClick:a[1]||(a[1]=e=>we.value=1===we.value?2:1)},[a[7]||(a[7]=t("span",{class:"toggle-label"},"切换",-1)),1===we.value?(g(),i("span",G,[...a[5]||(a[5]=[t("i",null,null,-1),t("i",null,null,-1),t("i",null,null,-1)])])):(g(),i("span",Q,[...a[6]||(a[6]=[t("i",null,null,-1),t("i",null,null,-1),t("i",null,null,-1),t("i",null,null,-1)])]))])],4),t("div",X,[t("div",{class:d(["video-list",1===we.value?"single-column":"double-column"])},[(g(!0),i(n,null,c(Je.value,e=>{return g(),i("div",{key:e.id,class:"video-card",onClick:a=>je(e),onMouseenter:a=>(e=>{e.preview_url&&!Ee.value&&(be.value=e.id,Ce&&clearTimeout(Ce),Ce=setTimeout(()=>{be.value===e.id&&Me(e)},300))})(e),onMouseleave:a=>(e=>{if(!Ee.value&&(Ce&&(clearTimeout(Ce),Ce=null),be.value===e.id)){be.value=null;const a=fe.value[e.id];a&&(a.pause(),a.currentTime=0)}})(e),onTouchstartPassive:Te},[t("div",Z,[t("img",{src:(s=e.cover_url,s?s.startsWith("/")?s:"/"+s:"/placeholder.webp"),alt:e.title,class:d({hidden:Se(e.id)})},null,10,ee),e.preview_url?(g(),i("video",{key:0,ref_for:!0,ref:a=>((e,a)=>{a&&(fe.value[e]=a)})(e.id,a),src:Ie(e.preview_url),class:d(["preview-video",{visible:Se(e.id)}]),muted:"",loop:"",playsinline:"",preload:"metadata"},null,10,ae)):r("",!0),t("div",le,[a[8]||(a[8]=t("span",{class:"play-icon"},"▶",-1)),t("span",null,k((l=e.view_count,l?l>=1e4?(l/1e4).toFixed(1)+"W":l.toString():"0")),1)]),t("div",se,k(Ke(e.duration)),1),e.is_vip_only?(g(),i("div",ie,"VIP")):r("",!0)]),t("div",te,[t("p",re,k(e.title),1),t("div",oe,[e.tags&&e.tags.length>0?(g(),i("span",ne,k(e.tags[0]),1)):e.category_name?(g(),i("span",ce,k(e.category_name),1)):e.tag?(g(),i("span",ue,k(e.tag),1)):(g(),i("span",ve,"精选")),t("span",de,"评论 "+k(e.comment_count||0),1)])])],40,Y);var l,s}),128))],2),_e.value&&Je.value.length?(g(),i("div",{key:0,class:"load-more",onClick:Fe}," 加载更多 ")):r("",!0)])],64)):r("",!0)]))}},[["__scopeId","data-v-1f1e514f"]]);export{ge as default};
