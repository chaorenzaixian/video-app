import{_ as e}from"./ic_search-_iX1dTi8.js";import{_ as a,a as l,b as s,c as t}from"./publish_img_text-DofjLvxr.js";import{y as i,I as o,M as c,aa as n,C as r,U as u,u as v,L as d,H as m,z as p,r as y,c as g,j as h,az as k,X as b,O as C,F as f,ai as _,E as w,aC as $,V as I,n as j}from"./vue-vendor-Ba_vealp.js";import{_ as A,a as N}from"./index-C3P4JTuA.js";import{d as x,f as E}from"./format-s96t4k9e.js";import{u as G}from"./useAbortController-pf-gfr0d.js";import{a as P}from"./useDebounce-CYVAMXBc.js";import{B as T}from"./BottomNav-CoGs_HZ2.js";import{I as B}from"./IconAdsGrid-DwXH5auI.js";import{g as M}from"./avatar-DXHBWedi.js";import{g as z}from"./vip-C8N2TCfr.js";import"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const L={class:"posts-list"},D=["onClick"],q={class:"post-header"},F=["src","onClick"],O={class:"user-info"},S={class:"user-name-row"},V=["onClick"],H=["src"],U={class:"time"},X={class:"post-text"},J={key:0,class:"post-images"},K=["src"],Q={key:0,class:"more-count"},R={class:"post-stats"},W=["onClick"],Y={key:0,class:"post-topic-tag"},Z={key:0,class:"loading"},ee={key:1,class:"no-more"},ae={key:2,class:"empty"},le=A({__name:"PostList",props:{posts:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!0}},emits:["detail","profile","like"],setup:e=>(a,l)=>(p(),i("div",L,[(p(!0),i(c,null,n(e.posts,e=>{var l,s,t,y,g,h,k,b;return p(),i("div",{key:e.id,class:"post-card",onClick:l=>a.$emit("detail",e.id)},[r("div",q,[r("img",{src:v(M)(null==(l=e.user)?void 0:l.avatar,null==(s=e.user)?void 0:s.id),class:"avatar clickable",onClick:u(l=>{var s;return a.$emit("profile",null==(s=e.user)?void 0:s.id)},["stop"])},null,8,F),r("div",O,[r("div",S,[r("span",{class:"username clickable",onClick:u(l=>{var s;return a.$emit("profile",null==(s=e.user)?void 0:s.id)},["stop"])},d((null==(t=e.user)?void 0:t.nickname)||(null==(y=e.user)?void 0:y.username)||"åŒ¿åç”¨æˆ·"),9,V),(null==(g=e.user)?void 0:g.is_vip)?(p(),i("img",{key:0,src:v(z)(null==(h=e.user)?void 0:h.vip_level),class:"vip-icon",alt:"VIP"},null,8,H)):o("",!0)]),r("span",U,d(v(x)(e.created_at)),1)])]),r("p",X,d(e.content),1),(null==(k=e.images)?void 0:k.length)?(p(),i("div",J,[r("div",{class:m(["images-grid",`grid-${Math.min(e.images.length,4)}`])},[(p(!0),i(c,null,n(e.images.slice(0,4),(a,l)=>(p(),i("div",{key:l,class:"img-item"},[r("img",{src:a},null,8,K),3===l&&e.images.length>4?(p(),i("span",Q,"+"+d(e.images.length-4),1)):o("",!0)]))),128))],2)])):o("",!0),r("div",R,[r("span",null,"ðŸ‘ "+d(v(E)(e.view_count)),1),r("span",null,"ðŸ’¬ "+d(e.comment_count||0),1),r("span",{onClick:u(l=>a.$emit("like",e),["stop"])},d(e.is_liked?"â¤ï¸":"ðŸ¤")+" "+d(v(E)(e.like_count)),9,W),(null==(b=e.topics)?void 0:b.length)?(p(),i("span",Y,"#"+d(e.topics[0].name),1)):o("",!0)])],8,D)}),128)),e.loading?(p(),i("div",Z,"åŠ è½½ä¸­...")):o("",!0),e.loading||e.hasMore||!e.posts.length?o("",!0):(p(),i("div",ee,"æ²¡æœ‰æ›´å¤šäº†")),e.loading||e.posts.length?o("",!0):(p(),i("div",ae,"æš‚æ— å†…å®¹"))]))},[["__scopeId","data-v-4bdb8cdc"]]),se={class:"gallery-list"},te={key:0,class:"loading"},ie={key:1,class:"empty"},oe={key:2,class:"gallery-grid"},ce=["onClick"],ne={class:"gallery-cover"},re=["src","alt"],ue={class:"gallery-info"},ve={class:"views"},de={class:"count"},me={key:0,class:"gallery-status"},pe={class:"gallery-title"},ye=A({__name:"GalleryList",props:{items:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["detail"],setup:e=>(a,l)=>(p(),i("div",se,[e.loading?(p(),i("div",te,"åŠ è½½ä¸­...")):e.items.length?(p(),i("div",oe,[(p(!0),i(c,null,n(e.items,e=>(p(),i("div",{key:e.id,class:"gallery-item",onClick:l=>a.$emit("detail",e.id)},[r("div",ne,[r("img",{src:e.cover,alt:e.title},null,8,re),r("div",ue,[r("span",ve,"ðŸ‘ "+d(v(E)(e.views)),1),r("span",de,"ðŸ“· "+d(e.count),1)]),"ongoing"===e.status?(p(),i("div",me,"è¿žè½½ä¸­")):o("",!0)]),r("p",pe,d(e.title),1)],8,ce))),128))])):(p(),i("div",ie,"æš‚æ— å›¾é›†"))]))},[["__scopeId","data-v-df935861"]]),ge={class:"novel-list"},he={key:0,class:"loading"},ke={key:1,class:"empty"},be={key:2,class:"novel-grid"},Ce=["onClick"],fe={class:"novel-cover-wrap"},_e=["src","alt"],we={key:0,class:"audio-badge"},$e={key:1,class:"novel-status"},Ie={class:"novel-info"},je={class:"novel-title"},Ae={class:"novel-author"},Ne={class:"novel-chapters"},xe=A({__name:"NovelList",props:{items:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},isAudio:{type:Boolean,default:!1}},emits:["detail"],setup:e=>(a,l)=>(p(),i("div",ge,[e.loading?(p(),i("div",he,"åŠ è½½ä¸­...")):e.items.length?(p(),i("div",be,[(p(!0),i(c,null,n(e.items,l=>(p(),i("div",{key:l.id,class:"novel-item",onClick:e=>a.$emit("detail",l)},[r("div",fe,[r("img",{src:l.cover,alt:l.title,class:"novel-cover"},null,8,_e),e.isAudio?(p(),i("span",we,"ðŸŽ§")):o("",!0),"ongoing"===l.status?(p(),i("div",$e,"è¿žè½½ä¸­")):o("",!0)]),r("div",Ie,[r("p",je,d(l.title),1),r("p",Ae,d(l.author),1),r("p",Ne,"å…±"+d(l.chapters)+"ç« ",1)])],8,Ce))),128))])):(p(),i("div",ke,"æš‚æ— å°è¯´"))]))},[["__scopeId","data-v-b895b376"]]),Ee={class:"publish-types"},Ge=A({__name:"PublishModal",props:{visible:{type:Boolean,default:!1}},emits:["close","publish"],setup:e=>(t,c)=>e.visible?(p(),i("div",{key:0,class:"publish-modal-overlay",onClick:c[4]||(c[4]=e=>t.$emit("close"))},[r("div",{class:"publish-modal",onClick:c[3]||(c[3]=u(()=>{},["stop"]))},[c[8]||(c[8]=r("div",{class:"modal-handle"},null,-1)),c[9]||(c[9]=r("h3",{class:"modal-title"},"é€‰æ‹©å‘å¸ƒç±»åž‹",-1)),r("div",Ee,[r("div",{class:"publish-type-item",onClick:c[0]||(c[0]=e=>t.$emit("publish","image"))},[...c[5]||(c[5]=[r("img",{src:a,alt:"å›¾ç‰‡",class:"type-icon"},null,-1),r("span",{class:"type-label"},"å›¾ç‰‡",-1)])]),r("div",{class:"publish-type-item",onClick:c[1]||(c[1]=e=>t.$emit("publish","video"))},[...c[6]||(c[6]=[r("img",{src:l,alt:"è§†é¢‘",class:"type-icon"},null,-1),r("span",{class:"type-label"},"è§†é¢‘",-1)])]),r("div",{class:"publish-type-item",onClick:c[2]||(c[2]=e=>t.$emit("publish","text-image"))},[...c[7]||(c[7]=[r("img",{src:s,alt:"å›¾æ–‡",class:"type-icon"},null,-1),r("span",{class:"type-label"},"å›¾æ–‡",-1)])])])])])):o("",!0)},[["__scopeId","data-v-ded2b63e"]]);const Pe={class:"top-header"},Te={class:"main-tabs"},Be=["onClick"],Me=["src","alt"],ze={key:1,class:"tab-text"},Le={key:0,class:"category-tabs"},De={class:"category-scroll"},qe=["onClick"],Fe={key:1,class:"category-tabs"},Oe={class:"category-scroll"},Se=["onClick"],Ve={key:2,class:"novel-type-tabs"},He={class:"type-tabs"},Ue={class:"category-scroll"},Xe=["onClick"],Je={key:0,class:"topic-cards"},Ke={class:"topic-grid"},Qe=["onClick"],Re={class:"topic-name"},We={class:"topic-count"},Ye={class:"filter-tabs"},Ze=["onClick"],ea={class:"content-area"},aa=A(Object.assign({name:"Community"},{__name:"index",setup(a){const l=$(),s=k(),{signal:u}=G(),{withLock:A}=P(),x=y(null),M=[{label:"ç¤¾åŒº",value:"community",activeIcon:"/images/backgrounds/tab_one_active.webp"},{label:"å›¾é›†",value:"gallery",activeIcon:"/images/backgrounds/tab_two_active.webp"},{label:"å°è¯´",value:"novel",activeIcon:"/images/backgrounds/tab_three_active.webp"}],z=[{label:"æŽ¨è",value:"recommend"},{label:"æœ€æ–°",value:"latest"},{label:"çƒ­è¯„",value:"hot_comment"},{label:"æœ€çƒ­",value:"hot"},{label:"è§†é¢‘",value:"video"}],L=y("community"),D=y([]),q=y(!1),{topCategories:F,selectedCategory:O,selectedTopic:S,currentSubTopics:V,posts:H,loading:U,hasMore:X,activeFilter:J,fetchCategories:K,fetchPosts:Q,likePost:R,selectCategory:W}=function(e){const a=y([]),l=y([]),s=y({}),t=y(null),i=y(null),o=y([]),c=y(!1),n=y(!0),r=y(1),u=y("recommend"),v=g(()=>{if(!t.value)return[];const e=a.value.find(e=>e.id===t.value);return(null==e?void 0:e.children)||[]}),d=async()=>{try{const a=(await N.get("/community/topics",{params:{page_size:30},signal:e})).data||[];l.value=a.map(e=>({id:e.id,name:e.name})),a.length>0&&!t.value&&(t.value=a[0].id),a.forEach(e=>{s.value[e.id]=e.name})}catch(a){"AbortError"!==a.name&&a.name}},m=async(a=!1)=>{if(!c.value&&(a&&(r.value=1,n.value=!0,o.value=[]),n.value)){c.value=!0;try{const l={page:r.value,page_size:20,feed_type:"video"===u.value?"recommend":u.value};i.value&&(l.topic_id=i.value);const s=(await N.get("/community/posts",{params:l,signal:e})).data||[];s.length<20&&(n.value=!1),o.value=a?s:[...o.value,...s],r.value++}catch(l){"AbortError"!==l.name&&l.name}finally{c.value=!1}}};return{categoriesData:a,topCategories:l,topicsMap:s,selectedCategory:t,selectedTopic:i,currentSubTopics:v,posts:o,loading:c,hasMore:n,activeFilter:u,fetchCategories:async()=>{try{const i=(await N.get("/community/topics/categories",{signal:e})).data||[];a.value=i,l.value=i.map(e=>({id:e.id,name:e.name,icon:e.icon})),i.length>0&&!t.value&&(t.value=i[0].id),i.forEach(e=>{s.value[e.id]=e.name,e.children&&e.children.forEach(e=>{s.value[e.id]=e.name})})}catch(i){"AbortError"!==i.name&&"CanceledError"!==i.name&&await d()}},fetchPosts:m,likePost:async a=>{try{const l=await N.post(`/community/posts/${a.id}/like`,null,{signal:e});a.is_liked=l.data.liked,a.like_count=l.data.like_count}catch(l){"AbortError"!==l.name&&l.name}},selectCategory:e=>{t.value=e.id,i.value=null,m(!0)}}}(u),{galleryCategories:Y,selectedGalleryCategory:Z,galleryItems:ee,loading:ae,fetchGalleryCategories:se,fetchGalleries:te,selectGalleryCategory:ie}=function(e){const a=y([]),l=y(null),s=y([]),t=y(!1),i=async()=>{t.value=!0;try{const a={page:1,page_size:30};l.value&&(a.category_id=l.value);const t=await N.get("/gallery-novel/gallery/list",{params:a,signal:e});s.value=(t.data||[]).map(e=>({id:e.id,title:e.title,cover:e.cover,views:e.view_count,count:e.image_count,status:e.status}))}catch(a){"AbortError"!==a.name&&a.name}finally{t.value=!1}};return{galleryCategories:a,selectedGalleryCategory:l,galleryItems:s,loading:t,fetchGalleryCategories:async()=>{try{const l=await N.get("/gallery-novel/gallery/categories",{signal:e});a.value=[{id:null,name:"å…¨éƒ¨"},...l.data||[]]}catch(l){"AbortError"!==l.name&&l.name}},fetchGalleries:i,selectGalleryCategory:e=>{l.value=e,i()}}}(u),{novelCategories:oe,selectedNovelType:ce,selectedNovelCategory:ne,novelItems:re,loading:ue,fetchNovelCategories:ve,fetchNovels:de,switchNovelType:me,selectNovelCategory:pe}=function(e){const a=y([]),l=y("text"),s=y(null),t=y([]),i=y(!1),o=async()=>{try{const s=await N.get("/gallery-novel/novel/categories",{params:{novel_type:l.value},signal:e});a.value=[{id:null,name:"å…¨éƒ¨"},...s.data||[]]}catch(s){"AbortError"!==s.name&&s.name}},c=async()=>{i.value=!0;try{const a={page:1,page_size:30,novel_type:l.value};s.value&&(a.category_id=s.value);const i=await N.get("/gallery-novel/novel/list",{params:a,signal:e});t.value=(i.data||[]).map(e=>({id:e.id,title:e.title,author:e.author||"ä½šå",cover:e.cover,chapters:e.chapter_count,status:e.status}))}catch(a){"AbortError"!==a.name&&a.name}finally{i.value=!1}};return{novelCategories:a,selectedNovelType:l,selectedNovelCategory:s,novelItems:t,loading:i,fetchNovelCategories:o,fetchNovels:c,switchNovelType:e=>{l.value=e,s.value=null,o(),c()},selectNovelCategory:e=>{s.value=e,c()}}}(u),ge=async e=>{await A(`like_post_${e.id}`,()=>R(e))},he=e=>l.push(`/user/community/post/${e}`),ke=e=>{e&&l.push(`/user/member/${e}`)},be=e=>l.push(`/user/gallery/${e}`),Ce=e=>{l.push("audio"===ce.value?`/user/audio-novel/${e.id}`:`/user/novel/${e.id}`)},fe=e=>{q.value=!1;l.push({image:"/user/publish/image",video:"/user/publish/video","text-image":"/user/publish/text-image"}[e])};return h(()=>{const e=s.query.tab;e&&["community","gallery","novel"].includes(e)&&(L.value=e);const a=s.query.type;a&&["text","audio"].includes(a)&&(ce.value=a),(async()=>{try{const e=await N.get("/ads/icons",{signal:u});D.value=e.data||[]}catch(e){}})(),K(),se(),ve(),"community"===L.value?Q(!0):"gallery"===L.value?te():"novel"===L.value&&de()}),b(async()=>{await j(),x.value&&(x.value.scrollTop=0)}),(a,s)=>{const u=_("router-link");return p(),i("div",{class:"community-page",ref_key:"scrollContainer",ref:x},[r("header",Pe,[r("div",Te,[(p(),i(c,null,n(M,e=>r("div",{key:e.value,class:m(["tab-item",{active:L.value===e.value}]),onClick:a=>(e=>{L.value=e,"community"===e?Q(!0):"gallery"===e?te():"novel"===e&&de()})(e.value)},[L.value===e.value&&e.activeIcon?(p(),i("img",{key:0,src:e.activeIcon,alt:e.label,class:"tab-icon"},null,8,Me)):(p(),i("span",ze,d(e.label),1))],10,Be)),64)),C(u,{to:"/user/search",class:"search-btn"},{default:f(()=>[...s[4]||(s[4]=[r("img",{src:e,alt:"æœç´¢"},null,-1)])]),_:1})]),"community"===L.value?(p(),i("div",Le,[r("div",De,[(p(!0),i(c,null,n(v(F),e=>(p(),i("span",{key:e.id,class:m(["category-tab",{active:v(O)===e.id}]),onClick:a=>v(W)(e)},d(e.name),11,qe))),128))])])):o("",!0),"gallery"===L.value?(p(),i("div",Fe,[r("div",Oe,[(p(!0),i(c,null,n(v(Y),e=>(p(),i("span",{key:e.id,class:m(["category-tab",{active:v(Z)===e.id}]),onClick:a=>v(ie)(e.id)},d(e.name),11,Se))),128))])])):o("",!0),"novel"===L.value?(p(),i("div",Ve,[r("div",He,[r("span",{class:m(["type-tab",{active:"text"===v(ce)}]),onClick:s[0]||(s[0]=e=>v(me)("text"))},"æ–‡å­—å°è¯´",2),r("span",{class:m(["type-tab",{active:"audio"===v(ce)}]),onClick:s[1]||(s[1]=e=>v(me)("audio"))},"æœ‰å£°å°è¯´",2)]),r("div",Ue,[(p(!0),i(c,null,n(v(oe),e=>(p(),i("span",{key:e.id,class:m(["category-tab",{active:v(ne)===e.id}]),onClick:a=>v(pe)(e.id)},d(e.name),11,Xe))),128))])])):o("",!0),C(B,{ads:D.value},null,8,["ads"]),"community"===L.value?(p(),i(c,{key:3},[v(V).length?(p(),i("div",Je,[r("div",Ke,[(p(!0),i(c,null,n(v(V),e=>(p(),i("div",{key:e.id,class:m(["topic-card",{active:v(S)===e.id}]),style:I(e.cover?{backgroundImage:`url(${e.cover})`}:{}),onClick:a=>(e=>{l.push({path:`/user/community/topic/${e.id}`,query:{name:e.name}})})(e)},[r("span",Re,d(e.name),1),r("span",We,d(v(E)(e.post_count))+"ä¸ªå¸–å­",1)],14,Qe))),128))])])):o("",!0),r("div",Ye,[(p(),i(c,null,n(z,e=>r("span",{key:e.value,class:m(["filter-tab",{active:v(J)===e.value}]),onClick:a=>{return l=e.value,J.value=l,void Q(!0);var l}},d(e.label),11,Ze)),64))])],64)):o("",!0)]),r("div",ea,["community"===L.value?(p(),w(le,{key:0,posts:v(H),loading:v(U),"has-more":v(X),onDetail:he,onProfile:ke,onLike:ge},null,8,["posts","loading","has-more"])):"gallery"===L.value?(p(),w(ye,{key:1,items:v(ee),loading:v(ae),onDetail:be},null,8,["items","loading"])):"novel"===L.value?(p(),w(xe,{key:2,items:v(re),loading:v(ue),"is-audio":"audio"===v(ce),onDetail:Ce},null,8,["items","loading","is-audio"])):o("",!0)]),"community"===L.value?(p(),i("div",{key:0,class:"publish-btn",onClick:s[2]||(s[2]=e=>q.value=!0)},[...s[5]||(s[5]=[r("img",{src:t,alt:"å‘å¸ƒ",class:"publish-icon"},null,-1)])])):o("",!0),C(Ge,{visible:q.value,onClose:s[3]||(s[3]=e=>q.value=!1),onPublish:fe},null,8,["visible"]),C(T)],512)}}}),[["__scopeId","data-v-9a88ebc0"]]);export{aa as default};
