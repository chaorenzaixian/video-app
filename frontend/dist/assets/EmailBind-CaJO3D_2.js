import{r as a,c as e,j as l,y as s,C as u,I as t,L as i,G as c,af as d,H as n,aC as v,z as o}from"./vue-vendor-Ba_vealp.js";import{_ as r}from"./ic_back-BPdSG6fy.js";import{_ as p,u as m,a as b}from"./index-C3P4JTuA.js";import{E as f}from"./element-plus-DlIn_qXi.js";import"./utils-DflAyOWx.js";const h={class:"email-bind-page"},y={class:"page-header"},g={key:0,class:"info-banner success"},k={class:"info-text"},_={class:"email"},w={class:"form-section"},x={class:"form-item"},j=["placeholder"],C={class:"form-item"},I=["disabled"],U={key:0,class:"debug-tip"},$={class:"debug-text"},E={class:"debug-code"},V=p({__name:"EmailBind",setup(p){const V=v(),z=m(),B=a(""),G=a(""),H=a(0),L=a(!1),O=a(!1);let q=null;const A=e(()=>{var a;return null==(a=z.user)?void 0:a.email}),D=e(()=>{const a=A.value;if(!a)return"";const e=a.indexOf("@");return e<=2?a:a.slice(0,2)+"***"+a.slice(e-1)}),F=e(()=>/^[\w.-]+@[\w.-]+\.\w+$/.test(B.value)),J=e(()=>F.value&&G.value.length>=4),K=a(""),M=async()=>{var a,e,l,s;if(!(H.value>0||!F.value||O.value)){O.value=!0,K.value="";try{const l=await b.post("/auth/email/send-code",null,{params:{email:B.value,code_type:"bind"}});(null==(a=l.data)?void 0:a.code)?(K.value=l.data.code,G.value=l.data.code,f({message:`è°ƒè¯•æ¨¡å¼ï¼šéªŒè¯ç  ${l.data.code} å·²è‡ªåŠ¨å¡«å…¥`,type:"success",duration:5e3})):f.success((null==(e=l.data)?void 0:e.message)||"éªŒè¯ç å·²å‘é€"),H.value=60,q=setInterval(()=>{H.value--,H.value<=0&&clearInterval(q)},1e3)}catch(u){f.error((null==(s=null==(l=u.response)?void 0:l.data)?void 0:s.detail)||"å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{O.value=!1}}},N=async()=>{var a,e;if(J.value&&!L.value){L.value=!0;try{await b.post("/auth/email/verify-code",null,{params:{email:B.value,code:G.value,code_type:"bind"}}),await b.put("/users/me",{email:B.value}),await z.fetchUser(),f.success("é‚®ç®±ç»‘å®šæˆåŠŸ"),V.back()}catch(l){f.error((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.detail)||"ç»‘å®šå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{L.value=!1}}};return l(()=>{z.fetchUser()}),(a,e)=>(o(),s("div",h,[u("header",y,[u("div",{class:"back-btn",onClick:e[0]||(e[0]=e=>a.$router.back())},[...e[3]||(e[3]=[u("img",{src:r,alt:"è¿”å›",class:"back-icon"},null,-1)])]),e[4]||(e[4]=u("h1",{class:"page-title"},"ç»‘å®šé‚®ç®±",-1)),e[5]||(e[5]=u("div",{class:"header-right"},null,-1))]),A.value?(o(),s("div",g,[e[7]||(e[7]=u("div",{class:"info-icon"},"âœ…",-1)),u("div",k,[e[6]||(e[6]=u("span",null,"æ‚¨å·²ç»‘å®šé‚®ç®±",-1)),u("span",_,i(D.value),1)])])):t("",!0),u("div",w,[u("div",x,[e[8]||(e[8]=u("span",{class:"form-label"},"é‚®ç®±",-1)),c(u("input",{type:"email","onUpdate:modelValue":e[1]||(e[1]=a=>B.value=a),placeholder:A.value?"è¯·è¾“å…¥æ–°é‚®ç®±åœ°å€":"è¯·è¾“å…¥é‚®ç®±åœ°å€"},null,8,j),[[d,B.value]])]),u("div",C,[e[9]||(e[9]=u("span",{class:"form-label"},"éªŒè¯ç ",-1)),c(u("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>G.value=a),placeholder:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç ",maxlength:"6"},null,512),[[d,G.value]]),u("div",{class:n(["code-btn",{disabled:H.value>0||!F.value||O.value}]),onClick:M},i(O.value?"å‘é€ä¸­...":H.value>0?`${H.value}s`:"è·å–éªŒè¯ç "),3)]),u("button",{class:"bind-btn",onClick:N,disabled:!J.value||L.value},i(L.value?"ç»‘å®šä¸­...":A.value?"æ›´æ¢ç»‘å®š":"ç«‹å³ç»‘å®š"),9,I),K.value?(o(),s("div",U,[e[11]||(e[11]=u("div",{class:"debug-icon"},"ğŸ”§",-1)),u("div",$,[e[10]||(e[10]=u("span",null,"è°ƒè¯•æ¨¡å¼ - éªŒè¯ç å·²è‡ªåŠ¨å¡«å…¥",-1)),u("span",E,i(K.value),1)])])):t("",!0),e[12]||(e[12]=u("div",{class:"tips"},[u("p",null,"ğŸ“§ ç»‘å®šé‚®ç®±åå¯é€šè¿‡é‚®ç®±æ‰¾å›è´¦å·"),u("p",null,"ğŸ”’ éªŒè¯ç å°†å‘é€åˆ°æ‚¨è¾“å…¥çš„é‚®ç®±åœ°å€"),u("p",null,"â° éªŒè¯ç æœ‰æ•ˆæœŸ10åˆ†é’Ÿ")],-1))])]))}},[["__scopeId","data-v-dc50dd23"]]);export{V as default};
