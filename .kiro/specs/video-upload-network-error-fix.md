# ç®¡ç†åå°ä¸Šä¼ è§†é¢‘ç½‘ç»œé”™è¯¯ä¿®å¤æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜æè¿°

**ç—‡çŠ¶**: ç®¡ç†åå°ä¸Šä¼ è§†é¢‘æ—¶å‡ºç°ç½‘ç»œé”™è¯¯ï¼Œè¯¢é—®é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†8000ç«¯å£

**å½±å“**: 
- ç®¡ç†å‘˜æ— æ³•ä¸Šä¼ è§†é¢‘å†…å®¹
- å½±å“å†…å®¹æ›´æ–°å’Œå¹³å°è¿è¥
- ç”¨æˆ·ä½“éªŒå—æŸ

## ğŸ” é—®é¢˜åˆ†æ

### æŠ€æœ¯æ ˆåˆ†æ
- **åç«¯**: FastAPIè¿è¡Œåœ¨8000ç«¯å£
- **å‰ç«¯**: Vue.jsé€šè¿‡Nginxåå‘ä»£ç†è®¿é—®åç«¯
- **ä»£ç†é…ç½®**: Nginxå°†`/api`è¯·æ±‚è½¬å‘åˆ°`http://127.0.0.1:8000`

### å¯èƒ½åŸå› 

#### 1. åç«¯æœåŠ¡é—®é¢˜
- 8000ç«¯å£æœåŠ¡æœªå¯åŠ¨æˆ–å´©æºƒ
- Pythonè¿›ç¨‹å¼‚å¸¸é€€å‡º
- ç«¯å£è¢«å…¶ä»–è¿›ç¨‹å ç”¨

#### 2. ç½‘ç»œé…ç½®é—®é¢˜
- é˜²ç«å¢™é˜»æ­¢8000ç«¯å£è®¿é—®
- Nginxåå‘ä»£ç†é…ç½®é”™è¯¯
- CORSè·¨åŸŸé…ç½®ä¸å®Œæ•´

#### 3. æ–‡ä»¶ä¸Šä¼ é™åˆ¶
- Nginxä¸Šä¼ å¤§å°é™åˆ¶ï¼ˆå½“å‰500Mï¼‰
- åç«¯æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆå½“å‰5GBï¼‰
- ç£ç›˜ç©ºé—´ä¸è¶³

#### 4. æƒé™é—®é¢˜
- ä¸Šä¼ ç›®å½•æƒé™ä¸è¶³
- æ–‡ä»¶å†™å…¥æƒé™è¢«æ‹’ç»

## ğŸ› ï¸ ç«‹å³ä¿®å¤æ–¹æ¡ˆ

### æ­¥éª¤1: æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥8000ç«¯å£å ç”¨æƒ…å†µ
netstat -tlnp | grep :8000
# æˆ–è€…ä½¿ç”¨
ss -tlnp | grep :8000

# æ£€æŸ¥Pythonåç«¯è¿›ç¨‹
ps aux | grep python | grep "app.main\|run.py"

# æ£€æŸ¥è¿›ç¨‹ç›‘å¬ç«¯å£
lsof -i :8000
```

**é¢„æœŸç»“æœ**: åº”è¯¥çœ‹åˆ°Pythonè¿›ç¨‹ç›‘å¬8000ç«¯å£

### æ­¥éª¤2: é‡å¯åç«¯æœåŠ¡

```bash
# è¿›å…¥åç«¯ç›®å½•
cd /www/wwwroot/video-app/backend

# åœæ­¢ç°æœ‰æœåŠ¡
pkill -f "run.py" 2>/dev/null
fuser -k 8000/tcp 2>/dev/null

# ç­‰å¾…è¿›ç¨‹å®Œå…¨åœæ­¢
sleep 3

# å¯åŠ¨åç«¯æœåŠ¡
python run.py
# æˆ–è€…ä½¿ç”¨
nohup python run.py > logs/app.log 2>&1 &
```

### æ­¥éª¤3: æ£€æŸ¥é˜²ç«å¢™é…ç½®

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
ufw status

# å¦‚æœé˜²ç«å¢™å¼€å¯ï¼Œç¡®ä¿å…è®¸å†…ç½‘è®¿é—®8000ç«¯å£
ufw allow from 127.0.0.1 to any port 8000
ufw allow from 10.0.0.0/8 to any port 8000
ufw allow from 172.16.0.0/12 to any port 8000
ufw allow from 192.168.0.0/16 to any port 8000

# é‡æ–°åŠ è½½é˜²ç«å¢™è§„åˆ™
ufw reload
```

### æ­¥éª¤4: éªŒè¯Nginxé…ç½®

```bash
# æ£€æŸ¥Nginxé…ç½®è¯­æ³•
nginx -t

# å¦‚æœé…ç½®æœ‰é—®é¢˜ï¼Œé‡æ–°åŠ è½½
nginx -s reload

# æ£€æŸ¥Nginxè¿›ç¨‹çŠ¶æ€
systemctl status nginx
```

### æ­¥éª¤5: æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™

```bash
# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p /www/wwwroot/video-app/backend/uploads/videos
mkdir -p /www/wwwroot/video-app/backend/uploads/thumbnails
mkdir -p /www/wwwroot/video-app/backend/uploads/temp_covers

# è®¾ç½®æ­£ç¡®æƒé™
chmod -R 755 /www/wwwroot/video-app/backend/uploads
chown -R www-data:www-data /www/wwwroot/video-app/backend/uploads

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /www/wwwroot/video-app/backend/uploads
```

### æ­¥éª¤6: æ›´æ–°CORSé…ç½®

ç¼–è¾‘ `backend/app/core/config.py`:

```python
# æ·»åŠ ç”Ÿäº§ç¯å¢ƒåŸŸååˆ°CORSé…ç½®
CORS_ORIGINS: str = "http://localhost:3000,http://localhost:8000,http://127.0.0.1:3000,http://38.47.218.137,https://38.47.218.137"
```

## ğŸ§ª éªŒè¯æµ‹è¯•

### 1. APIè¿é€šæ€§æµ‹è¯•

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
curl -X GET http://127.0.0.1:8000/api/docs

# æµ‹è¯•åŸºç¡€API
curl -X GET http://127.0.0.1:8000/api/v1/videos/categories
```

### 2. ä¸Šä¼ åŠŸèƒ½æµ‹è¯•

```bash
# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
dd if=/dev/zero of=test.mp4 bs=1M count=10

# æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ï¼ˆéœ€è¦æœ‰æ•ˆtokenï¼‰
curl -X POST http://127.0.0.1:8000/api/v1/videos/upload-file \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@test.mp4"
```

### 3. é€šè¿‡æµè§ˆå™¨æµ‹è¯•

1. è®¿é—®ç®¡ç†åå°
2. å°è¯•ä¸Šä¼ å°æ–‡ä»¶ï¼ˆ<10MBï¼‰
3. æ£€æŸ¥æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ç½‘ç»œé¢æ¿
4. æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹å…³é”®æ—¥å¿—

```bash
# åç«¯åº”ç”¨æ—¥å¿—
tail -f /www/wwwroot/video-app/backend/logs/app.log

# Nginxè®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log | grep "/api"

# Nginxé”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log

# ç³»ç»Ÿæ—¥å¿—
journalctl -u nginx -f
```

### å®æ—¶ç›‘æ§

```bash
# ç›‘æ§8000ç«¯å£è¿æ¥
watch -n 1 'netstat -an | grep :8000'

# ç›‘æ§ç£ç›˜ä½¿ç”¨
watch -n 5 'df -h /www/wwwroot/video-app/backend/uploads'

# ç›‘æ§å†…å­˜ä½¿ç”¨
watch -n 2 'ps aux | grep python | grep -v grep'
```

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: ç«¯å£è¢«å ç”¨
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -i :8000
# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 PID
```

### é—®é¢˜2: æƒé™è¢«æ‹’ç»
```bash
# æ£€æŸ¥SELinuxçŠ¶æ€ï¼ˆå¦‚æœå¯ç”¨ï¼‰
sestatus
# ä¸´æ—¶ç¦ç”¨SELinux
setenforce 0
```

### é—®é¢˜3: å†…å­˜ä¸è¶³
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
# æ¸…ç†ç¼“å­˜
echo 3 > /proc/sys/vm/drop_caches
```

### é—®é¢˜4: ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
find /tmp -type f -atime +7 -delete
# æ¸…ç†æ—¥å¿—æ–‡ä»¶
find /var/log -name "*.log" -size +100M -delete
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ä¸Šä¼ ä¼˜åŒ–
- å¯ç”¨åˆ†ç‰‡ä¸Šä¼ 
- å¢åŠ ä¸Šä¼ è¶…æ—¶æ—¶é—´
- ä½¿ç”¨CDNåŠ é€Ÿä¸Šä¼ 

### 2. æœåŠ¡å™¨ä¼˜åŒ–
- å¢åŠ workerè¿›ç¨‹æ•°
- ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± 
- å¯ç”¨Gzipå‹ç¼©

### 3. ç›‘æ§å‘Šè­¦
- è®¾ç½®æœåŠ¡çŠ¶æ€ç›‘æ§
- é…ç½®ç£ç›˜ç©ºé—´å‘Šè­¦
- ç›‘æ§ä¸Šä¼ æˆåŠŸç‡

## ğŸš€ é•¿æœŸè§£å†³æ–¹æ¡ˆ

### æ¶æ„ä¼˜åŒ–
1. **è´Ÿè½½å‡è¡¡**: éƒ¨ç½²å¤šä¸ªåç«¯å®ä¾‹
2. **å®¹å™¨åŒ–**: ä½¿ç”¨Dockeræé«˜ç¨³å®šæ€§
3. **å¾®æœåŠ¡**: åˆ†ç¦»ä¸Šä¼ æœåŠ¡å’Œä¸šåŠ¡é€»è¾‘
4. **å¯¹è±¡å­˜å‚¨**: ä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡

### ç›‘æ§ä½“ç³»
1. **å¥åº·æ£€æŸ¥**: å®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€
2. **æ€§èƒ½ç›‘æ§**: ç›‘æ§å“åº”æ—¶é—´å’Œé”™è¯¯ç‡
3. **æ—¥å¿—èšåˆ**: é›†ä¸­åŒ–æ—¥å¿—ç®¡ç†
4. **å‘Šè­¦é€šçŸ¥**: åŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] ç®¡ç†åå°å¯ä»¥æ­£å¸¸ä¸Šä¼ è§†é¢‘
- [ ] ä¸Šä¼ è¿›åº¦æ˜¾ç¤ºæ­£å¸¸
- [ ] å¤§æ–‡ä»¶ï¼ˆ>100MBï¼‰ä¸Šä¼ æˆåŠŸ
- [ ] é”™è¯¯æç¤ºæ¸…æ™°æ˜ç¡®

### æ€§èƒ½éªŒæ”¶
- [ ] ä¸Šä¼ å“åº”æ—¶é—´ < 5ç§’ï¼ˆ100MBæ–‡ä»¶ï¼‰
- [ ] æœåŠ¡å¯ç”¨æ€§ > 99.9%
- [ ] å†…å­˜ä½¿ç”¨ç¨³å®š
- [ ] ç£ç›˜ç©ºé—´å……è¶³

### ç›‘æ§éªŒæ”¶
- [ ] æ—¥å¿—è®°å½•å®Œæ•´
- [ ] é”™è¯¯å‘Šè­¦åŠæ—¶
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
- [ ] æœåŠ¡çŠ¶æ€å¯è§

---

**åˆ›å»ºæ—¶é—´**: 2026-01-16  
**ä¼˜å…ˆçº§**: ğŸ”¥ ç´§æ€¥  
**é¢„è®¡ä¿®å¤æ—¶é—´**: 30åˆ†é’Ÿ  
**è´Ÿè´£äºº**: ç³»ç»Ÿç®¡ç†å‘˜  
**çŠ¶æ€**: å¾…æ‰§è¡Œ